{"version":3,"sources":["meteor://ðŸ’»app/server/meteor-methods/SCORM-API-Methods.js","meteor://ðŸ’»app/server/meteor-methods/access-duration-log.js","meteor://ðŸ’»app/server/meteor-methods/announcement-methods.js","meteor://ðŸ’»app/server/meteor-methods/assessment-methods.js","meteor://ðŸ’»app/server/meteor-methods/audio-recorder-methods.js","meteor://ðŸ’»app/server/meteor-methods/bug-reports.js","meteor://ðŸ’»app/server/meteor-methods/cg-badge-methods.js","meteor://ðŸ’»app/server/meteor-methods/contact-form.js","meteor://ðŸ’»app/server/meteor-methods/database-queries-methods.js","meteor://ðŸ’»app/server/meteor-methods/dictionary-methods.js","meteor://ðŸ’»app/server/meteor-methods/feedback-forms.js","meteor://ðŸ’»app/server/meteor-methods/forums-methods.js","meteor://ðŸ’»app/server/meteor-methods/group-methods.js","meteor://ðŸ’»app/server/meteor-methods/hub_methods.js","meteor://ðŸ’»app/server/meteor-methods/messaging-methods.js","meteor://ðŸ’»app/server/meteor-methods/notebook-methods.js","meteor://ðŸ’»app/server/meteor-methods/organisation-methods.js","meteor://ðŸ’»app/server/meteor-methods/plan-methods.js","meteor://ðŸ’»app/server/meteor-methods/stripe-charge-NOT-IN-USE.js","meteor://ðŸ’»app/server/meteor-methods/user-account-methods.js","meteor://ðŸ’»app/server/meteor-methods/voucher-methods.js","meteor://ðŸ’»app/server/collections.js","meteor://ðŸ’»app/server/mailchimp.js","meteor://ðŸ’»app/server/publish.js","meteor://ðŸ’»app/server/server.js","meteor://ðŸ’»app/server/sitemaps.js","meteor://ðŸ’»app/server/startup.js","meteor://ðŸ’»app/templates.js"],"names":["Meteor","methods","scorm_Id","user","users","findOne","scormId","Error","userId","update","_id","$set","uId","oldExpiry","currentDate","expiry","Date","setTime","getTime","err","message","subscriberId","adminId","event","daysBefore","daysAfter","duration_log","insert","title","msg","aExpiry","org","organisation","formattedDate","Announcements","author","date","readBy","id","editedBy","upsert","remove","$push","studentId","voucher","Roles","userIsInRole","role","roles","studentAssessments","userRole","name","type","startDate","completeDate","score","assignedBy","pass","sections","answer","A1r","question","answerNumber","answerValue","A2r","B1r","B2r","C1r","wordLimit","playsAllowed","A2l","B1l","B2l","C1l","error","result","userProgress","$addToSet","assessments","A1l","assessmentId","sectionNo","newMark","obj","assessmentDoc","sectionName","assessment","i","length","userAnswers","currentScore","section","getSection","checkAnswers","finalscore","finalScore","updateAnswers","wordCount","wordCountParser","words","doc","checkAllSectionsFinished","validResults","indexOf","tutorId","userDoc","emails","address","userEmail","emailSubject","emailContent","Email","send","to","from","subject","html","updatedDoc","fileId","answerObj","call","finished","assessmentType","assessmentAnswers","initialAssessment","answer1","answer2","answer3","answer4","answer5","answer6","answer7","answer8","answer9","answer10","q1","q2","q3","q4","q5","q6","q7","assessmentTemp","correct","formatAnswer","toLowerCase","trim","acceptedAnswer","k","allowedAnswer","constructor","Array","j","Answer","wrong","x","val","wom","match","charactersNoSpaces","replace","characters","lines","split","uans","hamming_distance","a","b","prim","sec","len","dist","temp","substring","answers","sectionComplete","recording","audioRecordings","ownerId","commentId","comments","commenter","userType","noteId","commentText","comment","device","browser","location","description","uID","d","getDate","slice","getMonth","getFullYear","getHours","getMinutes","bug_reports","status","bugId","progTitle","progId","firstName","lastName","gender","email","dateofbirth","toDateString","CGBadgeData","orgName","fName","lName","recipient","text","receiver","username","msgsubject","msgbody","dayNames","monthNames","dayIndex","getDay","dateNo","monthIndex","year","hours","minutes","messages","formType","contact_form","messageId","checkUser","profile","throwError","searchTerm","HTTP","headers","Accept","app_id","app_key","accessKey","scores","feedback_forms","target","ids","f_forums","groups","newGroup","group","threads","subgroups","newSubgroup","subgroup","$elemMatch","orgId","$pull","organisationId","post","getFormattedDate","currentUser","oldGroupThreads","getGroupThreads","forEach","thread","push","admin","wrongOrg","wrongGroup","student","tutor","newThreads","poster","content","sticky","oldSubgroups","getGroupSubgroups","pushSubgroupThread","threadNo","lock","undefined","subG","newTitle","splice","postNo","newContent","posts","newPost","removeTopic","updateForumPost","moderator","getSubgroupThread","currG","item","groupId","getGroupThread","forumDoc","subgroupId","tutors","students","aName","aTutors","aUsers","aOrganisation","authorised","exists","valueOf","subgroupName","duplicates","find","$and","count","updated","old","currStudents","elem","crypto","require","password","iv","console","log","cipher","createCipheriv","encrypted","final","decipher","createDecipheriv","dec","mID","sender","currentConv","p1","p2_unread","p1_unread","p1_visible","p2_visible","body","userNotes","noteAuthor","noteDate","noteTitle","noteBody","note","Random","updatedComment","organisations","code","orgLogoAlt","logoAlt","payment_plans","fetch","packageId","planId","submittedCode","selectedVouchers","vouchers","usedVouchers","appliedVouchers","active","limitedUsage","usageAmount","Trial","Demo","aFirstname","aSurname","aUsername","aEmail","aAuthorised","aRole","firstname","surname","authorisedCourses","certificateEnabled","orgDoc","isValidEmailAddress","Accounts","createUser","addUsersToRoles","sendEnrollmentEmail","createUserProgress","newUserObj","registration","userName","cert","sendVerificationEmail","module","activity","currentActivityDB","modules","activities","dateEndedField","dateEnded","dateSta","compl","key_compl","completed","obj2","dateStartedField","dateStarted","completedField","now","currActivityDB","key","moment","datePau","datePaused","dateRes","dateResumed","timeTaken","time","parseInt","dateRes_bare","dateEnd","mod","lastActivityStr","lastActivity","activityCompleted","getNextActivity","subpage","activityObj","subpageField","notificationModule","moduleFinishedNotification","checkCompletedGame","checkModuleFinishedActivities","setModuleCompletionField","unit","feedbackForms","unitFeedbackForms","checkUnitCompleted","setUnitFeedbackFormStatus","checkTrophyCompletion","orgArray","progress","getPercentageComplete","timeSpent","getTimeTaken","hoursSpent","allGamesCompleted","checkAllCompletedGames","progressCompletion","checkProgressCompletion","setUserProgressCompletionNotification","setUserProgressHalfCompletionNotification","module_","score_","dateCompleted","gameAccess","passedTest","aUser","options","check","String","setUserRoles","exception","sendResetPasswordEmail","oldPass","newPass","changePassword","setPassword","data","courses","autoPassAssessment","state","modulesFinishedNotification","trophyIndex","trophyAchieved","details","user_id","stampedLoginToken","_generateStampedLoginToken","_insertLoginToken","findUserByEmail","course","latestSubpage","timeCompleted","timeStarted","emailAddress","pattern","RegExp","test","actObj","extractModActNum","modNum","actNum","userProg","nextAct","nextActStr","passed","toString","activityIsGame","getGameStr","activityStr","actStr","gameActs","checkCompletedUnit","moduleNum","currModule","startModule","endModule","percent","showPercentageComplete","checkTrophyStatus","firstTrophyPercentage","setTrophyCompletionField","secondTrophyPercentage","modulesCompleted","getNumberOfModuleBadges","completedCount","trophyAchievement","setTrophyReadField","moduleNumber","_userId","activityCount","endPercent","parseFloat","toFixed","currentModule","loggedUser","uProgress","allModuleActivities","allModuleActivitiesCount","completedModuleActivities","moduleAcitvities","gameActivity","checkDuplicate","voucherCode","duplicate","duplicateApplied","voucherCodes","multipleUsage","currCode","done","makeVoucherCode","singleUsage","discount","discountType","paymentPlans","vId","vCode","dateTime","possibleChars","charAt","Math","floor","random","Mongo","Collection","_ensureIndex","unique","assessmentTypes","ContactMails","stripeLog","customEmails","toolRecs","allow","audioStore","FS","Store","S3","region","accessKeyId","secretAccessKey","bucket","stores","download","commentStore","commentRecordings","assessmentStore","assessmentRecordings","Orglogos","FileSystem","path","filter","contentTypes","onInvalid","alert","fields","modifiers","LogoURLs","publish","userArray","$in","map","studentArray","cursor","userOrganisation","userGroups","userSubgroups","audioAuthor","commentArray","audioCursor","onStop","act","trial","$ne","userOrg","onCreateUser","onLogin","expiryDate","nowDate","onLoginFailure","sitemaps","add","page","lastmod","changefreq","priority","images","loc","caption","videos","content_loc","thumbnail_loc","parseQuery","queryString","query","pairs","substr","pair","decodeURIComponent","startup","callback","smtp","server","port","process","env","MAIL_URL","encodeURIComponent","METEOR_WATCH_PRIORITIZE_CHANGED","emailTemplates","siteName","enrollAccount","url","customEmail","enrollmentEmail","displayUsername","join","verifyEmail","verificationEmail","config","isClient","Session","setDefault","window","fbAsyncInit","FB","init","appId","xfbml","version","settings","isServer"],"mappings":"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","file":"/app.js","sourcesContent":["Meteor.methods({\n    \"getUserBySCORMId\": function (scorm_Id) {\n        var user = Meteor.users.findOne({ scormId: scorm_Id });\n        if (user == null || user == \"undefined\") {\n            throw new Meteor.Error(\"500\", \"No user associated with this ID\");\n        } else {\n            return user;\n        }\n    },\n\n    \"addScormIdToUser\": function(userId, scorm_Id){\n        Meteor.users.update({_id: userId}, {$set: { scormId: scorm_Id}});\n    }\n})","Meteor.methods({\r\n    'addSubscriptionUserExpiry' : function(uId, oldExpiry){\r\n      \ttry {\r\n    \t\tvar currentDate = Meteor.users.findOne({_id: uId}).expiry;\r\n   \t\t    var expiry = new Date(currentDate.setTime( currentDate.getTime() + oldExpiry * 86400000 ));\r\n\t\t\tMeteor.users.update({ _id : uId}, {$set : {expiry: expiry}});\r\n\t\t} catch (err) {\r\n\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t}\r\n    },\r\n\r\n    'removeSubscriptionUserExpiry' : function(uId, oldExpiry){\r\n      \ttry {\r\n   \t\t    var expiry = new Date();\r\n\t\t\tMeteor.users.update({ _id : uId}, {$set : {expiry: expiry}});\r\n\t\t} catch (err) {\r\n\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t}\r\n    },\r\n\r\n    'customUserExpiry' : function(uId, oldExpiry){\r\n      \ttry {\r\n    \t\tvar currentDate = new Date();\r\n   \t\t    var expiry = new Date(currentDate.setTime( currentDate.getTime() + oldExpiry * 86400000 ));\r\n\t\t\tMeteor.users.update({ _id : uId}, {$set : {expiry: expiry}});\r\n\t\t} catch (err) {\r\n\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t}\r\n    },\r\n\r\n\t'durationLogEntry': function(subscriberId, adminId, event, daysBefore, daysAfter) {\r\n\t\ttry {\r\n\t\t\tduration_log.insert({subscriberId: subscriberId, adminId: adminId, event: event, daysBefore: daysBefore, daysAfter: daysAfter});\r\n\t\t} catch (err) {\r\n\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t}\r\n\t\t//(userId, Meteor.userId(), \"Account creation.\", 0, aExpiry)\r\n\t}\r\n\r\n});\r\n\r\n","Meteor.methods({\n\n\t'addAnnouncements': function (title, msg, aExpiry, userId) {\n\t\tvar org = Meteor.users.findOne({ _id: userId }).organisation;\n\t\tvar formattedDate = new Date();\n\t\tvar currentDate = new Date();\n\t\tvar expiry = new Date(currentDate.setTime(currentDate.getTime() + aExpiry * 86400000));\n\n\t\ttry {\n\t\t\treturn Announcements.insert({ author: userId, date: formattedDate, organisation: org[0], expiry: expiry, title: title, message: msg, readBy: [] });\n\t\t} catch (err) {\n\t\t\tthrow new Meteor.Error(err.message);\n\t\t}\n\t},\n\n\t'editAnnouncements': function (id, title, msg, aExpiry, userId) {\n\t\t// var org = Meteor.users.findOne({_id: userId}).organisation;\n\t\tvar currentDate = new Date();\n\t\tvar expiry = new Date(currentDate.setTime(currentDate.getTime() + aExpiry * 86400000));\n\n\t\ttry {\n\t\t\treturn Announcements.update(\n\t\t\t\t{ _id: id },\n\t\t\t\t{\n\t\t\t\t\t$set: {\n\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\tmessage: msg,\n\t\t\t\t\t\texpiry: expiry,\n\t\t\t\t\t\teditedBy: userId\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{ upsert: true }\n\t\t\t);\n\t\t} catch (err) {\n\t\t\tthrow new Meteor.Error(err.message);\n\t\t}\n\t},\n\n\t'deleteAnnouncements': function (id) {\n\t\tAnnouncements.remove({ _id: id });\n\t},\n\n\t'markReadAnnouncement': function(id, userId){\n\t\tAnnouncements.update({_id: id}, {$push : { \"readBy\" : userId}});\n\t}\n});","Meteor.methods({\r\n\r\n\t/**\r\n\t*\t@method: \tassignNewAssessment\r\n\t*\t@summary: \tThis method is used to assign a new assessment to a student.\r\n\t*\t@requires: \tCurrently logged in user is Admin, Moderator or Tutor for the student.\r\n\t*\r\n\t*/\r\n\t'assignNewAssessment': function (studentId, voucher) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || voucher) {\r\n\t\t\tvar role = Meteor.users.findOne({ _id: studentId }).roles[0];\r\n\t\t\tstudentAssessments.insert({\r\n\t\t\t\tuserId: studentId,\r\n\t\t\t\tuserRole: role,\r\n\t\t\t\tname: \"Initial Assessment\",\r\n\t\t\t\ttype: \"initial-assessment\",\r\n\t\t\t\tstartDate: null,\r\n\t\t\t\tcompleteDate: null,\r\n\t\t\t\tscore: null,\r\n\t\t\t\tassignedBy: Meteor.userId(),\r\n\t\t\t\tpass: null,\r\n\t\t\t\tsections: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Reading\",\r\n\t\t\t\t\t\tstartDate: null,\r\n\t\t\t\t\t\tcompleteDate: null,\r\n\t\t\t\t\t\tscore: 0,\r\n\t\t\t\t\t\tanswer: {\r\n\t\t\t\t\t\t\tA1r: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"A1\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"When did the Italians begin to arrive in Scotland?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What work did most of them do?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What did some do when they made money?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What did their child and grandchildren do?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Do all Scottish Italians still work in the food and drink business?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tA2r: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"A2\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"When did thousand of Polish soldiers and airmen come to Britain?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Who controlled Poland after the war?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Who did most Polish soldiers and sailors in Britain marry?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"When did Poland become a member of the European Union?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Why did thousands of young people come to Britain?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What work did many Poles do at first?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Where did they go on to work after this?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer7\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Have they all returned to Poland?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer8\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tB1r: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"B1\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Which job did the first Chinese in Britain do?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Which cities did they arrive in?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"When did this begin to happen?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"In which century did the first Chinese restaurants open in London?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Are many new Chinese restaurants expected to open in the future?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Do Chinese families usually live close to each other?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What can you find in a Chinatown?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer7\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Do Chinese people often marry people who are not Chinese?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer8\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Do a lot of British Chinese work in the restaurant business today?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer9\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tB2r: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"B2\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Why do Scotland and Ireland have a great deal of common history?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\t\"answerValue\": null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"When did the â€˜Scotsâ€™ first arrive in Scotland?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Did the Highlands become Protestant in the 1560s?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Which word in paragraph 2 means â€˜connectionsâ€™?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What caused large scale Irish emigration in the 1840s?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"How many people emigrated?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"In which Scottish city did many Irish immigrants settle?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer7\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What issue caused difficulty between the Irish Catholics and the native Scots?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer8\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Have relation between Protestants and Catholics improved since the 19th century?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer9\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Which word in paragraph 3 means â€˜peacefulnessâ€™?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer10\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tC1r: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"C1\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What happened to some British sailors on the way to India?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What were Indian politicians preparing for before 1947?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Did all members of the Indian army return home after the wars?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Which exams could Indians only sit in London?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Which of these summarises the main reasons for South Asian settlement in Britain in the 19th and early 20th century?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"When was Pakistan established as a country?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Which two of these groups of South Asians came to work in Scotland?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer7\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Is the whole of the Punjab in modern India?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer8\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Did the immigration laws stop family members coming to Britain?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer9\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What word shows that Ugandan Asians did not come to Britain by choice?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer10\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tpass: null\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Writing\",\r\n\t\t\t\t\t\tstartDate: null,\r\n\t\t\t\t\t\tcompleteDate: null,\r\n\t\t\t\t\t\twordLimit: 150,\r\n\t\t\t\t\t\tscore: null,\r\n\t\t\t\t\t\tanswer: null,\r\n\t\t\t\t\t\tpass: null\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Listening\",\r\n\t\t\t\t\t\tstartDate: null,\r\n\t\t\t\t\t\tcompleteDate: null,\r\n\t\t\t\t\t\tscore: null,\r\n\t\t\t\t\t\tplaysAllowed: 2,\r\n\t\t\t\t\t\tanswer: {\r\n\t\t\t\t\t\t\tA2l: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"A2\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Mark lives in a busy road.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Mark doesn't like his house.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"John lives in a house\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"John lives near a school\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"There's a post office near Mark's house.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Mark lives near a park.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tB1l: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"B1\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What does Kasia tell Claire?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Kasia feels\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"When did Farhana's grandfather come to Scotland?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Why did Farhana's mother come to Scotland?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What three things does Murdo tell Claire?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What does Murdo not understand?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"How do Kasia, Fahrana and Murdo feel about living in Scotland?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer7\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tB2l: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"B2\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"When are they planning to go ?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\t\"answerValue\": null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What does Ash wat to see?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Does Sal agree?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Why doesn't Sal want to see the same movie as Ash?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"What does she want to see?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Why doesn't Ash want to see it?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\tC1l: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"C1\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The aviation industry is more positive about the future of space tourism than the space industry. True or False?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Space hotels circle the earth every one and half hours. True or False\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The main topic in this recording is...\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Where has this recording come from?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The man's attitude to space tourism is:\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The woman's attitude to space tourism is:\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tpass: null\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Speaking\",\r\n\t\t\t\t\t\tstartDate: null,\r\n\t\t\t\t\t\tcompleteDate: null,\r\n\t\t\t\t\t\tscore: null,\r\n\t\t\t\t\t\tanswer: [],\r\n\t\t\t\t\t\tpass: null\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}, function (error, result) {\r\n\t\t\t\tif (!error) {\r\n\t\t\t\t\tuserProgress.update({ userId: studentId },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$addToSet: {\r\n\t\t\t\t\t\t\t\tassessments: result\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t*\t@method: \tassignNewExitTest\r\n\t*\t@summary: \tThis method is used to assign a new exit test to a student.\r\n\t*\t@requires: \tCurrently logged in user is Admin, Moderator or Tutor for the student.\r\n\t*\r\n\t*/\r\n\t'assignNewExitTest': function (studentId, voucher) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || voucher) {\r\n\t\t\tvar role = Meteor.users.findOne({ _id: studentId }).roles[0];\r\n\t\t\tstudentAssessments.insert({\r\n\t\t\t\tuserId: studentId,\r\n\t\t\t\tuserRole: role,\r\n\t\t\t\tname: \"Exit Test\",\r\n\t\t\t\ttype: \"exit-test\",\r\n\t\t\t\tstartDate: null,\r\n\t\t\t\tcompleteDate: null,\r\n\t\t\t\tscore: null,\r\n\t\t\t\tassignedBy: Meteor.userId(),\r\n\t\t\t\tpass: null,\r\n\t\t\t\tsections: [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Reading\",\r\n\t\t\t\t\t\tstartDate: null,\r\n\t\t\t\t\t\tcompleteDate: null,\r\n\t\t\t\t\t\tscore: 0,\r\n\t\t\t\t\t\tanswer: {\r\n\t\t\t\t\t\t\tA1r: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"A1\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Who is the postcard from?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Why are they in Florida?\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The hotel is quiet.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The food is good.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"Shopping is cheap\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The guests like the hotel\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The weather is\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer7\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The buildings are\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer8\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tpass: null\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Writing\",\r\n\t\t\t\t\t\tstartDate: null,\r\n\t\t\t\t\t\tcompleteDate: null,\r\n\t\t\t\t\t\twordLimit: 150,\r\n\t\t\t\t\t\tscore: null,\r\n\t\t\t\t\t\tanswer: null,\r\n\t\t\t\t\t\tpass: null\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Listening\",\r\n\t\t\t\t\t\tstartDate: null,\r\n\t\t\t\t\t\tcompleteDate: null,\r\n\t\t\t\t\t\tscore: null,\r\n\t\t\t\t\t\tplaysAllowed: 2,\r\n\t\t\t\t\t\tanswer: {\r\n\t\t\t\t\t\t\tA1l: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"A1\"\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The bedroom is big.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer1\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"The window is big.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer2\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"There are two desks.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer3\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"There is a chair.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer4\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"I have a big TV.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer5\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tquestion: \"I have lots of clothes.\",\r\n\t\t\t\t\t\t\t\t\tanswerNumber: \"answer6\",\r\n\t\t\t\t\t\t\t\t\tanswerValue: null\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tpass: null\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tname: \"Speaking\",\r\n\t\t\t\t\t\tstartDate: null,\r\n\t\t\t\t\t\tcompleteDate: null,\r\n\t\t\t\t\t\tscore: null,\r\n\t\t\t\t\t\tanswer: [],\r\n\t\t\t\t\t\tpass: null\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}, function (error, result) {\r\n\t\t\t\tif (!error) {\r\n\t\t\t\t\tuserProgress.update({ userId: studentId },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$addToSet: {\r\n\t\t\t\t\t\t\t\tassessments: result\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\t'changeAssessmentSectionMark': function (assessmentId, sectionNo, newMark) {\r\n\t\tobj = {};\r\n\t\tobj[\"sections.\" + sectionNo + \".pass\"] = newMark;\r\n\t\tstudentAssessments.update({ _id: assessmentId }, { $set: obj });\r\n\t},\r\n\r\n\t'changeAssessmentOverallMark': function (assessmentId, newMark) {\r\n\t\tvar assessmentDoc = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tvar userId = assessmentDoc.userId;\r\n\t\tobj = {};\r\n\t\tobj[\"pass\"] = newMark;\r\n\t\tstudentAssessments.update({ _id: assessmentId }, { $set: obj });\r\n\t\tif (newMark == true) {\r\n\t\t\tMeteor.users.update({ _id: userId }, { $set: { 'authorisedCourses.journey2English': true } });\r\n\t\t} else if (newMark == false) {\r\n\t\t\tMeteor.users.update({ _id: userId }, { $set: { 'authorisedCourses.journey2English': false } });\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t*\t@method: \tsetAssessmentStart\r\n\t*\t@summary: \tThis method is used to set a section (and assessment) to started by\r\n\t*\t\t\t\tsetting the startDate to the current date.\r\n\t*\t@requires: \tAdmin or Student who owns this assessment.\r\n\t*\r\n\t*/\r\n\t'setAssessmentStart': function (assessmentId, sectionName) {\r\n\t\tvar assessment = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || (assessment.userId == Meteor.userId())) {\r\n\t\t\tif (assessment.startDate == null) {\r\n\t\t\t\tstudentAssessments.update({ _id: assessmentId }, { $set: { startDate: new Date() } })\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < assessment.sections.length; i++) {\r\n\t\t\t\tif (assessment.sections[i].name == sectionName) {\r\n\t\t\t\t\tif (assessment.sections[i].startDate == null) {\r\n\t\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$set: {\r\n\t\t\t\t\t\t\t\t\t\"sections.$.startDate\": new Date()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(\"Unauthorised attempt to edit studentAssessment doc.\");\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t*\t@method: \tsetScoredSectionComplete\r\n\t*\t@summary: \tThis method is used to set a section (and assessment) as completed by\r\n\t*\t\t\t\tsetting the dateComplete to the current date. In a Scored Section the answers\r\n\t*\t\t\t\tshould be auto-checked by the system, and a score automatically returned.\r\n\t*\r\n\t*\t@requires: Admin or Student who owns this assessment.\r\n\t*\r\n\t*/\r\n\t'setScoredSectionComplete': function (assessmentId, sectionName, userAnswers, currentScore) {\r\n\t\tvar assessment = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || (assessment.userId == Meteor.userId())) {\r\n\t\t\tfor (var i = 0; i < assessment.sections.length; i++) {\r\n\t\t\t\tvar section = getSection(sectionName);\r\n\t\t\t\tif (assessment.sections[i].name == section) {\r\n\t\t\t\t\tif (assessment.sections[i].startDate != null && assessment.sections[i].completeDate == null && assessment.completeDate == null) {\r\n\t\t\t\t\t\tvar score = checkAnswers(assessment.type, sectionName, userAnswers);\r\n\t\t\t\t\t\tvar finalscore = (finalScore(score, sectionName)) ? (score + currentScore) : 0;\r\n\t\t\t\t\t\tupdateAnswers(assessmentId, userAnswers, sectionName, section, finalScore(score, sectionName), finalscore);\r\n\t\t\t\t\t\treturn score;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn (score) ? score : null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(\"Unauthorised attempt to edit studentAssessment doc.\");\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t*\t@method: \tsetTextSectionComplete\r\n\t*\t@summary: \tThis method is used to set a section (and assessment) as completed by\r\n\t*\t\t\t\tsetting the dateComplete to the current date. A Text section is one in which\r\n\t*\t\t\t\tthe user submits a body of text which must be manually checked by a tutor.\r\n\t*\r\n\t*\t@requires: Admin or Student who owns this assessment.\r\n\t*\r\n\t*/\r\n\t'setTextSectionComplete': function (assessmentId, sectionName, userAnswers) {\r\n\t\tvar assessment = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || (assessment.userId == Meteor.userId())) {\r\n\t\t\tfor (var i = 0; i < assessment.sections.length; i++) {\r\n\t\t\t\tif (assessment.sections[i].name == sectionName) {\r\n\t\t\t\t\tvar wordCount = wordCountParser(userAnswers[0].answerValue);\r\n\t\t\t\t\tif (wordCount.words > assessment.sections[i].wordLimit) {\r\n\t\t\t\t\t\tthrow new Meteor.Error(\"Word Count Exceeded. Please ensure your submission is \" + assessment.sections[i].wordLimit + \" words or less.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (assessment.sections[i].startDate != null && assessment.sections[i].completeDate == null && assessment.completeDate == null) {\r\n\t\t\t\t\t\tvar doc = studentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$set: {\r\n\t\t\t\t\t\t\t\t\t\"sections.$.completeDate\": new Date(),\r\n\t\t\t\t\t\t\t\t\t\"sections.$.answer\": userAnswers\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\tvar doc = studentAssessments.findOne({ _id: assessmentId });\r\n\t\t\t\t\t\tif (checkAllSectionsFinished(doc)) {\r\n\t\t\t\t\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t$set: {\r\n\t\t\t\t\t\t\t\t\t\t\"completeDate\": new Date()\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Meteor.Error(\"Error: This section has already been completed.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(\"Unauthorised attempt to edit studentAssessment doc.\");\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t*\t@method: \tsetSectionComplete\r\n\t*\t@summary: \tThis method is used to set a section (and assessment) as completed by\r\n\t*\t\t\t\tsetting the dateComplete to the current date. It does not set a score.\r\n\t*\r\n\t*\t@requires: Admin or Student who owns this assessment.\r\n\t*\r\n\t*/\r\n\t'setSectionComplete': function (user, assessmentId, sectionName) {\r\n\t\t// Check the assessment section has started. If it has, set it to completed.\r\n\t\tvar assessment = studentAssessments.findOne({ _id: assessmentId, userId: user });\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || (assessment.userId == Meteor.userId())) {\r\n\t\t\tfor (var i = 0; i < assessment.sections.length; i++) {\r\n\t\t\t\tif (assessment.sections[i].name == sectionName) {\r\n\t\t\t\t\tif (assessment.sections[i].startDate != null && assessment.sections[i].completeDate == null && assessment.completeDate == null) {\r\n\t\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$set: { \"sections.$.completeDate\": new Date() }\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Meteor.Error(\"Error: This section has already been completed.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar doc = studentAssessments.findOne({ _id: assessmentId });\r\n\t\t\t\t\tif (checkAllSectionsFinished(doc)) {\r\n\t\t\t\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$set: {\r\n\t\t\t\t\t\t\t\t\t\"completeDate\": new Date()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(\"Unauthorised attempt to edit studentAssessment doc.\");\r\n\t\t}\r\n\t},\r\n\r\n\t'markAssessmentSection': function (assessmentId, sectionName, result) {\r\n\t\tvar validResults = [\r\n\t\t\t\"Not Attempted\", \"Not Marked\", \"Not Achieved\", \"A1\", \"A2\", \"B1\", \"B2\", \"C1\", \"C1+\"\r\n\t\t];\r\n\r\n\t\tif (validResults.indexOf(result) >= 0) {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName }, { $set: { \"sections.$.pass\": result } });\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(\"Error: Invalid mark for Initial Assessment\");\r\n\t\t}\r\n\t\t/*\r\n\t\t\t\tif (result == \"Not Attempted\") {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.pass\": \"Not Attempted\" }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t} else if (result == \"A1\") {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.pass\": \"A1\" }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t} else if (result == \"A2\") {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.pass\": \"A2\" }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t} else if (result == \"B1\") {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.pass\": \"B1\" }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t} else if (result == \"B2\") {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.pass\": \"B2\" }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t} else if (result == \"C1\") {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.pass\": \"C1\" }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t} else if (result == \"Not Marked\") {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.pass\": \"Not Marked\" }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t} else if (result == \"C1+\") {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.pass\": \"C1+\" }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Meteor.Error(\"Error: Invalid mark for Initial Assessment\");\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t},\r\n\r\n\t'markAssessment': function (assessmentId, result) {\r\n\t\t// Need to restrict this to authorised users (admins & appropriate tutors, mods)\r\n\t\tvar assessmentDoc = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tvar validResults = [\r\n\t\t\t\"Not Attempted\", \"Not Achieved\", \"A1\", \"A2\", \"B1\", \"B2\", \"C1\", \"C1+\"\r\n\t\t];\r\n\r\n\t\tif (validResults.indexOf(result) >= 0) {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId }, { $set: { \"pass\": result } });\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(\"Error: Invalid mark for Initial Assessment\");\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\tif (result == \"Not Attempted\") {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { \"pass\": \"Not Attempted\" }\r\n\t\t\t\t})\r\n\t\t} else if (result == \"Not Achieved\") {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { \"pass\": \"Not Achieved\" }\r\n\t\t\t\t})\r\n\t\t} else if (result == \"A1\") {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { \"pass\": \"A1\" }\r\n\t\t\t\t})\r\n\t\t} else if (result == \"A2\") {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { \"pass\": \"A2\" }\r\n\t\t\t\t})\r\n\t\t} else if (result == \"B1\") {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { \"pass\": \"B1\" }\r\n\t\t\t\t})\r\n\t\t} else if (result == \"B2\") {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { \"pass\": \"B2\" }\r\n\t\t\t\t})\r\n\t\t} else if (result == \"C1\") {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { \"pass\": \"C1\" }\r\n\t\t\t\t})\r\n\t\t} else if (result == \"C1+\") {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { \"pass\": \"C1+\" }\r\n\t\t\t\t})\r\n\t\t}*/\r\n\r\n\t},\r\n\r\n\t'sendPassedAssessmentEmail': function (userId, tutorId) {\r\n\t\t// Send the email\r\n\t\tvar userDoc = Meteor.users.findOne({ _id: userId });\r\n\t\tif (userDoc.emails && userDoc.emails[0].address) {\r\n\t\t\tvar userEmail = userDoc.emails[0].address;\r\n\t\t\tvar emailSubject = \"Your English Skills Test has been marked\";\r\n\t\t\tvar emailContent = '<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background-color: #edf4ff; border-width: 0; max-width: 640px; margin-left: auto; margin-right: auto;\"><tr><td style=\"margin: 0; padding: 0;\"><img src=\"http://www.klik2learn.com/wp-content/uploads/2016/07/email_jte_logo.jpg\" style=\"max-width: 100%;\" alt=\"Journey to English\"></td></tr><tr><td style=\"margin: 0; padding: 1em;\"><h1 style=\"color: #42b677; text-align: center; font-family: sans-serif;\">Your English Skills Test has been marked</h1><p style=\"font-family: sans-serif;\">To find out your results go to your account and select \"Assessments\"</p><p style=\"text-align: center;\"><img src=\"http://www.klik2learn.com/wp-content/uploads/2018/04/account-assessment.png\" alt=\"Account &gt; Assessments\"></p><p style=\"font-family: sans-serif;\">You can now continue with the Journey 2 English course. There is roughly 40 hours of learning, after which you may be invited to take the English Skills Test again to see how you have improved.</p><p style=\"font-family: sans-serif; text-align: center;\">Good luck with your studies.</p><p style=text-align:center> Work hard and you will receive a certificate after completing 80% of the course. </p><p style=\"font-family: sans-serif; text-align: center;\">The Journey 2 English team</p><p style=\"text-align: center;\"><a href=\"http://www.klik2learn.com\"><img src=\"http://www.klik2learn.com/wp-content/uploads/2016/10/header-logo.png\" width=\"100\" height=\"100\" alt=\"Klik2learn\"></a></p></td></tr></table>'\r\n\t\t\tEmail.send({\r\n\t\t\t\tto: userEmail,\r\n\t\t\t\tfrom: \"Journey 2 English\",\r\n\t\t\t\tsubject: emailSubject,\r\n\t\t\t\thtml: emailContent\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t'sendFailAssessmentEmail': function (userId, tutorId) {\r\n\t\t// Send the email\r\n\t\tvar userDoc = Meteor.users.findOne({ _id: userId });\r\n\t\tif (userDoc.emails && userDoc.emails[0].address) {\r\n\t\t\tvar userEmail = userDoc.emails[0].address;\r\n\t\t\tvar emailSubject = \"Your English Skills Test has been marked\";\r\n\t\t\tvar emailContent = '<table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"background-color: #edf4ff; border-width: 0; max-width: 640px; margin-left: auto; margin-right: auto;\"><tr><td style=\"margin: 0; padding: 0;\"><img src=\"http://www.klik2learn.com/wp-content/uploads/2016/07/email_jte_logo.jpg\" style=\"max-width: 100%;\" alt=\"Journey to English\"></td></tr><tr><td style=\"margin: 0; padding: 1em;\"><h1 style=\"color: #42b677; text-align: center; font-family: sans-serif;\">Your English Skills Test has been marked</h1><p style=\"font-family: sans-serif;\">To find out your results go to your account and select \"Assessments\"</p><p style=\"text-align: center;\"><img src=\"http://www.klik2learn.com/wp-content/uploads/2018/04/account-assessment.png\" alt=\"Account &gt; Assessments\"></p><p style=\"font-family: sans-serif;\">You can now continue with the Journey 2 English course. There is roughly 40 hours of learning, after which you may be invited to take the English Skills Test again to see how you have improved.</p><p style=\"font-family: sans-serif; text-align: center;\">Good luck with your studies.</p><p style=text-align:center> Work hard and you will receive a certificate after completing 80% of the course.</p><p style=\"font-family: sans-serif; text-align: center;\">The Journey 2 English team</p><p style=\"text-align: center;\"><a href=\"http://www.klik2learn.com\"><img src=\"http://www.klik2learn.com/wp-content/uploads/2016/10/header-logo.png\" width=\"100\" height=\"100\" alt=\"Klik2learn\"></a></p></td></tr></table>';\r\n\t\t\tEmail.send({\r\n\t\t\t\tto: userEmail,\r\n\t\t\t\tfrom: \"Journey 2 English\",\r\n\t\t\t\tsubject: emailSubject,\r\n\t\t\t\thtml: emailContent\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t*\t@method: \thandleAssessmentDisconnect\r\n\t*\t@summary: \tThis method is used to set a section (and assessment) as completed by\r\n\t*\t\t\t\tsetting the dateComplete to the current date. It is called when the user disconnects\r\n\t*\t\t\t\twhen completed an assessment.\r\n\t*\r\n\t*\t@requires: Admin or Student who owns this assessment.\r\n\t*\r\n\t*/\r\n\t'handleAssessmentDisconnect': function (user, assessmentId, sectionName) {\r\n\t\t// Check the assessment section has started. If it has, set it to completed.\r\n\t\tvar doc = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tfor (var i = 0; i < doc.sections.length; i++) {\r\n\t\t\tif (doc.sections[i].name == sectionName) {\r\n\t\t\t\tif (doc.sections[i].startDate != null && doc.sections[i].completeDate == null) {\r\n\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$set: { \"sections.$.completeDate\": new Date() }\r\n\t\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar updatedDoc = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tif (checkAllSectionsFinished(updatedDoc)) {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: {\r\n\t\t\t\t\t\t\"completeDate\": new Date()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\t'addAssessmentAudio': function (fileId, assessmentId, sectionName, answerNumber, question) {\r\n\t\tvar assessment = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tif (Meteor.userId()) {\r\n\t\t\tfor (var i = 0; i < assessment.sections.length; i++) {\r\n\t\t\t\tif (assessment.sections[i].name == sectionName) {\r\n\t\t\t\t\tif (assessment.sections[i].startDate != null && assessment.sections[i].completeDate == null) {\r\n\t\t\t\t\t\tvar answerObj = {\r\n\t\t\t\t\t\t\t\"question\": question,\r\n\t\t\t\t\t\t\t\"answerNumber\": answerNumber,\r\n\t\t\t\t\t\t\t\"answerId\": fileId\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": sectionName },\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$addToSet: {\r\n\t\t\t\t\t\t\t\t\t\"sections.$.answer\": answerObj\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t'resetAssessment': function (uId) {\r\n\t\tstudentAssessments.remove({ userId: uId });\r\n\t\tMeteor.call('assignNewAssessment', uId, false);\r\n\t}\r\n\r\n})\r\n\r\nfunction checkAllSectionsFinished(assessmentDoc) {\r\n\tvar sections = assessmentDoc.sections;\r\n\tvar finished = true;\r\n\tfor (var i = 0; i < sections.length; i++) {\r\n\t\tif (sections[i].completeDate == null) {\r\n\t\t\tfinished = false;\r\n\t\t}\r\n\t}\r\n\treturn finished;\r\n}\r\n\r\nfunction getSection(sectionName) {\r\n\tif (sectionName.length < 4) {\r\n\t\treturn (sectionName.indexOf(\"r\") >= 0) ? \"Reading\" : \"Listening\";\r\n\t} else {\r\n\t\treturn sectionName;\r\n\t}\r\n}\r\n\r\nfunction finalScore(score, sectionName) {\r\n\tvar pass = 100;\r\n\tswitch (sectionName) {\r\n\t\tcase \"A2l\":\r\n\t\t\tpass = 4;\r\n\t\t\tbreak;\r\n\t\tcase \"A1r\":\r\n\t\tcase \"B1l\":\r\n\t\t\tpass = 3;\r\n\t\t\tbreak;\r\n\t\tcase \"A2r\":\r\n\t\tcase \"B2l\":\r\n\t\t\tpass = 4;\r\n\t\t\tbreak;\r\n\t\tcase \"B1r\":\r\n\t\tcase \"B2r\":\r\n\t\t\tpass = 5;\r\n\t\t\tbreak;\r\n\t\tcase \"C1r\":\r\n\t\tcase \"C1l\":\r\n\t\t\treturn true;\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn score < pass;\r\n}\r\n\r\nfunction checkAnswers(assessmentType, sectionName, userAnswers) {\r\n\tassessmentType = \"initialAssessment\"; // TEMP SOLN\r\n\tvar assessmentAnswers = {\r\n\t\tinitialAssessment: {\r\n\t\t\tA1r: {\r\n\t\t\t\tanswer1: [\"after 1870\"],\r\n\t\t\t\tanswer2: [\"sold ice cream\"],\r\n\t\t\t\tanswer3: [\"opened cafes\"],\r\n\t\t\t\tanswer4: [\"opened italian restaurants\"],\r\n\t\t\t\tanswer5: [\"no\"]\r\n\t\t\t},\r\n\r\n\t\t\tA2r: {\r\n\t\t\t\tanswer1: [\"world war 2\", \"world war two\", \"world war II\"],\r\n\t\t\t\tanswer2: [\"soviet union\"],\r\n\t\t\t\tanswer3: [\"local women\"],\r\n\t\t\t\tanswer4: [\"2004\"],\r\n\t\t\t\tanswer5: [\"find work\", \"get jobs\"],\r\n\t\t\t\tanswer6: [\"on farms\", \"picking crops\", \"in farms\", \"in farming\", \"on farms picking crops\", \"in farms picking crops\"],\r\n\t\t\t\tanswer7: [\"bars and restaurants\", \"restaurants and bars\"],\r\n\t\t\t\tanswer8: [\"no\"]\r\n\t\t\t},\r\n\r\n\t\t\tB1r: {\r\n\t\t\t\tanswer1: [\"sailors\"],\r\n\t\t\t\tanswer2: [\"london, cardiff and liverpool\", \"london, liverpool and cardiff\", \"cardiff, london and liverpool\", \"cardiff, liverpool and london\", \"liverpool, cardiff and london\", \"liverpool, london and cardiff\", \"london cardiff liverpool\", \"london liverpool cardiff\", \"cardiff london liverpool\", \"cardiff liverpool london\", \"liverpool cardiff london\", \"liverpool london cardiff\"],\r\n\t\t\t\tanswer3: [\"early 1800s\"],\r\n\t\t\t\tanswer4: [\"20th\"],\r\n\t\t\t\tanswer5: [\"no\"],\r\n\t\t\t\tanswer6: [\"no\"],\r\n\t\t\t\tanswer7: [\"chinese shops and restaurants\", \"chinese foods and goods\"],\r\n\t\t\t\tanswer8: [\"yes\"],\r\n\t\t\t\tanswer9: [\"yes\"]\r\n\t\t\t},\r\n\r\n\t\t\tB2r: {\r\n\t\t\t\tanswer1: [\"12 miles apart\", \"twelve miles apart\", \"12 miles away\", \"twelve miles away\"],\r\n\t\t\t\tanswer2: [\"5th century\", \"the 5th century\"],\r\n\t\t\t\tanswer3: [\"no\"],\r\n\t\t\t\tanswer4: [\"links\"],\r\n\t\t\t\tanswer5: [\"famine\"],\r\n\t\t\t\tanswer6: [\"a million\", \"one million\", \"1 million\"],\r\n\t\t\t\tanswer7: [\"glasgow\"],\r\n\t\t\t\tanswer8: [\"jobs\", \"pay\", \"work\", \"low rates of pay\", \"lower rates of pay\"],\r\n\t\t\t\tanswer9: [\"yes\"],\r\n\t\t\t\tanswer10: [\"harmony\"]\r\n\t\t\t},\r\n\r\n\t\t\tC1r: {\r\n\t\t\t\tanswer1: [\"died\", \"were killed\"],\r\n\t\t\t\tanswer2: [\"independence\"],\r\n\t\t\t\tanswer3: [\"no\"],\r\n\t\t\t\tanswer4: [\"civil service\", \"indian civil service\"],\r\n\t\t\t\tanswer5: [\"b\"],\r\n\t\t\t\tanswer6: [\"1947\"],\r\n\t\t\t\tanswer7: [\"a,c\", \"c,a\"],\r\n\t\t\t\tanswer8: [\"no\"],\r\n\t\t\t\tanswer9: [\"no\"],\r\n\t\t\t\tanswer10: [\"expelled\"]\r\n\t\t\t},\r\n\r\n\r\n\t\t\tA2l: {\r\n\t\t\t\tq1: [\"false\"],\r\n\t\t\t\tq2: [\"false\"],\r\n\t\t\t\tq3: [\"false\"],\r\n\t\t\t\tq4: [\"true\"],\r\n\t\t\t\tq5: [\"false\"],\r\n\t\t\t\tq6: [\"true\"]\r\n\t\t\t},\r\n\r\n\t\t\tB1l: {\r\n\t\t\t\tq1: [\"kasia has been in scotland for five years\",\r\n\t\t\t\t\t\"kasia's father couldn't find a job in poland\",\r\n\t\t\t\t\t\"kasia was born in poland\"],\r\n\t\t\t\tq2: [\"polish and scottish\"],\r\n\t\t\t\tq3: [\"he came in the 1960s\"],\r\n\t\t\t\tq4: [\"she came to marry farhana's father\"],\r\n\t\t\t\tq5: [\"this is his first time away from lewis\",\r\n\t\t\t\t\t\"he doesn't have any brothers or sisters\",\r\n\t\t\t\t\t\"he speaks two languages\"],\r\n\t\t\t\tq6: [\"he doesn't understand the glasgow dialect\"],\r\n\t\t\t\tq7: [\"mostly happy\"]\r\n\t\t\t},\r\n\r\n\t\t\tB2l: {\r\n\t\t\t\tq1: [\"tonight\"],\r\n\t\t\t\tq2: [\"mark thorne film\"],\r\n\t\t\t\tq3: [\"no\"],\r\n\t\t\t\tq4: [\"she doesn't like car chases\"],\r\n\t\t\t\tq5: [\"the new french film\"],\r\n\t\t\t\tq6: [\"it sounds a bit heavy\"]\r\n\t\t\t},\r\n\r\n\t\t\tC1l: {\r\n\t\t\t\tq1: [\"true\"],\r\n\t\t\t\tq2: [\"true\"],\r\n\t\t\t\tq3: [\"space tourism\"],\r\n\t\t\t\tq4: [\"a radio interview\"],\r\n\t\t\t\tq5: [\"positive\"],\r\n\t\t\t\tq6: [\"neutral\"]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (userAnswers == null) {\r\n\t\treturn null;\r\n\t} else {\r\n\t\tvar assessment = assessmentAnswers[assessmentType]\r\n\t\tvar assessmentTemp = assessment[sectionName];\r\n\t\tvar score = 0;\r\n\r\n\t\tfor (var i = 1; i < userAnswers.length; i++) {\r\n\t\t\tif (userAnswers[i].answerValue == null || userAnswers[i].answerValue == 'undefined' || userAnswers[i].answerValue.length < 1) {\r\n\t\t\t\tuserAnswers[i].correct = false;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof userAnswers[i].answerValue == \"string\") {\r\n\r\n\t\t\t\tvar formatAnswer = userAnswers[i].answerValue.toLowerCase();\r\n\t\t\t\tformatAnswer = formatAnswer.trim();\r\n\t\t\t\tvar acceptedAnswer = assessmentTemp[userAnswers[i].answerNumber];\r\n\r\n\t\t\t\tfor (var k = 0; k < acceptedAnswer.length; k++) {\r\n\t\t\t\t\tif (allowedAnswer(acceptedAnswer[k], formatAnswer)) {\r\n\t\t\t\t\t\tscore++;\r\n\t\t\t\t\t\tuserAnswers[i].correct = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuserAnswers[i].correct = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (userAnswers[i].answerValue.constructor === Array) {\r\n\t\t\t\t//The user answer is an array - Listening Section\r\n\t\t\t\tuserAnswers[i].correct = false;\r\n\r\n\t\t\t\tif (userAnswers[i] == null || userAnswers[i] == 'undefined' || userAnswers[i].answerValue == null || userAnswers[i].answerValue == 'undefined') {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var j = 0; j < userAnswers[i].answerValue.length; j++) {\r\n\t\t\t\t\tvar Answer = userAnswers[i].answerValue[j];\r\n\t\t\t\t\tvar question = assessmentTemp[userAnswers[i].answerNumber];\r\n\r\n\t\t\t\t\tvar wrong = true;\r\n\t\t\t\t\tfor (var x = 0; x < question.length; x++) {\r\n\t\t\t\t\t\tif (allowedAnswer(question[x], Answer)) {\r\n\t\t\t\t\t\t\twrong = false;\r\n\t\t\t\t\t\t\t//The answer matches one of the acceppted answers so go to the next answer\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (wrong) {\r\n\t\t\t\t\t\tuserAnswers[i].correct = false;\r\n\t\t\t\t\t\tj = userAnswers[i].answerValue.length + 1;\r\n\t\t\t\t\t\t//i++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//The answer is correct so increase the score and go to the next question\r\n\t\t\t\tif (!wrong) {\r\n\t\t\t\t\tuserAnswers[i].correct = true;\r\n\t\t\t\t\tscore++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn score;\r\n\t}\r\n}\r\n\r\nfunction wordCountParser(val) {\r\n\tvar wom = val.match(/\\S+/g);\r\n\treturn {\r\n\t\tcharactersNoSpaces: val.replace(/\\s+/g, '').length,\r\n\t\tcharacters: val.length,\r\n\t\twords: wom ? wom.length : 0,\r\n\t\tlines: val.split(/\\r*\\n/).length\r\n\t};\r\n}\r\n\r\nallowedAnswer = function (correct, uans) {\r\n\tcorrect = correct.toLowerCase();\r\n\tuans = uans.toLowerCase();\r\n\tif (correct.length >= 3 && correct.length <= 5) {\r\n\t\treturn hamming_distance(uans, correct) >= 0 && hamming_distance(uans, correct) <= 1;\r\n\t} else if (correct.length >= 6 && correct.length <= 10) {\r\n\t\treturn hamming_distance(uans, correct) >= 0 && hamming_distance(uans, correct) <= 2;\r\n\t} else if (correct.length >= 11) {\r\n\t\treturn hamming_distance(uans, correct) >= 0 && hamming_distance(uans, correct) <= 3;\r\n\t} else {\r\n\t\treturn correct == uans;\r\n\t}\r\n}\r\n\r\n\r\n/*\r\n *\r\n * Calculates the hamming distance between two strings\r\n * (operations needed to transform string a to string b).\r\n * \r\n */\r\nhamming_distance = function (a, b) {\r\n\tvar prim = \"\",\r\n\t\tsec = \"\",\r\n\t\tlen = 0,\r\n\t\tdist = 0;\r\n\r\n\t//If null, undefined or empty string, return error value\r\n\tif (a == null || b == null || a == \"undefined\" || b == \"undefined\" || a.length < 1 || b.length < 1) {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t//Decide which string is the \"primary\"\r\n\tif (a.length > b.length) {\r\n\t\tprim = a;\r\n\t\tsec = b;\r\n\t} else {\r\n\t\tprim = b;\r\n\t\tsec = a;\r\n\t}\r\n\r\n\t//For each character of the \"primary\" string, compare it with the \"secondary\" and increase\r\n\t//The total distance on the way.\r\n\tfor (var i = 0; i < prim.length; i++) {\r\n\t\t//The second string still has characters left\r\n\t\tif (sec[i]) {\r\n\t\t\t//Characters are the same so continue to the next one\r\n\t\t\tif (prim[i] == sec[i])\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t//Check for fat-fingered letter.\r\n\t\t\tvar temp = prim.substring(0, i) + prim.substring((i + 1), prim.length);\r\n\t\t\tif (sec == temp)\r\n\t\t\t\treturn 1;\r\n\t\t}\r\n\r\n\t\tdist++;\r\n\t}\r\n\r\n\treturn dist;\r\n\r\n}\r\n\r\n\r\nupdateAnswers = function (assessmentId, answers, sectionName, section, sectionComplete, score) {\r\n\tvar obj = {};\r\n\r\n\tif (sectionComplete) {\r\n\t\tobj[\"sections.$.completeDate\"] = new Date();\r\n\t\tobj[\"sections.$.score\"] = score;\r\n\t}\r\n\r\n\r\n\tif (sectionName.length < 4)\r\n\t\tobj[\"sections.$.answer.\" + sectionName] = answers;\r\n\telse\r\n\t\tobj[\"sections.$.answer\"] = answers;\r\n\r\n\r\n\tstudentAssessments.update({ _id: assessmentId, \"sections.name\": section }, { $set: obj });\r\n\r\n\tif (sectionComplete) {\r\n\t\tvar doc = studentAssessments.findOne({ _id: assessmentId });\r\n\t\tif (checkAllSectionsFinished(doc)) {\r\n\t\t\tstudentAssessments.update({ _id: assessmentId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: {\r\n\t\t\t\t\t\t\"completeDate\": new Date()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t}\r\n\t}\r\n}","Meteor.methods({\r\n\r\n\t'deleteAudioRecording': function(fileId) {\r\n\t\tif (Meteor.userId()) {\r\n\t\t\tvar recording = audioRecordings.findOne({ _id : fileId });\r\n\t\t\tif (recording.ownerId == Meteor.userId()) {\r\n\t\t\t\taudioRecordings.remove({ _id : fileId });\r\n\t\t\t}\t\t\r\n\t\t}\r\n\t},\r\n\r\n\t'addAudioComment': function(fileId, commentId) {\r\n\t\tif (Meteor.userId() && Roles.userIsInRole(Meteor.userId(), \"student\")) {\r\n\t\t\taudioRecordings.update({ _id : fileId },\r\n\t\t\t{\r\n\t\t\t\t$addToSet : { \r\n\t\t\t\t\tcomments : { \r\n\t\t\t\t\t\t_id : commentId, \r\n\t\t\t\t\t\ttype : \"audio\",\r\n\t\t\t\t\t\tcommenter: Meteor.userId(),\r\n\t\t\t\t\t\tuserType: \"student\"\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else if(Meteor.userId() && Roles.userIsInRole(Meteor.userId(), \"tutor\")) {\r\n\t\t\taudioRecordings.update({ _id : fileId },\r\n\t\t\t{\r\n\t\t\t\t$addToSet : { \r\n\t\t\t\t\tcomments : { \r\n\t\t\t\t\t\t_id : commentId, \r\n\t\t\t\t\t\ttype : \"audio\",\r\n\t\t\t\t\t\tcommenter: Meteor.userId(),\r\n\t\t\t\t\t\tuserType: \"tutor\"\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}else if(Meteor.userId() && Roles.userIsInRole(Meteor.userId(), \"moderator\")) {\r\n\t\t\taudioRecordings.update({ _id : fileId },\r\n\t\t\t{\r\n\t\t\t\t$addToSet : { \r\n\t\t\t\t\tcomments : { \r\n\t\t\t\t\t\t_id : commentId, \r\n\t\t\t\t\t\ttype : \"audio\",\r\n\t\t\t\t\t\tcommenter: Meteor.userId(),\r\n\t\t\t\t\t\tuserType: \"tutor\"\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}else if(Meteor.userId() && Roles.userIsInRole(Meteor.userId(), \"admin\")) {\r\n\t\t\taudioRecordings.update({ _id : fileId },\r\n\t\t\t{\r\n\t\t\t\t$addToSet : { \r\n\t\t\t\t\tcomments : { \r\n\t\t\t\t\t\t_id : commentId, \r\n\t\t\t\t\t\ttype : \"audio\",\r\n\t\t\t\t\t\tcommenter: Meteor.userId(),\r\n\t\t\t\t\t\tuserType: \"admin\"\r\n\t\t\t\t\t} \r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\t'insertAudioTextComment': function(noteId, commentText) {\r\n\t\tif (Meteor.userId() && Roles.userIsInRole(Meteor.user(), \"student\")) {\r\n\t\t\taudioRecordings.update({ _id : noteId }, \r\n\t\t\t\t{\t\r\n\t\t\t\t\t$addToSet: { \r\n\t\t\t\t\t\tcomments : { \r\n\t\t\t\t\t\t\tcomment : commentText,\r\n\t\t\t\t\t\t\ttype : \"text\",\r\n\t\t\t\t\t\t\tcommenter: Meteor.userId(),\r\n\t\t\t\t\t\t\tuserType: \"student\"\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} else if(Meteor.userId() && Roles.userIsInRole(Meteor.user(), \"tutor\")) {\r\n\t\t\taudioRecordings.update({ _id : noteId }, \r\n\t\t\t\t{\t\r\n\t\t\t\t\t$addToSet: { \r\n\t\t\t\t\t\tcomments : { \r\n\t\t\t\t\t\t\tcomment : commentText,\r\n\t\t\t\t\t\t\ttype : \"text\",\r\n\t\t\t\t\t\t\tcommenter: Meteor.userId(),\r\n\t\t\t\t\t\t\tuserType: \"tutor\"\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} else if(Meteor.userId() && Roles.userIsInRole(Meteor.user(), \"moderator\")) {\r\n\t\t\taudioRecordings.update({ _id : noteId }, \r\n\t\t\t\t{\t\r\n\t\t\t\t\t$addToSet: { \r\n\t\t\t\t\t\tcomments : { \r\n\t\t\t\t\t\t\tcomment : commentText,\r\n\t\t\t\t\t\t\ttype : \"text\",\r\n\t\t\t\t\t\t\tcommenter: Meteor.userId(),\r\n\t\t\t\t\t\t\tuserType: \"tutor\"\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t} else if(Meteor.userId() && Roles.userIsInRole(Meteor.user(), \"admin\")) {\r\n\t\t\taudioRecordings.update({ _id : noteId }, \r\n\t\t\t\t{\t\r\n\t\t\t\t\t$addToSet: { \r\n\t\t\t\t\t\tcomments : { \r\n\t\t\t\t\t\t\tcomment : commentText,\r\n\t\t\t\t\t\t\ttype : \"text\",\r\n\t\t\t\t\t\t\tcommenter: Meteor.userId(),\r\n\t\t\t\t\t\t\tuserType: \"Admin\"\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n})","Meteor.methods({\r\n\r\n\t'submitBugReport': function(device, browser, location, description, uID) {\r\n\t\tvar d = new Date();\r\n\t\tvar formattedDate = (\"0\" + d.getDate()).slice(-2) + \"-\" + (\"0\"+(d.getMonth()+1)).slice(-2) + \"-\" + d.getFullYear() + \" \" + (\"0\" + d.getHours()).slice(-2) + \":\" + (\"0\" + d.getMinutes()).slice(-2);\r\n\r\n\t\ttry {\r\n\t\t\treturn bug_reports.insert({userId: uID, status: \"New\", date: formattedDate, device: device, browser: browser, location: location, description: description });\r\n\t\t} catch (err) {\r\n\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t}\r\n\t},\r\n\r\n\t'changeBugReportStatus': function(status, bugId){\r\n\t\tif (Roles.userIsInRole( Meteor.userId(), 'admin' )) {\r\n\t\t\ttry {\r\n\t\t\t\treturn bug_reports.update({_id : bugId}, {$set : {status : status}});\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not an admin - no permission to change bug report status.');\r\n\t\t}\r\n\t}\r\n});","Meteor.methods({\n\n    'addBagdeRecord': function (org, progTitle, progId, firstName, lastName, gender, email, dateofbirth) {\n        var currentDate = new Date();\n        var date = currentDate.toDateString();\n\n        try {\n\t\t\treturn CGBadgeData.insert({\n                \"Organisation Name\": org,\n                \"Programme Title\": progTitle,\n                \"Programme ID\": progId,\n                \"First Name\": firstName,\n                \"Last Name\": lastName,\n                \"Gender\": gender,\n                \"Email Address\": email,\n                \"Date of Birth\": dateofbirth,\n                \"Date of details submission\": currentDate\n            });\n\t\t} catch (err) {\n\t\t\tthrow new Meteor.Error(err.message);\n\t\t}\n    },\n\n    'sendCertificateDetailsEmail': function (orgName, fName, lName, gender, email, dateofbirth) {\n\t\t// Send the email\n\t\tvar recipient = \"svetlozar@klik2learn.com\";\n\t\tvar emailSubject = \"Certificate Details Submitted\";\n        var emailContent = \"A user with the following details has just added their certificate details for requesting their Assured Customer Credential: \\nFirst Name: \" + fName + \"\\nLast Name: \" + lName + \"\\nGender: \" + gender + \"\\nDate of Birth: \" + dateofbirth + \"\\nEmail: \" + email + \"\\nOrganisation: \" + orgName;\n\t\tEmail.send({\n            to: recipient,\n            from: \"noreply@journey2english.com\",\n            subject: emailSubject,\n            text: emailContent\n        });\n    },\n    \n    'sendNotificationMessage': function(fName, lName, email) {\n\n        var receiver = Meteor.users.findOne({username:\"cgbadge\"})._id;\n        var msgsubject = \"New certificate details submitted\";\n        var msgbody = \"A user has completed the course and submitted the details for their certificate. \\nThe details they've used on the certificate are:\\nFull name: \" + fName + \" \" + lName + \"\\nEmail: \" + email;\n        var uID = Meteor.userId();\n        \n\t\tif(msgbody == ''){\n\t\t\tthrow new Meteor.Error(500, 'You can\\'t send an empty message.');\n\t\t} else if(msgsubject == '') {\n\t\t\tthrow new Meteor.Error(500, 'You can\\'t send a message without a subject.');\n\t\t} else {\n\t\t\tvar d = new Date();\n\t\t\t// var formattedDate = (\"0\" + d.getDate()).slice(-2) + \"-\" + (\"0\"+(d.getMonth()+1)).slice(-2) + \"-\" + d.getFullYear() + \" \" + (\"0\" + d.getHours()).slice(-2) + \":\" + (\"0\" + d.getMinutes()).slice(-2);\n\t\t\tvar dayNames = [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thur\",\"Fri\",\"Sat\"];\n\t\t\tvar monthNames = [  \"Jan\", \"Feb\", \"Mar\",  \"Apr\", \"May\", \"June\", \"July\",  \"Aug\", \"Sept\", \"Oct\",  \"Nov\", \"Dec\"];\n\t\t\tvar date = new Date();\n\t\t\tvar dayIndex = date.getDay();\n\t\t\tvar dateNo = date.getDate();\n\t\t\tvar monthIndex = date.getMonth();\n\t\t\tvar year = date.getFullYear();\n\t\t\tvar hours = date.getHours();\n\t\t\tvar minutes = (date.getMinutes()<10?'0':'') + date.getMinutes();\n\t\t\tvar formattedDate = dayNames[dayIndex] + ' ' + monthNames[monthIndex] + ' ' + dateNo + ' ' + year + ' ' + hours + ':' + minutes;\n\n            //Sending a message to admin \"cgbadge\" to let him know that a user has submitted their certificate details\n\t\t\tmessages.insert(                    \n                {\"p1\": receiver, \"p2\": receiver, \"p1_unread\": false, \"p2_unread\": true, \"p1_visible\":true, \"p2_visible\": true, \"title\": msgsubject, \"messages\": [{\"sender\": receiver, \"date\": formattedDate,  \"message\": msgbody}] }\n            );\n            //Seding a message to user that has just submitted their certificate details to let them know that the details have been passed on to an admin\n            messages.insert(\n                {\"p1\": uID, \"p2\": uID, \"p1_unread\": false, \"p2_unread\": true, \"p1_visible\":true, \"p2_visible\": true, \"title\": \"Course completed!\", \"messages\": [{\"sender\": uID, \"date\": formattedDate,  \"message\": \"Congratulations on completing 'Journey 2 English!'  We've received your details and are forwarding them to City & Guilds. They will send you your Digital Credentials badge. You can share this on social media and on your CV.\"}]}\n            )\n\t\t}\n\t},\n})","Meteor.methods({\r\n\r\n\t'submitContactForm': function(formType, name, email, organisation, uID) {\r\n\t\tvar d = new Date();\r\n\t\tvar formattedDate = (\"0\" + d.getDate()).slice(-2) + \"-\" + (\"0\"+(d.getMonth()+1)).slice(-2) + \"-\" + d.getFullYear() + \" \" + (\"0\" + d.getHours()).slice(-2) + \":\" + (\"0\" + d.getMinutes()).slice(-2);\r\n\r\n\t\ttry {\r\n\t\t\treturn contact_form.insert({userId: uID, formType: formType, status: \"New\", date: formattedDate, name: name, email: email, organisation: organisation[0]});\r\n\t\t} catch (err) {\r\n\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t}\r\n\t},\r\n\r\n\t'changeContactFormStatus': function(status, messageId){\r\n\t\tif (Roles.userIsInRole( Meteor.userId(), 'admin' )) {\r\n\t\t\ttry {\r\n\t\t\t\treturn contact_form.update({_id : messageId}, {$set : {status : status}});\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not an admin - no permission to change contact form status.');\r\n\t\t}\r\n\t}\r\n});","Meteor.methods({\n    'getUsernameFromId': function(userId){\n        var user = checkUser(userId);\n\n        return user.username;\n    },\n\n    'getUserProfileFromId': function(userId){\n        var user = checkUser(userId);\n\n        return user.profile;\n    }\n});\n\nvar checkUser = function(userId){\n    if(userId == null || userId == 'undefined'){\n        throwError(\"UserId undefined\");\n    }\n    var user = Meteor.users.findOne({_id: userId});\n\n    if(user == null || user == 'undefined'){\n        throwError(\"No such user: \" + userId);\n    }\n\n    return user;\n}\n\nvar throwError = function(msg){\n    throw new Meteor.Error(msg);\n}","Meteor.methods({\r\n    // Returns the 'Best Match' of the user's search.\r\n    // 'dictionaryGBMRequest': function(searchTerm) {\r\n    // \tif (Meteor.userId) {\r\n    // \t\tvar result = HTTP.call('GET', 'https://api.collinsdictionary.com/api/v1/dictionaries/english-learner/search/first/?q=' + searchTerm + '&format=html',\r\n    // \t\t\t{ headers: { \r\n    // \t\t\t\t\tAccept: 'application/xml', \r\n    // \t\t\t\t\taccessKey: 'fBAPlBWOupM2dPpU4njH75ATCjVmNDBZO4IHV4RgtjDoKxJdkNmhZkstKG5ohnz4'\r\n    // \t\t\t\t}\r\n    // \t\t\t});\r\n    // \t\treturn result;\r\n    // \t}\r\n    // },\r\n\r\n\r\n    'dictionarySearch': function(searchTerm) {\r\n        if (Meteor.userId) {\r\n            var result = HTTP.call('GET', 'https://od-api.oxforddictionaries.com/api/v2/entries/en/' + searchTerm, {\r\n                headers: {\r\n                    Accept: 'application/json',\r\n                    app_id: '046baef6',\r\n                    app_key: '6479550290009ca38a812a64e7337f5d'\r\n                }\r\n            });\r\n            return result;\r\n        }\r\n    },\r\n\r\n    // Used to find the 'See Also' words and phrases which is returned from other searches.\r\n    'dictionaryEntrySearch': function(searchTerm) {\r\n            var result = HTTP.call('GET', 'https://api.collinsdictionary.com/api/v1/dictionaries/english-learner/entries/' + searchTerm + '?format=html', {\r\n                headers: {\r\n                    Accept: 'application/xml',\r\n                    accessKey: 'fBAPlBWOupM2dPpU4njH75ATCjVmNDBZO4IHV4RgtjDoKxJdkNmhZkstKG5ohnz4'\r\n                }\r\n            });\r\n            return result;\r\n        }\r\n        /*'dictionaryMASRequest': function(searchTerm){\r\n        \tvar result = HTTP.call(\"GET\", \"https://dictionary.cambridge.org/api/v1/dictionaries/learner-english/search/?q=\" + searchTerm,\r\n        \t\t\t\t\t\t\t{headers: {accessKey: 'XeP9lybBzAcet0psiaZOTkRLk7QGsfUE2hSJYBOUFxgKCZcghvcu5vGBlJO6QnmC'}});\r\n        \t\r\n        \tvar resultList = result.data.results; // All the resuls from the search\t\r\n        \tvar matchedList = [];\r\n        \t\r\n        \tfor (var i = 0; i < resultList.length; i++){\r\n        \t\tif (resultList[i].entryId == searchTerm || resultList[i].entryId == (searchTerm+'_' + (i + 1))) {\r\n        \t\t\tvar found = false;\r\n        \t\t\tfor (var j = 0; j < matchedList.length; j++){\r\n        \t\t\t\tif (matchedList[j] == resultList[i].entryId) {\r\n        \t\t\t\t\tfound = true;\r\n        \t\t\t\t\tbreak;\r\n        \t\t\t\t}\r\n        \t\t\t}\r\n        \t\t\t//var found = jQuery.inArray(resultList.entryId, matchedList) > -1; // Check if entryId is in array\r\n        \t\t\tif (!found){\r\n        \t\t\t\tmatchedList.push(resultList[i]);\r\n        \t\t\t}\r\n        \t\t}\r\n        \t}\r\n        \t\r\n        \tvar entriesList = [];\r\n        \tfor (var i = 0; i < matchedList.length; i++){\r\n        \t\tvar result = HTTP.call(\"GET\", \"https://dictionary.cambridge.org/api/v1/dictionaries/learner-english/entries/\" + matchedList[i].entryId + '/',\r\n        \t\t\t\t\t\t\t   {headers: {accessKey: 'XeP9lybBzAcet0psiaZOTkRLk7QGsfUE2hSJYBOUFxgKCZcghvcu5vGBlJO6QnmC'}});\r\n        \t\tentriesList.push(result);\r\n        \t}\r\n        \treturn entriesList;\r\n        },\r\n          \r\n         'dictionaryGBMRequest': function(searchTerm){\r\n        \tvar result = HTTP.call(\"GET\", \"https://dictionary.cambridge.org/api/v1/dictionaries/learner-english/search/first/?q=\" + searchTerm,\r\n        \t\t\t\t\t\t   {headers: {accessKey: 'XeP9lybBzAcet0psiaZOTkRLk7QGsfUE2hSJYBOUFxgKCZcghvcu5vGBlJO6QnmC'}});\r\n        \t\treturn result;\r\n        }*/\r\n        /*'dictionaryMASRequest': function(searchTerm){\r\n        \tvar result = HTTP.call('GET', 'https://api.collinsdictionary.com/api/v1/dictionaries/english-learner/search/?q=' + searchTerm,\r\n        \t\t{ headers: { \r\n        \t\t\t\tAccept: 'application/json', \r\n        \t\t\t\taccessKey: 'fBAPlBWOupM2dPpU4njH75ATCjVmNDBZO4IHV4RgtjDoKxJdkNmhZkstKG5ohnz4'\r\n        \t\t\t}\r\n        \t\t}, function(error, result) {\r\n        \t\t\tif (!error) {\r\n        \t\t\t\tfor (var i = 0; i < result.data.results.length; i++) {\r\n        \t\t\t\t\tconsole.log(result.data.results[i].entryUrl);\r\n        \t\t\t\t}\r\n        \t\t\t}\r\n        \t\t\treturn result;\r\n        \t\t});\r\n\t\r\n\r\n        },*/\r\n\r\n\r\n\r\n\r\n})","Meteor.methods({\n\n    'submitFeedbackForm': function(name, scores, comments, uID) {\n\t\tvar d = new Date();\n\t\tvar formattedDate = (\"0\" + d.getDate()).slice(-2) + \"-\" + (\"0\"+(d.getMonth()+1)).slice(-2) + \"-\" + d.getFullYear() + \" \" + (\"0\" + d.getHours()).slice(-2) + \":\" + (\"0\" + d.getMinutes()).slice(-2);\n\n\t\ttry {\n\t\t\treturn feedback_forms.insert({userId: uID, name: name, date: formattedDate, scores: scores, comments: comments });\n\t\t} catch (err) {\n\t\t\tthrow new Meteor.Error(err.message);\n\t\t}\n\t},\n\n});","Meteor.methods({\r\n\t'UpdateForum': function (target, ids) {\r\n\t\tif (target == \"organisation\") { /* Add new Organisation */\r\n\t\t\tf_forums.insert({\r\n\t\t\t\torganisation: ids.organisation,\r\n\t\t\t\tgroups: []\r\n\t\t\t});\r\n\r\n\t\t} else if (target == \"group\") { /* Add new Group */\r\n\t\t\tvar newGroup = {\r\n\t\t\t\tid: ids.group,\r\n\t\t\t\tthreads: [],\r\n\t\t\t\tsubgroups: []\r\n\t\t\t};\r\n\r\n\t\t\tf_forums.update({ organisation: ids.organisation }, {\r\n\t\t\t\t$push: {\r\n\t\t\t\t\tgroups: newGroup\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t} else if (target == \"subgroup\") { /* Add new Subgroup */\r\n\t\t\tvar newSubgroup = {\r\n\t\t\t\tid: ids.subgroup,\r\n\t\t\t\tthreads: []\r\n\t\t\t};\r\n\r\n\t\t\tf_forums.update({ organisation: ids.organisation, groups: { $elemMatch: { id: ids.group } } }, {\r\n\t\t\t\t$push: {\r\n\t\t\t\t\t\"$.subgroups\": newSubgroup\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t} else if (target == \"organisationDelete\") {\r\n\t\t\tf_forums.remove({ organisation: orgId });\r\n\r\n\t\t} else if (target == \"groupDelete\") {\r\n\t\t\tvar orgId = groups.findOne({ _id: ids.group }).organisation;\r\n\t\t\tf_forums.update({ organisation: orgId }, { $pull: { groups: { $elemMatch: { id: ids.group } } } });\r\n\r\n\t\t} else if (target == \"subgroupDelete\") {\r\n\t\t\tvar orgId = groups.findOne({ _id: ids.group }).organisation;\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: ids.group } } }, { $pull: { \"$.subgroups\": { $elemMatch: { id: ids.subgroup } } } });\r\n\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(\"Unknown operation '\" + target + \"' in Meteor method 'UpdateForum'\");\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t'createNewThread': function (organisationId, group, subgroup, title, post, uID) {\r\n\t\tvar formattedDate = getFormattedDate();\r\n\r\n\t\tvar currentUser = Meteor.users.findOne({ _id: uID });\r\n\t\tvar orgId = currentUser.organisation;\r\n\t\tvar groups = currentUser.groups;\r\n\t\tvar oldGroupThreads = [];\r\n\t\tgetGroupThreads(organisationId, group).forEach(function (thread) {\r\n\t\t\toldGroupThreads.push(thread);\r\n\t\t});\r\n\r\n\t\tif (!admin()) {\r\n\t\t\tvar wrongOrg = (orgId != organisationId);\r\n\t\t\tvar wrongGroup = (student() || tutor()) && (groups.indexOf(group) == -1);\r\n\t\t\tif (wrongOrg || wrongGroup) {\r\n\t\t\t\tthrow new Meteor.Error(500, 'No permission to make a thread here.');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar newThreads = { \"title\": title, \"date\": formattedDate, \"posts\": [{ poster: Meteor.userId(), date: formattedDate, content: post }] };\r\n\t\t} else {\r\n\t\t\tvar newThreads = { \"title\": title, \"date\": formattedDate, sticky: false, \"posts\": [{ poster: Meteor.userId(), date: formattedDate, content: post }] };\r\n\t\t}\r\n\r\n\r\n\t\tif (subgroup == null) {\r\n\t\t\t/* New Group Thread */\r\n\t\t\toldGroupThreads.push(newThreads);\r\n\t\t\tf_forums.update({ organisation: organisationId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.threads\": oldGroupThreads } });\r\n\r\n\t\t} else {\r\n\t\t\t/* New Subgroup Thread */\r\n\t\t\t//This does not work in mongoDB - multiple $ are not allowed.\r\n\t\t\t//Instead take the whole subgroups part of groups.$ and replace that.\r\n\t\t\tvar oldSubgroups = getGroupSubgroups(organisationId, group);\r\n\t\t\toldSubgroups = pushSubgroupThread(oldSubgroups, subgroup, newThreads);\r\n\t\t\tf_forums.update({ organisation: organisationId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.subgroups\": oldSubgroups } });\r\n\t\t}\r\n\r\n\t},\r\n\r\n\r\n\t'toggleSticky': function (orgId, group, subgroup, threadNo, uID, lock) {\r\n\t\tif (lock == true) {\r\n\t\t\tthrow new Meteor.Error(500, 'Previous toggle still executing. Please wait.');\r\n\t\t}\r\n\r\n\t\tvar currentUser = Meteor.users.findOne({ _id: uID });\r\n\r\n\t\tfor(orgId of currentUser.organisation){\r\n\t\t\tif (!admin() && orgId != currentUser.organisation) {\r\n\t\t\t\tthrow new Meteor.Error(500, 'You\\'re not part of this organisation!');\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\r\n\t\tif (subgroup == null) {\r\n\t\t\tvar threads = getGroupThreads(orgId, group);\r\n\t\t\tthreads[threadNo].sticky = (sticky == null || sticky == undefined) ? true : !threads[threadNo].sticky;\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.threads\": threads } });\r\n\t\t} else {\r\n\t\t\tvar subgroups = getGroupSubgroups(orgId, group);\r\n\t\t\tsubgroups.forEach(function (subG) {\r\n\t\t\t\tif (subG.id == subgroup) {\r\n\t\t\t\t\tsubG.threads[threadNo].sticky = !subG.threads[threadNo].sticky;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.subgroups\": subgroups } });\r\n\t\t}\r\n\t},\r\n\r\n\t'editThreadTitle': function (orgId, group, subgroup, threadNo, uID, newTitle) {\r\n\r\n\t\tvar currentUser = Meteor.users.findOne({ _id: uID });\r\n\r\n\t\tfor(orgId of currentUser.organisation){\r\n\t\t\tif (!admin() && orgId != currentUser.organisation) {\r\n\t\t\t\tthrow new Meteor.Error(500, 'You\\'re not part of this organisation!');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (subgroup == null) {\r\n\t\t\tvar threads = getGroupThreads(orgId, group);\r\n\t\t\tthreads[threadNo].title = newTitle;\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.threads\": threads } });\r\n\t\t} else {\r\n\t\t\tvar subgroups = getGroupSubgroups(orgId, group);\r\n\t\t\tsubgroups.forEach(function (subG) {\r\n\t\t\t\tif (subG.id == subgroup) {\r\n\t\t\t\t\tsubG.threads[threadNo].title = newTitle;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.subgroups\": subgroups } });\r\n\t\t}\r\n\t},\r\n\r\n\t'deleteThread': function (orgId, group, subgroup, threadNo, uID) {\r\n\r\n\t\tvar currentUser = Meteor.users.findOne({ _id: uID });\r\n\r\n\t\tfor(orgId of currentUser.organisation) {\r\n\t\t\tif (!admin() && orgId != currentUser.organisation) {\r\n\t\t\t\tthrow new Meteor.Error(500, 'You\\'re not part of this organisation!');\r\n\t\t\t}\r\n\t\t}\t\t\r\n\r\n\t\tif (subgroup == null) {\r\n\r\n\t\t\tvar threads = getGroupThreads(orgId, group);\r\n\t\t\tthreads.splice(threadNo, 1);\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.threads\": threads } });\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar oldSubgroups = getGroupSubgroups(orgId, group);\r\n\t\t\toldSubgroups.forEach(function (subG) {\r\n\t\t\t\tif (subG.id == subgroup) {\r\n\t\t\t\t\tsubG.threads.splice(threadNo, 1);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.subgroups\": oldSubgroups } });\r\n\r\n\t\t}\r\n\t},\r\n\r\n\t'editPost': function (orgId, group, subgroup, threadNo, postNo, uID, newContent) {\r\n\t\tvar formattedDate = getFormattedDate();\r\n\r\n\t\tvar currentUser = Meteor.users.findOne({ _id: uID });\r\n\r\n\t\tfor(orgId of currentUser.organisation) {\r\n\t\t\tif (!admin() && orgId != currentUser.organisation) {\r\n\t\t\t\tthrow new Meteor.Error(500, 'You\\'re not part of this organisation!');\r\n\t\t\t}\r\n\t\t}\t\t\r\n\r\n\t\tnewContent = newContent + \"\\n\\nEdited by poster on \" + formattedDate;\r\n\r\n\t\tif (subgroup == null) {\r\n\r\n\t\t\tvar threads = getGroupThreads(orgId, group);\r\n\t\t\tthreads[threadNo].posts[postNo].content = newContent;\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.threads\": threads } });\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar oldSubgroups = getGroupSubgroups(orgId, group);\r\n\t\t\toldSubgroups.forEach(function (subG) {\r\n\t\t\t\tif (subG.id == subgroup) {\r\n\t\t\t\t\tsubG.threads[threadNo].posts[postNo].content = newContent;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.subgroups\": oldSubgroups } });\r\n\r\n\t\t}\r\n\t},\r\n\r\n\t'replyInThread': function (orgId, group, subgroup, threadNo, post, uID) {\r\n\t\tvar formattedDate = getFormattedDate();\r\n\r\n\t\t\r\n\t\tvar currentUser = Meteor.users.findOne({ _id: uID });\r\n\t\t\r\n\t\tfor (orgId of currentUser.organisation) {\r\n\t\t\tif (!admin() && orgId != currentUser.organisation) {\r\n\t\t\t\tthrow new Meteor.Error(500, 'You\\'re not part of this organisation!');\r\n\t\t\t}\r\n\t\t}\t\t\r\n\r\n\t\tvar newPost = {\r\n\t\t\tposter: uID,\r\n\t\t\tdate: formattedDate,\r\n\t\t\tcontent: post\r\n\t\t};\r\n\t\tif (subgroup == null) {\r\n\r\n\t\t\tvar threads = getGroupThreads(orgId, group);\r\n\t\t\tthreads[threadNo].posts.push(newPost);\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.threads\": threads } });\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvar oldSubgroups = getGroupSubgroups(orgId, group);\r\n\t\t\toldSubgroups.forEach(function (subG) {\r\n\t\t\t\tif (subG.id == subgroup) {\r\n\t\t\t\t\tsubG.threads[threadNo].posts.push(newPost);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.subgroups\": oldSubgroups } });\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t'deletePost': function (orgId, group, subgroup, threadNo, postNo, uID) {\r\n\r\n\t\tvar currentUser = Meteor.users.findOne({ _id: uID });\r\n\t\t\r\n\t\tfor (orgId of currentUser.organisation) {\r\n\t\t\tif (!admin() && orgId != currentUser.organisation) {\r\n\t\t\t\tthrow new Meteor.Error(500, 'You\\'re not part of this organisation!');\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t\t\r\n\t\tif (subgroup == null) {\r\n\r\n\t\t\tvar threads = getGroupThreads(orgId, group);\r\n\t\t\tthreads[threadNo].posts.splice(postNo, 1);\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.threads\": threads } });\r\n\t\t\t\r\n\t\t\tif(threads[threadNo].posts.length == 0){\r\n\t\t\t\tMeteor.call(\"deleteThread\", orgId, group, subgroup, threadNo, uID);\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\tvar oldSubgroups = getGroupSubgroups(orgId, group);\r\n\t\t\tvar removeTopic = false;\r\n\t\t\toldSubgroups.forEach(function (subG) {\r\n\t\t\t\tif (subG.id == subgroup) {\r\n\t\t\t\t\tsubG.threads[threadNo].posts.splice(postNo, 1);\r\n\t\t\t\t\tif(subG.threads[threadNo].posts.length == 0){\r\n\t\t\t\t\t\tremoveTopic = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tf_forums.update({ organisation: orgId, groups: { $elemMatch: { id: group } } }, { $set: { \"groups.$.subgroups\": oldSubgroups } });\r\n\t\t\t\r\n\t\t\tif(removeTopic){\r\n\t\t\t\tMeteor.call(\"deleteThread\", orgId, group, subgroup, threadNo, uID);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n\r\n\r\nupdateForumPost = function (target, ids, obj) {\r\n\tif (target == \"group\") {\r\n\t\tf_forums.update({ organisation: ids.organisation, groups: { $elemMatch: { id: ids.group } } }, { $set: obj });\r\n\t} else if (target == \"subgroup\") {\r\n\t\tf_forums.update({ organisation: ids.organisation, groups: { $elemMatch: { id: ids.group } }, \"$.subgroups\": { $elemMatch: { id: ids.subgroup } } }, { $set: obj });\r\n\t}\r\n}\r\n\r\n\r\ngetFormattedDate = function () {\r\n\tvar d = new Date();\r\n\t// var formattedDate = (\"0\" + d.getDate()).slice(-2) + \"-\" + (\"0\"+(d.getMonth()+1)).slice(-2) + \"-\" + d.getFullYear() + \" \" + (\"0\" + d.getHours()).slice(-2) + \":\" + (\"0\" + d.getMinutes()).slice(-2);\r\n\tvar dayNames = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thur\", \"Fri\", \"Sat\"];\r\n\tvar monthNames = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"June\", \"July\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\r\n\tvar date = new Date();\r\n\tvar dayIndex = date.getDay();\r\n\tvar dateNo = date.getDate();\r\n\tvar monthIndex = date.getMonth();\r\n\tvar year = date.getFullYear();\r\n\tvar hours = date.getHours();\r\n\tvar minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();\r\n\r\n\treturn dayNames[dayIndex] + ' ' + monthNames[monthIndex] + ' ' + dateNo + ' ' + year + ' ' + hours + ':' + minutes;\r\n}\r\n\r\nadmin = function () {\r\n\treturn Roles.userIsInRole(Meteor.userId(), 'admin');\r\n}\r\n\r\nmoderator = function () {\r\n\treturn Roles.userIsInRole(Meteor.userId(), 'moderator');\r\n}\r\n\r\ntutor = function () {\r\n\treturn Roles.userIsInRole(Meteor.userId(), 'tutor');\r\n}\r\n\r\nstudent = function () {\r\n\treturn Roles.userIsInRole(Meteor.userId(), 'student');\r\n}\r\n\r\ngetSubgroupThread = function (org, group, subgroup, thread) {\r\n\tvar groups = f_forums.findOne({ organisation: org, \"groups.id\": group }).groups;\r\n\tvar currG = null;\r\n\tgroups.forEach(function (item) {\r\n\t\tif (item[\"id\"] == groupId) {\r\n\t\t\tcurrG = item;\r\n\t\t}\r\n\t});\r\n\r\n\tvar threads = [];\r\n\r\n\tcurrG.subgroups.forEach(function (item) {\r\n\t\tif (item[\"id\"] == subgroup) {\r\n\t\t\tthreads = item.threads;\r\n\t\t}\r\n\t});\r\n\r\n\treturn threads[thread];\r\n\r\n}\r\n\r\ngetGroupThread = function (org, group) {\r\n\tvar groups = f_forums.findOne({ organisation: org, \"groups.id\": group }).groups;\r\n\tvar currG = null;\r\n\tgroups.forEach(function (item) {\r\n\t\tif (item[\"id\"] == groupId) {\r\n\t\t\tcurrG = item;\r\n\t\t}\r\n\t});\r\n\r\n\tvar threads = currG.threads;\r\n\r\n\treturn threads;\r\n}\r\n\r\n\r\ngetGroupThreads = function (orgId, groupId) {\r\n\tforumDoc = f_forums.findOne({ organisation: orgId });\r\n\tvar threads = [];\r\n\r\n\tforumDoc.groups.forEach(function (item) {\r\n\t\tif (item.id == groupId) {\r\n\t\t\titem.threads.forEach(function (thread) {\r\n\t\t\t\tthreads.push(thread);\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\treturn threads;\r\n\r\n}\r\n\r\ngetGroupSubgroups = function (orgId, groupId) {\r\n\tvar subgroups = [];\r\n\tvar forumDoc = f_forums.findOne({ organisation: orgId });\r\n\tforumDoc.groups.forEach(function (group) {\r\n\t\tif (group.id == groupId) {\r\n\t\t\tsubgroups = group.subgroups;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\treturn subgroups;\r\n}\r\n\r\n\r\npushSubgroupThread = function (oldGroupThreads, subgroupId, newThreads) {\r\n\toldGroupThreads.forEach(function (subgroup) {\r\n\t\tif (subgroup.id == subgroupId) {\r\n\t\t\tsubgroup.threads.push(newThreads);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\treturn oldGroupThreads;\r\n}","Meteor.methods({\r\n\t'addUserToGroupUsingGroupEditor': function (userId, groupId, role) {\r\n\t\tif ((Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator')) && groups.findOne({_id: groupId}) != null) {\r\n\t\t\tif (role == \"tutor\") {\r\n\t\t\t\tgroups.update({ _id: groupId }, { $push: { tutors: userId } });\r\n\t\t\t} else if (role == \"student\") {\r\n\t\t\t\tgroups.update({ _id: groupId }, { $push: { students: userId } });\r\n\t\t\t}\r\n\t\t\tMeteor.users.update({ _id: userId }, { $push: { groups: groupId } });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t'removeUserFromGroupUsingGroupEditor': function (userId, groupId, role) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator')) {\r\n\t\t\tif (role == \"tutor\") {\r\n\t\t\t\tgroups.update({ _id: groupId }, { $pull: { tutors: userId } });\r\n\t\t\t} else if (role == \"student\") {\r\n\t\t\t\tgroups.update({ _id: groupId }, { $pull: { students: userId } });\r\n\t\t\t}\r\n\t\t\tMeteor.users.update({ _id: userId }, { $pull: { groups: groupId } });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t'changeOrganisationOfAGroup': function (orgId, groupId) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n\t\t\tgroups.update({ _id: groupId }, { $set: { organisation: orgId } });\r\n\t\t\t/*\r\n\t\t\t\tChange the forum documents for those organisations\r\n\t\t\t*/\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'editGroupName': function (groupId, newTitle, uID) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator')) {\r\n\t\t\tgroups.update({ _id: groupId }, { $set: { name: newTitle } });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t// Creates a new group and adds Tutors and Students to the group\r\n\t'createNewGroup': function (aName, aTutors, aUsers, aOrganisation) {\r\n\t\tvar authorised = false;\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n\t\t\tauthorised = true;\r\n\t\t} else if (Roles.userIsInRole(Meteor.userId(), 'moderator')) {\r\n\t\t\tvar userDoc = Meteor.users.findOne({ _id: Meteor.userId() });\r\n\t\t\tif (userDoc.organisation.indexOf(aOrganisation) >= 0) {\r\n\t\t\t\tauthorised = true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\tif (authorised) {\r\n\t\t\tvar exists = groups.findOne({organisation: aOrganisation, name: aName});\r\n            if(exists != null && exists != undefined)\r\n                throw new Meteor.Error(\"Group with this name already exists in this organisation.\");\r\n \r\n\t\t\tgroups.insert({\r\n\t\t\t\tname: aName,\r\n\t\t\t\ttutors: aTutors,\r\n\t\t\t\tstudents: aUsers,\r\n\t\t\t\tsubgroups: [],\r\n\t\t\t\torganisation: aOrganisation\r\n\t\t\t}, function (error, result) {\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tthrow new Meteor.Error(\"Error creating group.\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (var i = 0; i < aTutors.length; i++) {\r\n\t\t\t\t\t\tMeteor.users.update({ _id: aTutors[i] }, { $addToSet: { groups: result.valueOf() } });\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (var j = 0; j < aUsers.length; j++) {\r\n\t\t\t\t\t\tMeteor.users.update({ _id: aUsers[j] }, { $addToSet: { groups: result.valueOf() } });\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//creates a forum for the group\r\n\t\t\t\t\t// //Outdated -  f_forums.insert({ organisation: aOrganisation, group: result.valueOf(), threads: [] });\r\n\r\n\t\t\t\t\tMeteor.call(\"UpdateForum\", \"group\", {organisation: aOrganisation, group: result.valueOf()}, function(err){\r\n\t\t\t\t\t\tif(err) throw new Meteor.Error(err);\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t// Deletes a Group and removes all references to it\r\n\t'deleteGroup': function (groupId) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator')) {\r\n\t\t\tvar group = groups.findOne({ _id: groupId });\r\n\t\t\tvar tutors = group.tutors;\r\n\t\t\tvar students = group.students;\r\n\t\t\tvar subgroups = group.subgroups;\r\n\r\n\t\t\t// Remove this group from all Tutors\r\n\t\t\tfor (var i = 0; i < tutors; i++) {\r\n\t\t\t\tMeteor.users.update({ _id: tutors[i] }, { $pull: { groups: groupId } });\r\n\t\t\t}\r\n\r\n\t\t\t// Remove this group from all Students\r\n\t\t\tfor (var j = 0; j < students; j++) {\r\n\t\t\t\tMeteor.users.update({ _id: students[j] }, { $pull: { groups: groupId } });\r\n\t\t\t}\r\n\r\n\t\t\t// Remove all subgroups in this group.\r\n\t\t\tfor (var k = 0; k < subgroups; k++){\r\n\t\t\t\tMeteor.call(\"deleteSubgroup\", subgroups[k]);\r\n\t\t\t}\r\n\r\n\t\t\t// Remove this group from the forum\r\n\t\t\tMeteor.call(\"UpdateForum\", \"groupDelete\", {group: groupId}, function(err){\r\n\t\t\t\tif(err) throw new Meteor.Error(err);\r\n\t\t\t})\r\n\r\n\r\n\t\t\t// Remove the Group\r\n\t\t\tgroups.remove({ _id: groupId });\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'createSubgroup': function(subgroupName, tutorId, groupId, organisationId){\r\n\t\t\r\n\t\tvar duplicates = subgroups.find({$and: [{ name: subgroupName}, { group: groupId}]}).count();\r\n\t\tif(duplicates != null && duplicates != 'undefined' && duplicates > 0){\r\n\t\t\tthrow new Meteor.Error(500, 'Subgroup with this name already exists, please try again');\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Roles.userIsInRole(Meteor.userId(), 'tutor')) {\r\n\t\t\t\r\n\t\t\tsubgroups.insert({\r\n\t\t\t\tname: subgroupName,\r\n\t\t\t\ttutor: tutorId,\r\n\t\t\t\tstudents: [],\r\n\t\t\t\tgroup: groupId,\r\n\t\t\t\torganisation: organisationId\r\n\t\t\t});\r\n\t\t\tvar subgroupId = subgroups.findOne({name: subgroupName})._id;\r\n\r\n\t\t\tMeteor.users.update({ _id: tutorId}, { $push: { subgroups: subgroupId } });\r\n\t\t\tgroups.update({_id: groupId}, { $push: { subgroups: subgroupId } });\r\n\t\t\tvar updated = f_forums.update({ groups: { $elemMatch: { id: groupId } } }, { $push: { \"groups.$.subgroups\": {\r\n\t\t\t\tid: subgroupId,\r\n\t\t\t\tthreads: [] \r\n\t\t\t }}});\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'deleteSubgroup': function(subgroupId){\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Roles.userIsInRole(Meteor.userId(), 'tutor')) {\t\t\t\r\n\t\t\tvar old = subgroups.findOne({ _id: subgroupId});\r\n\r\n\t\t\t/* remove the subgroup from all students' profiles */\r\n\t\t\tvar users = old.students;\r\n\t\t\tfor(var i = 0; i < users; i++){\r\n\t\t\t\tvar userId = users[i];\r\n\t\t\t\tMeteor.users.update({ _id: userId}, { $pull: { subgroups: subgroupId } });\r\n\t\t\t}\r\n\r\n\t\t\t/* remove the subgroup from the tutor's profile */\r\n\t\t\tvar tutor = old.tutor;\r\n\t\t\tMeteor.users.update({ _id: tutor}, { $pull: { subgroups: subgroupId } });\r\n\r\n\t\t\t/* remove the subgroup from the list of subgroups of its parent group */\r\n\t\t\tvar groupId = old.group;\r\n\t\t\tgroups.update({_id: groupId}, { $pull: { subgroups: subgroupId } });\r\n\r\n\t\t\t// Remove this subgroup from the forum\r\n\t\t\tMeteor.call(\"UpdateForum\", \"subgroupDelete\", {group: groupId, subgroup: subgroupId}, function(err){\r\n\t\t\t\tif(err) throw new Meteor.Error(err);\r\n\t\t\t})\r\n\r\n\t\t\t/* finally, delete the subgroup itself */\r\n\t\t\tsubgroups.remove({_id: subgroupId});\r\n\t\t\t\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'addStudentToSubgroup': function(subgroupId, studentId){\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Roles.userIsInRole(Meteor.userId(), 'tutor')) {\t\t\t\r\n\t\t\t\r\n\t\t\t/* Check if this student exsists */\r\n\t\t\tvar student = Meteor.users.findOne({_id: studentId});\r\n\t\t\tif(student == null){\r\n\t\t\t\tthrow new Meteor.Error(500, 'This student is doesn\\'t exsist, please try another one.');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t/* Check if the user is not already in the subgroup */\r\n\t\t\tvar currStudents = subgroups.findOne({_id: subgroupId}).students;\r\n\t\t\tif(currStudents > 0){\r\n\t\t\t\tcurrStudents.forEach(function(elem){\r\n\t\t\t\t\tif(elem == studentId){\r\n\t\t\t\t\t\tthrow new Meteor.Error(500, 'This student is already in this subgroup, please try another one.');\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t/* If everything is okay, proceed to update */\r\n\t\t\tsubgroups.update({ _id: subgroupId }, { $push: { students: studentId } });\r\n\t\t\tMeteor.users.update({ _id: studentId}, { $push: { subgroups: subgroupId } });\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'removeStudentFromSubgroup': function(subgroupId, studentId){\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Roles.userIsInRole(Meteor.userId(), 'tutor')) {\t\t\t\r\n\t\t\tsubgroups.update({ _id: subgroupId }, { $pull: { students: studentId } });\r\n\t\t\tMeteor.users.update({ _id: studentId}, { $pull: { subgroups: subgroupId } });\r\n\t\t} else {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t}\r\n\t\r\n\r\n});\r\n","var crypto = require('crypto'); // Node.js module for cryptography\n\n//encryption/decryption parameters\nlet password = '1234567890abcdef1234567890abcdef'; // password- same as on the hub\nlet iv = '1234567890abcdef' // initialization vector, same as on the hub\n\n\nMeteor.methods({\n    /*\n        encrypts @text based on 'aes-256-ctr' algorithm\n        @params text- text to be encrypted\n        @return encrypted- encrypted text value or Error if crypto module has not been found\n    */\n    'hub_encrypt': function (text) {\n        console.log('hub encrypt');\n        if (crypto) {\n            let cipher = crypto.createCipheriv('aes-256-ctr', password, iv)\n            let encrypted = cipher.update(text, 'utf8', 'hex')\n            encrypted += cipher.final('hex');\n            return encrypted;\n        }\n        return new Error('crypto module not found');\n    },\n\n    /*\n        decrypts @text based on 'aes-256-ctr' algorithm\n        @params text- text to be decrypted\n        @return dec- decrypted text value or Error if crypto module has not been found\n    */\n    'hub_decrypt': function (text) {\n        if (crypto) {\n            var decipher = crypto.createDecipheriv('aes-256-ctr', password, iv);\n            var dec = decipher.update(text, 'hex', 'utf8');\n            dec += decipher.final('utf8');\n            return dec;\n        }\n        return new Error('crypto module not found');\n    },\n\n    /* \n        --------------NOT USED---------------\n        got 404 responses from the hub on dev\n\n        sends POST request to hub API to receive an encrypted user email\n        @params key -  token for quering the hub API received earlier by get message \n        @returns j2e_email - encrypted j2e email received from the hub or Error if email has not been received\n                            or if there has been a network error\n    */\n   /*\n    'query_user_email_hub': async function (key) {\n        try {\n            const url = 'https://hub.klik2learn.com/api/getUserStatus'; // hub API url\n\n            let hub_resp = new Promise(function (resolve, reject) {\n                // call 'POST' request on hub API\n                HTTP.call('POST', url,\n                    { params: { userKey: key }, \n                      npmRequestOptions: { rejectUnauthorized: false } \n                    },\n                    function (err, res) {\n                        if (err) {\n                            resolve({res: res, err_msg: \"Error POST conn\", err: err});\n                        } else {\n                            //response content\n                            let res_content = res['content'];\n                            if (!res_content) {\n                                //reject(new Error('invalid POST response'));\n                                resolve({res: res, err: \"No res_content field\"});\n                            }\n                            res_content = JSON.parse(res_content);\n                            let data = res_content['data'];\n                            if (!data) {\n                                //reject(new Error('invalid POST response'));\n                                resolve({res: res, err: \"No data field\"});\n                            }\n                            let j2eId = data['j2eId']; //encrypted user email\n                            result = j2eId;\n                            resolve({j2eId: j2eId, res: res});\n                        }\n                    });\n            });\n\n            let j2e_email = await hub_resp;\n            return j2e_email;\n\n        } catch (e) {\n            // Got a network error, timeout, or HTTP error in the 400 or 500 range.\n            return Error('Network error');\n        }\n    }\n    */\n});","Meteor.methods({\r\n\t'sendMessage': function(receiver, msgsubject, msgbody, uID){\r\n\t\tif(msgbody == ''){\r\n\t\t\tthrow new Meteor.Error(500, 'You can\\'t send an empty message.');\r\n\t\t} else if(msgsubject == '') {\r\n\t\t\tthrow new Meteor.Error(500, 'You can\\'t send a message without a subject.');\r\n\t\t} else {\r\n\t\t\tvar d = new Date();\r\n\t\t\t// var formattedDate = (\"0\" + d.getDate()).slice(-2) + \"-\" + (\"0\"+(d.getMonth()+1)).slice(-2) + \"-\" + d.getFullYear() + \" \" + (\"0\" + d.getHours()).slice(-2) + \":\" + (\"0\" + d.getMinutes()).slice(-2);\r\n\t\t\tvar dayNames = [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thur\",\"Fri\",\"Sat\"];\r\n\t\t\tvar monthNames = [  \"Jan\", \"Feb\", \"Mar\",  \"Apr\", \"May\", \"June\", \"July\",  \"Aug\", \"Sept\", \"Oct\",  \"Nov\", \"Dec\"];\r\n\t\t\tvar date = new Date();\r\n\t\t\tvar dayIndex = date.getDay();\r\n\t\t\tvar dateNo = date.getDate();\r\n\t\t\tvar monthIndex = date.getMonth();\r\n\t\t\tvar year = date.getFullYear();\r\n\t\t\tvar hours = date.getHours();\r\n\t\t\tvar minutes = (date.getMinutes()<10?'0':'') + date.getMinutes();\r\n\t\t\tvar formattedDate = dayNames[dayIndex] + ' ' + monthNames[monthIndex] + ' ' + dateNo + ' ' + year + ' ' + hours + ':' + minutes;\r\n\r\n\t\t\tmessages.insert({\"p1\": uID, \"p2\": receiver, \"p1_unread\": false, \"p2_unread\": true, \"p1_visible\":true, \"p2_visible\": true, \"title\": msgsubject, \"messages\": [{\"sender\": uID, \"date\": formattedDate,  \"message\": msgbody}] });\r\n\t\t}\r\n\t},\r\n\r\n\t'sendReply': function( mID, sender, msgbody){\r\n\t\tif(msgbody == ''){\r\n\t\t\tthrow new Meteor.Error(500, 'You can\\'t send an empty message.');\r\n\t\t} else {\r\n\t\t\tvar d = new Date();\r\n\t\t\t// var formattedDate = (\"0\" + d.getDate()).slice(-2) + \"-\" + (\"0\"+(d.getMonth()+1)).slice(-2) + \"-\" + d.getFullYear() + \" \" + (\"0\" + d.getHours()).slice(-2) + \":\" + (\"0\" + d.getMinutes()).slice(-2);\r\n\t\t\tvar dayNames = [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thur\",\"Fri\",\"Sat\"];\r\n\t\t\tvar monthNames = [  \"Jan\", \"Feb\", \"Mar\",  \"Apr\", \"May\", \"June\", \"July\",  \"Aug\", \"Sept\", \"Oct\",  \"Nov\", \"Dec\"];\r\n\t\t\tvar date = new Date();\r\n\t\t\tvar dayIndex = date.getDay();\r\n\t\t\tvar dateNo = date.getDate();\r\n\t\t\tvar monthIndex = date.getMonth();\r\n\t\t\tvar year = date.getFullYear();\r\n\t\t\tvar hours = date.getHours();\r\n\t\t\tvar minutes = (date.getMinutes()<10?'0':'') + date.getMinutes();\r\n\t\t\tvar formattedDate = dayNames[dayIndex] + ' ' + monthNames[monthIndex] + ' ' + dateNo + ' ' + year + ' ' + hours + ':' + minutes;\r\n\r\n\t\t\tobj = {};\r\n\t\t\tobj[\"messages\"] = {\"sender\": sender, \"date\": formattedDate,  \"message\": msgbody}; \r\n\t\t\r\n\t\t\tmessages.update({$and:[{ _id : mID }]}, {$addToSet: obj});\r\n\r\n\t\t\tvar currentConv = messages.findOne({\"_id\": mID});\r\n\r\n\t\t\tif (currentConv.p1 == sender){\r\n\t\t\t\tmessages.update({$and:[{ _id : mID }]}, { $set : {p2_unread: true}});\r\n\t\t\t}else{\r\n\t\t\t\tmessages.update({$and:[{ _id : mID }]}, { $set : {p1_unread: true}});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t'deleteMessage': function(mID, uID){\r\n\t\tvar currentConv = messages.findOne({\"_id\": mID});\r\n\r\n\t\tif (currentConv.p1 == uID){\r\n\t\t\tmessages.update({$and:[{ _id : mID }]}, { $set : {p1_visible: false}});\r\n\t\t}else{\r\n\t\t\tmessages.update({$and:[{ _id : mID }]}, { $set : {p2_visible: false}});\r\n\t\t}\r\n\t},\r\n\r\n\t'readMessage': function(mID, uID){\r\n\t\tvar currentConv = messages.findOne({\"_id\": mID});\r\n\r\n\t\tif (currentConv.p1 == uID){\r\n\t\t\tmessages.update({$and:[{ _id : mID }]}, { $set : {p1_unread: false}});\r\n\t\t}else{\r\n\t\t\tmessages.update({$and:[{ _id : mID }]}, { $set : {p2_unread: false}});\r\n\t\t}\r\n\t}\r\n\r\n\r\n});","Meteor.methods({\r\n\r\n\t'saveNote': function(userId, title, body, formattedDate){\r\n\t\t// Do some checks on the data before writing to DB.\r\n\t\t\r\n\t\tif (title.length > 50) {\r\n\t\t\tthrow new Meteor.Error(\"Invalid Note Title\", \"The note title must be less than 50 characters (including spaces).\");\r\n\t\t} else if (title.length == 0) {\r\n\t\t\tthrow new Meteor.Error(\"Invalid Note Title\", \"You must enter a title for the note.\");\r\n\t\t} else if (body.length > 5000) { \r\n\t\t\tthrow new Meteor.Error(\"Invalid Note\", \"Your Note must not exceed 5000 characters. Your current character count is \" + body.length + \".\");\r\n\t\t} else if (body.length == 0) {\r\n\t\t\tthrow new Meteor.Error(\"Invalid Note\", \"You must enter a Note.\");\r\n\t\t} else {\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tuserNotes.insert({\r\n\t\t\t\tnoteAuthor: userId,\r\n\t\t\t\tnoteDate: formattedDate,\r\n\t\t\t\tnoteTitle: title,\r\n\t\t\t\tnoteBody: body\r\n\t\t\t});\t\r\n\t\t\treturn true\r\n\t\t}\r\n\t},\r\n\t\r\n\t'deleteNote': function(noteId){\r\n\t\tnote = userNotes.findOne({_id: noteId});\r\n\t\tif (note.noteAuthor == Meteor.userId() || Roles.userIsInRole( Meteor.userId(), 'admin' )) {\r\n\t\t\tuserNotes.remove({_id: noteId});\r\n\t\t}\r\n\t\t\t\t\r\n\t},\r\n\t\r\n\t'editNote': function(noteId, body){\r\n\t\tif (body.length == 0) {\r\n\t\t\tthrow new Meteor.Error(\"Invalid Note\", \"You must enter a Note.\");\r\n\t\t} else if (body.length > 5000) {\r\n\t\t\tthrow new Meteor.Error(\"Invalid Note\", \"Your Note must not exceed 5000 characters. Your current character count is \" + body.length + \".\");\r\n\t\t} else {\r\n\t\t\tuserNotes.update(\r\n\t\t\t\t{ _id: noteId },\r\n\t\t\t\t{\r\n\t\t\t\t\t$set: { noteBody: body }\r\n\t\t\t\t}\r\n\t\t\t)\r\n\t\t}\r\n\t},\r\n\r\n\t/****************************************\r\n\t*\r\n\t*\t\t\tCOMMENT METHODS\r\n\t*\r\n\t*****************************************/\r\n\t'insertNoteComment': function(noteId, body, comment) {\r\n\t\t// Check if Tutor/valid commentor\r\n\t\tif (Roles.userIsInRole(Meteor.user(), \"tutor\") || Roles.userIsInRole(Meteor.user(), \"admin\")) {\r\n\t\t\tuserNotes.update({ _id : noteId }, \r\n\t\t\t{\r\n\t\t\t\t$addToSet: { comments : {\r\n\t\t\t\t\t\t_id : Random.id(),\r\n\t\t\t\t\t\ttitle : \"na\",\r\n\t\t\t\t\t\tcomment: comment,\r\n\t\t\t\t\t\tauthor: Meteor.userId(),\r\n\t\t\t\t\t\tuserType: \"tutor\"\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t$set: { noteBody: body }\r\n\t\t\t})\r\n\t\t} \r\n\t},\r\n\r\n\t'insertCommentComment': function( noteId, updatedComment, commentId, comment) {\r\n\t\tif (Roles.userIsInRole(Meteor.user(), \"tutor\") || Roles.userIsInRole(Meteor.user(), \"admin\")) {\r\n\t\t\tuserNotes.update({ _id : noteId }, \r\n\t\t\t{\r\n\t\t\t\t$addToSet: { comments : {\r\n\t\t\t\t\t\t_id : Random.id(),\r\n\t\t\t\t\t\ttitle : \"na\",\r\n\t\t\t\t\t\tcomment: comment,\r\n\t\t\t\t\t\tauthor: Meteor.userId(),\r\n\t\t\t\t\t\tuserType: \"tutor\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tuserNotes.update({ _id : noteId, \"comments._id\" : commentId }, \r\n\t\t\t{\r\n\t\t\t\t$set: { \"comments.$.comment\" : updatedComment } \r\n\t\t\t})\r\n\t\t} \r\n\t},\r\n\r\n\t'insertStudentNoteComment': function(noteId, comment) {\r\n\t\t// Check if Student\r\n\t\tif (Roles.userIsInRole(Meteor.user(), \"student\") || Roles.userIsInRole(Meteor.user(), \"admin\")) {\r\n\t\t\tuserNotes.update({ _id : noteId },\r\n\t\t\t{\r\n\t\t\t\t$addToSet: { comments : {\r\n\t\t\t\t\t\t_id : Random.id(),\r\n\t\t\t\t\t\ttitle : \"na\",\r\n\t\t\t\t\t\tcomment: comment,\r\n\t\t\t\t\t\tauthor: Meteor.userId(),\r\n\t\t\t\t\t\tuserType: \"student\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else if (Roles.userIsInRole(Meteor.user(), \"tutor\") || Roles.userIsInRole(Meteor.user(), \"admin\")) {\r\n\t\t\tuserNotes.update({ _id : noteId },\r\n\t\t\t{\r\n\t\t\t\t$addToSet: { comments : {\r\n\t\t\t\t\t\t_id : Random.id(),\r\n\t\t\t\t\t\ttitle : \"na\",\r\n\t\t\t\t\t\tcomment: comment,\r\n\t\t\t\t\t\tauthor: Meteor.userId(),\r\n\t\t\t\t\t\tuserType: \"tutor\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\t\t\r\n\t\t}\r\n\t}\r\n\t\r\n})\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","Meteor.methods({\r\n\t'createNewOrg': function (orgName) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n\t\t\ttry {\r\n\t\t\t\tvar doc = organisations.insert({ name: orgName });\r\n\t\t\t\tvar orgId = organisations.findOne({ name: orgName })._id;\r\n\t\t\t\tMeteor.call(\"UpdateForum\", \"organisation\", { organisation: orgId }, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tthrow new Meteor.Error(err);\r\n\t\t\t\t\t\t//Do something\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn doc;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tif (err.code == 11000) {\r\n\t\t\t\t\tthrow new Meteor.Error('An organisation with the name  ' + orgName + ' already exists. Please enter a different value.');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Meteor.Error(err.message);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'editOrganisationName': function (orgId, newTitle, uID) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n\t\t\torganisations.update({ _id: orgId }, { $set: { name: newTitle } });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'deleteOrganisation': function (orgId, uID) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n\t\t\torganisations.remove({ _id: orgId });\r\n\t\t\tgroups.update({ organisation: orgId }, { $set: { organisation: \"\" } });\r\n\t\t\tMeteor.call(\"UpdateForum\", \"organisationDelete\", { organisation: orgId }, function (err) {\r\n\t\t\t\tif (err) throw new Meteor.Error(err);\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'changeOrganisationOfAUser': function (orgId, userId) {\r\n\t\tif (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n\t\t\tif (Roles.userIsInRole(Meteor.userId(), 'moderator')) {\r\n\t\t\t\tMeteor.users.update({ _id: userId }, { $addToSet: { organisation: [orgId] } });\r\n\t\t\t} else {\r\n\t\t\t\tMeteor.users.update({ _id: userId }, { $set: { organisation: [orgId] } });\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Meteor.Error(500, 'You\\'re not authorised.');\r\n\t\t}\r\n\t},\r\n\r\n\t'removeOrganisationFromUser': function(orgId, userId){\r\n\t\treturn Meteor.users.update({ _id: userId}, { $pull: { organisation: orgId}});\r\n\t},\r\n\r\n\t'addOrganisationToUser': function(orgId, userId){\r\n\t\treturn Meteor.users.update({ _id: userId }, { $addToSet: { organisation: orgId } });\r\n\t},\r\n\r\n\t'changeOrganisationLogoAlt': function (orgId, orgLogoAlt) {\r\n\t\treturn organisations.update({ _id: orgId }, { $set: { logoAlt: orgLogoAlt } });\r\n\t},\r\n\r\n\t'getOrgIdByName': function(orgName){\r\n\t\treturn organisations.findOne({\"name\": orgName})._id;\r\n\t}\r\n});\r\n","Meteor.methods({\r\n\r\n\t// PACKAGES\r\n\t// Loops through packages returning html for template\t\r\n\t'methodPackagesCollection': function () {\r\n\t\treturn payment_plans.find().fetch();\r\n\t},\r\n\r\n\t'methodSinglePackage': function (packageId) {\r\n\t\treturn payment_plans.find({ planId: packageId }).fetch();\r\n\t},\r\n\r\n\t\"redeemVoucher\": function (submittedCode) {\r\n\t\tvar selectedVouchers = vouchers.find({ code: submittedCode }).fetch();\r\n\t\tvar usedVouchers = appliedVouchers.find({ code: submittedCode }).fetch();\r\n\r\n\t\tif (selectedVouchers.length < 1) {\r\n\t\t\tthrow new Meteor.Error(500, 'Voucher not found or expired.');\r\n\t\t} else {\r\n\t\t\tif (selectedVouchers[0].active === true) {\r\n\r\n\t\t\t\tif (selectedVouchers[0].uId != null && selectedVouchers[0].uId != Meteor.userId()) {\r\n\t\t\t\t\tthrow new Meteor.Error(500, 'Voucher not found or expired.');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (selectedVouchers.length === 1) {\r\n\r\n\t\t\t\t\t\tif (selectedVouchers[0].limitedUsage === true) {\r\n\r\n\t\t\t\t\t\t\tif (usedVouchers.length < selectedVouchers[0].usageAmount) {\r\n\t\t\t\t\t\t\t\treturn selectedVouchers;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthrow new Meteor.Error(500, 'Voucher not found or expired.');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn selectedVouchers;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Meteor.Error(500, 'Voucher not found or expired.');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Meteor.Error(500, 'Voucher not found or expired.');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n});\r\n\r\n\r\n\r\n","    /**\r\n    *   @method:    chargeCard\r\n    *   @summary:   - This method process the stripe payment. On success updates account to include newly purchased time. \r\n    *               \r\n    *               \r\n    *   @requires:  - stripeToken,cost,planType& planAmount - sent accross from client/system/subscriptionPayment/subscriptions.js              \r\n    *\r\n    *   @returns:   True if user successfully added. False if an error occurs.\r\n    *  \r\n    *   @notes:   \tFor help contact Boundary Creative\r\n    */\r\n    \r\n\r\nMeteor.methods({\r\n  /*\r\n\t'chargeCard': function(stripeToken,cost,planType,planAmount,voucherArray) {\r\n\r\n\tvar testSecretKey =  Meteor.settings.private.testSecretKey;\r\n\tvar liveSecretKey =  Meteor.settings.private.liveSecretKey;\t  \r\n\t\r\n\tif (cost > 0){\r\n\t\tvar Stripe = StripeAPI(liveSecretKey);\r\n\t    Stripe.charges.create({\r\n\t      amount: cost,\r\n\t      currency: 'gbp',\r\n\t      source: stripeToken\r\n\t    },Meteor.bindEnvironment(function(err, charge) {\r\n\r\n\t      if (err === null){  \r\n\t\t\t  stripeLog.insert({ status : 'succeeded', data: charge });\r\n\t\t\t  \r\n\t\t\t  Meteor.call('addTimeToAccount', planType,planAmount);\r\n\t\t\t  \r\n\t\t\t  \tif (voucherArray !== null){\r\n\t\t\t  \t\tMeteor.call('registerVoucher', voucherArray);\r\n\t\t\t\t}\r\n\t\t\t return 'succeeded';\t\r\n\t\t\t  \t\t\r\n\t      }else{\r\n\t\t    \tstripeLog.insert({ status : 'errors', data: err });\r\n\t\t    \tvar stripeOutput = $('.stripeOutput').html('<span class=\"error\">Sorry there has been an error processing your card details. You have not been charged.</span>');\t\r\n\t\t    \treturn 'error';\r\n\t      }\r\n\t    }));\r\n\t    \r\n\t    \r\n\t\t}\r\n\t\r\n\t},\r\n\t\r\n\t'processVoucher': function(cost,planType,planAmount,voucherArray) {\r\n\r\n\t\tMeteor.call('addTimeToAccount', planType,planAmount, voucherArray);\r\n\t\r\n\t\tif (voucherArray !== null){\r\n\t\t\tMeteor.call('registerVoucher', voucherArray);\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\t'addTimeToAccount': function(planType,planAmount){\r\n\t\tvar uId = Meteor.userId();\t\r\n\t\t \r\n\t\t// if (planType ===\"monthly\"){\r\n\t\t\t// console.log('user'+ uId +'months: '+planAmount);\r\n\t\t\t\r\n\t\t\t if (planType === 'monthly'){\r\n\t\t\t\t\r\n\t\t\t\t// var dayWrapper = moment().add(planAmount,'months').calendar(); \r\n\t\t\t\t// var expireDateNew = moment(dayWrapper).format(\"DD/MM/YYYY H:mm\");\r\n\t\t\t\tvar currentDate = new Date();\r\n                var expireDateNew = new Date(currentDate.setTime( currentDate.getTime() + planAmount * 2629746000 ));\r\n\t\t\t\t\r\n\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\tMeteor.users.update({_id : uId}, {$set: { 'expiredSubscription': false,'expiry': expireDateNew,'authorisedCourses.journey2English' : true  } });\r\n\t\r\n\t\t\t }\r\n\t\t\t \t\r\n\t\t\t if (planType === 'daily' || planType === 'trial'){\r\n\t\t\t\t\r\n\t\t\t\t// var dayWrapper = moment().add(planAmount,'days').calendar(); \r\n\t\t\t\t// var expireDateNew = moment(dayWrapper).format(\"DD/MM/YYYY H:mm\");\r\n\t\t\t\tvar currentDate = new Date();\r\n                var expireDateNew = new Date(currentDate.setTime( currentDate.getTime() + planAmount * 86400000 ));\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tMeteor.users.update({_id : uId}, {$set: { 'expiredSubscription': false,'expiry': expireDateNew,'authorisedCourses.journey2English' : true  } });\r\n\t\t\t\r\n\t\r\n\t\t\t }\t\r\n\r\n\t\t\t if (planType === 'Assessment'){\r\n\t\t\t\t\r\n\t\t\t\t// var dayWrapper = moment().add(planAmount,'days').calendar(); \r\n\t\t\t\t// var expireDateNew = moment(dayWrapper).format(\"DD/MM/YYYY H:mm\");\r\n\t\t\t\tvar currentDate = new Date();\r\n                var expireDateNew = new Date(currentDate.setTime( currentDate.getTime() +  86400000 ));\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tMeteor.users.update({_id : uId}, {$set: { 'expiredSubscription': false,'expiry': expireDateNew  } });\r\n\t\t\t\r\n\t\r\n\t\t\t }\t\r\n\t\t // }\t \r\n\t\t return true;\r\n\r\n\t},\r\n\r\n\t'registerVoucher': function(voucherArray){\r\n\t\tvar datetime = moment().format(\"DD/MM/YYYY H:mm\");\r\n\t\tvar uId = Meteor.userId();\t\r\n\t\t\r\n\t\t// Register voucher as used\r\n\t\tappliedVouchers.insert({ code : voucherArray[0].code, userId: uId, date: datetime  });\r\n\t\t\r\n\t\t//Upgrade account if applicable \r\n\t\tif (voucherArray[0].applyGroup != null && voucherArray[0].applyGroup.length > 1){\r\n\t\t\tMeteor.users.update({_id : uId}, {$set: { 'roles': [voucherArray[0].applyGroup] } });\r\n\t\t}\r\n\r\n\t\tif (voucherArray[0].applyOrgID != null && voucherArray[0].applyOrgID.length > 1){\r\n\t\t\tMeteor.users.update({_id : uId}, {$set: { 'organisation': voucherArray[0].applyOrgID } });\r\n\t\t}\r\n\r\n\t\tif (voucherArray[0].applyGroupID != null && voucherArray[0].applyGroupID.length > 1){\r\n\t\t\tMeteor.users.update({ _id : uId }, {$push : {groups : voucherArray[0].applyGroupID}});\r\n\t\t\t // Meteor.users.update({_id : uId}, {$set: { 'groups': [voucherArray[0].applyGroupID] } });\r\n\t\t\t var role = Meteor.users.findOne({_id : uId}).roles[0];\r\n\t\t\t if(role == \"tutor\"){\r\n\t\t\t \t groups.update({ _id : voucherArray[0].applyGroupID }, {$push : {tutors : uId}});\r\n\t\t\t } else {\r\n\t\t\t groups.update({ _id : voucherArray[0].applyGroupID }, {$push : {students : uId}});\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\r\n\t\tif (voucherArray[0].initialAssess === true ){\r\n\t\t\tMeteor.call('assignNewAssessment', uId, voucher = true, function(err, result){\r\n\t\t\t\tif(err){\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} \r\n\r\n\t\tif (voucherArray[0].discountType === \"trial\"){\r\n\t\t\tMeteor.users.update({_id : uId}, {$set: { 'authorisedCourses.journey2English': true  } });\r\n\t\t}\r\n\t\treturn true;\r\n\t}*/\r\n});\r\n\r\n\r\n\r\n\r\n\t","Meteor.methods({\r\n\r\n    /**************************************\r\n    *\r\n    *   User Account methods\r\n    *\r\n    ***************************************/\r\n\r\n    'addTrailtoAccount': function (uId, expiry) {\r\n\r\n        var Trial = organisations.findOne({ name: \"Trial\" })._id;\r\n        var Demo = groups.findOne({ name: \"Demo\" })._id;\r\n        Meteor.users.update({ _id: uId }, { $set: { 'roles': [\"tutor\"], 'expiry': expiry, 'organisation': Trial, groups: [Demo] } });\r\n        groups.update({ name: 'Demo' }, { $push: { tutors: uId } });\r\n\r\n    },\r\n\r\n    /**\r\n    *   @method:    createNewEnrollmentAccount\r\n    *   @summary:   This method creates a new user and add the user to the system. An enrollment email is automatically\r\n    *               sent to the provided email address. The user must follow the instructions in the enrollment email\r\n    *               in order to verify their account and set their password.\r\n    *   @requires:  Currently logged in user is admin\r\n    *               Valid email address\r\n    *\r\n    */\r\n    'createNewEnrollmentAccount': function (aFirstname, aSurname, aUsername, aEmail, organisation, aAuthorised, aRole, aExpiry) {\r\n\r\n        // Permission checks\r\n        if (Roles.userIsInRole(this.userId, 'admin')) {\r\n            // ok\r\n        } else if (Roles.userIsInRole(this.userId, 'moderator')) {\r\n            if (aRole == \"admin\" || aRole == \"moderator\") {\r\n                throw new Meteor.Error('No permission to make such a user.');\r\n            }\r\n        } else if (Roles.userIsInRole(this.userId, 'tutor')) {\r\n            if (aRole == \"admin\" || aRole == \"moderator\" || aRole == \"tutor\") {\r\n                throw new Meteor.Error('No permission to make such a user.');\r\n            }\r\n        } else if (Roles.userIsInRole(this.userId, 'student')) {\r\n            throw new Meteor.Error('No permission to make a new user as a student.');\r\n        } else {\r\n            throw new Meteor.Error('No permission to make a new user.');\r\n        }\r\n\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n            var email = aEmail;\r\n            var profile = {\r\n                firstname: aFirstname,\r\n                surname: aSurname\r\n            };\r\n            var org = organisation;\r\n            var role = aRole; // \"admin\", \"tutor\" or \"student\"\r\n            var username = aUsername;\r\n            var orgId;\r\n            var authorisedCourses = {};\r\n            var userId;\r\n            var messages = [];\r\n            var certificateEnabled = true;\r\n            console.log(certificateEnabled);\r\n\r\n            if (aExpiry == undefined || aExpiry == \"\") {\r\n                var expiry = undefined;\r\n            } else {\r\n                var currentDate = new Date();\r\n                var expiry = new Date(currentDate.setTime(currentDate.getTime() + aExpiry * 86400000));\r\n            }\r\n\r\n            for (var i = 0; i < aAuthorised.length; i++) {\r\n                authorisedCourses[aAuthorised[i]] = true;\r\n            }\r\n\r\n            if (!organisations.findOne({ _id: org })) {\r\n                if (!organisations.findOne({ name: org })) {\r\n                    throw new Meteor.Error('Organisation ' + org + ' does not exist.')\r\n                } else {\r\n                    var orgDoc = organisations.findOne({ name: org })\r\n                    orgId = orgDoc._id;\r\n                }\r\n            } else {\r\n                orgId = org;\r\n            }\r\n\r\n            console.log(certificateEnabled);\r\n\r\n            if (isValidEmailAddress(email)) {\r\n                // Uses the Accounts package to create the user and add the document to the 'user'\r\n                userId = Accounts.createUser({\r\n                    email: email,\r\n                    username: username,\r\n                    profile: profile,\r\n                    organisation: [orgId],\r\n                    authorisedCourses: authorisedCourses,\r\n                    expiry: expiry,\r\n                    messages: messages,\r\n                    certificateEnabled: certificateEnabled\r\n                });\r\n                if (role === 'admin') {\r\n                    Roles.addUsersToRoles(userId, role);\r\n                } else {\r\n                    Roles.addUsersToRoles(userId, role);\r\n                }\r\n                Accounts.sendEnrollmentEmail(userId);\r\n                // insert new document userProgress collection\r\n                createUserProgress(userId);\r\n\r\n\r\n                if (aExpiry != undefined && aExpiry != \"\") {\r\n                    Meteor.call(\"durationLogEntry\", userId, Meteor.userId(), \"Account creation.\", 0, aExpiry);\r\n                }\r\n\r\n            } else {\r\n                return new Meteor.Error('Error: Invalid Email Address. Please provide an email with the format \"joe@company.com\"');\r\n            }\r\n            return userId;\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n    *   @method:    createNewPasswordAccount\r\n    *   @summary:   - This method creates a new user and add the user to the system. The password is passed\r\n    *               as an argument to this method and that password is set as the account password.\r\n    *               - If an email address is supplied the email is added to the user.\r\n    *\r\n    *   @requires:  - Currently logged in user is admin\r\n    *               - Valid Organisation\r\n    *\r\n    *   @returns:   True if user successfully added. False if an error occurs.\r\n    *\r\n    *   @notes:   \tEdited by Boundary Creative to add publicSignup option\r\n    */\r\n\r\n    // This executes when using the /register form.\r\n\r\n    'createNewPasswordAccount': function (newUserObj) {\r\n        // var newUserObj = {\r\n        //     newUserObj.fName: firstName,\r\n        //     newUserObj.lName: lastName,\r\n        //     newUserObj.userName: userEmail,\r\n        //     newUserObj.email: userEmail,\r\n        //     newUserObj.pass: userPassword,\r\n        //     newUserObj.org: organisation,\r\n        //     newUserObj.group: group,\r\n        //     newUserObj.authorised: authorisedCourses,\r\n        //     newUserObj.role: role,\r\n        //     newUserObj.expiry: expiry,\r\n        //     newUserObj.registration: registration,\r\n        // };\r\n        //aFirstname, aSurname, aUsername, aEmail, aPassword, organisation, aGroup, aAuthorised, aRole, aExpiry, registration\r\n\r\n        // Permission checks\r\n        if (Roles.userIsInRole(this.userId, 'admin') || newUserObj.role === \"publicSignup\" || newUserObj.registration === true) {\r\n            // ok\r\n        } else if (Roles.userIsInRole(this.userId, 'moderator')) {\r\n            if (newUserObj.role == \"admin\" || newUserObj.role == \"moderator\") {\r\n                throw new Meteor.Error('No permission to make such a user.');\r\n            }\r\n        } else if (Roles.userIsInRole(this.userId, 'tutor')) {\r\n            if (newUserObj.role == \"admin\" || newUserObj.role == \"moderator\" || newUserObj.role == \"tutor\") {\r\n                throw new Meteor.Error('No permission to make such a user.');\r\n            }\r\n        } else if (Roles.userIsInRole(this.userId, 'student')) {\r\n            throw new Meteor.Error('No permission to make a new user as a student.');\r\n        } else {\r\n            throw new Meteor.Error('No permission to make a new user.');\r\n        }\r\n\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin') || newUserObj.role === \"publicSignup\" || newUserObj.registration === true) {\r\n            var email = newUserObj.email;\r\n            var profile = {\r\n                firstname: newUserObj.fName,\r\n                surname: newUserObj.lName\r\n            };\r\n            var username = newUserObj.userName;\r\n            var org = newUserObj.org[0];\r\n            var groupId = newUserObj.group;\r\n            var role = newUserObj.role; // \"admin\", \"moderator\", \"tutor\" or \"student\"\r\n            if (role === \"publicSignup\") { role = \"student\" }\r\n            var userId = {};\r\n            var password = newUserObj.pass;\r\n            var orgId;\r\n            var authorisedCourses = {};\r\n            var messages = [];\r\n            if (newUserObj.cert == 1) {\r\n                var certificateEnabled = true;\r\n            } else {\r\n                var certificateEnabled = false;\r\n            }\r\n            \r\n            //var confirmedEmail = false;\r\n\r\n            if (newUserObj.expiry == undefined || newUserObj.expiry == \"\") {\r\n                var expiry = undefined;\r\n            } else {\r\n                var currentDate = new Date();\r\n                var expiry = new Date(currentDate.setTime(currentDate.getTime() + newUserObj.expiry * 86400000)); // newUserObj.expiry * 1 day (newUserObj.expiry is the number of days)\r\n            }\r\n\r\n            for (var i = 0; i < newUserObj.authorised.length; i++) {\r\n                authorisedCourses[newUserObj.authorised[i]] = true;\r\n            }\r\n\r\n            if (!organisations.findOne({ _id: org })) {\r\n                if (!organisations.findOne({ name: org })) {\r\n                    throw new Meteor.Error('Organisation ' + org + ' does not exist.')\r\n                } else {\r\n                    var orgDoc = organisations.findOne({ name: org })\r\n                    orgId = orgDoc._id;\r\n                }\r\n            } else {\r\n                orgId = org;\r\n            }\r\n\r\n            if (isValidEmailAddress(email) || email.length == 0) {\r\n                userId = Accounts.createUser({\r\n                    email: email,\r\n                    username: username,\r\n                    profile: profile,\r\n                    organisation: [orgId],\r\n                    authorisedCourses: authorisedCourses,\r\n                    password: password,\r\n                    expiry: expiry,\r\n                    messages: messages,\r\n                    certificateEnabled: certificateEnabled\r\n                });\r\n\r\n                Roles.addUsersToRoles(userId, role);\r\n                if (isValidEmailAddress(email)) {\r\n                    Accounts.sendVerificationEmail(userId);\r\n                }\r\n                createUserProgress(userId);\r\n\r\n                if (groupId != null && groupId != 'undefined') {\r\n                    if (role == \"tutor\" || role == \"admin\" || role == \"moderator\") {\r\n                        groups.update({ _id: groupId }, { $push: { tutors: userId } });\r\n                    } else {\r\n                        groups.update({ _id: groupId }, { $push: { students: userId } });\r\n                    }\r\n\r\n                    Meteor.users.update({ _id: userId }, { $push: { groups: groupId } });\r\n                }\r\n\r\n            }\r\n\r\n            if (newUserObj.expiry != undefined && newUserObj.expiry != \"\") {\r\n                Meteor.call(\"durationLogEntry\", userId, Meteor.userId(), \"Account creation.\", 0, newUserObj.expiry);\r\n            }\r\n\r\n            return userId;\r\n        }\r\n\r\n    },\r\n\r\n    'setStartActivity': function (module, activity) {\r\n        /* Checks copied from client-side (needed in both places) */\r\n        var currentActivityDB = userProgress.findOne({ userId: Meteor.userId() }).modules[module - 1].activities[activity - 1];\r\n        var dateEndedField = currentActivityDB.dateEnded;\r\n        if (dateEndedField != null) { return; }\r\n        /* Check end */\r\n\r\n        console.log(\"setStartActivity\");\r\n\r\n        var obj = {};\r\n        var dateSta = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.dateStarted';\r\n        var compl = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.completed';\r\n        var key_compl = currentActivityDB.completed;\r\n\r\n        if (key_compl == false) {\r\n            obj[dateSta] = new Date();\r\n            userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n            var obj2 = {};\r\n            obj2[compl] = \"Started\";\r\n            userProgress.update({ userId: Meteor.userId() }, { $set: obj2 });\r\n        }\r\n        else if (key_compl == \"Paused\") {\r\n            // Resume button change\r\n            Meteor.call('setResumeActivity', module, activity);\r\n        }\r\n    },\r\n\r\n    'setResumeActivity': function (module, activity) {\r\n        /* Checks copied from client-side (needed in both places) */\r\n        var currentActivityDB = userProgress.findOne({ userId: Meteor.userId() }).modules[module - 1].activities[activity - 1];\r\n        var dateStartedField = currentActivityDB.dateStarted;\r\n        var completedField = currentActivityDB.completed;\r\n        if (completedField != \"Paused\" || dateStartedField == null) { \r\n            //console.log('returning');\r\n            return; }\r\n        /* Check end */\r\n\r\n        console.log(\"setResumeActivity\");\r\n\r\n        var now = new Date();\r\n        var currActivityDB = userProgress.findOne({ userId: Meteor.userId() }).modules[module - 1].activities[activity - 1];\r\n       // var paused = currActivityDB.datePaused;\r\n       // var started = currActivityDB.dateStarted;\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.dateResumed';\r\n        obj[key] = now;\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n\r\n       /* var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.datePaused';\r\n        obj[key] = now;\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj }); */\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.dateStarted';\r\n        //started = new Date(now - (paused - started));\r\n        obj[key] = now;\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.completed';\r\n        obj[key] = \"Resumed\";\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n    },\r\n\r\n    'setPauseActivity': function (module, activity, user) {\r\n        console.log(\"setPauseActivity\");\r\n        //console.log('PAUSING');\r\n        //Meteor.call(\"setLastActivity\", user, module, activity);\r\n\r\n        if (user == null || user == undefined) {\r\n            user = Meteor.userId();\r\n        }\r\n\r\n        /* Checks copied from client-side (needed in both places) */\r\n        var currentActivityDB = userProgress.findOne({ userId: user }).modules[module - 1].activities[activity - 1];\r\n        var dateStartedField = currentActivityDB.dateStarted;\r\n        var dateEndedField = currentActivityDB.dateEnded;\r\n        if (dateStartedField == null || dateEndedField != null) { return; }\r\n\r\n        /* Check end */\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.datePaused';\r\n        if (obj[key] == null) { obj[key] = new Date(); }\r\n        userProgress.update({ userId: user }, { $set: obj });\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.completed';\r\n        obj[key] = \"Paused\";\r\n        userProgress.update({ userId: user }, { $set: obj });\r\n\r\n        var currentActivityDB = userProgress.findOne({ userId: user }).modules[module - 1].activities[activity - 1];\r\n        var dateSta = moment(currentActivityDB.dateStarted);\r\n        var datePau = moment(currentActivityDB.datePaused);\r\n        var dateRes = moment(currentActivityDB.dateResumed);\r\n        var timeTaken = currentActivityDB.timeTaken;\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.timeTaken';\r\n\r\n        /*if (timeTaken == null || timeTaken == undefined || timeTaken == NaN) {\r\n            var time = 0;\r\n            time = datePau - dateSta;\r\n        } else {\r\n            time = timeTaken;\r\n            time += datePau - dateRes;\r\n        }*/\r\n\r\n        var time = 0;\r\n        time = datePau - dateSta;\r\n\r\n        obj[key] = parseInt(time);\r\n        userProgress.update({ userId: user }, { $set: obj });\r\n    },\r\n\r\n    'setEndActivity': function (module, activity) {\r\n        /* Checks copied from client-side (needed in both places) */\r\n        var currentActivityDB = userProgress.findOne({ userId: Meteor.userId() }).modules[module - 1].activities[activity - 1];\r\n        var dateEndedField = currentActivityDB.dateEnded;\r\n        if (dateEndedField != null) { return; }\r\n        /* Check end */\r\n\r\n        console.log(\"setEndActivity\");\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.dateEnded';\r\n        if (obj[key] == null) { obj[key] = new Date(); }\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n\r\n        var currentActivityDB = userProgress.findOne({ userId: Meteor.userId() }).modules[module - 1].activities[activity - 1];\r\n\r\n        var dateRes_bare = currentActivityDB.dateResumed;\r\n        var dateSta = moment(currentActivityDB.dateStarted);\r\n        var dateEnd = moment(currentActivityDB.dateEnded);\r\n\r\n        var time = dateEnd - dateSta;\r\n\r\n        /*if (dateRes_bare == null) {\r\n            time = dateEnd - dateSta;\r\n        } else {\r\n            time = dateEnd - dateSta;\r\n        }*/\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.timeTaken';\r\n        obj[key] = parseInt(time);\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.latestSubpage';\r\n        obj[key] = null;\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n\r\n        //Meteor.call(\"setLastActivity\", Meteor.userId(), module, activity);\r\n\r\n        Meteor.call('setCompletedActivity', module, activity);\r\n    },\r\n\r\n    'setLastActivity': function (uId, mod, activity) {\r\n        var lastActivityStr = \"m\" + mod + \"a\" + activity;\r\n        userProgress.update({ userId: uId }, { $set: { lastActivity: lastActivityStr } });\r\n    },\r\n\r\n    'getLastActivity': function (uId) {\r\n        var lastActivity = userProgress.findOne({ userId: uId }).lastActivity;\r\n        if (lastActivity == null || lastActivity == 'undefined' || lastActivity == \"m10a29\") {\r\n            return null;\r\n        } else {\r\n            if (activityCompleted(lastActivity, uId)) {\r\n                return  lastActivity = getNextActivity(lastActivity, uId);\r\n                //return lastActivity = getNextActivity(lastActivity, uId);\r\n             }else{\r\n                 return lastActivity;\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n\r\n    'setLatestSubpage': function (module, activity, subpage) {\r\n        var activityObj = userProgress.findOne({ userId: Meteor.userId() }).modules[module - 1].activities[activity - 1];\r\n        if (\"latestSubpage\" in activityObj) {\r\n            var obj = {};\r\n            var subpageField = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.latestSubpage';\r\n            obj[subpageField] = subpage;\r\n            userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n        }\r\n    },   \r\n\r\n    'setCompletedActivity': function (module, activity) {\r\n        console.log(\"setCompletedActivity\");\r\n\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.completed';\r\n        obj[key] = \"Completed\";\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n\r\n\r\n        var notificationModule = Meteor.users.findOne({ _id: Meteor.userId() }).moduleFinishedNotification;\r\n        if(notificationModule != null && notificationModule != undefined) {\r\n            notificationModule = notificationModule[module];\r\n        }\r\n               \r\n        if(checkCompletedGame(module) && checkModuleFinishedActivities(module) && notificationModule != 'Read' && notificationModule != 'ModalSeen'){\r\n            setModuleCompletionField(module);\r\n        }\r\n\r\n        if (module <= 5) {\r\n            var unit = 1;\r\n        } else if (module > 5) {\r\n            var unit = 2;\r\n        }\r\n\r\n        var feedbackForms = Meteor.users.findOne({ _id: Meteor.userId() }).unitFeedbackForms;\r\n        if (feedbackForms != null && feedbackForms != undefined) {\r\n            feedbackForms = feedbackForms[unit];\r\n        }\r\n        if (checkUnitCompleted(module) && feedbackForms != 'Ignored' && feedbackForms != 'Completed') {\r\n            setUnitFeedbackFormStatus(unit);\r\n        } \r\n        checkTrophyCompletion();\r\n        \r\n\r\n        //Check if the user progress matches a custom set percentage by an organisation, and if so, update the user's document to\r\n        //set a flag which will then be used to show a custom message to congratulate them for the completion.\r\n        var orgArray = Meteor.users.findOne({_id: Meteor.userId()}).organisation;\r\n        //By default the \"main\" organisation of users will be the 1st one, even though moderators should not access the course.\r\n        //For other users, there is only 1 organisation anyway.\r\n        var org = orgArray[0];\r\n        var orgName = null;\r\n        if (org != null && org != 'undefined') {\r\n            orgName = organisations.findOne({_id: org}).name;\r\n        } else {\r\n            return null;\r\n        }\r\n\r\n        //Need to calculate those 2 variables\r\n        var progress = getPercentageComplete(Meteor.userId());\r\n        var timeSpent = getTimeTaken(Meteor.userId());        \r\n        var hoursSpent = ((timeSpent / 1000) / 60) / 60;\r\n        var allGamesCompleted = checkAllCompletedGames();\r\n        var progressCompletion = checkProgressCompletion(progress, hoursSpent, orgName, allGamesCompleted);\r\n        if (progressCompletion == \"Full-Completion\") {\r\n            setUserProgressCompletionNotification();\r\n        } else if (progressCompletion == \"Half-Way-Completion\"){\r\n            setUserProgressHalfCompletionNotification();\r\n        } else {\r\n            //not achieved or other options\r\n        }\r\n\r\n\r\n        for (var i = 0; i < userProgress.findOne({ userId: Meteor.userId() }).modules[module - 1].activities.length; i++) {\r\n            if (userProgress.findOne({ userId: Meteor.userId() }).modules[module - 1].activities[i].completed != \"Completed\") {\r\n                return;\r\n            }\r\n        }\r\n\r\n        Meteor.call('setFinishedModule', module);\r\n    },\r\n\r\n    'setFinishedModule': function (module) {\r\n        var obj = {};\r\n        var key = 'modules.' + (module - 1) + '.finished';\r\n        obj[key] = true;\r\n        userProgress.update({ userId: Meteor.userId() }, { $set: obj });\r\n    },\r\n\r\n    'setGameAccess': function (uId, module_, score_, pass) {\r\n        var dateCompleted = new Date();\r\n        return gameAccess.insert({ user: uId, module: module_, score: score_, date: dateCompleted, passedTest: pass });\r\n    },\r\n\r\n    'editUserFirstname': function (aUser, aFirstname) {\r\n\r\n        // console.log(\"UPDATING user first name\");\r\n        // console.log(aUser);\r\n        // console.log(aFirstname);\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Meteor.userId() == aUser) {\r\n            Meteor.users.update({ _id: aUser }, { $set: { 'profile.firstname': aFirstname } });\r\n        }\r\n\r\n    },\r\n\r\n    'editUserSurname': function (aUser, aSurname) {\r\n\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Meteor.userId() == aUser) {\r\n            Meteor.users.update({ _id: aUser }, { $set: { 'profile.surname': aSurname } });\r\n        }\r\n\r\n    },\r\n\r\n    'editUserEmail': function (aUser, aEmail) {\r\n\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Meteor.userId() == aUser) {\r\n            Meteor.users.update({ _id: aUser }, { $set: { 'emails.0.address': aEmail } });\r\n        }\r\n\r\n    },\r\n\r\n    'setRoleOnUser': function (options) {\r\n        check(options, {\r\n            user: String,\r\n            role: String\r\n        });\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n            try {\r\n                Roles.setUserRoles(options.user, [options.role]);\r\n            } catch (exception) {\r\n                return exception;\r\n            }\r\n        }\r\n    },\r\n\r\n    // Send User an Email to reset their password\r\n    'sendResetPasswordEmail': function (userId) {\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin') || Meteor.userId == userId) {\r\n            return Accounts.sendResetPasswordEmail(userId);\r\n        } else {\r\n            throw new Meteor.Error('Error! You are not an admin or this is not your account.');\r\n        }\r\n    },\r\n\r\n    'addJ2ECourse': function(userId) {\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n            console.log('updating'+userId);\r\n            Meteor.users.update({ _id: userId }, { $set: { 'authorisedCourses.journey2English': true } });\r\n        } else {\r\n            throw new Meteor.Error('Error! You are not an admin or this is not your account.');\r\n        }\r\n    },\r\n\r\n    'changePasswordAcc': function (oldPass, newPass) {\r\n        //if (Roles.userIsInRole( Meteor.userId(), 'admin' )) {\r\n        Accounts.changePassword(oldPass, newPass);\r\n        //} else {\r\n        //    throw new Meteor.Error('Error! You are not an admin or this is not your account.');\r\n        //}\r\n    },\r\n\r\n    'changeToDefaultPassword': function (userId) {\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n            return Accounts.setPassword(userId, 'journey001');\r\n        } else {\r\n            throw new Meteor.Error('Error! You are not an admin or this is not your account.');\r\n        }\r\n    },\r\n\r\n    'parseUpload': function (data) {\r\n        for (var i = 0; i < data.length; i++) {\r\n            var item = data[i];\r\n            var email = {};\r\n            var courses = [];\r\n            var userId;\r\n            var messages = [];\r\n\r\n            if (item.autoPassAssessment == true || item.role == 'admin' || item.role == 'moderator' || item.role == 'tutor') {\r\n                courses.push('journey2English');\r\n            }\r\n\r\n            if (item.email) {\r\n                email = item.email;\r\n                if (item.password) {\r\n                    userId = Meteor.call('createNewPasswordAccount', item.firstname, item.surname, item.username, email, item.password, item.organisation, courses, item.role, item.expiry, false);\r\n\r\n                } else {\r\n                    userId = Meteor.call('createNewEnrollmentAccount', item.firstname, item.surname, item.username, email, item.organisation, courses, item.role, item.expiry);\r\n                }\r\n            } else {\r\n                userId = Meteor.call('createNewPasswordAccount', item.firstname, item.surname, item.username, email, item.password, item.organisation, courses, item.role, item.expiry, false);\r\n            }\r\n\r\n            // Assign the Assessment.\r\n            if (item.role != 'admin' && item.role != 'moderator' && item.role != 'tutor') {\r\n                if (item.autoPassAssessment == false || item.autoPassAssessment == undefined) {\r\n                    Meteor.call('assignNewAssessment', userId);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    'removeUser': function (userId) {\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n            if (Meteor.userId() == userId) {\r\n                throw new Meteor.Error('You cannot delete yourself.');\r\n            }\r\n            Meteor.users.remove({ _id: userId });\r\n            studentAssessments.remove({ userId: userId });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Used for a % course completion for a certificate - uncomment if needed\r\n     */\r\n    // 'setProgCompNotification': function(state){\r\n    //     if(state != null && state != 'undefined'){\r\n    //         var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: { 'progCompNotification': state } });\r\n    //         return result;\r\n    //     } else {\r\n    //         throw new Meteor.Error('Error! Invalid state for progress completion notification variable');\r\n    //     }\r\n    // },\r\n\r\n    'setFeedbackFormStatus': function(unit, status) {\r\n        if(status != null && status != 'undefined' && unit != null && unit != undefined){\r\n            var obj = {};\r\n\r\n            var feedbackForms = Meteor.users.findOne({ _id: Meteor.userId() }).unitFeedbackForms;\r\n            if(feedbackForms != null && feedbackForms != undefined)\r\n                obj = feedbackForms;\r\n\r\n            obj[unit] = status;\r\n            var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: {'unitFeedbackForms': obj }});\r\n            return result;\r\n        } else {\r\n            throw new Meteor.Error('Error! Invalid status for unit completion notification variable');\r\n        }\r\n    },\r\n\r\n    'setModuleProgress': function(module, state){\r\n        if(state != null && state != 'undefined' && module != null && module != undefined){\r\n            var obj = {};\r\n\r\n            var modulesFinishedNotification = Meteor.users.findOne({ _id: Meteor.userId() }).moduleFinishedNotification;\r\n            if(modulesFinishedNotification != null && modulesFinishedNotification != undefined)\r\n                obj = modulesFinishedNotification;\r\n\r\n            obj[module] = state;\r\n            var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: {'moduleFinishedNotification': obj }});\r\n            return result;\r\n        } else {\r\n            throw new Meteor.Error('Error! Invalid state for module completion notification variable');\r\n        }\r\n    },\r\n\r\n    'setTrophyProgress': function(trophyIndex, state){\r\n        if(state != null && state != 'undefined' && trophyIndex != null && trophyIndex != undefined){\r\n            var obj = {};\r\n\r\n            var trophyAchieved = Meteor.users.findOne({ _id: Meteor.userId() }).trophyAchieved;\r\n            if(trophyAchieved != null && trophyAchieved != undefined)\r\n                obj = trophyAchieved;\r\n\r\n            obj[trophyIndex] = state;\r\n            var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: {'trophyAchieved': obj }});\r\n            return result;\r\n        } else {\r\n            throw new Meteor.Error('Error! Invalid state for trophy achievement variable');\r\n        }\r\n    },\r\n\r\n    'setCertificateNotification': function(state) {\r\n        if (state != null && state != undefined) {\r\n            var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: { 'certificateNotification': state } });\r\n            return result;\r\n        } else {\r\n            throw new Meteor.Error('Error! Invalid parameter for changing the certificate field for this account');\r\n        }\r\n    },\r\n\r\n    'setCertificateStatus': function (aUser, status) {\r\n        if (aUser != null && aUser != undefined && status != null && status != undefined) {\r\n            if (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n                var result = Meteor.users.update({_id: aUser}, { $set: { 'certificateEnabled': status } });\r\n                return result;\r\n            }\r\n        } else {\r\n            throw new Meteor.Error('Error! Invalid parameters for setting the certificate status for this account')\r\n        }\r\n    },\r\n\r\n    'setCertificateDetails': function(details) {\r\n        if (details != null && details != undefined) {\r\n            var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: { 'certificateDetails': details } });\r\n            return result;\r\n        } else {\r\n            throw new Meteor.Error('Error! Invalid parameter for changing the certificate field for this account');\r\n        }\r\n    },\r\n\r\n\r\n    /**\r\n\t * Used for a certificate/non-certificate version of the course\r\n\t * Uncomment if needed - not implemented fully yet\r\n     * _id needs to be the id of the selected user, not the one currently logged-in - needs to be fixed if \r\n     * the code is going to be used\r\n\t */\r\n    // 'addCertificate': function(flag) {\r\n    //     if(flag != null && flat != 'undefined') {\r\n    //         var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: { 'addedCertificate': flag } });\r\n    //         return result;\r\n    //     } else {\r\n    //         throw new Meteor.Error('Error! Invalid flag for adding a certificate for this account');\r\n    //     }\r\n    // },\r\n\r\n    /*\r\n        creates and inserts a login token for the user with @param user_id\r\n    */\r\n    'create_token': function(user_id){\r\n        const stampedLoginToken = Accounts._generateStampedLoginToken();\r\n        Accounts._insertLoginToken(user_id, stampedLoginToken);\r\n        return stampedLoginToken;\r\n    },\r\n\r\n    /*\r\n        returns a user whose email is the same as @param email\r\n     */\r\n    'getUserByEmail': function(email){\r\n        user = Accounts.findUserByEmail(email);\r\n        return user;\r\n    },\r\n\r\n    'authoriseCourse': function (userId, course) {\r\n        var userDoc = Meteor.users.findOne({ _id: userId });\r\n        var authorisedCourses = userDoc.authorisedCourses;\r\n        authorisedCourses[course] = true;\r\n        Meteor.users.update({ _id: userId }, { $set: { 'authorisedCourses': authorisedCourses } });\r\n    },\r\n    /**\r\n   *   @method insertNewUserProgress\r\n   *   @summary This method create a new 'userProgress' document and inserts it into the database.\r\n   *           Each user has a reference to one userProgress entry. The entry references its user with the\r\n   *           userId field.\r\n   *\r\n   *\r\n   */\r\n    'insertNewUserProgress': function (aUser) {\r\n        return userProgress.insert({\r\n            userId: aUser,\r\n            modules: [\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                },\r\n\r\n                {\r\n                    finished: false,\r\n                    activities: [\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null },\r\n                        { completed: false, dateStarted: null, dateEnded: null, datePaused: null, dateResumed: null, timeTaken: null, latestSubpage: null }\r\n                    ],\r\n                    timeCompleted: {},\r\n                    timeStarted: {}\r\n                }\r\n            ]\r\n        })\r\n\r\n    }\r\n\r\n})\r\n\r\nfunction createUserProgress(userId) {\r\n    // Once the user has been created, a new userProgress document must be created for the user\r\n    Meteor.call('insertNewUserProgress', userId, function (error, result) {\r\n        if (!error) {\r\n            Meteor.users.update({ _id: userId }, { $set: { progress: result } });\r\n        }\r\n    });\r\n}\r\n\r\nfunction isValidEmailAddress(emailAddress) {\r\n    var pattern = new RegExp(/^((\"[\\w-+\\s]+\")|([\\w-+]+(?:\\.[\\w-+]+)*)|(\"[\\w-+\\s]+\")([\\w-+]+(?:\\.[\\w-+]+)*))(@((?:[\\w-+]+\\.)*\\w[\\w-+]{0,66})\\.([a-z]{2,6}(?:\\.[a-z]{2})?)$)|(@\\[?((25[0-5]\\.|2[0-4][\\d]\\.|1[\\d]{2}\\.|[\\d]{1,2}\\.))((25[0-5]|2[0-4][\\d]|1[\\d]{2}|[\\d]{1,2})\\.){2}(25[0-5]|2[0-4][\\d]|1[\\d]{2}|[\\d]{1,2})\\]?$)/i);\r\n    return pattern.test(emailAddress);\r\n};\r\n\r\n\r\nfunction activityCompleted(activity, uId) {\r\n    console.log(activity);\r\n    var actObj = extractModActNum(activity);\r\n    var completed = userProgress.findOne({ userId: uId }).modules[actObj.modNum].activities[actObj.actNum].completed;\r\n    return completed == \"Completed\";\r\n}\r\n\r\nfunction getNextActivity(activity, uId) {\r\n    var actObj = extractModActNum(activity);\r\n    var userProg = userProgress.findOne({ userId: uId });\r\n    var nextAct = userProg.modules[actObj.modNum].activities[actObj.actNum + 1];\r\n    var nextActStr = \"m\" + (actObj.modNum + 1) + \"a\" + (actObj.actNum + 2);\r\n    var passed = gameAccess.find({ \"user\": uId, \"module\": (actObj.modNum + 1).toString(), \"passedTest\": true }).count();\r\n    if (activityIsGame(nextActStr)) {\r\n        nextActStr = getGameStr(nextActStr);\r\n        console.log(\"if game: \" + nextActStr);\r\n        if (passed == 0) {\r\n            //if \"test\" is failed, \"continue\" gets you to the next module, activity 1\r\n            return \"m\" + (actObj.modNum + 2) + \"a\" + 1;\r\n        };\r\n        return nextActStr;\r\n    }\r\n    if (nextAct == null || nextAct == 'undefined') {\r\n        nextActStr = \"m\" + (actObj.modNum + 2) + \"a1\";\r\n    }\r\n    console.log(\"if not game: \" + nextActStr);\r\n    return nextActStr;\r\n}\r\n\r\nfunction extractModActNum(activityStr) {\r\n    var obj = {\r\n        modNum: null,\r\n        actNum: null\r\n    };\r\n\r\n    obj.modNum = activityStr.substring((activityStr.indexOf(\"m\") + 1), activityStr.indexOf(\"a\")) - 1;\r\n    obj.actNum = activityStr.substring((activityStr.indexOf(\"a\") + 1), activityStr.length) - 1;\r\n    return obj;\r\n}\r\n\r\nfunction activityIsGame(actStr) {\r\n    var gameActs = [\"m1a28\", \"m2a29\", \"m3a30\", \"m4a31\", \"m5a25\", \"m6a30\", \"m7a27\", \"m8a35\", \"m9a31\", \"m10a29\"];\r\n    return gameActs.indexOf(actStr) >= 0;\r\n}\r\n\r\nfunction getGameStr(actStr) {\r\n    return actStr.substring(0, actStr.indexOf(\"a\")) + \"Game\";\r\n}\r\n\r\nfunction checkProgressCompletion(progress, timeSpent, orgName, allGamesCompleted) {\r\n    var result = \"\";\r\n    if(allGamesCompleted){\r\n        if(orgName == \"City and Guilds\"){\r\n\r\n        } else { //default for other orgs\r\n            //Leaving this the same as with c&g for testing only. This should be changed\r\n            //Once the whole thing is implemented\r\n            if(progress >= 40 && timeSpent >= 20)\r\n                result = \"Half-Way-Completion\";\r\n        \r\n            if(progress >= 80 && timeSpent >= 40)\r\n                result = \"Full-Completion\";\r\n        }\r\n    }   \r\n    //Currently checking overall course completion only, however it should be possible to switch to checking units instead\r\n    return result;\r\n}\r\n\r\nfunction checkCompletedUnit(moduleNum) {\r\n\tvar progress = userProgress.findOne({ userId : Meteor.userId() });\r\n\tvar modules = progress.modules;\r\n\tif (modules[moduleNum-1].finished == true) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction checkUnitCompleted(currModule) {\r\n    if (currModule <= 5) {\r\n        var startModule = 1;\r\n        var endModule = 5;\r\n    } else if (currModule > 5) {\r\n        var startModule = 6;\r\n        var endModule = 10;\r\n    }\r\n\tfor (var i = startModule; i <= endModule; i++) {\r\n\t\tif (!checkCompletedUnit(i)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nfunction checkTrophyCompletion() {\r\n\r\n    var percent = showPercentageComplete();\r\n    //('PERCENT ' + percent);\r\n    if(checkTrophyStatus(1) == null || checkTrophyStatus(1) == undefined){\r\n        var firstTrophyPercentage = 30;\r\n        if(percent >= firstTrophyPercentage)\r\n            setTrophyCompletionField(1);\r\n    }\r\n\r\n    if(checkTrophyStatus(2) == null || checkTrophyStatus(2) == undefined){\r\n        var secondTrophyPercentage = 60;\r\n        if(percent >= secondTrophyPercentage)\r\n            setTrophyCompletionField(2);\r\n    }\r\n\r\n    if(checkTrophyStatus(3) == null || checkTrophyStatus(3) == undefined){\r\n        var moduleNum = 10;\r\n        var modulesCompleted = getNumberOfModuleBadges();\r\n        if(modulesCompleted  == moduleNum)\r\n            setTrophyCompletionField(3);\r\n    }\r\n \r\n}\r\n\r\nfunction getNumberOfModuleBadges(){\r\n    var modulesFinishedNotification = Meteor.users.findOne({ _id: Meteor.userId() }).moduleFinishedNotification;\r\n    var completedCount = 0;\r\n    var moduleNum = 10;\r\n    if(modulesFinishedNotification != null && modulesFinishedNotification != undefined){\r\n        for(var i = 1; i <= moduleNum; i++){\r\n            if(modulesFinishedNotification[i] != null && modulesFinishedNotification[i] != undefined){\r\n                completedCount++;\r\n            }\r\n        }\r\n        return completedCount;\r\n    }\r\n}\r\n\r\nfunction checkTrophyStatus(trophyIndex){\r\n    var trophyAchievement = Meteor.users.findOne({ _id: Meteor.userId() }).trophyAchieved;\r\n    if(trophyAchievement != null && trophyAchievement != undefined) {\r\n        return trophyAchievement[trophyIndex];\r\n    }\r\n}\r\n\r\nfunction setTrophyReadField(trophyIndex) {\r\n    Meteor.call('setTrophyProgress', trophyIndex, 'Read');\r\n}\r\n\r\nfunction setTrophyCompletionField(trophyIndex) {\r\n    Meteor.call('setTrophyProgress', trophyIndex, 'Finished');\r\n}\r\n\r\nfunction setModuleCompletionField(moduleNumber) {\r\n    //set flag in DB user doc\r\n    // flag should be either of these 2 values - null/undefined, \"Finished\", \"Read\"\r\n    // this will allow for the pop-up to be shown only after the current module is completed\r\n    // and to not show again for the current module once it has been read already\r\n    Meteor.call('setModuleProgress', moduleNumber, 'Finished');\r\n}\r\n\r\nfunction setUnitFeedbackFormStatus(unit) {\r\n    Meteor.call('setFeedbackFormStatus', unit, 'Not completed');\r\n}\r\n\r\n/**\r\n * Used for a % course completion for a certificate - uncomment if needed\r\n */\r\n// function setUserProgressCompletionNotification(){\r\n//     //set flag in DB user doc to display message\r\n//     //flag should be either of these 3 values - null / undefined,  \"Completed\", HalfWay , \"Read\"\r\n//     //this will allow for the pop-up to be shown only after course is completed\r\n//     //and to be hidden once it has been already seen.\r\n//     Meteor.call('setProgCompNotification', \"Completed\");\r\n// }\r\n\r\n/**\r\n * Used for a % course completion for a certificate - uncomment if needed\r\n */\r\n// function setUserProgressHalfCompletionNotification(){\r\n//     //set flag in DB user doc to display message\r\n//     //flag should be either of these 3 values - null / undefined,  \"Completed\", HalfWay , \"Read\"\r\n//     //this will allow for the pop-up to be shown only after course is completed\r\n//     //and to be hidden once it has been already seen.\r\n//     Meteor.call('setProgCompNotification', \"Half-Way\");\r\n// }\r\n\r\n\r\nfunction getPercentageComplete(_userId) {\r\n\r\n\tvar progress = userProgress.findOne({ userId: _userId });\r\n\tvar activityCount = 0;\r\n\tvar completedCount = 0;\r\n\r\n\tif (progress == null || progress == \"undefined\") { return; }\r\n\r\n\tfor (var i = 0; i < progress.modules.length; i++) {\r\n\t\tfor (var j = 0; j < progress.modules[i].activities.length; j++) {\r\n\t\t\tactivityCount++;\r\n\t\t\tif (progress.modules[i].activities[j].completed == \"Completed\") {\r\n\t\t\t\tcompletedCount++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//This is the current completion percent for the user\r\n\tvar endPercent = parseFloat((completedCount / activityCount) * 100).toFixed(1);\r\n\treturn endPercent;\r\n\r\n}\r\n\r\nfunction getTimeTaken(_userId){\r\n    var progress = userProgress.findOne({ userId: _userId });\r\n    if (progress == null || progress == \"undefined\") { return null; }\r\n    var timeTaken = 0;\r\n    for (var i = 0; i < progress.modules.length; i++) {\r\n\t\tfor (var j = 0; j < progress.modules[i].activities.length; j++) {\r\n\t\t\tif (typeof progress.modules[i].activities[j].timeTaken == \"number\") {\r\n                timeTaken = timeTaken + progress.modules[i].activities[j].timeTaken;\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n    \r\n    return timeTaken;\r\n}\r\n\r\n/**\r\n * This method returns true if for a given module\r\n * the user has completed at least all-2 activities.\r\n * Otherwise, returns false.\r\n */\r\nfunction checkModuleFinishedActivities(mod) {\r\n\tvar currentModule = mod - 1;\r\n\tvar loggedUser = Meteor.userId();\r\n\tvar uProgress = userProgress.findOne({userId: loggedUser});\r\n\tvar allModuleActivities = uProgress.modules[currentModule].activities;\r\n\tvar allModuleActivitiesCount = allModuleActivities.length;\r\n\tvar completedModuleActivities = 0;\r\n\r\n\tallModuleActivities.forEach(function(x) {\r\n\t\tif(x.completed == \"Completed\") {\r\n\t\t\tcompletedModuleActivities++;\r\n\t\t}\r\n\t});\r\n\t\r\n\tif ((allModuleActivitiesCount - completedModuleActivities) <= 4) {\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction checkCompletedGame(moduleNum){\r\n    var progress = userProgress.findOne({ userId : Meteor.userId() });\r\n    var moduleAcitvities = progress.modules[moduleNum - 1].activities;\r\n    var gameActivity = moduleAcitvities[moduleAcitvities.length -1];\r\n    if(gameActivity.completed == \"Completed\")\r\n        return true;\r\n\r\n    return false;\r\n}\r\n\r\nfunction checkAllCompletedGames(){\r\n    var moduleNum = 10;\r\n    for(var i = 1; i <= moduleNum; i++){\r\n        if(!checkCompletedGame(i))\r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n function showPercentageComplete() {\r\n\r\n\tvar progress = userProgress.findOne({ userId: Meteor.userId() });\r\n\tvar activityCount = 0;\r\n\tvar completedCount = 0;\r\n\r\n\tif (progress == null || progress == \"undefined\") { return; }\r\n\r\n\tfor (var i = 0; i < progress.modules.length; i++) {\r\n\t\tfor (var j = 0; j < progress.modules[i].activities.length; j++) {\r\n\t\t\tactivityCount++;\r\n\t\t\tif (progress.modules[i].activities[j].completed == \"Completed\") {\r\n\t\t\t\tcompletedCount++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//This is the current completion percent for the user\r\n\tvar endPercent = (parseFloat((completedCount / activityCount) * 100).toFixed(1) / 100);\r\n\treturn endPercent * 100;\r\n\r\n}","Meteor.methods({\r\n\r\n    //'addVoucher': function (name, description, code, discount, usage, active, limitedUsage, assessment, roles, org, group, paymentPlans, discountType) {\r\n    'addVoucher': function (voucher) {\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n\r\n            //returns true if the voucher of a given code exists in the system\r\n            //parameter: voucher code\r\n            var checkDuplicate = function(voucherCode){\r\n                var duplicate = vouchers.findOne({ code: voucherCode });\r\n                var duplicateApplied = appliedVouchers.findOne({ code: voucherCode });\r\n                if (((duplicate != null) && (duplicate != 'undefined')) || ((duplicateApplied != null) && (duplicateApplied != 'undefined'))) {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            try {\r\n                //Check if the voucher is to be used for multiple users - usageAmount > 1\r\n                //if so, generate different voucher for each user and return an array of\r\n                //voucher codes back to the client\r\n                //Nowhere in the mongo/meteor docs can I find how to insert multiple docs when\r\n                //the array is already pre-defined like below... none of the documents help, so\r\n                //have to do it the \"dumb\" way 1 by 1 and hope we don't have vouchers\r\n                //for more than 50 users ....\r\n\r\n                var voucherCodes = [];              \r\n                if (voucher.multipleUsage >= 1) {\r\n                    var currCode = \"\";\r\n                    var done = voucher.multipleUsage;\r\n                    var i = 0;\r\n                    while(done > 0){\r\n                        //currCode = voucher.code + \"_j2e_\" + i;\r\n                        currCode = makeVoucherCode();\r\n                        currCode = \"J2E\" + currCode;\r\n                        //currCode = voucher.code + suffix;\r\n                        if(!checkDuplicate(currCode)){\r\n                            voucherCodes.push(currCode);\r\n                            done--;\r\n                        }\r\n                        i++;\r\n                    }\r\n\r\n                } else if (voucher.singleUsage >= 1) {\r\n                    var currCode = \"\";\r\n                    var done = voucher.singleUsage;\r\n                    while (done > 0) {\r\n                        currCode = makeVoucherCode();\r\n                        currCode = \"J2E\" + currCode;\r\n                        if (!checkDuplicate(currCode)) {\r\n                            vouchers.insert({\r\n                                \"name\": voucher.name,\r\n                                \"description\": voucher.description,\r\n                                \"code\": currCode,\r\n                                \"discount\": voucher.discount,\r\n                                \"discountType\": voucher.discountType,\r\n                                \"applyPlans\": voucher.paymentPlans,\r\n                                \"active\": voucher.active,\r\n                                \"limitedUsage\": voucher.limitedUsage,\r\n                                \"usageAmount\": voucher.singleUsage,\r\n                                \"initialAssess\": voucher.assessment,\r\n                                \"uId\": voucher.uId,\r\n                                \"applyGroup\": voucher.roles,\r\n                                \"applyOrgID\": voucher.org,\r\n                                \"applyGroupID\": voucher.group,\r\n                            });\r\n                            done = 0;\r\n                        }\r\n                    }\r\n                    return currCode;\r\n                    \r\n                    \r\n                    \r\n\r\n                } else {\r\n                    if(checkDuplicate(voucher.code)){\r\n                        throw new Meteor.Error(\"This voucher code already exists. Please try again.\");\r\n                    }\r\n                    voucherCodes.push(voucher.code);\r\n                }\r\n                \r\n                voucherCodes.forEach(function(code){\r\n                    vouchers.insert({\r\n                        \"name\": voucher.name,\r\n                        \"description\": voucher.description,\r\n                        \"code\": code,\r\n                        \"discount\": voucher.discount,\r\n                        \"discountType\": voucher.discountType,\r\n                        \"applyPlans\": voucher.paymentPlans,\r\n                        \"active\": voucher.active,\r\n                        \"limitedUsage\": voucher.limitedUsage,\r\n                        \"usageAmount\": 1,\r\n                        \"initialAssess\": voucher.assessment,\r\n                        \"uId\": voucher.uId,\r\n                        \"applyGroup\": voucher.roles,\r\n                        \"applyOrgID\": voucher.org,\r\n                        \"applyGroupID\": voucher.group,\r\n                    });\r\n                });\r\n\r\n                return voucherCodes;\r\n\r\n            } catch (err) {\r\n                throw new Meteor.Error(err.message);\r\n            }\r\n        } else {\r\n            throw new Meteor.Error(500, 'You\\'re not an admin - no permission to add voucher.');\r\n        }\r\n    },\r\n\r\n    'deleteVoucher': function (vId) {\r\n        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {\r\n            vouchers.remove({ _id: vId });\r\n        }\r\n        else {\r\n            throw new Meteor.Error(500, 'You\\'re not authorised.');\r\n        }\r\n    },\r\n\r\n    //Code not used anywhere\r\n    'getVoucherByCode': function (vCode) {\r\n        var voucher = vouchers.findOne({ code: vCode });\r\n        if (voucher == null || voucher == 'undefined') {\r\n            throw new Meteor.Error(500, 'No such voucher code');\r\n        } else {\r\n            return voucher;\r\n        }\r\n    },\r\n\r\n    'voucherUsed': function (vCode, uId) {\r\n        var dateTime = new Date();\r\n        appliedVouchers.insert({ code: vCode, userId: uId, date: dateTime });\r\n    }\r\n});\r\n\r\nvar makeVoucherCode = function() {\r\n    var code = \"\";\r\n    var possibleChars = \"ABCDEFGHIJKLMNPQRSTUVWXYZ123456789\";\r\n    /**\r\n     * Below can be used if the randomisation is implemented with regular expressions\r\n     */\r\n    // var lowerChar = new RegExp(/[a-z]/);\r\n    // var upperChar = new RegExp(/[A-Z]/);\r\n    // var digit = new RegExp(/\\d/);\r\n    // var notDigit = new RegExp(/\\D/);\r\n    // var finalRegEx = new RegExp(\"(\" + lowerChar.source + \")|(\" + upperChar.source + \")|(\" + digit.source + \")|(\" + notDigit.source + \")\");\r\n\r\n    for (var i = 0; i < 11; i++) {\r\n        code += possibleChars.charAt(Math.floor(Math.random() * possibleChars.length));\r\n    }\r\n\r\n    return code;\r\n}\r\n","\nuserNotes = new Mongo.Collection('userNotes');\nuserProgress = new Mongo.Collection('userProgress');\ngameAccess = new Mongo.Collection('gameAccess');\ngroups = new Mongo.Collection('groups');\nsubgroups = new Mongo.Collection('subgroups');\norganisations = new Mongo.Collection('organisations');\norganisations._ensureIndex({ name: 1 }, { unique: 1 });\nstudentAssessments = new Mongo.Collection('studentAssessments');\nassessmentTypes = new Mongo.Collection('assessmentTypes');\nf_forums = new Mongo.Collection('f_forums');\n\nbug_reports = new Mongo.Collection('bug_reports');\nfeedback_forms = new Mongo.Collection('feedback_forms');\ncontact_form = new Mongo.Collection('contact_form');\n\nduration_log = new Mongo.Collection('duration_log');\nmessages = new Mongo.Collection('messages');\n\nContactMails = new Mongo.Collection('contact_mail');\nstripeLog = new Mongo.Collection('stripe_log');\npayment_plans = new Mongo.Collection('payment_plans');\nvouchers = new Mongo.Collection('vouchers');\nappliedVouchers = new Mongo.Collection('appliedVouchers');\nAnnouncements = new Mongo.Collection('Announcements');\ncustomEmails = new Mongo.Collection('customEmails');\n\nCGBadgeData = new Mongo.Collection('CGBadgeData');\n\ntoolRecs = new Mongo.Collection('toolRecs');\n\ntoolRecs.allow({\n    insert: function (userId, doc) {\n        if (userId) {\n            return true;\n        }\n    },\n    update: function () {\n        return true;\n    },\n    remove: function () {\n        return true;\n    }\n})\n\n/****************************************************************\n*****************************************************************\n*\n*                    audioRecordings\n*\n*****************************************************************\n*****************************************************************/\n/*\n* - audioRecordings collection is used to hold each student's Voice Recorder\n*   entry.\n*\n*/\n\n// var audioStore = new FS.Store.FileSystem(\"audio-recordings\", {\n//     maxTries: 5, // optional, default 5\n//     path: \"cfs/audioRecs/files\"\n//     //chunkSize: 1024 * 1024,  // optional, default GridFS chunk size in bytes (can be overridden per file).\n//     // Default: 2MB. Reasonable range: 512KB - 4MB\n// });\n\n// audioRecordings = new FS.Collection(\"audioRecordings\", {\n//     stores: [audioStore]\n// });\n\n// audioRecordings.allow({\n//     insert: function (userId, doc) {\n//         if (userId) {\n//             return true;\n//         }\n//     },\n//     update: function () {\n//         return true;\n//     },\n//     remove: function () {\n//         return true;\n//     },\n//     download: function () {\n//         return true;\n//     }\n// })\n\nvar audioStore = new FS.Store.S3(\"audio-recordings\", {\n    region: \"eu-west-2\",\n    accessKeyId: \"AKIAJWTNAETF776YKCFQ\", \n    secretAccessKey: \"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\", \n    bucket: \"j2e-recordings\"\n});\n\naudioRecordings = new FS.Collection(\"audioRecordings\", {\n    stores: [audioStore]\n});\n\naudioRecordings.allow({\n    insert: function (userId, doc) {\n        if (userId) {\n            return true;\n        }\n    },\n    update: function () {\n        return true;\n    },\n    remove: function () {\n        return true;\n    },\n    download: function () {\n        return true;\n    }\n})\n\n/*********************************************************************\n**********************************************************************\n**********************************************************************\n**********************************************************************/\n\n/****************************************************************\n*****************************************************************\n*\n*                    commentAudioRecordings\n*\n*****************************************************************\n*****************************************************************/\n/*\n* - commentAudioRecordings collection is used to hold audio replies to audioRecordings.\n*\n*/\n// var commentStore = new FS.Store.FileSystem(\"comment-recordings\", {\n//     maxTries: 5, // optional, default 5\n//     path: \"cfs/commentRecs/files\"\n//     //chunkSize: 1024 * 1024  // optional, default GridFS chunk size in bytes (can be overridden per file).\n//     // Default: 2MB. Reasonable range: 512KB - 4MB\n// });\n\n// commentRecordings = new FS.Collection(\"commentRecordings\", {\n//     stores: [commentStore]\n// });\n\n// commentRecordings.allow({\n//     insert: function (userId, doc) {\n//         if (userId) {\n//             return true;\n//         }\n//     },\n//     update: function () {\n//         return true;\n//     },\n//     remove: function () {\n//         return true;\n//     },\n//     download: function () {\n//         return true;\n//     }\n// })\n\nvar commentStore = new FS.Store.S3(\"comment-recordings\", {\n    region: \"eu-west-2\",\n    accessKeyId: \"AKIAJWTNAETF776YKCFQ\", \n    secretAccessKey: \"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\", \n    bucket: \"j2e-recordings\"\n});\n\ncommentRecordings = new FS.Collection(\"commentRecordings\", {\n    stores: [commentStore]\n});\n\ncommentRecordings.allow({\n    insert: function (userId, doc) {\n        if (userId) {\n            return true;\n        }\n    },\n    update: function () {\n        return true;\n    },\n    remove: function () {\n        return true;\n    },\n    download: function () {\n        return true;\n    }\n})\n\n/*********************************************************************\n**********************************************************************\n**********************************************************************\n**********************************************************************/\n\n\n/****************************************************************\n*****************************************************************\n*\n*                    assessmentRecordings\n*\n*****************************************************************\n*****************************************************************/\n/*\n* - assessmentRecordings collection is used to hold recordings used in assessments.\n*\n*/\n// var assessmentStore = new FS.Store.FileSystem(\"assessment-recordings\", {\n//     maxTries: 5, // optional, default 5\n//     path: \"cfs/assessmentRecs/files\"\n//     //chunkSize: 1024 * 1024  // optional, default GridFS chunk size in bytes (can be overridden per file).\n//     // Default: 2MB. Reasonable range: 512KB - 4MB\n// });\n\n// assessmentRecordings = new FS.Collection(\"assessmentRecordings\", {\n//     stores: [assessmentStore]\n// });\n\n// assessmentRecordings.allow({\n//     insert: function (userId, doc) {\n//         if (userId) {\n//             return true;\n//         }\n//     },\n//     update: function () {\n//         return true;\n//     },\n//     remove: function () {\n//         return true;\n//     },\n//     download: function () {\n//         return true;\n//     }\n// })\n\nvar assessmentStore = new FS.Store.S3(\"assessment-recordings\", {\n    region: \"eu-west-2\",\n    accessKeyId: \"AKIAJWTNAETF776YKCFQ\", \n    secretAccessKey: \"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\", \n    bucket: \"j2e-recordings\"\n});\n\nassessmentRecordings = new FS.Collection(\"assessmentRecordings\", {\n    stores: [assessmentStore]\n});\n\nassessmentRecordings.allow({\n    insert: function (userId, doc) {\n        if (userId) {\n            return true;\n        }\n    },\n    update: function () {\n        return true;\n    },\n    remove: function () {\n        return true;\n    },\n    download: function () {\n        return true;\n    }\n})\n\n/****************************************************************\n*****************************************************************\n*\n*                custom organisations logos\n*\n*****************************************************************\n*****************************************************************/\n// Orglogos = new FS.Collection(\"orglogos\", {\n//     stores: [\n//         new FS.Store.GridFS(\"original\", { path: \"/public/images/logos\" }),\n//         new FS.Store.GridFS(\"thumb\", { path: \"/public/images/logos\" })\n//     ],\n//     filter: {\n//         maxSize: 32000000, //32Mb\n//         allow: { contentTypes: ['image/*'] }\n//     },\n//     onInvalid: function (message) {\n//         //throw new Meteor.Error(403, message);\n//     }\n// });\n\nOrglogos = new FS.Collection(\"Orglogos\", {\n    stores: [\n        new FS.Store.FileSystem(\"OrgLogosOriginals\", {path: \"cfs/orgLogosOrig/files\"}),\n        new FS.Store.FileSystem(\"OrgLogosThumbs\", {path: \"cfs/orgLogosThumbs/files\"})\n    ],\n    filter: {\n        allow: { contentTypes: ['image/*'] }\n    },\n    onInvalid: function (message) {\n        alert(message);\n    }\n});\n\nOrglogos.allow({\n    insert: function (userId, doc) {\n        if (userId) {\n            return true;\n        }\n    },\n    update: function (userId, doc, fields, modifiers) {\n        return true;\n    },\n    download: function () {\n        return true;\n    }\n})\n\nLogoURLs = new Mongo.Collection(\"LogoURLs\");\n\nLogoURLs.allow({\n    insert: function () {\n        return true;\n    },\n    update: function (userId, doc, fields, modifiers) {\n        return true;\n    }\n})","// var settings = Meteor.settings.private.MailChimp,\r\n//     chimp    = new MailChimp( settings.apiKey, { version: '2.0' } ),\r\n//     listId   = settings.listId;\r\n\r\n// Meteor.methods({\r\n//    getSubscribers: function() {\r\n//     try {\r\n//       var subscribers = chimp.call( 'lists', 'members', {\r\n//         id: listId,\r\n//         status: 'subscribed'\r\n//       });\r\n\r\n//       subscribers = _.map( subscribers.data, function( subscriber ) {\r\n//         return { email: subscriber.email };\r\n//       });\r\n\r\n//       return subscribers;\r\n//     } catch( exception ) {\r\n//       return exception;\r\n//     }\r\n//   },\r\n//   handleSubscriber: function( subscriber ) {\r\n//     check( subscriber, {\r\n//       email: String,\r\n//       action: String\r\n//     });\r\n\r\n//     try {\r\n//       var subscribe = chimp.call( 'lists', subscriber.action, {\r\n//         id: listId,\r\n//         email: {\r\n//           email: subscriber.email\r\n//         }\r\n//       });\r\n\r\n//       return subscribe;\r\n//     } catch( exception ) {\r\n//       return exception;\r\n//     }\r\n//   }\r\n// });","\n/**\n*\t@summary: Publishes data from 'userNotes' collection. Data should be published in the following way.\n*\t\t\t\t- Admins can see all notes and comments.\n*\t\t\t\t- Tutors can only see their own comments and notes of Students in their groups.\n*\t\t\t\t- Students can only see their own notes and the comments from a Tutor.\n*/\nMeteor.publish(\"nbnotes\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn userNotes.find({});\n\t} else if (Roles.userIsInRole(this.userId, 'moderator')) {\n\t\tvar userDoc = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userArray = [];\n\t\tuserArray = Meteor.users.find({\n\t\t\t\"organisation\": { $in: userDoc.organisation}\n\t\t}).map(function (user) {\n\t\t\treturn user._id;\n\t\t});\n\t\tvar result = userArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t})\n\t\treturn userNotes.find({ noteAuthor: { $in: result } });\n\t} else if (Roles.userIsInRole(this.userId, 'tutor')) {\n\t\tvar studentArray = [];\n\t\tvar cursor = groups.find({ \"tutors\": this.userId });\n\t\tcursor.forEach(function (doc) {\n\t\t\tfor (var i = 0; i < doc.students.length; i++) {\n\t\t\t\tstudentArray.push(doc.students[i]);\n\t\t\t}\n\t\t})\n\t\tvar result = studentArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\t\tresult.push(this.userId);\n\t\treturn userNotes.find({ noteAuthor: { $in: result } });\n\t} else {\n\t\treturn userNotes.find({ noteAuthor: this.userId })\n\t}\n});\n\n/**\n*\t@summary: Publishes data from the 'organisations' collection. Data should be published in the following way:\n*\t\t\t\t- Admins can see all organisations and the users that constitute each organisation.\n*\t\t\t\t- Tutors and Moderators can only see organisations to which they belong.\n*\t\t\t\t- Students can only see organisations to which they belong.\n*/\nMeteor.publish(\"organisations\", function () {\n\t// Rule 1\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn organisations.find({});\n\t} // Rule 2 & Rule 3 (Non-Admins)\n\telse {\n\t\tif (!this.userId) {\n\t\t\treturn;\n\t\t}\n\t\tvar user = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userOrganisation = user.organisation;\n\t\treturn organisations.find({ _id: { $in: userOrganisation} });\n\t}\n})\n\nMeteor.publish(\"group\", function (groupId) {\n\treturn groups.find({ _id: groupId });\n})\n\n\nMeteor.publish(\"messages\", function () {\n\tvar uID = this.userId;\n\treturn messages.find({ \"$or\": [{ \"p1\": uID }, { \"p2\": uID }] });\n})\n/**\n*\t@summary: Publishes data from the 'groups' collection. Data should be published in the following way:\n*\t\t\t\t- Admins can see all groups and the users that constitute each group.\n*\t\t\t\t- Tutors and Moderators can only see groups belonging to their organisation and their constituents.\n*\t\t\t\t- Students can only see Groups to which they belong and other users in the same group as them.\n*/\nMeteor.publish(\"groups\", function () {\n\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn groups.find({});\n\t} else if (Roles.userIsInRole(this.userId, 'moderator') || Roles.userIsInRole(this.userId, 'tutor')) {\n\t\tvar user = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userOrganisation = user.organisation;\n\t\treturn groups.find({ organisation: {$in: userOrganisation} });\n\t} else {\n\t\tvar user = Meteor.users.findOne({ _id: this.userId });\n\t\tif (user.groups) {\n\t\t\tvar userGroups = user.groups;\n\t\t\treturn groups.find({ _id: { $in: userGroups } });\n\t\t}\n\t}\n});\n\n/**\n*\t@summary: Publishes data from the 'subgroups' collection. Data should be published in the following way:\n*\t\t\t\t- Admins can see all subgroups and the users that constitute each subgroups.\n*\t\t\t\t- Tutors and Moderators can only see subgroups belonging to their organisation and their constituents.\n*\t\t\t\t- Students can only see subgroups to which they belong and other users in the same group as them.\n*/\nMeteor.publish(\"subgroups\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn subgroups.find({});\n\t} else if (Roles.userIsInRole(this.userId, 'moderator') || Roles.userIsInRole(this.userId, 'tutor')) {\n\t\tvar user = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userOrganisation = user.organisation;\n\n\t\treturn subgroups.find({ organisation: {$in: userOrganisation} });\n\t} else {\n\t\tvar user = Meteor.users.findOne({ _id: this.userId });\n\t\tif (user.subgroups) {\n\t\t\tvar userSubgroups = user.subgroups;\n\n\t\t\treturn subgroups.find({ _id: { $in: userSubgroups } });\n\t\t}\n\t}\n})\n\n/**\n*\t@summary: Publishes data from the 'audioRecordings' collection. Data should be published in the following way:\n*\t\t\t- Admins can see all recordings\n*\t\t\t- Moderators can see all recordings by Users in their organisation.\n*\t\t\t- Tutors can only see recordings by Users in their group.\n*\t\t\t- Students can only hear their own recordings and replies from Tutors.\n*/\nMeteor.publish(\"audioRecordings\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn audioRecordings.find({});\n\t} else if (Roles.userIsInRole(this.userId, 'moderator')) {\n\t\tvar userDoc = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userArray = [];\n\t\tuserArray = Meteor.users.find({\n\t\t\t\"organisation\": {$in: userDoc.organisation}\n\t\t}).map(function (user) {\n\t\t\treturn user._id;\n\t\t});\n\t\tvar result = userArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\t\treturn audioRecordings.find({ audioAuthor: { $in: result } });\n\t} else if (Roles.userIsInRole(this.userId, 'tutor')) {\n\t\tvar studentArray = [];\n\t\tvar cursor = groups.find({ \"tutors\": this.userId });\n\t\tcursor.forEach(function (doc) {\n\t\t\tfor (var i = 0; i < doc.students.length; i++) {\n\t\t\t\tstudentArray.push(doc.students[i]);\n\t\t\t}\n\t\t});\n\t\tvar result = studentArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\t\tresult.push(this.userId);\n\t\treturn audioRecordings.find({ audioAuthor: { $in: result } });\n\t} else {\n\t\treturn audioRecordings.find({ audioAuthor: this.userId })\n\t}\n});\n\n/**\n*\t@summary: Publishes data from the 'commentAudioRecordings' collection. Data should be published in the following way:\n*\t\t\t- Admins can see all recordings.\n*\t\t\t- Moderators can see all recordings by Users in their organisation.\n*\t\t\t- Tutors can only see recordings by Users in their group.\n*\t\t\t- Students can only hear their own recordings and replies from Tutors.\n*/\nMeteor.publish(\"commentAudioRecordings\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn commentRecordings.find({});\n\t} else if (Roles.userIsInRole(this.userId, 'moderator')) {\n\t\tvar userDoc = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userArray = [];\n\t\tuserArray = Meteor.users.find({\n\t\t\t\"organisation\": {$in: userDoc.organisation}\n\t\t}).map(function (user) {\n\t\t\treturn user._id;\n\t\t});\n\t\tvar result = userArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\t\treturn commentRecordings.find({ audioAuthor: { $in: result } });\n\t} else if (Roles.userIsInRole(this.userId, 'tutor')) {\n\t\tvar studentArray = [];\n\t\tvar cursor = groups.find({ \"tutors\": this.userId });\n\t\tcursor.forEach(function (doc) {\n\t\t\tfor (var i = 0; i < doc.students.length; i++) {\n\t\t\t\tstudentArray.push(doc.students[i]);\n\t\t\t}\n\t\t});\n\n\t\tvar commentArray = [];\n\t\tvar audioCursor = audioRecordings.find({ audioAuthor: { $in: studentArray } });\n\t\taudioCursor.forEach(function (doc) {\n\t\t\tfor (var i = 0; i < doc.comments.length; i++) {\n\t\t\t\tif (doc.comments[i].type == \"audio\") {\n\t\t\t\t\tcommentArray.push(doc.comments[i]._id);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tvar result = commentArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\n\n\t\treturn commentRecordings.find({ _id: { $in: result } });\n\t} else if (Roles.userIsInRole(this.userId, 'student')) {\n\t\tvar commentArray = [];\n\t\tvar cursor = audioRecordings.find({ \"audioAuthor\": this.userId })\n\t\tcursor.forEach(function (doc) {\n\t\t\tfor (var i = 0; i < doc.comments.length; i++) {\n\t\t\t\tif (doc.comments[i].type == \"audio\") {\n\t\t\t\t\tcommentArray.push(doc.comments[i]._id);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\tvar result = commentArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\t\treturn commentRecordings.find({ _id: { $in: result } });\n\t}\n});\n\nMeteor.publish(\"assessmentRecordings\", function () {\n\treturn assessmentRecordings.find({});\n});\n\nMeteor.publish(\"connectionCheck\", function (user, assessment, section) {\n\tthis.onStop(function () {\n\t\tMeteor.call('handleAssessmentDisconnect', user, assessment, section);\n\t})\n\treturn undefined;\n})\n\nMeteor.publish(\"pauseConnection\", function (mod, act, user) {\n\n\tvar uId = user;\n\tthis.onStop(function () {\n\t\tMeteor.call('setPauseActivity', mod, act, uId);\n\t});\n});\n\n/**\n*\t@summary: Publishes user data from the 'users' collection. Data should be published in the following way:\n*\t\t\t- Admins can see all user data.\n*\t\t\t- Tutors can see users in the organisation\n*\t\t\t- Students can only only see users in their groups.\n*/\nMeteor.publish(\"Users\", function () {\n\n\tvar trial = organisations.findOne({ name: \"Trial\" });\n\tvar user = Meteor.users.findOne({ _id: this.userId });\n\t\n\tif(user == null || user == 'undefined')\n\t\treturn null;\n\n\tvar orgId = user.organisation;\n\n\tif (trial != null && trial != 'undefined') {\n\t\ttrial = trial._id;\n\t}\n\n\tif (orgId == trial) {\n\t\treturn Meteor.users.find({ roles: { $ne: \"tutor\" } });\n\t} else {\n\t\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\n\t\t\treturn Meteor.users.find({});\n\n\t\t} else if (Roles.userIsInRole(this.userId, 'moderator')) {\n\n\t\t\tvar user = Meteor.users.findOne({ _id: this.userId });\n\t\t\tvar userOrganisation = user.organisation;\n\t\t\treturn Meteor.users.find({ organisation: { $in: userOrganisation}, \"roles\": { $ne: \"admin\" } })\n\n\t\t} else if (Roles.userIsInRole(this.userId, 'tutor')) {\n\n\t\t\tvar user = Meteor.users.findOne({ _id: this.userId });\n\t\t\tvar userOrganisation = user.organisation;\n\t\t\treturn Meteor.users.find({ organisation: { $in: userOrganisation}, \"roles\": { $ne: \"admin\" } })\n\n\t\t} else if (Roles.userIsInRole(this.userId, 'student')) {\n\n\t\t\tvar studentArray = [];\n\t\t\tvar cursor = groups.find({ \"students\": this.userId });\n\t\t\tcursor.forEach(function (doc) {\n\t\t\t\tfor (var i = 0; i < doc.students.length; i++) {\n\t\t\t\t\tstudentArray.push(doc.students[i]);\n\t\t\t\t}\n\t\t\t\tfor (var i = 0; i < doc.tutors.length; i++) {\n\t\t\t\t\tstudentArray.push(doc.tutors[i]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar result = studentArray.map(function (item) {\n\t\t\t\treturn item.toString();\n\t\t\t});\n\t\t\treturn Meteor.users.find({ _id: { $in: result } }, { fields: { username: 1, 'emails.address': 1, profile: 1, groups: 1, organisation: 1, roles: 1 } })\n\t\t}\n\t}\n});\n\nMeteor.publish(\"User\", function () {\n\treturn Meteor.users.find({ _id: this.userId });\n})\n\n/**\n*\t@summary: Publishes data from the 'userProgress' collection. Data should be published in the following way:\n*\t\t\t- Admins can see all userProgress.\n*\t\t\t- Moderators can see all progress by Users in their organisation.\n*\t\t\t- Tutors can only see progress by Users in their group.\n*\t\t\t- Students can only see their own progress\n*/\nMeteor.publish(\"userProgress\", function () {\n\t// ADMIN\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn userProgress.find({});\n\t\t// MODERATOR\n\t} else if (Roles.userIsInRole(this.userId, 'moderator')) {\n\t\tvar userDoc = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userArray = [];\n\t\tuserArray = Meteor.users.find({\n\t\t\t\"organisation\": {$in: userDoc.organisation}\n\t\t}).map(function (user) {\n\t\t\treturn user._id;\n\t\t});\n\t\tvar result = userArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\t\treturn userProgress.find({ userId: { $in: result } });\n\t\t// TUTOR\n\t} else if (Roles.userIsInRole(this.userId, 'tutor')) {\n\n\t\tvar userDoc = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userArray = [];\n\t\tuserArray = Meteor.users.find({\n\t\t\t\"groups\": { $in: userDoc.groups }\n\t\t}).map(function (user) {\n\t\t\treturn user._id;\n\t\t});\n\t\tvar result = userArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\t\treturn userProgress.find({ userId: { $in: result } });\n\n\t} else if (Roles.userIsInRole(this.userId, 'student')) {\n\t\treturn userProgress.find({ userId: this.userId });\n\t}\n});\n\nMeteor.publish('singleUserProgress', function () {\n\tif (this.userId) {\n\t\treturn userProgress.find({ userId: this.userId });\n\t} else {\n\t\treturn\n\t}\n});\n\nMeteor.publish(\"studentAssessments\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn studentAssessments.find({});\n\t} else if (Roles.userIsInRole(this.userId, 'moderator')) {\n\t\tvar userDoc = Meteor.users.findOne({ _id: this.userId });\n\t\tvar userArray = [];\n\t\tuserArray = Meteor.users.find({\n\t\t\t\"organisation\": {$in: userDoc.organisation}\n\t\t}).map(function (user) {\n\t\t\treturn user._id;\n\t\t});\n\t\tvar result = userArray.map(function (item) {\n\t\t\treturn item.toString();\n\t\t});\n\t\tresult.push(this.userId);\n\t\treturn studentAssessments.find({ userId: { $in: result } });\n\t} else if (Roles.userIsInRole(this.userId, 'tutor')) {\n\t\tvar studentArray = [];\n\t\tvar cursor = groups.find({ \"tutors\": this.userId });\n\t\tcursor.forEach(function (doc) {\n\t\t\tfor (var i = 0; i < doc.students.length; i++) {\n\t\t\t\tstudentArray.push(doc.students[i]);\n\t\t\t}\n\t\t});\n\t\tstudentArray.push(this.userId); // This line ensures Tutor can see his own assessments (if ever any).\n\t\treturn studentAssessments.find({ userId: { $in: studentArray } });\n\t} else if (Roles.userIsInRole(this.userId, 'student')) {\n\t\treturn studentAssessments.find({ userId: this.userId })\n\t}\n})\n\nMeteor.publish(\"f_forums\", function () {\n\n\tvar user = Meteor.users.findOne({ _id: this.userId });\n\tvar userOrg = user.organisation;\n\tvar userGroups = user.groups;\n\n\t// if admin\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn f_forums.find({});\n\t} else if (Roles.userIsInRole(this.userId, 'tutor') || Roles.userIsInRole(this.userId, 'moderator')) {\n\t\treturn f_forums.find({ \"organisation\": {$in: userOrg} });\n\t} else if (Roles.userIsInRole(this.userId, 'student')) {\n\t\treturn f_forums.find({ \"organisation\": {$in: userOrg} });\n11\t} else {\n\t\treturn {};\n\t}\n})\n\nMeteor.publish(\"assessmentTypes\", function () {\n\treturn assessmentTypes.find({});\n})\n\nMeteor.publish(\"bug_reports\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn bug_reports.find({});\n\t}\n})\n\nMeteor.publish(\"feedback_forms\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn feedback_forms.find({});\n\t}\n})\n\nMeteor.publish(\"vouchers\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn vouchers.find({});\n\t}\n})\n\nMeteor.publish(\"payment_plans\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn payment_plans.find({});\n\t}\n})\n\nMeteor.publish(\"contact_form\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn contact_form.find({});\n\t}\n})\n\nMeteor.publish(\"duration_log\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn duration_log.find({});\n\t}\n})\n\nMeteor.publish(\"gameAccess\", function () {\n\tvar userId = this.userId;\n\tif (Roles.userIsInRole(userId, 'admin')) {\n\t\treturn gameAccess.find({});\n\t} else {\n\t\treturn gameAccess.find({ user: userId });\n\t}\n})\n\nMeteor.publish(\"Announcements\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn Announcements.find({});\n\t} else if (Roles.userIsInRole(this.userId, 'moderator') || Roles.userIsInRole(this.userId, 'tutor') || Roles.userIsInRole(this.userId, 'student')) {\n\t\tvar org = Meteor.users.findOne({ _id: this.userId }).organisation;\n\t\treturn Announcements.find({ organisation: {$in: org} });\n\t};\n})\n\n\nMeteor.publish(\"appliedVouchers\", function () {\n\tif (Roles.userIsInRole(this.userId, 'admin')) {\n\t\treturn appliedVouchers.find({});\n\t}\n})\n\nMeteor.publish(\"Orglogos\", function () {\n\treturn Orglogos.find({});\n})\n\nMeteor.publish(\"LogoURLs\", function () {\n\treturn LogoURLs.find({});\n})\n\nMeteor.publish(null, function () {\n\treturn Meteor.roles.find({})\n})","// (server-side)\r\nAccounts.onCreateUser(function (options, user) {\r\n\r\n    var email = options.email;\r\n    if(email.indexOf(\"@\") < 0 || email.indexOf(\".\") < 0){\r\n        //Invalid email address. Do not allow account creation.\r\n        throw new Meteor.Error('500', 'Error: Invalid Email Address. Please provide an email with the format \"joe@company.com\"');\r\n    }\r\n\r\n    user.profile = options.profile;\r\n    user.groups = [];\r\n    user.organisation = options.organisation;\r\n    user.authorisedCourses = options.authorisedCourses;\r\n    user.expiry = options.expiry;\r\n    user.messages = options.messages;\r\n    if(options.scormId != null && options.scormId != \"undefined\"){\r\n        user.scormId = options.scormId;\r\n    }\r\n    user.certificateEnabled = options.certificateEnabled;\r\n    //user.confirmedEmail = options.confirmedEmail;\r\n\r\n    // we wait for Meteor to create the user before sending an email\r\n    //Meteor.setTimeout(function() {\r\n    //  Accounts.sendVerificationEmail(user._id);\r\n    //}, 2 * 1000);\r\n\r\n    return user;\r\n\r\n});\r\n\r\nAccounts.onLogin(function () {\r\n    var uId = Meteor.userId();\r\n    var expiryDate = Meteor.users.findOne({ _id: uId }).expiry;\r\n\r\n    if (expiryDate == undefined || expiryDate == \"\") {\r\n        Meteor.users.update({ _id: uId }, { $set: { 'expiredSubscription': false } });\r\n        return;\r\n    }\r\n\r\n    var expiryDate = moment(Meteor.user().expiry, \"DD/MM/YYYY H:mm\");\r\n    var nowDate = moment();\r\n\r\n    if (expiryDate > nowDate) {\r\n        // Not expired yet\r\n        Meteor.users.update({ _id: uId }, { $set: { 'expiredSubscription': false } });\r\n\r\n    } else {\r\n        // Update field used by routes.js\r\n        Meteor.users.update({ _id: uId }, { $set: { 'expiredSubscription': true } });\r\n        // Log out user if expired\r\n        /*\r\n            Meteor.setTimeout(function(){\r\n              Meteor.users.update({_id : uId}, {$set: { \"services.resume.loginTokens\" : [] }});\r\n            },2000);\r\n        */\r\n    }\r\n})\r\n\r\nAccounts.onLoginFailure(function () {\r\n    // to implement counts\r\n    // console.log('login failure');\r\n});\r\n\r\n\r\naudioRecordings.allow({\r\n    insert: function (userId, doc) {\r\n        if (userId) {\r\n            return true;\r\n        }\r\n    },\r\n    update: function () {\r\n        return true;\r\n    },\r\n    remove: function () {\r\n        return true;\r\n    },\r\n    download: function () {\r\n        return true;\r\n    }\r\n})\r\n","sitemaps.add('/sitemap.xml', function() {\r\n  return [\r\n   {\r\n    // Required.  http[s]://sitename.com automatically prepended */\r\n    page: '/',\r\n    // Optional.  Timestamp of when the page was last modified.\r\n    lastmod: new Date(),         // or new Date().getTime()\r\n    // Optional.  always, hourly, daily, weekly, monthly, yearly, never\r\n    // http://www.sitemaps.org/protocol.html#changefreqdef\r\n    changefreq: 'weekly',\r\n    // Optional.  http://www.sitemaps.org/protocol.html#prioritydef\r\n    priority: 0.5,\r\n    // Optional.  https://support.google.com/webmasters/answer/2620865\r\n    // Again, the base URL is automatically prepended to the href key\r\n\r\n    // /!!!\\ Ian: We should come back to this if we translate the home page\r\n\r\n    // xHtmlLinks: [\r\n    //   { ref: 'alternate', 'hreflang': 'en', 'href': 'en/blah' },\r\n    //   { ref: 'alternate', 'hreflang': 'de', 'href': 'de/blah' }\r\n    // ],\r\n    // Optional.  https://support.google.com/webmasters/answer/2620865?hl=en\r\n    // Again, the base URL is automatically prepended to the loc key\r\n    images: [\r\n      { \r\n        loc: '/landing/logo-journey.png',\r\n        caption: \"Journey 2 English Logo\",\r\n        title: \"Journey 2 English Logo\", \r\n      },      \r\n      { \r\n        loc: 'landing/logo-klik2learn.png',\r\n        caption: \"Klik2learn Logo\",\r\n        title: \"Klik2learn Logo\", \r\n      }\r\n      // ,{ \r\n      //   loc: '/myOtherImg.jpg',   \r\n      //   // Below properties are optional\r\n      //   caption: \"..\", \r\n      //   geo_location: \"..\", \r\n      //   title: \"..\", \r\n      //   license: \"..\"\r\n      // }\r\n    ],\r\n    // Optional.  https://support.google.com/webmasters/answer/80472?hl=en\r\n    // Again, the base URL is automatically prepended to loc, *_loc\r\n    videos: [\r\n      { \r\n        content_loc: 'https://do9d8j0j2sh3m.cloudfront.net/assets/journey2english/video/course.mp4',\r\n        thumbnail_loc: \"https://do9d8j0j2sh3m.cloudfront.net/assets/journey2english/video/course.jpg\", \r\n        title: \"Why choose Journey 2 English\", \r\n        description: \"Why choose Journey 2 English\", \r\n      }, \r\n      { \r\n        content_loc: 'https://do9d8j0j2sh3m.cloudfront.net/assets/journey2english/video/testimonials.mp4',\r\n        thumbnail_loc: \"https://do9d8j0j2sh3m.cloudfront.net/assets/journey2english/video/testimonials.jpg\", \r\n        title: \"Journey 2 English Testimonials\", \r\n        description: \"What people say about Journey 2 English\", \r\n      }\r\n      // ,{ \r\n      //   loc: '/myOtherVideo.jpg',  // Below properties are optional\r\n      //   thumbnail_loc: \"..\", \r\n      //   title: \"..\", \r\n      //   description: \"..\", \r\n      //   etc: \"..\" \r\n      // }\r\n    ]\r\n  }\r\n  ];\r\n});","var parseQuery = function(queryString) {\r\n    var query = {};\r\n    var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');\r\n    for (var i = 0; i < pairs.length; i++) {\r\n        var pair = pairs[i].split('=');\r\n        query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');\r\n    }\r\n    return query;\r\n}\r\n\r\n/**\r\n* Code to run on server deployment.\r\n*/\r\nMeteor.startup(function (callback) {\r\n\r\n\t// smtp = {\r\n\t// \tusername: 'contact@klik2learn.com',   // eg: server@gentlenode.com\r\n\t// \tpassword: 'k2ladmin001',   // eg: 3eeP1gtizk5eziohfervU\r\n\t// \tserver: 'smtp.gmail.com',  // eg: mail.gandi.net\r\n\t// \tport: 587\t// Changed from '25' to remove ECONNREFUSED error (9th Feb 2016)\r\n\t// };\r\n\r\n\t//POST request handling example- not used\r\n\t\r\n\t/*WebApp.connectHandlers.use(\"/hubLogin\", function(req, res, next) {\r\n\t\tvar body = '';\r\n\t\r\n        req.on('data', function (data) {\r\n\t\t\tbody += data.toString('utf-8');\r\n\t\t\tconsole.log(body);\r\n            //1e6 === 1 * Math.pow(10, 6) === 1 * 1000000 ~~~ 1MB\r\n            if (body.length > 1e6) { \r\n                // FLOOD ATTACK OR FAULTY CLIENT, NUKE REQUEST\r\n                req.connection.destroy();\r\n\t\t\t}\r\n\t\t});\r\n\r\n        req.on('end', function () {\r\n\t\t\tlet qs = parseQuery(body);\r\n\t\t\tconsole.log(qs);\r\n\t\t\tconsole.log(\"END\");\r\n\t\t\tlet username = qs.username;\r\n\t\t\tlet password = qs.parsword;\r\n\r\n\t\t\tif(username && password){\r\n\t\t\t}\r\n\t\t});\r\n\t\tnext();\r\n\t\tconsole.log(\"NEXT\");\r\n\t});*/\r\n\r\n\r\n\tsmtp = {\r\n\t\tusername: \"noreply@journey2english.com\",\r\n\t\tpassword: \"K2Ln0r3ply\",\r\n\t\tserver: 'mail.hostedemail.com',\r\n\t\tport: 587\r\n\t};\r\n\tprocess.env.MAIL_URL = 'smtp://' + encodeURIComponent(smtp.username) + ':' + encodeURIComponent(smtp.password) + '@' + encodeURIComponent(smtp.server) + ':' + smtp.port;\r\n\tprocess.env.METEOR_WATCH_PRIORITIZE_CHANGED = false;\r\n\r\n\tAccounts.emailTemplates.siteName = \"Journey2English\";\r\n\tAccounts.emailTemplates.from = 'Journey2English <noreply@journey2english.com>';\r\n\tAccounts.emailTemplates.enrollAccount.subject = function (user) {\r\n\t\treturn \"Welcome to Journey 2 English, \" + user.profile.firstname;\r\n\t};\r\n\r\n\tAccounts.emailTemplates.enrollAccount.html = function (user, url) {\r\n\t\tvar email = null;\r\n\r\n\t\tif (user.organisation == null || user.organisation == 'undefined') {\r\n\t\t\tthrow new Meteor.Error('500', \"Failed to create account. No Organisation provided.\");\r\n\t\t} else {\r\n\t\t\tvar customEmail = customEmails.findOne({ orgId: user.organisation[0] });\r\n\t\t\tif (customEmail != null && customEmail != 'undefined') {\r\n\t\t\t\temail = customEmail.enrollmentEmail;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar displayUsername;\r\n\t\tif (user.username == undefined) {\r\n\t\t\tdisplayUsername = '';\r\n\t\t} else {\r\n\t\t\tdisplayUsername = user.username;\r\n\t\t}\r\n\t\t//[VERIFICATION_URL] - url\r\n\t\t//[USERNAME] - username\r\n\t\tif (email != null) {\r\n\t\t\temail = email.split('[VERIFICATION_URL]').join(url);\r\n\t\t\temail = email.split('[USERNAME]').join(displayUsername);\r\n\t\t\treturn email;\r\n\t\t}\r\n\r\n\t\treturn '<table border=0 cellpadding=0 cellspacing=0 style=background-color:#edf4ff;border-width:0;max-width:640px;margin-left:auto;margin-right:auto;font-family:sans-serif;font-size:16px><tr><td style=margin:0;padding:0><img alt=\"Journey 2 English\"src=http://www.klik2learn.com/wp-content/uploads/2016/07/email_jte_logo.jpg style=max-width:100%><tr><td style=margin:0;padding:1em><h1 style=color:#1e72ca;font-family:sans-serif;text-align:center;margin-bottom:1em>Welcome to <span style=display:inline-block>Journey 2 English</span></h1><p style=font-family:sans-serif;font-weight:700>Follow these steps to create your account:<ol style=font-weight:800;font-size:24px><li style=margin-bottom:40px><p style=font-weight:400;font-size:16px>Go to this link:<br><br><a href=\"' + url + '\">' + url + '</a><br><br><i>(The course works in <img alt=Chrome src=http://www.klik2learn.com/wp-content/uploads/2016/10/chrome.png style=padding-left:3px;padding-right:1px height=15 width=15>Chrome, <img alt=Firefox src=http://www.klik2learn.com/wp-content/uploads/2016/10/firefox.png style=padding-left:3px;padding-right:1px height=15 width=15>Firefox, <img alt=Safari src=http://www.klik2learn.com/wp-content/uploads/2016/10/safari.png style=padding-left:3px;padding-right:1px height=15 width=15>Safari and <img alt=Edge src=http://www.klik2learn.com/wp-content/uploads/2016/10/edge.png style=padding-left:3px;padding-right:1px height=15 width=15>Edge on all devices)</i><li style=margin-bottom:40px><p style=font-weight:400;font-size:16px>Choose a password<p style=text-align:center><img alt=\"Choose a password\"src=http://www.klik2learn.com/wp-content/uploads/2016/10/set-password.png style=max-width:100%;height:auto><li style=margin-bottom:40px><p style=font-weight:400;font-size:16px>Congratulations! You can now access the course.<li style=margin-bottom:40px><p style=font-weight:400;font-size:16px>You can sign in again at any time at <a href=https://journey2english.com>journey2english.com</a> using your email or username. Your username is <span style=font-family:monospace;background-color:#fff;display:inline-block;margin:2px;padding:3px>' + user.username + '</span></ol><p style=text-align:center>Good luck with your studies.<p style=text-align:center>The Klik2learn team<p style=text-align:center><a href=http://www.klik2learn.com><img alt=Klik2learn src=http://www.klik2learn.com/wp-content/uploads/2016/10/header-logo.png height=100 width=100></a></table>'\r\n\t};\r\n\r\n\tAccounts.emailTemplates.verifyEmail.subject = function (user) {\r\n\t\treturn \"Welcome to Journey 2 English, \" + user.profile.firstname;\r\n\t};\r\n\r\n\tAccounts.emailTemplates.verifyEmail.html = function (user, url) {\r\n\t\tvar email = null;\r\n\r\n\t\tif (user.organisation == null || user.organisation == 'undefined') {\r\n\t\t\tthrow new Meteor.Error('500', \"Failed to create account. No Organisation provided.\");\r\n\t\t} else {\r\n\t\t\tvar customEmail = customEmails.findOne({ orgId: user.organisation[0] });\r\n\t\t\tif (customEmail != null && customEmail != 'undefined') {\r\n\t\t\t\temail = customEmail.verificationEmail;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar displayUsername;\r\n\t\tif (user.username == undefined) {\r\n\t\t\tdisplayUsername = '';\r\n\t\t} else {\r\n\t\t\tdisplayUsername = user.username;\r\n\t\t}\r\n\r\n\t\t//[VERIFICATION_URL] - url\r\n\t\t//[USERNAME] - username\r\n\t\tif (email != null) {\r\n\t\t\temail = email.split('[VERIFICATION_URL]').join(url);\r\n\t\t\temail = email.split('[USERNAME]').join(displayUsername);\r\n\t\t\treturn email;\r\n\t\t}\r\n\r\n\t\treturn '<!DOCTYPE html> <html> <head> <title></title> </head> <body> <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#edf4ff;border-width:0;max-width:640px;margin-left:auto;margin-right:auto;font-family:sans-serif;font-size:16px\"> <tr> <td style=\"margin:0;padding:0\"><img alt=\"Journey 2 English\" src=\"http://www.klik2learn.com/wp-content/uploads/2016/07/email_jte_logo.jpg\" style=\"max-width:100%\"></td> </tr> <tr> <td style=\"margin:0;padding:1em\"> <h1 style=\"color:#1e72ca;font-family:sans-serif;text-align:center;margin-bottom:1em\">Welcome to <span style=\"display:inline-block\">Journey 2 English</span></h1> <p style=\"font-family:sans-serif;font-weight:700\">You are almost there!</p> <ol style=\"font-weight:800;font-size:24px\"> <li style=\"margin-bottom:40px\"> <p style=\"font-weight:400;font-size:16px\">Click this link to activate your account:<br> <br> <a href=\"' + url + '\">' + url + '</a><br> <br> <i>(The course works in <img alt=\"Chrome\" height=\"15\" src=\"http://www.klik2learn.com/wp-content/uploads/2016/10/chrome.png\" style=\"padding-left:3px;padding-right:1px\" width=\"15\">Chrome, <img alt=\"Firefox\" height=\"15\" src=\"http://www.klik2learn.com/wp-content/uploads/2016/10/firefox.png\" style=\"padding-left:3px;padding-right:1px\" width=\"15\">Firefox, <img alt=Safari src=http://www.klik2learn.com/wp-content/uploads/2016/10/safari.png style=padding-left:3px;padding-right:1px height=15 width=15>Safari and <img alt=\"Edge\" height=\"15\" src=\"http://www.klik2learn.com/wp-content/uploads/2016/10/edge.png\" style=\"padding-left:3px;padding-right:1px\" width=\"15\">Edge on all devices)</i></p> </li> <li style=\"margin-bottom:40px\"> <p style=\"font-weight:400;font-size:16px\">You can sign in again at any time at <a href=\"https://journey2english.com\">journey2english.com</a> using your email or username. Your username is <span style=\"font-family:monospace;background-color:#fff;display:inline-block;margin:2px;padding:3px\">' + user.username + '</span></p> </li> </ol> <p style=\"text-align:center\">Good luck with your studies.</p> <p style=\"text-align:center\">The Klik2learn team</p> <p style=\"text-align:center\"><a href=\"http://www.klik2learn.com\"><img alt=\"Klik2learn\" height=\"100\" src=\"http://www.klik2learn.com/wp-content/uploads/2016/10/header-logo.png\" width=\"100\"></a></p> </td> </tr> </table> </body> </html>'\r\n\t};\r\n\r\n\tAccounts.config({\r\n\t\t// use 0.0000001, and not 0, to test immediate expiration\r\n\t\t\"passwordResetTokenExpirationInDays\": 30\r\n\t});\r\n});\r\n","if (Meteor.isClient) {\r\n  // counter starts at 0\r\n  Session.setDefault(\"counter\", 0);\r\n\r\n  window.fbAsyncInit = function () {\r\n    FB.init({\r\n      appId: '334914750233778',\r\n      status: true,\r\n      xfbml: true,\r\n      version: 'v2.8'\r\n    });\r\n  };\r\n\r\n  //console.log(\"METEOR CLIENT TEMPLATES.js\");\r\n  if (Meteor.isClient) {\r\n    //console.log(\"meteor is client\");\r\n    Meteor.settings = { \"public\": { \"ga\": { \"id\": \"UA-144464149-2\" } } };\r\n  }\r\n}\r\n\r\nif (Meteor.isServer) {\r\n\r\n}\r\n"]}