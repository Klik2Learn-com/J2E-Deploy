var require = meteorInstall({"server":{"meteor-methods":{"SCORM-API-Methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/SCORM-API-Methods.js                                                                          //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
    "getUserBySCORMId": function (scorm_Id) {                                                                          // 2
        var user = Meteor.users.findOne({                                                                              // 3
            scormId: scorm_Id                                                                                          // 3
        });                                                                                                            // 3
                                                                                                                       //
        if (user == null || user == "undefined") {                                                                     // 4
            throw new Meteor.Error("500", "No user associated with this ID");                                          // 5
        } else {                                                                                                       // 6
            return user;                                                                                               // 7
        }                                                                                                              // 8
    },                                                                                                                 // 9
    "addScormIdToUser": function (userId, scorm_Id) {                                                                  // 11
        Meteor.users.update({                                                                                          // 12
            _id: userId                                                                                                // 12
        }, {                                                                                                           // 12
            $set: {                                                                                                    // 12
                scormId: scorm_Id                                                                                      // 12
            }                                                                                                          // 12
        });                                                                                                            // 12
    }                                                                                                                  // 13
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"access-duration-log.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/access-duration-log.js                                                                        //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'addSubscriptionUserExpiry': function (uId, oldExpiry) {                                                              // 2
		try {                                                                                                                // 3
			var currentDate = Meteor.users.findOne({                                                                            // 4
				_id: uId                                                                                                           // 4
			}).expiry;                                                                                                          // 4
			var expiry = new Date(currentDate.setTime(currentDate.getTime() + oldExpiry * 86400000));                           // 5
			Meteor.users.update({                                                                                               // 6
				_id: uId                                                                                                           // 6
			}, {                                                                                                                // 6
				$set: {                                                                                                            // 6
					expiry: expiry                                                                                                    // 6
				}                                                                                                                  // 6
			});                                                                                                                 // 6
		} catch (err) {                                                                                                      // 7
			throw new Meteor.Error(err.message);                                                                                // 8
		}                                                                                                                    // 9
	},                                                                                                                    // 10
	'removeSubscriptionUserExpiry': function (uId, oldExpiry) {                                                           // 12
		try {                                                                                                                // 13
			var expiry = new Date();                                                                                            // 14
			Meteor.users.update({                                                                                               // 15
				_id: uId                                                                                                           // 15
			}, {                                                                                                                // 15
				$set: {                                                                                                            // 15
					expiry: expiry                                                                                                    // 15
				}                                                                                                                  // 15
			});                                                                                                                 // 15
		} catch (err) {                                                                                                      // 16
			throw new Meteor.Error(err.message);                                                                                // 17
		}                                                                                                                    // 18
	},                                                                                                                    // 19
	'customUserExpiry': function (uId, oldExpiry) {                                                                       // 21
		try {                                                                                                                // 22
			var currentDate = new Date();                                                                                       // 23
			var expiry = new Date(currentDate.setTime(currentDate.getTime() + oldExpiry * 86400000));                           // 24
			Meteor.users.update({                                                                                               // 25
				_id: uId                                                                                                           // 25
			}, {                                                                                                                // 25
				$set: {                                                                                                            // 25
					expiry: expiry                                                                                                    // 25
				}                                                                                                                  // 25
			});                                                                                                                 // 25
		} catch (err) {                                                                                                      // 26
			throw new Meteor.Error(err.message);                                                                                // 27
		}                                                                                                                    // 28
	},                                                                                                                    // 29
	'durationLogEntry': function (subscriberId, adminId, event, daysBefore, daysAfter) {                                  // 31
		try {                                                                                                                // 32
			duration_log.insert({                                                                                               // 33
				subscriberId: subscriberId,                                                                                        // 33
				adminId: adminId,                                                                                                  // 33
				event: event,                                                                                                      // 33
				daysBefore: daysBefore,                                                                                            // 33
				daysAfter: daysAfter                                                                                               // 33
			});                                                                                                                 // 33
		} catch (err) {                                                                                                      // 34
			throw new Meteor.Error(err.message);                                                                                // 35
		} //(userId, Meteor.userId(), "Account creation.", 0, aExpiry)                                                       // 36
                                                                                                                       //
	}                                                                                                                     // 38
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"announcement-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/announcement-methods.js                                                                       //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'addAnnouncements': function (title, msg, aExpiry, userId) {                                                          // 3
		var org = Meteor.users.findOne({                                                                                     // 4
			_id: userId                                                                                                         // 4
		}).organisation;                                                                                                     // 4
		var formattedDate = new Date();                                                                                      // 5
		var currentDate = new Date();                                                                                        // 6
		var expiry = new Date(currentDate.setTime(currentDate.getTime() + aExpiry * 86400000));                              // 7
                                                                                                                       //
		try {                                                                                                                // 9
			return Announcements.insert({                                                                                       // 10
				author: userId,                                                                                                    // 10
				date: formattedDate,                                                                                               // 10
				organisation: org[0],                                                                                              // 10
				expiry: expiry,                                                                                                    // 10
				title: title,                                                                                                      // 10
				message: msg,                                                                                                      // 10
				readBy: []                                                                                                         // 10
			});                                                                                                                 // 10
		} catch (err) {                                                                                                      // 11
			throw new Meteor.Error(err.message);                                                                                // 12
		}                                                                                                                    // 13
	},                                                                                                                    // 14
	'editAnnouncements': function (id, title, msg, aExpiry, userId) {                                                     // 16
		// var org = Meteor.users.findOne({_id: userId}).organisation;                                                       // 17
		var currentDate = new Date();                                                                                        // 18
		var expiry = new Date(currentDate.setTime(currentDate.getTime() + aExpiry * 86400000));                              // 19
                                                                                                                       //
		try {                                                                                                                // 21
			return Announcements.update({                                                                                       // 22
				_id: id                                                                                                            // 23
			}, {                                                                                                                // 23
				$set: {                                                                                                            // 25
					title: title,                                                                                                     // 26
					message: msg,                                                                                                     // 27
					expiry: expiry,                                                                                                   // 28
					editedBy: userId                                                                                                  // 29
				}                                                                                                                  // 25
			}, {                                                                                                                // 24
				upsert: true                                                                                                       // 32
			});                                                                                                                 // 32
		} catch (err) {                                                                                                      // 34
			throw new Meteor.Error(err.message);                                                                                // 35
		}                                                                                                                    // 36
	},                                                                                                                    // 37
	'deleteAnnouncements': function (id) {                                                                                // 39
		Announcements.remove({                                                                                               // 40
			_id: id                                                                                                             // 40
		});                                                                                                                  // 40
	},                                                                                                                    // 41
	'markReadAnnouncement': function (id, userId) {                                                                       // 43
		Announcements.update({                                                                                               // 44
			_id: id                                                                                                             // 44
		}, {                                                                                                                 // 44
			$push: {                                                                                                            // 44
				"readBy": userId                                                                                                   // 44
			}                                                                                                                   // 44
		});                                                                                                                  // 44
	}                                                                                                                     // 45
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"assessment-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/assessment-methods.js                                                                         //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	/**                                                                                                                   // 3
 *	@method: 	assignNewAssessment                                                                                       //
 *	@summary: 	This method is used to assign a new assessment to a student.                                             //
 *	@requires: 	Currently logged in user is Admin, Moderator or Tutor for the student.                                  //
 *                                                                                                                     //
 */'assignNewAssessment': function (studentId, voucher) {                                                              //
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || voucher) {   // 10
			var role = Meteor.users.findOne({                                                                                   // 11
				_id: studentId                                                                                                     // 11
			}).roles[0];                                                                                                        // 11
			studentAssessments.insert({                                                                                         // 12
				userId: studentId,                                                                                                 // 13
				userRole: role,                                                                                                    // 14
				name: "Initial Assessment",                                                                                        // 15
				type: "initial-assessment",                                                                                        // 16
				startDate: null,                                                                                                   // 17
				completeDate: null,                                                                                                // 18
				score: null,                                                                                                       // 19
				assignedBy: Meteor.userId(),                                                                                       // 20
				pass: null,                                                                                                        // 21
				sections: [{                                                                                                       // 22
					name: "Reading",                                                                                                  // 24
					startDate: null,                                                                                                  // 25
					completeDate: null,                                                                                               // 26
					score: 0,                                                                                                         // 27
					answer: {                                                                                                         // 28
						A1r: [{                                                                                                          // 29
							name: "A1"                                                                                                      // 31
						}, {                                                                                                             // 30
							question: "When did the Italians begin to arrive in Scotland?",                                                 // 34
							answerNumber: "answer1",                                                                                        // 35
							answerValue: null                                                                                               // 36
						}, {                                                                                                             // 33
							question: "What work did most of them do?",                                                                     // 39
							answerNumber: "answer2",                                                                                        // 40
							answerValue: null                                                                                               // 41
						}, {                                                                                                             // 38
							question: "What did some do when they made money?",                                                             // 44
							answerNumber: "answer3",                                                                                        // 45
							answerValue: null                                                                                               // 46
						}, {                                                                                                             // 43
							question: "What did their child and grandchildren do?",                                                         // 49
							answerNumber: "answer4",                                                                                        // 50
							answerValue: null                                                                                               // 51
						}, {                                                                                                             // 48
							question: "Do all Scottish Italians still work in the food and drink business?",                                // 54
							answerNumber: "answer5",                                                                                        // 55
							answerValue: null                                                                                               // 56
						}],                                                                                                              // 53
						A2r: [{                                                                                                          // 59
							name: "A2"                                                                                                      // 61
						}, {                                                                                                             // 60
							question: "When did thousand of Polish soldiers and airmen come to Britain?",                                   // 64
							answerNumber: "answer1",                                                                                        // 65
							answerValue: null                                                                                               // 66
						}, {                                                                                                             // 63
							question: "Who controlled Poland after the war?",                                                               // 69
							answerNumber: "answer2",                                                                                        // 70
							answerValue: null                                                                                               // 71
						}, {                                                                                                             // 68
							question: "Who did most Polish soldiers and sailors in Britain marry?",                                         // 74
							answerNumber: "answer3",                                                                                        // 75
							answerValue: null                                                                                               // 76
						}, {                                                                                                             // 73
							question: "When did Poland become a member of the European Union?",                                             // 79
							answerNumber: "answer4",                                                                                        // 80
							answerValue: null                                                                                               // 81
						}, {                                                                                                             // 78
							question: "Why did thousands of young people come to Britain?",                                                 // 84
							answerNumber: "answer5",                                                                                        // 85
							answerValue: null                                                                                               // 86
						}, {                                                                                                             // 83
							question: "What work did many Poles do at first?",                                                              // 89
							answerNumber: "answer6",                                                                                        // 90
							answerValue: null                                                                                               // 91
						}, {                                                                                                             // 88
							question: "Where did they go on to work after this?",                                                           // 94
							answerNumber: "answer7",                                                                                        // 95
							answerValue: null                                                                                               // 96
						}, {                                                                                                             // 93
							question: "Have they all returned to Poland?",                                                                  // 99
							answerNumber: "answer8",                                                                                        // 100
							answerValue: null                                                                                               // 101
						}],                                                                                                              // 98
						B1r: [{                                                                                                          // 104
							name: "B1"                                                                                                      // 106
						}, {                                                                                                             // 105
							question: "Which job did the first Chinese in Britain do?",                                                     // 109
							answerNumber: "answer1",                                                                                        // 110
							answerValue: null                                                                                               // 111
						}, {                                                                                                             // 108
							question: "Which cities did they arrive in?",                                                                   // 114
							answerNumber: "answer2",                                                                                        // 115
							answerValue: null                                                                                               // 116
						}, {                                                                                                             // 113
							question: "When did this begin to happen?",                                                                     // 119
							answerNumber: "answer3",                                                                                        // 120
							answerValue: null                                                                                               // 121
						}, {                                                                                                             // 118
							question: "In which century did the first Chinese restaurants open in London?",                                 // 124
							answerNumber: "answer4",                                                                                        // 125
							answerValue: null                                                                                               // 126
						}, {                                                                                                             // 123
							question: "Are many new Chinese restaurants expected to open in the future?",                                   // 129
							answerNumber: "answer5",                                                                                        // 130
							answerValue: null                                                                                               // 131
						}, {                                                                                                             // 128
							question: "Do Chinese families usually live close to each other?",                                              // 134
							answerNumber: "answer6",                                                                                        // 135
							answerValue: null                                                                                               // 136
						}, {                                                                                                             // 133
							question: "What can you find in a Chinatown?",                                                                  // 139
							answerNumber: "answer7",                                                                                        // 140
							answerValue: null                                                                                               // 141
						}, {                                                                                                             // 138
							question: "Do Chinese people often marry people who are not Chinese?",                                          // 144
							answerNumber: "answer8",                                                                                        // 145
							answerValue: null                                                                                               // 146
						}, {                                                                                                             // 143
							question: "Do a lot of British Chinese work in the restaurant business today?",                                 // 149
							answerNumber: "answer9",                                                                                        // 150
							answerValue: null                                                                                               // 151
						}],                                                                                                              // 148
						B2r: [{                                                                                                          // 154
							name: "B2"                                                                                                      // 156
						}, {                                                                                                             // 155
							question: "Why do Scotland and Ireland have a great deal of common history?",                                   // 159
							answerNumber: "answer1",                                                                                        // 160
							"answerValue": null                                                                                             // 161
						}, {                                                                                                             // 158
							question: "When did the ‘Scots’ first arrive in Scotland?",                                                     // 164
							answerNumber: "answer2",                                                                                        // 165
							answerValue: null                                                                                               // 166
						}, {                                                                                                             // 163
							question: "Did the Highlands become Protestant in the 1560s?",                                                  // 169
							answerNumber: "answer3",                                                                                        // 170
							answerValue: null                                                                                               // 171
						}, {                                                                                                             // 168
							question: "Which word in paragraph 2 means ‘connections’?",                                                     // 174
							answerNumber: "answer4",                                                                                        // 175
							answerValue: null                                                                                               // 176
						}, {                                                                                                             // 173
							question: "What caused large scale Irish emigration in the 1840s?",                                             // 179
							answerNumber: "answer5",                                                                                        // 180
							answerValue: null                                                                                               // 181
						}, {                                                                                                             // 178
							question: "How many people emigrated?",                                                                         // 184
							answerNumber: "answer6",                                                                                        // 185
							answerValue: null                                                                                               // 186
						}, {                                                                                                             // 183
							question: "In which Scottish city did many Irish immigrants settle?",                                           // 189
							answerNumber: "answer7",                                                                                        // 190
							answerValue: null                                                                                               // 191
						}, {                                                                                                             // 188
							question: "What issue caused difficulty between the Irish Catholics and the native Scots?",                     // 194
							answerNumber: "answer8",                                                                                        // 195
							answerValue: null                                                                                               // 196
						}, {                                                                                                             // 193
							question: "Have relation between Protestants and Catholics improved since the 19th century?",                   // 199
							answerNumber: "answer9",                                                                                        // 200
							answerValue: null                                                                                               // 201
						}, {                                                                                                             // 198
							question: "Which word in paragraph 3 means ‘peacefulness’?",                                                    // 204
							answerNumber: "answer10",                                                                                       // 205
							answerValue: null                                                                                               // 206
						}],                                                                                                              // 203
						C1r: [{                                                                                                          // 209
							name: "C1"                                                                                                      // 211
						}, {                                                                                                             // 210
							question: "What happened to some British sailors on the way to India?",                                         // 214
							answerNumber: "answer1",                                                                                        // 215
							answerValue: null                                                                                               // 216
						}, {                                                                                                             // 213
							question: "What were Indian politicians preparing for before 1947?",                                            // 219
							answerNumber: "answer2",                                                                                        // 220
							answerValue: null                                                                                               // 221
						}, {                                                                                                             // 218
							question: "Did all members of the Indian army return home after the wars?",                                     // 224
							answerNumber: "answer3",                                                                                        // 225
							answerValue: null                                                                                               // 226
						}, {                                                                                                             // 223
							question: "Which exams could Indians only sit in London?",                                                      // 229
							answerNumber: "answer4",                                                                                        // 230
							answerValue: null                                                                                               // 231
						}, {                                                                                                             // 228
							question: "Which of these summarises the main reasons for South Asian settlement in Britain in the 19th and early 20th century?",
							answerNumber: "answer5",                                                                                        // 235
							answerValue: null                                                                                               // 236
						}, {                                                                                                             // 233
							question: "When was Pakistan established as a country?",                                                        // 239
							answerNumber: "answer6",                                                                                        // 240
							answerValue: null                                                                                               // 241
						}, {                                                                                                             // 238
							question: "Which two of these groups of South Asians came to work in Scotland?",                                // 244
							answerNumber: "answer7",                                                                                        // 245
							answerValue: null                                                                                               // 246
						}, {                                                                                                             // 243
							question: "Is the whole of the Punjab in modern India?",                                                        // 249
							answerNumber: "answer8",                                                                                        // 250
							answerValue: null                                                                                               // 251
						}, {                                                                                                             // 248
							question: "Did the immigration laws stop family members coming to Britain?",                                    // 254
							answerNumber: "answer9",                                                                                        // 255
							answerValue: null                                                                                               // 256
						}, {                                                                                                             // 253
							question: "What word shows that Ugandan Asians did not come to Britain by choice?",                             // 259
							answerNumber: "answer10",                                                                                       // 260
							answerValue: null                                                                                               // 261
						}]                                                                                                               // 258
					},                                                                                                                // 28
					pass: null                                                                                                        // 265
				}, {                                                                                                               // 23
					name: "Writing",                                                                                                  // 268
					startDate: null,                                                                                                  // 269
					completeDate: null,                                                                                               // 270
					wordLimit: 150,                                                                                                   // 271
					score: null,                                                                                                      // 272
					answer: null,                                                                                                     // 273
					pass: null                                                                                                        // 274
				}, {                                                                                                               // 267
					name: "Listening",                                                                                                // 277
					startDate: null,                                                                                                  // 278
					completeDate: null,                                                                                               // 279
					score: null,                                                                                                      // 280
					playsAllowed: 2,                                                                                                  // 281
					answer: {                                                                                                         // 282
						A2l: [{                                                                                                          // 283
							name: "A2"                                                                                                      // 285
						}, {                                                                                                             // 284
							question: "Mark lives in a busy road.",                                                                         // 288
							answerNumber: "answer1",                                                                                        // 289
							answerValue: null                                                                                               // 290
						}, {                                                                                                             // 287
							question: "Mark doesn't like his house.",                                                                       // 293
							answerNumber: "answer2",                                                                                        // 294
							answerValue: null                                                                                               // 295
						}, {                                                                                                             // 292
							question: "John lives in a house",                                                                              // 298
							answerNumber: "answer3",                                                                                        // 299
							answerValue: null                                                                                               // 300
						}, {                                                                                                             // 297
							question: "John lives near a school",                                                                           // 303
							answerNumber: "answer4",                                                                                        // 304
							answerValue: null                                                                                               // 305
						}, {                                                                                                             // 302
							question: "There's a post office near Mark's house.",                                                           // 308
							answerNumber: "answer5",                                                                                        // 309
							answerValue: null                                                                                               // 310
						}, {                                                                                                             // 307
							question: "Mark lives near a park.",                                                                            // 313
							answerNumber: "answer6",                                                                                        // 314
							answerValue: null                                                                                               // 315
						}],                                                                                                              // 312
						B1l: [{                                                                                                          // 318
							name: "B1"                                                                                                      // 320
						}, {                                                                                                             // 319
							question: "What does Kasia tell Claire?",                                                                       // 323
							answerNumber: "answer1",                                                                                        // 324
							answerValue: null                                                                                               // 325
						}, {                                                                                                             // 322
							question: "Kasia feels",                                                                                        // 328
							answerNumber: "answer2",                                                                                        // 329
							answerValue: null                                                                                               // 330
						}, {                                                                                                             // 327
							question: "When did Farhana's grandfather come to Scotland?",                                                   // 333
							answerNumber: "answer3",                                                                                        // 334
							answerValue: null                                                                                               // 335
						}, {                                                                                                             // 332
							question: "Why did Farhana's mother come to Scotland?",                                                         // 338
							answerNumber: "answer4",                                                                                        // 339
							answerValue: null                                                                                               // 340
						}, {                                                                                                             // 337
							question: "What three things does Murdo tell Claire?",                                                          // 343
							answerNumber: "answer5",                                                                                        // 344
							answerValue: null                                                                                               // 345
						}, {                                                                                                             // 342
							question: "What does Murdo not understand?",                                                                    // 348
							answerNumber: "answer6",                                                                                        // 349
							answerValue: null                                                                                               // 350
						}, {                                                                                                             // 347
							question: "How do Kasia, Fahrana and Murdo feel about living in Scotland?",                                     // 353
							answerNumber: "answer7",                                                                                        // 354
							answerValue: null                                                                                               // 355
						}],                                                                                                              // 352
						B2l: [{                                                                                                          // 358
							name: "B2"                                                                                                      // 360
						}, {                                                                                                             // 359
							question: "When are they planning to go ?",                                                                     // 363
							answerNumber: "answer1",                                                                                        // 364
							"answerValue": null                                                                                             // 365
						}, {                                                                                                             // 362
							question: "What does Ash wat to see?",                                                                          // 368
							answerNumber: "answer2",                                                                                        // 369
							answerValue: null                                                                                               // 370
						}, {                                                                                                             // 367
							question: "Does Sal agree?",                                                                                    // 373
							answerNumber: "answer3",                                                                                        // 374
							answerValue: null                                                                                               // 375
						}, {                                                                                                             // 372
							question: "Why doesn't Sal want to see the same movie as Ash?",                                                 // 378
							answerNumber: "answer4",                                                                                        // 379
							answerValue: null                                                                                               // 380
						}, {                                                                                                             // 377
							question: "What does she want to see?",                                                                         // 383
							answerNumber: "answer5",                                                                                        // 384
							answerValue: null                                                                                               // 385
						}, {                                                                                                             // 382
							question: "Why doesn't Ash want to see it?",                                                                    // 388
							answerNumber: "answer6",                                                                                        // 389
							answerValue: null                                                                                               // 390
						}],                                                                                                              // 387
						C1l: [{                                                                                                          // 393
							name: "C1"                                                                                                      // 395
						}, {                                                                                                             // 394
							question: "The aviation industry is more positive about the future of space tourism than the space industry. True or False?",
							answerNumber: "answer1",                                                                                        // 399
							answerValue: null                                                                                               // 400
						}, {                                                                                                             // 397
							question: "Space hotels circle the earth every one and half hours. True or False",                              // 403
							answerNumber: "answer2",                                                                                        // 404
							answerValue: null                                                                                               // 405
						}, {                                                                                                             // 402
							question: "The main topic in this recording is...",                                                             // 408
							answerNumber: "answer3",                                                                                        // 409
							answerValue: null                                                                                               // 410
						}, {                                                                                                             // 407
							question: "Where has this recording come from?",                                                                // 413
							answerNumber: "answer4",                                                                                        // 414
							answerValue: null                                                                                               // 415
						}, {                                                                                                             // 412
							question: "The man's attitude to space tourism is:",                                                            // 418
							answerNumber: "answer5",                                                                                        // 419
							answerValue: null                                                                                               // 420
						}, {                                                                                                             // 417
							question: "The woman's attitude to space tourism is:",                                                          // 423
							answerNumber: "answer6",                                                                                        // 424
							answerValue: null                                                                                               // 425
						}]                                                                                                               // 422
					},                                                                                                                // 282
					pass: null                                                                                                        // 429
				}, {                                                                                                               // 276
					name: "Speaking",                                                                                                 // 432
					startDate: null,                                                                                                  // 433
					completeDate: null,                                                                                               // 434
					score: null,                                                                                                      // 435
					answer: [],                                                                                                       // 436
					pass: null                                                                                                        // 437
				}]                                                                                                                 // 431
			}, function (error, result) {                                                                                       // 12
				if (!error) {                                                                                                      // 441
					userProgress.update({                                                                                             // 442
						userId: studentId                                                                                                // 442
					}, {                                                                                                              // 442
						$addToSet: {                                                                                                     // 444
							assessments: result                                                                                             // 445
						}                                                                                                                // 444
					});                                                                                                               // 443
				}                                                                                                                  // 448
			});                                                                                                                 // 449
		}                                                                                                                    // 450
	},                                                                                                                    // 451
	/**                                                                                                                   // 453
 *	@method: 	assignNewExitTest                                                                                         //
 *	@summary: 	This method is used to assign a new exit test to a student.                                              //
 *	@requires: 	Currently logged in user is Admin, Moderator or Tutor for the student.                                  //
 *                                                                                                                     //
 */'assignNewExitTest': function (studentId, voucher) {                                                                //
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || voucher) {   // 460
			var role = Meteor.users.findOne({                                                                                   // 461
				_id: studentId                                                                                                     // 461
			}).roles[0];                                                                                                        // 461
			studentAssessments.insert({                                                                                         // 462
				userId: studentId,                                                                                                 // 463
				userRole: role,                                                                                                    // 464
				name: "Exit Test",                                                                                                 // 465
				type: "exit-test",                                                                                                 // 466
				startDate: null,                                                                                                   // 467
				completeDate: null,                                                                                                // 468
				score: null,                                                                                                       // 469
				assignedBy: Meteor.userId(),                                                                                       // 470
				pass: null,                                                                                                        // 471
				sections: [{                                                                                                       // 472
					name: "Reading",                                                                                                  // 474
					startDate: null,                                                                                                  // 475
					completeDate: null,                                                                                               // 476
					score: 0,                                                                                                         // 477
					answer: {                                                                                                         // 478
						A1r: [{                                                                                                          // 479
							name: "A1"                                                                                                      // 481
						}, {                                                                                                             // 480
							question: "Who is the postcard from?",                                                                          // 484
							answerNumber: "answer1",                                                                                        // 485
							answerValue: null                                                                                               // 486
						}, {                                                                                                             // 483
							question: "Why are they in Florida?",                                                                           // 489
							answerNumber: "answer2",                                                                                        // 490
							answerValue: null                                                                                               // 491
						}, {                                                                                                             // 488
							question: "The hotel is quiet.",                                                                                // 494
							answerNumber: "answer3",                                                                                        // 495
							answerValue: null                                                                                               // 496
						}, {                                                                                                             // 493
							question: "The food is good.",                                                                                  // 499
							answerNumber: "answer4",                                                                                        // 500
							answerValue: null                                                                                               // 501
						}, {                                                                                                             // 498
							question: "Shopping is cheap",                                                                                  // 504
							answerNumber: "answer5",                                                                                        // 505
							answerValue: null                                                                                               // 506
						}, {                                                                                                             // 503
							question: "The guests like the hotel",                                                                          // 509
							answerNumber: "answer6",                                                                                        // 510
							answerValue: null                                                                                               // 511
						}, {                                                                                                             // 508
							question: "The weather is",                                                                                     // 514
							answerNumber: "answer7",                                                                                        // 515
							answerValue: null                                                                                               // 516
						}, {                                                                                                             // 513
							question: "The buildings are",                                                                                  // 519
							answerNumber: "answer8",                                                                                        // 520
							answerValue: null                                                                                               // 521
						}]                                                                                                               // 518
					},                                                                                                                // 478
					pass: null                                                                                                        // 525
				}, {                                                                                                               // 473
					name: "Writing",                                                                                                  // 528
					startDate: null,                                                                                                  // 529
					completeDate: null,                                                                                               // 530
					wordLimit: 150,                                                                                                   // 531
					score: null,                                                                                                      // 532
					answer: null,                                                                                                     // 533
					pass: null                                                                                                        // 534
				}, {                                                                                                               // 527
					name: "Listening",                                                                                                // 537
					startDate: null,                                                                                                  // 538
					completeDate: null,                                                                                               // 539
					score: null,                                                                                                      // 540
					playsAllowed: 2,                                                                                                  // 541
					answer: {                                                                                                         // 542
						A1l: [{                                                                                                          // 543
							name: "A1"                                                                                                      // 545
						}, {                                                                                                             // 544
							question: "The bedroom is big.",                                                                                // 548
							answerNumber: "answer1",                                                                                        // 549
							answerValue: null                                                                                               // 550
						}, {                                                                                                             // 547
							question: "The window is big.",                                                                                 // 553
							answerNumber: "answer2",                                                                                        // 554
							answerValue: null                                                                                               // 555
						}, {                                                                                                             // 552
							question: "There are two desks.",                                                                               // 558
							answerNumber: "answer3",                                                                                        // 559
							answerValue: null                                                                                               // 560
						}, {                                                                                                             // 557
							question: "There is a chair.",                                                                                  // 563
							answerNumber: "answer4",                                                                                        // 564
							answerValue: null                                                                                               // 565
						}, {                                                                                                             // 562
							question: "I have a big TV.",                                                                                   // 568
							answerNumber: "answer5",                                                                                        // 569
							answerValue: null                                                                                               // 570
						}, {                                                                                                             // 567
							question: "I have lots of clothes.",                                                                            // 573
							answerNumber: "answer6",                                                                                        // 574
							answerValue: null                                                                                               // 575
						}]                                                                                                               // 572
					},                                                                                                                // 542
					pass: null                                                                                                        // 579
				}, {                                                                                                               // 536
					name: "Speaking",                                                                                                 // 582
					startDate: null,                                                                                                  // 583
					completeDate: null,                                                                                               // 584
					score: null,                                                                                                      // 585
					answer: [],                                                                                                       // 586
					pass: null                                                                                                        // 587
				}]                                                                                                                 // 581
			}, function (error, result) {                                                                                       // 462
				if (!error) {                                                                                                      // 591
					userProgress.update({                                                                                             // 592
						userId: studentId                                                                                                // 592
					}, {                                                                                                              // 592
						$addToSet: {                                                                                                     // 594
							assessments: result                                                                                             // 595
						}                                                                                                                // 594
					});                                                                                                               // 593
				}                                                                                                                  // 598
			});                                                                                                                 // 599
		}                                                                                                                    // 600
	},                                                                                                                    // 601
	'changeAssessmentSectionMark': function (assessmentId, sectionNo, newMark) {                                          // 603
		obj = {};                                                                                                            // 604
		obj["sections." + sectionNo + ".pass"] = newMark;                                                                    // 605
		studentAssessments.update({                                                                                          // 606
			_id: assessmentId                                                                                                   // 606
		}, {                                                                                                                 // 606
			$set: obj                                                                                                           // 606
		});                                                                                                                  // 606
	},                                                                                                                    // 607
	'changeAssessmentOverallMark': function (assessmentId, newMark) {                                                     // 609
		var assessmentDoc = studentAssessments.findOne({                                                                     // 610
			_id: assessmentId                                                                                                   // 610
		});                                                                                                                  // 610
		var userId = assessmentDoc.userId;                                                                                   // 611
		obj = {};                                                                                                            // 612
		obj["pass"] = newMark;                                                                                               // 613
		studentAssessments.update({                                                                                          // 614
			_id: assessmentId                                                                                                   // 614
		}, {                                                                                                                 // 614
			$set: obj                                                                                                           // 614
		});                                                                                                                  // 614
                                                                                                                       //
		if (newMark == true) {                                                                                               // 615
			Meteor.users.update({                                                                                               // 616
				_id: userId                                                                                                        // 616
			}, {                                                                                                                // 616
				$set: {                                                                                                            // 616
					'authorisedCourses.journey2English': true                                                                         // 616
				}                                                                                                                  // 616
			});                                                                                                                 // 616
		} else if (newMark == false) {                                                                                       // 617
			Meteor.users.update({                                                                                               // 618
				_id: userId                                                                                                        // 618
			}, {                                                                                                                // 618
				$set: {                                                                                                            // 618
					'authorisedCourses.journey2English': false                                                                        // 618
				}                                                                                                                  // 618
			});                                                                                                                 // 618
		}                                                                                                                    // 619
	},                                                                                                                    // 620
	/**                                                                                                                   // 622
 *	@method: 	setAssessmentStart                                                                                        //
 *	@summary: 	This method is used to set a section (and assessment) to started by                                      //
 *				setting the startDate to the current date.                                                                       //
 *	@requires: 	Admin or Student who owns this assessment.                                                              //
 *                                                                                                                     //
 */'setAssessmentStart': function (assessmentId, sectionName) {                                                        //
		var assessment = studentAssessments.findOne({                                                                        // 630
			_id: assessmentId                                                                                                   // 630
		});                                                                                                                  // 630
                                                                                                                       //
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || assessment.userId == Meteor.userId()) {                          // 631
			if (assessment.startDate == null) {                                                                                 // 632
				studentAssessments.update({                                                                                        // 633
					_id: assessmentId                                                                                                 // 633
				}, {                                                                                                               // 633
					$set: {                                                                                                           // 633
						startDate: new Date()                                                                                            // 633
					}                                                                                                                 // 633
				});                                                                                                                // 633
			}                                                                                                                   // 634
                                                                                                                       //
			for (var i = 0; i < assessment.sections.length; i++) {                                                              // 635
				if (assessment.sections[i].name == sectionName) {                                                                  // 636
					if (assessment.sections[i].startDate == null) {                                                                   // 637
						studentAssessments.update({                                                                                      // 638
							_id: assessmentId,                                                                                              // 638
							"sections.name": sectionName                                                                                    // 638
						}, {                                                                                                             // 638
							$set: {                                                                                                         // 640
								"sections.$.startDate": new Date()                                                                             // 641
							}                                                                                                               // 640
						});                                                                                                              // 639
					}                                                                                                                 // 644
				}                                                                                                                  // 645
			}                                                                                                                   // 646
		} else {                                                                                                             // 647
			throw new Meteor.Error("Unauthorised attempt to edit studentAssessment doc.");                                      // 648
		}                                                                                                                    // 649
	},                                                                                                                    // 650
	/**                                                                                                                   // 652
 *	@method: 	setScoredSectionComplete                                                                                  //
 *	@summary: 	This method is used to set a section (and assessment) as completed by                                    //
 *				setting the dateComplete to the current date. In a Scored Section the answers                                    //
 *				should be auto-checked by the system, and a score automatically returned.                                        //
 *                                                                                                                     //
 *	@requires: Admin or Student who owns this assessment.                                                               //
 *                                                                                                                     //
 */'setScoredSectionComplete': function (assessmentId, sectionName, userAnswers, currentScore) {                       //
		var assessment = studentAssessments.findOne({                                                                        // 662
			_id: assessmentId                                                                                                   // 662
		});                                                                                                                  // 662
                                                                                                                       //
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || assessment.userId == Meteor.userId()) {                          // 663
			for (var i = 0; i < assessment.sections.length; i++) {                                                              // 664
				var section = getSection(sectionName);                                                                             // 665
                                                                                                                       //
				if (assessment.sections[i].name == section) {                                                                      // 666
					if (assessment.sections[i].startDate != null && assessment.sections[i].completeDate == null && assessment.completeDate == null) {
						var score = checkAnswers(assessment.type, sectionName, userAnswers);                                             // 668
						var finalscore = finalScore(score, sectionName) ? score + currentScore : 0;                                      // 669
						updateAnswers(assessmentId, userAnswers, sectionName, section, finalScore(score, sectionName), finalscore);      // 670
						return score;                                                                                                    // 671
					}                                                                                                                 // 673
                                                                                                                       //
					return score ? score : null;                                                                                      // 674
				}                                                                                                                  // 675
			}                                                                                                                   // 676
		} else {                                                                                                             // 677
			throw new Meteor.Error("Unauthorised attempt to edit studentAssessment doc.");                                      // 678
		}                                                                                                                    // 679
	},                                                                                                                    // 680
	/**                                                                                                                   // 682
 *	@method: 	setTextSectionComplete                                                                                    //
 *	@summary: 	This method is used to set a section (and assessment) as completed by                                    //
 *				setting the dateComplete to the current date. A Text section is one in which                                     //
 *				the user submits a body of text which must be manually checked by a tutor.                                       //
 *                                                                                                                     //
 *	@requires: Admin or Student who owns this assessment.                                                               //
 *                                                                                                                     //
 */'setTextSectionComplete': function (assessmentId, sectionName, userAnswers) {                                       //
		var assessment = studentAssessments.findOne({                                                                        // 692
			_id: assessmentId                                                                                                   // 692
		});                                                                                                                  // 692
                                                                                                                       //
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || assessment.userId == Meteor.userId()) {                          // 693
			for (var i = 0; i < assessment.sections.length; i++) {                                                              // 694
				if (assessment.sections[i].name == sectionName) {                                                                  // 695
					var wordCount = wordCountParser(userAnswers[0].answerValue);                                                      // 696
                                                                                                                       //
					if (wordCount.words > assessment.sections[i].wordLimit) {                                                         // 697
						throw new Meteor.Error("Word Count Exceeded. Please ensure your submission is " + assessment.sections[i].wordLimit + " words or less.");
					}                                                                                                                 // 699
                                                                                                                       //
					if (assessment.sections[i].startDate != null && assessment.sections[i].completeDate == null && assessment.completeDate == null) {
						var doc = studentAssessments.update({                                                                            // 701
							_id: assessmentId,                                                                                              // 701
							"sections.name": sectionName                                                                                    // 701
						}, {                                                                                                             // 701
							$set: {                                                                                                         // 703
								"sections.$.completeDate": new Date(),                                                                         // 704
								"sections.$.answer": userAnswers                                                                               // 705
							}                                                                                                               // 703
						});                                                                                                              // 702
						var doc = studentAssessments.findOne({                                                                           // 708
							_id: assessmentId                                                                                               // 708
						});                                                                                                              // 708
                                                                                                                       //
						if (checkAllSectionsFinished(doc)) {                                                                             // 709
							studentAssessments.update({                                                                                     // 710
								_id: assessmentId                                                                                              // 710
							}, {                                                                                                            // 710
								$set: {                                                                                                        // 712
									"completeDate": new Date()                                                                                    // 713
								}                                                                                                              // 712
							});                                                                                                             // 711
						}                                                                                                                // 716
					} else {                                                                                                          // 717
						throw new Meteor.Error("Error: This section has already been completed.");                                       // 718
					}                                                                                                                 // 719
                                                                                                                       //
					return;                                                                                                           // 720
				}                                                                                                                  // 721
			}                                                                                                                   // 722
		} else {                                                                                                             // 723
			throw new Meteor.Error("Unauthorised attempt to edit studentAssessment doc.");                                      // 724
		}                                                                                                                    // 725
	},                                                                                                                    // 726
	/**                                                                                                                   // 728
 *	@method: 	setSectionComplete                                                                                        //
 *	@summary: 	This method is used to set a section (and assessment) as completed by                                    //
 *				setting the dateComplete to the current date. It does not set a score.                                           //
 *                                                                                                                     //
 *	@requires: Admin or Student who owns this assessment.                                                               //
 *                                                                                                                     //
 */'setSectionComplete': function (user, assessmentId, sectionName) {                                                  //
		// Check the assessment section has started. If it has, set it to completed.                                         // 737
		var assessment = studentAssessments.findOne({                                                                        // 738
			_id: assessmentId,                                                                                                  // 738
			userId: user                                                                                                        // 738
		});                                                                                                                  // 738
                                                                                                                       //
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || assessment.userId == Meteor.userId()) {                          // 739
			for (var i = 0; i < assessment.sections.length; i++) {                                                              // 740
				if (assessment.sections[i].name == sectionName) {                                                                  // 741
					if (assessment.sections[i].startDate != null && assessment.sections[i].completeDate == null && assessment.completeDate == null) {
						studentAssessments.update({                                                                                      // 743
							_id: assessmentId,                                                                                              // 743
							"sections.name": sectionName                                                                                    // 743
						}, {                                                                                                             // 743
							$set: {                                                                                                         // 745
								"sections.$.completeDate": new Date()                                                                          // 745
							}                                                                                                               // 745
						});                                                                                                              // 744
					} else {                                                                                                          // 747
						throw new Meteor.Error("Error: This section has already been completed.");                                       // 748
					}                                                                                                                 // 749
                                                                                                                       //
					var doc = studentAssessments.findOne({                                                                            // 750
						_id: assessmentId                                                                                                // 750
					});                                                                                                               // 750
                                                                                                                       //
					if (checkAllSectionsFinished(doc)) {                                                                              // 751
						studentAssessments.update({                                                                                      // 752
							_id: assessmentId                                                                                               // 752
						}, {                                                                                                             // 752
							$set: {                                                                                                         // 754
								"completeDate": new Date()                                                                                     // 755
							}                                                                                                               // 754
						});                                                                                                              // 753
					}                                                                                                                 // 758
				}                                                                                                                  // 759
			}                                                                                                                   // 760
		} else {                                                                                                             // 761
			throw new Meteor.Error("Unauthorised attempt to edit studentAssessment doc.");                                      // 762
		}                                                                                                                    // 763
	},                                                                                                                    // 764
	'markAssessmentSection': function (assessmentId, sectionName, result) {                                               // 766
		var validResults = ["Not Attempted", "Not Marked", "Not Achieved", "A1", "A2", "B1", "B2", "C1", "C1+"];             // 767
                                                                                                                       //
		if (validResults.indexOf(result) >= 0) {                                                                             // 771
			studentAssessments.update({                                                                                         // 772
				_id: assessmentId,                                                                                                 // 772
				"sections.name": sectionName                                                                                       // 772
			}, {                                                                                                                // 772
				$set: {                                                                                                            // 772
					"sections.$.pass": result                                                                                         // 772
				}                                                                                                                  // 772
			});                                                                                                                 // 772
		} else {                                                                                                             // 773
			throw new Meteor.Error("Error: Invalid mark for Initial Assessment");                                               // 774
		} /*                                                                                                                 // 775
    		if (result == "Not Attempted") {                                                                                 //
    			studentAssessments.update({ _id: assessmentId, "sections.name": sectionName },                                  //
    				{                                                                                                              //
    					$set: { "sections.$.pass": "Not Attempted" }                                                                  //
    				})                                                                                                             //
    		} else if (result == "A1") {                                                                                     //
    			studentAssessments.update({ _id: assessmentId, "sections.name": sectionName },                                  //
    				{                                                                                                              //
    					$set: { "sections.$.pass": "A1" }                                                                             //
    				})                                                                                                             //
    		} else if (result == "A2") {                                                                                     //
    			studentAssessments.update({ _id: assessmentId, "sections.name": sectionName },                                  //
    				{                                                                                                              //
    					$set: { "sections.$.pass": "A2" }                                                                             //
    				})                                                                                                             //
    		} else if (result == "B1") {                                                                                     //
    			studentAssessments.update({ _id: assessmentId, "sections.name": sectionName },                                  //
    				{                                                                                                              //
    					$set: { "sections.$.pass": "B1" }                                                                             //
    				})                                                                                                             //
    		} else if (result == "B2") {                                                                                     //
    			studentAssessments.update({ _id: assessmentId, "sections.name": sectionName },                                  //
    				{                                                                                                              //
    					$set: { "sections.$.pass": "B2" }                                                                             //
    				})                                                                                                             //
    		} else if (result == "C1") {                                                                                     //
    			studentAssessments.update({ _id: assessmentId, "sections.name": sectionName },                                  //
    				{                                                                                                              //
    					$set: { "sections.$.pass": "C1" }                                                                             //
    				})                                                                                                             //
    		} else if (result == "Not Marked") {                                                                             //
    			studentAssessments.update({ _id: assessmentId, "sections.name": sectionName },                                  //
    				{                                                                                                              //
    					$set: { "sections.$.pass": "Not Marked" }                                                                     //
    				})                                                                                                             //
    		} else if (result == "C1+") {                                                                                    //
    			studentAssessments.update({ _id: assessmentId, "sections.name": sectionName },                                  //
    				{                                                                                                              //
    					$set: { "sections.$.pass": "C1+" }                                                                            //
    				})                                                                                                             //
    		} else {                                                                                                         //
    			throw new Meteor.Error("Error: Invalid mark for Initial Assessment");                                           //
    		}                                                                                                                //
    		*/                                                                                                               //
	},                                                                                                                    // 821
	'markAssessment': function (assessmentId, result) {                                                                   // 823
		// Need to restrict this to authorised users (admins & appropriate tutors, mods)                                     // 824
		var assessmentDoc = studentAssessments.findOne({                                                                     // 825
			_id: assessmentId                                                                                                   // 825
		});                                                                                                                  // 825
		var validResults = ["Not Attempted", "Not Achieved", "A1", "A2", "B1", "B2", "C1", "C1+"];                           // 826
                                                                                                                       //
		if (validResults.indexOf(result) >= 0) {                                                                             // 830
			studentAssessments.update({                                                                                         // 831
				_id: assessmentId                                                                                                  // 831
			}, {                                                                                                                // 831
				$set: {                                                                                                            // 831
					"pass": result                                                                                                    // 831
				}                                                                                                                  // 831
			});                                                                                                                 // 831
		} else {                                                                                                             // 832
			throw new Meteor.Error("Error: Invalid mark for Initial Assessment");                                               // 833
		} /*                                                                                                                 // 834
    if (result == "Not Attempted") {                                                                                   //
    	studentAssessments.update({ _id: assessmentId },                                                                  //
    		{                                                                                                                //
    			$set: { "pass": "Not Attempted" }                                                                               //
    		})                                                                                                               //
    } else if (result == "Not Achieved") {                                                                             //
    	studentAssessments.update({ _id: assessmentId },                                                                  //
    		{                                                                                                                //
    			$set: { "pass": "Not Achieved" }                                                                                //
    		})                                                                                                               //
    } else if (result == "A1") {                                                                                       //
    	studentAssessments.update({ _id: assessmentId },                                                                  //
    		{                                                                                                                //
    			$set: { "pass": "A1" }                                                                                          //
    		})                                                                                                               //
    } else if (result == "A2") {                                                                                       //
    	studentAssessments.update({ _id: assessmentId },                                                                  //
    		{                                                                                                                //
    			$set: { "pass": "A2" }                                                                                          //
    		})                                                                                                               //
    } else if (result == "B1") {                                                                                       //
    	studentAssessments.update({ _id: assessmentId },                                                                  //
    		{                                                                                                                //
    			$set: { "pass": "B1" }                                                                                          //
    		})                                                                                                               //
    } else if (result == "B2") {                                                                                       //
    	studentAssessments.update({ _id: assessmentId },                                                                  //
    		{                                                                                                                //
    			$set: { "pass": "B2" }                                                                                          //
    		})                                                                                                               //
    } else if (result == "C1") {                                                                                       //
    	studentAssessments.update({ _id: assessmentId },                                                                  //
    		{                                                                                                                //
    			$set: { "pass": "C1" }                                                                                          //
    		})                                                                                                               //
    } else if (result == "C1+") {                                                                                      //
    	studentAssessments.update({ _id: assessmentId },                                                                  //
    		{                                                                                                                //
    			$set: { "pass": "C1+" }                                                                                         //
    		})                                                                                                               //
    }*/                                                                                                                //
	},                                                                                                                    // 879
	'sendPassedAssessmentEmail': function (userId, tutorId) {                                                             // 881
		// Send the email                                                                                                    // 882
		var userDoc = Meteor.users.findOne({                                                                                 // 883
			_id: userId                                                                                                         // 883
		});                                                                                                                  // 883
                                                                                                                       //
		if (userDoc.emails && userDoc.emails[0].address) {                                                                   // 884
			var userEmail = userDoc.emails[0].address;                                                                          // 885
			var emailSubject = "Your English Skills Test has been marked";                                                      // 886
			var emailContent = '<table cellpadding="0" cellspacing="0" border="0" style="background-color: #edf4ff; border-width: 0; max-width: 640px; margin-left: auto; margin-right: auto;"><tr><td style="margin: 0; padding: 0;"><img src="http://www.klik2learn.com/wp-content/uploads/2016/07/email_jte_logo.jpg" style="max-width: 100%;" alt="Journey to English"></td></tr><tr><td style="margin: 0; padding: 1em;"><h1 style="color: #42b677; text-align: center; font-family: sans-serif;">Your English Skills Test has been marked</h1><p style="font-family: sans-serif;">To find out your results go to your account and select "Assessments"</p><p style="text-align: center;"><img src="http://www.klik2learn.com/wp-content/uploads/2018/04/account-assessment.png" alt="Account &gt; Assessments"></p><p style="font-family: sans-serif;">You can now continue with the Journey 2 English course. There is roughly 40 hours of learning, after which you may be invited to take the English Skills Test again to see how you have improved.</p><p style="font-family: sans-serif; text-align: center;">Good luck with your studies.</p><p style=text-align:center> Work hard and you will receive a certificate after completing 80% of the course. </p><p style="font-family: sans-serif; text-align: center;">The Journey 2 English team</p><p style="text-align: center;"><a href="http://www.klik2learn.com"><img src="http://www.klik2learn.com/wp-content/uploads/2016/10/header-logo.png" width="100" height="100" alt="Klik2learn"></a></p></td></tr></table>';
			Email.send({                                                                                                        // 888
				to: userEmail,                                                                                                     // 889
				from: "Journey 2 English",                                                                                         // 890
				subject: emailSubject,                                                                                             // 891
				html: emailContent                                                                                                 // 892
			});                                                                                                                 // 888
		}                                                                                                                    // 894
	},                                                                                                                    // 895
	'sendFailAssessmentEmail': function (userId, tutorId) {                                                               // 897
		// Send the email                                                                                                    // 898
		var userDoc = Meteor.users.findOne({                                                                                 // 899
			_id: userId                                                                                                         // 899
		});                                                                                                                  // 899
                                                                                                                       //
		if (userDoc.emails && userDoc.emails[0].address) {                                                                   // 900
			var userEmail = userDoc.emails[0].address;                                                                          // 901
			var emailSubject = "Your English Skills Test has been marked";                                                      // 902
			var emailContent = '<table cellpadding="0" cellspacing="0" border="0" style="background-color: #edf4ff; border-width: 0; max-width: 640px; margin-left: auto; margin-right: auto;"><tr><td style="margin: 0; padding: 0;"><img src="http://www.klik2learn.com/wp-content/uploads/2016/07/email_jte_logo.jpg" style="max-width: 100%;" alt="Journey to English"></td></tr><tr><td style="margin: 0; padding: 1em;"><h1 style="color: #42b677; text-align: center; font-family: sans-serif;">Your English Skills Test has been marked</h1><p style="font-family: sans-serif;">To find out your results go to your account and select "Assessments"</p><p style="text-align: center;"><img src="http://www.klik2learn.com/wp-content/uploads/2018/04/account-assessment.png" alt="Account &gt; Assessments"></p><p style="font-family: sans-serif;">You can now continue with the Journey 2 English course. There is roughly 40 hours of learning, after which you may be invited to take the English Skills Test again to see how you have improved.</p><p style="font-family: sans-serif; text-align: center;">Good luck with your studies.</p><p style=text-align:center> Work hard and you will receive a certificate after completing 80% of the course.</p><p style="font-family: sans-serif; text-align: center;">The Journey 2 English team</p><p style="text-align: center;"><a href="http://www.klik2learn.com"><img src="http://www.klik2learn.com/wp-content/uploads/2016/10/header-logo.png" width="100" height="100" alt="Klik2learn"></a></p></td></tr></table>';
			Email.send({                                                                                                        // 904
				to: userEmail,                                                                                                     // 905
				from: "Journey 2 English",                                                                                         // 906
				subject: emailSubject,                                                                                             // 907
				html: emailContent                                                                                                 // 908
			});                                                                                                                 // 904
		}                                                                                                                    // 910
	},                                                                                                                    // 911
	/**                                                                                                                   // 913
 *	@method: 	handleAssessmentDisconnect                                                                                //
 *	@summary: 	This method is used to set a section (and assessment) as completed by                                    //
 *				setting the dateComplete to the current date. It is called when the user disconnects                             //
 *				when completed an assessment.                                                                                    //
 *                                                                                                                     //
 *	@requires: Admin or Student who owns this assessment.                                                               //
 *                                                                                                                     //
 */'handleAssessmentDisconnect': function (user, assessmentId, sectionName) {                                          //
		// Check the assessment section has started. If it has, set it to completed.                                         // 923
		var doc = studentAssessments.findOne({                                                                               // 924
			_id: assessmentId                                                                                                   // 924
		});                                                                                                                  // 924
                                                                                                                       //
		for (var i = 0; i < doc.sections.length; i++) {                                                                      // 925
			if (doc.sections[i].name == sectionName) {                                                                          // 926
				if (doc.sections[i].startDate != null && doc.sections[i].completeDate == null) {                                   // 927
					studentAssessments.update({                                                                                       // 928
						_id: assessmentId,                                                                                               // 928
						"sections.name": sectionName                                                                                     // 928
					}, {                                                                                                              // 928
						$set: {                                                                                                          // 930
							"sections.$.completeDate": new Date()                                                                           // 930
						}                                                                                                                // 930
					});                                                                                                               // 929
				}                                                                                                                  // 932
			}                                                                                                                   // 933
		}                                                                                                                    // 934
                                                                                                                       //
		var updatedDoc = studentAssessments.findOne({                                                                        // 935
			_id: assessmentId                                                                                                   // 935
		});                                                                                                                  // 935
                                                                                                                       //
		if (checkAllSectionsFinished(updatedDoc)) {                                                                          // 936
			studentAssessments.update({                                                                                         // 937
				_id: assessmentId                                                                                                  // 937
			}, {                                                                                                                // 937
				$set: {                                                                                                            // 939
					"completeDate": new Date()                                                                                        // 940
				}                                                                                                                  // 939
			});                                                                                                                 // 938
		}                                                                                                                    // 943
	},                                                                                                                    // 944
	'addAssessmentAudio': function (fileId, assessmentId, sectionName, answerNumber, question) {                          // 946
		var assessment = studentAssessments.findOne({                                                                        // 947
			_id: assessmentId                                                                                                   // 947
		});                                                                                                                  // 947
                                                                                                                       //
		if (Meteor.userId()) {                                                                                               // 948
			for (var i = 0; i < assessment.sections.length; i++) {                                                              // 949
				if (assessment.sections[i].name == sectionName) {                                                                  // 950
					if (assessment.sections[i].startDate != null && assessment.sections[i].completeDate == null) {                    // 951
						var answerObj = {                                                                                                // 952
							"question": question,                                                                                           // 953
							"answerNumber": answerNumber,                                                                                   // 954
							"answerId": fileId                                                                                              // 955
						};                                                                                                               // 952
						studentAssessments.update({                                                                                      // 957
							_id: assessmentId,                                                                                              // 957
							"sections.name": sectionName                                                                                    // 957
						}, {                                                                                                             // 957
							$addToSet: {                                                                                                    // 959
								"sections.$.answer": answerObj                                                                                 // 960
							}                                                                                                               // 959
						});                                                                                                              // 958
					}                                                                                                                 // 963
                                                                                                                       //
					return;                                                                                                           // 964
				}                                                                                                                  // 965
			}                                                                                                                   // 966
		}                                                                                                                    // 967
	},                                                                                                                    // 968
	'resetAssessment': function (uId) {                                                                                   // 970
		studentAssessments.remove({                                                                                          // 971
			userId: uId                                                                                                         // 971
		});                                                                                                                  // 971
		Meteor.call('assignNewAssessment', uId, false);                                                                      // 972
	}                                                                                                                     // 973
});                                                                                                                    // 1
                                                                                                                       //
function checkAllSectionsFinished(assessmentDoc) {                                                                     // 977
	var sections = assessmentDoc.sections;                                                                                // 978
	var finished = true;                                                                                                  // 979
                                                                                                                       //
	for (var i = 0; i < sections.length; i++) {                                                                           // 980
		if (sections[i].completeDate == null) {                                                                              // 981
			finished = false;                                                                                                   // 982
		}                                                                                                                    // 983
	}                                                                                                                     // 984
                                                                                                                       //
	return finished;                                                                                                      // 985
}                                                                                                                      // 986
                                                                                                                       //
function getSection(sectionName) {                                                                                     // 988
	if (sectionName.length < 4) {                                                                                         // 989
		return sectionName.indexOf("r") >= 0 ? "Reading" : "Listening";                                                      // 990
	} else {                                                                                                              // 991
		return sectionName;                                                                                                  // 992
	}                                                                                                                     // 993
}                                                                                                                      // 994
                                                                                                                       //
function finalScore(score, sectionName) {                                                                              // 996
	var pass = 100;                                                                                                       // 997
                                                                                                                       //
	switch (sectionName) {                                                                                                // 998
		case "A2l":                                                                                                          // 999
			pass = 4;                                                                                                           // 1000
			break;                                                                                                              // 1001
                                                                                                                       //
		case "A1r":                                                                                                          // 1002
		case "B1l":                                                                                                          // 1003
			pass = 3;                                                                                                           // 1004
			break;                                                                                                              // 1005
                                                                                                                       //
		case "A2r":                                                                                                          // 1006
		case "B2l":                                                                                                          // 1007
			pass = 4;                                                                                                           // 1008
			break;                                                                                                              // 1009
                                                                                                                       //
		case "B1r":                                                                                                          // 1010
		case "B2r":                                                                                                          // 1011
			pass = 5;                                                                                                           // 1012
			break;                                                                                                              // 1013
                                                                                                                       //
		case "C1r":                                                                                                          // 1014
		case "C1l":                                                                                                          // 1015
			return true;                                                                                                        // 1016
                                                                                                                       //
		default:                                                                                                             // 1017
			break;                                                                                                              // 1018
	}                                                                                                                     // 998
                                                                                                                       //
	return score < pass;                                                                                                  // 1021
}                                                                                                                      // 1022
                                                                                                                       //
function checkAnswers(assessmentType, sectionName, userAnswers) {                                                      // 1024
	assessmentType = "initialAssessment"; // TEMP SOLN                                                                    // 1025
                                                                                                                       //
	var assessmentAnswers = {                                                                                             // 1026
		initialAssessment: {                                                                                                 // 1027
			A1r: {                                                                                                              // 1028
				answer1: ["after 1870"],                                                                                           // 1029
				answer2: ["sold ice cream"],                                                                                       // 1030
				answer3: ["opened cafes"],                                                                                         // 1031
				answer4: ["opened italian restaurants"],                                                                           // 1032
				answer5: ["no"]                                                                                                    // 1033
			},                                                                                                                  // 1028
			A2r: {                                                                                                              // 1036
				answer1: ["world war 2", "world war two", "world war II"],                                                         // 1037
				answer2: ["soviet union"],                                                                                         // 1038
				answer3: ["local women"],                                                                                          // 1039
				answer4: ["2004"],                                                                                                 // 1040
				answer5: ["find work", "get jobs"],                                                                                // 1041
				answer6: ["on farms", "picking crops", "in farms", "in farming", "on farms picking crops", "in farms picking crops"],
				answer7: ["bars and restaurants", "restaurants and bars"],                                                         // 1043
				answer8: ["no"]                                                                                                    // 1044
			},                                                                                                                  // 1036
			B1r: {                                                                                                              // 1047
				answer1: ["sailors"],                                                                                              // 1048
				answer2: ["london, cardiff and liverpool", "london, liverpool and cardiff", "cardiff, london and liverpool", "cardiff, liverpool and london", "liverpool, cardiff and london", "liverpool, london and cardiff", "london cardiff liverpool", "london liverpool cardiff", "cardiff london liverpool", "cardiff liverpool london", "liverpool cardiff london", "liverpool london cardiff"],
				answer3: ["early 1800s"],                                                                                          // 1050
				answer4: ["20th"],                                                                                                 // 1051
				answer5: ["no"],                                                                                                   // 1052
				answer6: ["no"],                                                                                                   // 1053
				answer7: ["chinese shops and restaurants", "chinese foods and goods"],                                             // 1054
				answer8: ["yes"],                                                                                                  // 1055
				answer9: ["yes"]                                                                                                   // 1056
			},                                                                                                                  // 1047
			B2r: {                                                                                                              // 1059
				answer1: ["12 miles apart", "twelve miles apart", "12 miles away", "twelve miles away"],                           // 1060
				answer2: ["5th century", "the 5th century"],                                                                       // 1061
				answer3: ["no"],                                                                                                   // 1062
				answer4: ["links"],                                                                                                // 1063
				answer5: ["famine"],                                                                                               // 1064
				answer6: ["a million", "one million", "1 million"],                                                                // 1065
				answer7: ["glasgow"],                                                                                              // 1066
				answer8: ["jobs", "pay", "work", "low rates of pay", "lower rates of pay"],                                        // 1067
				answer9: ["yes"],                                                                                                  // 1068
				answer10: ["harmony"]                                                                                              // 1069
			},                                                                                                                  // 1059
			C1r: {                                                                                                              // 1072
				answer1: ["died", "were killed"],                                                                                  // 1073
				answer2: ["independence"],                                                                                         // 1074
				answer3: ["no"],                                                                                                   // 1075
				answer4: ["civil service", "indian civil service"],                                                                // 1076
				answer5: ["b"],                                                                                                    // 1077
				answer6: ["1947"],                                                                                                 // 1078
				answer7: ["a,c", "c,a"],                                                                                           // 1079
				answer8: ["no"],                                                                                                   // 1080
				answer9: ["no"],                                                                                                   // 1081
				answer10: ["expelled"]                                                                                             // 1082
			},                                                                                                                  // 1072
			A2l: {                                                                                                              // 1086
				q1: ["false"],                                                                                                     // 1087
				q2: ["false"],                                                                                                     // 1088
				q3: ["false"],                                                                                                     // 1089
				q4: ["true"],                                                                                                      // 1090
				q5: ["false"],                                                                                                     // 1091
				q6: ["true"]                                                                                                       // 1092
			},                                                                                                                  // 1086
			B1l: {                                                                                                              // 1095
				q1: ["kasia has been in scotland for five years", "kasia's father couldn't find a job in poland", "kasia was born in poland"],
				q2: ["polish and scottish"],                                                                                       // 1099
				q3: ["he came in the 1960s"],                                                                                      // 1100
				q4: ["she came to marry farhana's father"],                                                                        // 1101
				q5: ["this is his first time away from lewis", "he doesn't have any brothers or sisters", "he speaks two languages"],
				q6: ["he doesn't understand the glasgow dialect"],                                                                 // 1105
				q7: ["mostly happy"]                                                                                               // 1106
			},                                                                                                                  // 1095
			B2l: {                                                                                                              // 1109
				q1: ["tonight"],                                                                                                   // 1110
				q2: ["mark thorne film"],                                                                                          // 1111
				q3: ["no"],                                                                                                        // 1112
				q4: ["she doesn't like car chases"],                                                                               // 1113
				q5: ["the new french film"],                                                                                       // 1114
				q6: ["it sounds a bit heavy"]                                                                                      // 1115
			},                                                                                                                  // 1109
			C1l: {                                                                                                              // 1118
				q1: ["true"],                                                                                                      // 1119
				q2: ["true"],                                                                                                      // 1120
				q3: ["space tourism"],                                                                                             // 1121
				q4: ["a radio interview"],                                                                                         // 1122
				q5: ["positive"],                                                                                                  // 1123
				q6: ["neutral"]                                                                                                    // 1124
			}                                                                                                                   // 1118
		}                                                                                                                    // 1027
	};                                                                                                                    // 1026
                                                                                                                       //
	if (userAnswers == null) {                                                                                            // 1128
		return null;                                                                                                         // 1129
	} else {                                                                                                              // 1130
		var assessment = assessmentAnswers[assessmentType];                                                                  // 1131
		var assessmentTemp = assessment[sectionName];                                                                        // 1132
		var score = 0;                                                                                                       // 1133
                                                                                                                       //
		for (var i = 1; i < userAnswers.length; i++) {                                                                       // 1135
			if (userAnswers[i].answerValue == null || userAnswers[i].answerValue == 'undefined' || userAnswers[i].answerValue.length < 1) {
				userAnswers[i].correct = false;                                                                                    // 1137
				continue;                                                                                                          // 1138
			}                                                                                                                   // 1139
                                                                                                                       //
			if (typeof userAnswers[i].answerValue == "string") {                                                                // 1141
				var formatAnswer = userAnswers[i].answerValue.toLowerCase();                                                       // 1143
				formatAnswer = formatAnswer.trim();                                                                                // 1144
				var acceptedAnswer = assessmentTemp[userAnswers[i].answerNumber];                                                  // 1145
                                                                                                                       //
				for (var k = 0; k < acceptedAnswer.length; k++) {                                                                  // 1147
					if (allowedAnswer(acceptedAnswer[k], formatAnswer)) {                                                             // 1148
						score++;                                                                                                         // 1149
						userAnswers[i].correct = true;                                                                                   // 1150
						break;                                                                                                           // 1151
					} else {                                                                                                          // 1152
						userAnswers[i].correct = false;                                                                                  // 1153
					}                                                                                                                 // 1154
				}                                                                                                                  // 1155
			} else if (userAnswers[i].answerValue.constructor === Array) {                                                      // 1157
				//The user answer is an array - Listening Section                                                                  // 1158
				userAnswers[i].correct = false;                                                                                    // 1159
                                                                                                                       //
				if (userAnswers[i] == null || userAnswers[i] == 'undefined' || userAnswers[i].answerValue == null || userAnswers[i].answerValue == 'undefined') {
					continue;                                                                                                         // 1162
				}                                                                                                                  // 1163
                                                                                                                       //
				for (var j = 0; j < userAnswers[i].answerValue.length; j++) {                                                      // 1165
					var Answer = userAnswers[i].answerValue[j];                                                                       // 1166
					var question = assessmentTemp[userAnswers[i].answerNumber];                                                       // 1167
					var wrong = true;                                                                                                 // 1169
                                                                                                                       //
					for (var x = 0; x < question.length; x++) {                                                                       // 1170
						if (allowedAnswer(question[x], Answer)) {                                                                        // 1171
							wrong = false; //The answer matches one of the acceppted answers so go to the next answer                       // 1172
                                                                                                                       //
							break;                                                                                                          // 1174
						}                                                                                                                // 1175
					}                                                                                                                 // 1176
                                                                                                                       //
					if (wrong) {                                                                                                      // 1177
						userAnswers[i].correct = false;                                                                                  // 1178
						j = userAnswers[i].answerValue.length + 1; //i++;                                                                // 1179
					}                                                                                                                 // 1181
				} //The answer is correct so increase the score and go to the next question                                        // 1182
                                                                                                                       //
                                                                                                                       //
				if (!wrong) {                                                                                                      // 1184
					userAnswers[i].correct = true;                                                                                    // 1185
					score++;                                                                                                          // 1186
				}                                                                                                                  // 1187
			}                                                                                                                   // 1188
		}                                                                                                                    // 1190
                                                                                                                       //
		return score;                                                                                                        // 1191
	}                                                                                                                     // 1192
}                                                                                                                      // 1193
                                                                                                                       //
function wordCountParser(val) {                                                                                        // 1195
	var wom = val.match(/\S+/g);                                                                                          // 1196
	return {                                                                                                              // 1197
		charactersNoSpaces: val.replace(/\s+/g, '').length,                                                                  // 1198
		characters: val.length,                                                                                              // 1199
		words: wom ? wom.length : 0,                                                                                         // 1200
		lines: val.split(/\r*\n/).length                                                                                     // 1201
	};                                                                                                                    // 1197
}                                                                                                                      // 1203
                                                                                                                       //
allowedAnswer = function (correct, uans) {                                                                             // 1205
	correct = correct.toLowerCase();                                                                                      // 1206
	uans = uans.toLowerCase();                                                                                            // 1207
                                                                                                                       //
	if (correct.length >= 3 && correct.length <= 5) {                                                                     // 1208
		return hamming_distance(uans, correct) >= 0 && hamming_distance(uans, correct) <= 1;                                 // 1209
	} else if (correct.length >= 6 && correct.length <= 10) {                                                             // 1210
		return hamming_distance(uans, correct) >= 0 && hamming_distance(uans, correct) <= 2;                                 // 1211
	} else if (correct.length >= 11) {                                                                                    // 1212
		return hamming_distance(uans, correct) >= 0 && hamming_distance(uans, correct) <= 3;                                 // 1213
	} else {                                                                                                              // 1214
		return correct == uans;                                                                                              // 1215
	}                                                                                                                     // 1216
}; /*                                                                                                                  // 1217
    *                                                                                                                  //
    * Calculates the hamming distance between two strings                                                              //
    * (operations needed to transform string a to string b).                                                           //
    *                                                                                                                  //
    */                                                                                                                 //
                                                                                                                       //
hamming_distance = function (a, b) {                                                                                   // 1226
	var prim = "",                                                                                                        // 1227
	    sec = "",                                                                                                         // 1227
	    len = 0,                                                                                                          // 1227
	    dist = 0; //If null, undefined or empty string, return error value                                                // 1227
                                                                                                                       //
	if (a == null || b == null || a == "undefined" || b == "undefined" || a.length < 1 || b.length < 1) {                 // 1233
		return -1;                                                                                                           // 1234
	} //Decide which string is the "primary"                                                                              // 1235
                                                                                                                       //
                                                                                                                       //
	if (a.length > b.length) {                                                                                            // 1238
		prim = a;                                                                                                            // 1239
		sec = b;                                                                                                             // 1240
	} else {                                                                                                              // 1241
		prim = b;                                                                                                            // 1242
		sec = a;                                                                                                             // 1243
	} //For each character of the "primary" string, compare it with the "secondary" and increase                          // 1244
	//The total distance on the way.                                                                                      // 1247
                                                                                                                       //
                                                                                                                       //
	for (var i = 0; i < prim.length; i++) {                                                                               // 1248
		//The second string still has characters left                                                                        // 1249
		if (sec[i]) {                                                                                                        // 1250
			//Characters are the same so continue to the next one                                                               // 1251
			if (prim[i] == sec[i]) continue; //Check for fat-fingered letter.                                                   // 1252
                                                                                                                       //
			var temp = prim.substring(0, i) + prim.substring(i + 1, prim.length);                                               // 1256
			if (sec == temp) return 1;                                                                                          // 1257
		}                                                                                                                    // 1259
                                                                                                                       //
		dist++;                                                                                                              // 1261
	}                                                                                                                     // 1262
                                                                                                                       //
	return dist;                                                                                                          // 1264
};                                                                                                                     // 1266
                                                                                                                       //
updateAnswers = function (assessmentId, answers, sectionName, section, sectionComplete, score) {                       // 1269
	var obj = {};                                                                                                         // 1270
                                                                                                                       //
	if (sectionComplete) {                                                                                                // 1272
		obj["sections.$.completeDate"] = new Date();                                                                         // 1273
		obj["sections.$.score"] = score;                                                                                     // 1274
	}                                                                                                                     // 1275
                                                                                                                       //
	if (sectionName.length < 4) obj["sections.$.answer." + sectionName] = answers;else obj["sections.$.answer"] = answers;
	studentAssessments.update({                                                                                           // 1284
		_id: assessmentId,                                                                                                   // 1284
		"sections.name": section                                                                                             // 1284
	}, {                                                                                                                  // 1284
		$set: obj                                                                                                            // 1284
	});                                                                                                                   // 1284
                                                                                                                       //
	if (sectionComplete) {                                                                                                // 1286
		var doc = studentAssessments.findOne({                                                                               // 1287
			_id: assessmentId                                                                                                   // 1287
		});                                                                                                                  // 1287
                                                                                                                       //
		if (checkAllSectionsFinished(doc)) {                                                                                 // 1288
			studentAssessments.update({                                                                                         // 1289
				_id: assessmentId                                                                                                  // 1289
			}, {                                                                                                                // 1289
				$set: {                                                                                                            // 1291
					"completeDate": new Date()                                                                                        // 1292
				}                                                                                                                  // 1291
			});                                                                                                                 // 1290
		}                                                                                                                    // 1295
	}                                                                                                                     // 1296
};                                                                                                                     // 1297
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"audio-recorder-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/audio-recorder-methods.js                                                                     //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'deleteAudioRecording': function (fileId) {                                                                           // 3
		if (Meteor.userId()) {                                                                                               // 4
			var recording = audioRecordings.findOne({                                                                           // 5
				_id: fileId                                                                                                        // 5
			});                                                                                                                 // 5
                                                                                                                       //
			if (recording.ownerId == Meteor.userId()) {                                                                         // 6
				audioRecordings.remove({                                                                                           // 7
					_id: fileId                                                                                                       // 7
				});                                                                                                                // 7
			}                                                                                                                   // 8
		}                                                                                                                    // 9
	},                                                                                                                    // 10
	'addAudioComment': function (fileId, commentId) {                                                                     // 12
		if (Meteor.userId() && Roles.userIsInRole(Meteor.userId(), "student")) {                                             // 13
			audioRecordings.update({                                                                                            // 14
				_id: fileId                                                                                                        // 14
			}, {                                                                                                                // 14
				$addToSet: {                                                                                                       // 16
					comments: {                                                                                                       // 17
						_id: commentId,                                                                                                  // 18
						type: "audio",                                                                                                   // 19
						commenter: Meteor.userId(),                                                                                      // 20
						userType: "student"                                                                                              // 21
					}                                                                                                                 // 17
				}                                                                                                                  // 16
			});                                                                                                                 // 15
		} else if (Meteor.userId() && Roles.userIsInRole(Meteor.userId(), "tutor")) {                                        // 25
			audioRecordings.update({                                                                                            // 26
				_id: fileId                                                                                                        // 26
			}, {                                                                                                                // 26
				$addToSet: {                                                                                                       // 28
					comments: {                                                                                                       // 29
						_id: commentId,                                                                                                  // 30
						type: "audio",                                                                                                   // 31
						commenter: Meteor.userId(),                                                                                      // 32
						userType: "tutor"                                                                                                // 33
					}                                                                                                                 // 29
				}                                                                                                                  // 28
			});                                                                                                                 // 27
		} else if (Meteor.userId() && Roles.userIsInRole(Meteor.userId(), "moderator")) {                                    // 37
			audioRecordings.update({                                                                                            // 38
				_id: fileId                                                                                                        // 38
			}, {                                                                                                                // 38
				$addToSet: {                                                                                                       // 40
					comments: {                                                                                                       // 41
						_id: commentId,                                                                                                  // 42
						type: "audio",                                                                                                   // 43
						commenter: Meteor.userId(),                                                                                      // 44
						userType: "tutor"                                                                                                // 45
					}                                                                                                                 // 41
				}                                                                                                                  // 40
			});                                                                                                                 // 39
		} else if (Meteor.userId() && Roles.userIsInRole(Meteor.userId(), "admin")) {                                        // 49
			audioRecordings.update({                                                                                            // 50
				_id: fileId                                                                                                        // 50
			}, {                                                                                                                // 50
				$addToSet: {                                                                                                       // 52
					comments: {                                                                                                       // 53
						_id: commentId,                                                                                                  // 54
						type: "audio",                                                                                                   // 55
						commenter: Meteor.userId(),                                                                                      // 56
						userType: "admin"                                                                                                // 57
					}                                                                                                                 // 53
				}                                                                                                                  // 52
			});                                                                                                                 // 51
		}                                                                                                                    // 61
	},                                                                                                                    // 62
	'insertAudioTextComment': function (noteId, commentText) {                                                            // 64
		if (Meteor.userId() && Roles.userIsInRole(Meteor.user(), "student")) {                                               // 65
			audioRecordings.update({                                                                                            // 66
				_id: noteId                                                                                                        // 66
			}, {                                                                                                                // 66
				$addToSet: {                                                                                                       // 68
					comments: {                                                                                                       // 69
						comment: commentText,                                                                                            // 70
						type: "text",                                                                                                    // 71
						commenter: Meteor.userId(),                                                                                      // 72
						userType: "student"                                                                                              // 73
					}                                                                                                                 // 69
				}                                                                                                                  // 68
			});                                                                                                                 // 67
		} else if (Meteor.userId() && Roles.userIsInRole(Meteor.user(), "tutor")) {                                          // 78
			audioRecordings.update({                                                                                            // 79
				_id: noteId                                                                                                        // 79
			}, {                                                                                                                // 79
				$addToSet: {                                                                                                       // 81
					comments: {                                                                                                       // 82
						comment: commentText,                                                                                            // 83
						type: "text",                                                                                                    // 84
						commenter: Meteor.userId(),                                                                                      // 85
						userType: "tutor"                                                                                                // 86
					}                                                                                                                 // 82
				}                                                                                                                  // 81
			});                                                                                                                 // 80
		} else if (Meteor.userId() && Roles.userIsInRole(Meteor.user(), "moderator")) {                                      // 91
			audioRecordings.update({                                                                                            // 92
				_id: noteId                                                                                                        // 92
			}, {                                                                                                                // 92
				$addToSet: {                                                                                                       // 94
					comments: {                                                                                                       // 95
						comment: commentText,                                                                                            // 96
						type: "text",                                                                                                    // 97
						commenter: Meteor.userId(),                                                                                      // 98
						userType: "tutor"                                                                                                // 99
					}                                                                                                                 // 95
				}                                                                                                                  // 94
			});                                                                                                                 // 93
		} else if (Meteor.userId() && Roles.userIsInRole(Meteor.user(), "admin")) {                                          // 104
			audioRecordings.update({                                                                                            // 105
				_id: noteId                                                                                                        // 105
			}, {                                                                                                                // 105
				$addToSet: {                                                                                                       // 107
					comments: {                                                                                                       // 108
						comment: commentText,                                                                                            // 109
						type: "text",                                                                                                    // 110
						commenter: Meteor.userId(),                                                                                      // 111
						userType: "Admin"                                                                                                // 112
					}                                                                                                                 // 108
				}                                                                                                                  // 107
			});                                                                                                                 // 106
		}                                                                                                                    // 117
	}                                                                                                                     // 118
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"bug-reports.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/bug-reports.js                                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'submitBugReport': function (device, browser, location, description, uID) {                                           // 3
		var d = new Date();                                                                                                  // 4
		var formattedDate = ("0" + d.getDate()).slice(-2) + "-" + ("0" + (d.getMonth() + 1)).slice(-2) + "-" + d.getFullYear() + " " + ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
                                                                                                                       //
		try {                                                                                                                // 7
			return bug_reports.insert({                                                                                         // 8
				userId: uID,                                                                                                       // 8
				status: "New",                                                                                                     // 8
				date: formattedDate,                                                                                               // 8
				device: device,                                                                                                    // 8
				browser: browser,                                                                                                  // 8
				location: location,                                                                                                // 8
				description: description                                                                                           // 8
			});                                                                                                                 // 8
		} catch (err) {                                                                                                      // 9
			throw new Meteor.Error(err.message);                                                                                // 10
		}                                                                                                                    // 11
	},                                                                                                                    // 12
	'changeBugReportStatus': function (status, bugId) {                                                                   // 14
		if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                                  // 15
			try {                                                                                                               // 16
				return bug_reports.update({                                                                                        // 17
					_id: bugId                                                                                                        // 17
				}, {                                                                                                               // 17
					$set: {                                                                                                           // 17
						status: status                                                                                                   // 17
					}                                                                                                                 // 17
				});                                                                                                                // 17
			} catch (err) {                                                                                                     // 18
				throw new Meteor.Error(err.message);                                                                               // 19
			}                                                                                                                   // 20
		} else {                                                                                                             // 21
			throw new Meteor.Error(500, 'You\'re not an admin - no permission to change bug report status.');                   // 22
		}                                                                                                                    // 23
	}                                                                                                                     // 24
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"cg-badge-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/cg-badge-methods.js                                                                           //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
  'addBagdeRecord': function (org, progTitle, progId, firstName, lastName, gender, email, dateofbirth) {               // 3
    var currentDate = new Date();                                                                                      // 4
    var date = currentDate.toDateString();                                                                             // 5
                                                                                                                       //
    try {                                                                                                              // 7
      return CGBadgeData.insert({                                                                                      // 8
        "Organisation Name": org,                                                                                      // 9
        "Programme Title": progTitle,                                                                                  // 10
        "Programme ID": progId,                                                                                        // 11
        "First Name": firstName,                                                                                       // 12
        "Last Name": lastName,                                                                                         // 13
        "Gender": gender,                                                                                              // 14
        "Email Address": email,                                                                                        // 15
        "Date of Birth": dateofbirth,                                                                                  // 16
        "Date of details submission": currentDate                                                                      // 17
      });                                                                                                              // 8
    } catch (err) {                                                                                                    // 19
      throw new Meteor.Error(err.message);                                                                             // 20
    }                                                                                                                  // 21
  },                                                                                                                   // 22
  'sendCertificateDetailsEmail': function (orgName, fName, lName, gender, email, dateofbirth) {                        // 24
    // Send the email                                                                                                  // 25
    var recipient = "svetlozar@klik2learn.com";                                                                        // 26
    var emailSubject = "Certificate Details Submitted";                                                                // 27
    var emailContent = "A user with the following details has just added their certificate details for requesting their Assured Customer Credential: \nFirst Name: " + fName + "\nLast Name: " + lName + "\nGender: " + gender + "\nDate of Birth: " + dateofbirth + "\nEmail: " + email + "\nOrganisation: " + orgName;
    Email.send({                                                                                                       // 29
      to: recipient,                                                                                                   // 30
      from: "noreply@journey2english.com",                                                                             // 31
      subject: emailSubject,                                                                                           // 32
      text: emailContent                                                                                               // 33
    });                                                                                                                // 29
  },                                                                                                                   // 35
  'sendNotificationMessage': function (fName, lName, email) {                                                          // 37
    var receiver = Meteor.users.findOne({                                                                              // 39
      username: "cgbadge"                                                                                              // 39
    })._id;                                                                                                            // 39
                                                                                                                       //
    var msgsubject = "New certificate details submitted";                                                              // 40
    var msgbody = "A user has completed the course and submitted the details for their certificate. \nThe details they've used on the certificate are:\nFull name: " + fName + " " + lName + "\nEmail: " + email;
    var uID = Meteor.userId();                                                                                         // 42
                                                                                                                       //
    if (msgbody == '') {                                                                                               // 44
      throw new Meteor.Error(500, 'You can\'t send an empty message.');                                                // 45
    } else if (msgsubject == '') {                                                                                     // 46
      throw new Meteor.Error(500, 'You can\'t send a message without a subject.');                                     // 47
    } else {                                                                                                           // 48
      var d = new Date(); // var formattedDate = ("0" + d.getDate()).slice(-2) + "-" + ("0"+(d.getMonth()+1)).slice(-2) + "-" + d.getFullYear() + " " + ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
                                                                                                                       //
      var dayNames = ["Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat"];                                               // 51
      var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept", "Oct", "Nov", "Dec"];        // 52
      var date = new Date();                                                                                           // 53
      var dayIndex = date.getDay();                                                                                    // 54
      var dateNo = date.getDate();                                                                                     // 55
      var monthIndex = date.getMonth();                                                                                // 56
      var year = date.getFullYear();                                                                                   // 57
      var hours = date.getHours();                                                                                     // 58
      var minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();                                           // 59
      var formattedDate = dayNames[dayIndex] + ' ' + monthNames[monthIndex] + ' ' + dateNo + ' ' + year + ' ' + hours + ':' + minutes; //Sending a message to admin "cgbadge" to let him know that a user has submitted their certificate details
                                                                                                                       //
      messages.insert({                                                                                                // 63
        "p1": receiver,                                                                                                // 64
        "p2": receiver,                                                                                                // 64
        "p1_unread": false,                                                                                            // 64
        "p2_unread": true,                                                                                             // 64
        "p1_visible": true,                                                                                            // 64
        "p2_visible": true,                                                                                            // 64
        "title": msgsubject,                                                                                           // 64
        "messages": [{                                                                                                 // 64
          "sender": receiver,                                                                                          // 64
          "date": formattedDate,                                                                                       // 64
          "message": msgbody                                                                                           // 64
        }]                                                                                                             // 64
      }); //Seding a message to user that has just submitted their certificate details to let them know that the details have been passed on to an admin
                                                                                                                       //
      messages.insert({                                                                                                // 67
        "p1": uID,                                                                                                     // 68
        "p2": uID,                                                                                                     // 68
        "p1_unread": false,                                                                                            // 68
        "p2_unread": true,                                                                                             // 68
        "p1_visible": true,                                                                                            // 68
        "p2_visible": true,                                                                                            // 68
        "title": "Course completed!",                                                                                  // 68
        "messages": [{                                                                                                 // 68
          "sender": uID,                                                                                               // 68
          "date": formattedDate,                                                                                       // 68
          "message": "Congratulations on completing 'Journey 2 English!'  We've received your details and are forwarding them to City & Guilds. They will send you your Digital Credentials badge. You can share this on social media and on your CV."
        }]                                                                                                             // 68
      });                                                                                                              // 68
    }                                                                                                                  // 70
  }                                                                                                                    // 71
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"contact-form.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/contact-form.js                                                                               //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'submitContactForm': function (formType, name, email, organisation, uID) {                                            // 3
		var d = new Date();                                                                                                  // 4
		var formattedDate = ("0" + d.getDate()).slice(-2) + "-" + ("0" + (d.getMonth() + 1)).slice(-2) + "-" + d.getFullYear() + " " + ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
                                                                                                                       //
		try {                                                                                                                // 7
			return contact_form.insert({                                                                                        // 8
				userId: uID,                                                                                                       // 8
				formType: formType,                                                                                                // 8
				status: "New",                                                                                                     // 8
				date: formattedDate,                                                                                               // 8
				name: name,                                                                                                        // 8
				email: email,                                                                                                      // 8
				organisation: organisation[0]                                                                                      // 8
			});                                                                                                                 // 8
		} catch (err) {                                                                                                      // 9
			throw new Meteor.Error(err.message);                                                                                // 10
		}                                                                                                                    // 11
	},                                                                                                                    // 12
	'changeContactFormStatus': function (status, messageId) {                                                             // 14
		if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                                  // 15
			try {                                                                                                               // 16
				return contact_form.update({                                                                                       // 17
					_id: messageId                                                                                                    // 17
				}, {                                                                                                               // 17
					$set: {                                                                                                           // 17
						status: status                                                                                                   // 17
					}                                                                                                                 // 17
				});                                                                                                                // 17
			} catch (err) {                                                                                                     // 18
				throw new Meteor.Error(err.message);                                                                               // 19
			}                                                                                                                   // 20
		} else {                                                                                                             // 21
			throw new Meteor.Error(500, 'You\'re not an admin - no permission to change contact form status.');                 // 22
		}                                                                                                                    // 23
	}                                                                                                                     // 24
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"database-queries-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/database-queries-methods.js                                                                   //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
    'getUsernameFromId': function (userId) {                                                                           // 2
        var user = checkUser(userId);                                                                                  // 3
        return user.username;                                                                                          // 5
    },                                                                                                                 // 6
    'getUserProfileFromId': function (userId) {                                                                        // 8
        var user = checkUser(userId);                                                                                  // 9
        return user.profile;                                                                                           // 11
    }                                                                                                                  // 12
});                                                                                                                    // 1
                                                                                                                       //
var checkUser = function (userId) {                                                                                    // 15
    if (userId == null || userId == 'undefined') {                                                                     // 16
        throwError("UserId undefined");                                                                                // 17
    }                                                                                                                  // 18
                                                                                                                       //
    var user = Meteor.users.findOne({                                                                                  // 19
        _id: userId                                                                                                    // 19
    });                                                                                                                // 19
                                                                                                                       //
    if (user == null || user == 'undefined') {                                                                         // 21
        throwError("No such user: " + userId);                                                                         // 22
    }                                                                                                                  // 23
                                                                                                                       //
    return user;                                                                                                       // 25
};                                                                                                                     // 26
                                                                                                                       //
var throwError = function (msg) {                                                                                      // 28
    throw new Meteor.Error(msg);                                                                                       // 29
};                                                                                                                     // 30
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"dictionary-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/dictionary-methods.js                                                                         //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
    // Returns the 'Best Match' of the user's search.                                                                  // 2
    // 'dictionaryGBMRequest': function(searchTerm) {                                                                  // 3
    // 	if (Meteor.userId) {                                                                                           // 4
    // 		var result = HTTP.call('GET', 'https://api.collinsdictionary.com/api/v1/dictionaries/english-learner/search/first/?q=' + searchTerm + '&format=html',
    // 			{ headers: {                                                                                                 // 6
    // 					Accept: 'application/xml',                                                                                 // 7
    // 					accessKey: 'fBAPlBWOupM2dPpU4njH75ATCjVmNDBZO4IHV4RgtjDoKxJdkNmhZkstKG5ohnz4'                              // 8
    // 				}                                                                                                           // 9
    // 			});                                                                                                          // 10
    // 		return result;                                                                                                // 11
    // 	}                                                                                                              // 12
    // },                                                                                                              // 13
    'dictionarySearch': function (searchTerm) {                                                                        // 16
        if (Meteor.userId) {                                                                                           // 17
            var result = HTTP.call('GET', 'https://od-api.oxforddictionaries.com/api/v2/entries/en/' + searchTerm, {   // 18
                headers: {                                                                                             // 19
                    Accept: 'application/json',                                                                        // 20
                    app_id: '046baef6',                                                                                // 21
                    app_key: '6479550290009ca38a812a64e7337f5d'                                                        // 22
                }                                                                                                      // 19
            });                                                                                                        // 18
            return result;                                                                                             // 25
        }                                                                                                              // 26
    },                                                                                                                 // 27
    // Used to find the 'See Also' words and phrases which is returned from other searches.                            // 29
    'dictionaryEntrySearch': function (searchTerm) {                                                                   // 30
        var result = HTTP.call('GET', 'https://api.collinsdictionary.com/api/v1/dictionaries/english-learner/entries/' + searchTerm + '?format=html', {
            headers: {                                                                                                 // 32
                Accept: 'application/xml',                                                                             // 33
                accessKey: 'fBAPlBWOupM2dPpU4njH75ATCjVmNDBZO4IHV4RgtjDoKxJdkNmhZkstKG5ohnz4'                          // 34
            }                                                                                                          // 32
        });                                                                                                            // 31
        return result;                                                                                                 // 37
    } /*'dictionaryMASRequest': function(searchTerm){                                                                  // 38
      	var result = HTTP.call("GET", "https://dictionary.cambridge.org/api/v1/dictionaries/learner-english/search/?q=" + searchTerm,
      							{headers: {accessKey: 'XeP9lybBzAcet0psiaZOTkRLk7QGsfUE2hSJYBOUFxgKCZcghvcu5vGBlJO6QnmC'}});              //
      	                                                                                                                //
      	var resultList = result.data.results; // All the resuls from the search	                                        //
      	var matchedList = [];                                                                                           //
      	                                                                                                                //
      	for (var i = 0; i < resultList.length; i++){                                                                    //
      		if (resultList[i].entryId == searchTerm || resultList[i].entryId == (searchTerm+'_' + (i + 1))) {              //
      			var found = false;                                                                                            //
      			for (var j = 0; j < matchedList.length; j++){                                                                 //
      				if (matchedList[j] == resultList[i].entryId) {                                                               //
      					found = true;                                                                                               //
      					break;                                                                                                      //
      				}                                                                                                            //
      			}                                                                                                             //
      			//var found = jQuery.inArray(resultList.entryId, matchedList) > -1; // Check if entryId is in array           //
      			if (!found){                                                                                                  //
      				matchedList.push(resultList[i]);                                                                             //
      			}                                                                                                             //
      		}                                                                                                              //
      	}                                                                                                               //
      	                                                                                                                //
      	var entriesList = [];                                                                                           //
      	for (var i = 0; i < matchedList.length; i++){                                                                   //
      		var result = HTTP.call("GET", "https://dictionary.cambridge.org/api/v1/dictionaries/learner-english/entries/" + matchedList[i].entryId + '/',
      							   {headers: {accessKey: 'XeP9lybBzAcet0psiaZOTkRLk7QGsfUE2hSJYBOUFxgKCZcghvcu5vGBlJO6QnmC'}});           //
      		entriesList.push(result);                                                                                      //
      	}                                                                                                               //
      	return entriesList;                                                                                             //
      },                                                                                                               //
                                                                                                                       //
       'dictionaryGBMRequest': function(searchTerm){                                                                   //
      	var result = HTTP.call("GET", "https://dictionary.cambridge.org/api/v1/dictionaries/learner-english/search/first/?q=" + searchTerm,
      						   {headers: {accessKey: 'XeP9lybBzAcet0psiaZOTkRLk7QGsfUE2hSJYBOUFxgKCZcghvcu5vGBlJO6QnmC'}});            //
      		return result;                                                                                                 //
      }*/ /*'dictionaryMASRequest': function(searchTerm){                                                              //
          	var result = HTTP.call('GET', 'https://api.collinsdictionary.com/api/v1/dictionaries/english-learner/search/?q=' + searchTerm,
          		{ headers: {                                                                                               //
          				Accept: 'application/json',                                                                              //
          				accessKey: 'fBAPlBWOupM2dPpU4njH75ATCjVmNDBZO4IHV4RgtjDoKxJdkNmhZkstKG5ohnz4'                            //
          			}                                                                                                         //
          		}, function(error, result) {                                                                               //
          			if (!error) {                                                                                             //
          				for (var i = 0; i < result.data.results.length; i++) {                                                   //
          					console.log(result.data.results[i].entryUrl);                                                           //
          				}                                                                                                        //
          			}                                                                                                         //
          			return result;                                                                                            //
          		});                                                                                                        //
               },*/                                                                                                    //
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"feedback-forms.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/feedback-forms.js                                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'submitFeedbackForm': function (name, scores, comments, uID) {                                                        // 3
		var d = new Date();                                                                                                  // 4
		var formattedDate = ("0" + d.getDate()).slice(-2) + "-" + ("0" + (d.getMonth() + 1)).slice(-2) + "-" + d.getFullYear() + " " + ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
                                                                                                                       //
		try {                                                                                                                // 7
			return feedback_forms.insert({                                                                                      // 8
				userId: uID,                                                                                                       // 8
				name: name,                                                                                                        // 8
				date: formattedDate,                                                                                               // 8
				scores: scores,                                                                                                    // 8
				comments: comments                                                                                                 // 8
			});                                                                                                                 // 8
		} catch (err) {                                                                                                      // 9
			throw new Meteor.Error(err.message);                                                                                // 10
		}                                                                                                                    // 11
	}                                                                                                                     // 12
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"forums-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/forums-methods.js                                                                             //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'UpdateForum': function (target, ids) {                                                                               // 2
		if (target == "organisation") {                                                                                      // 3
			/* Add new Organisation */f_forums.insert({                                                                         // 3
				organisation: ids.organisation,                                                                                    // 5
				groups: []                                                                                                         // 6
			});                                                                                                                 // 4
		} else if (target == "group") {                                                                                      // 9
			/* Add new Group */var newGroup = {                                                                                 // 9
				id: ids.group,                                                                                                     // 11
				threads: [],                                                                                                       // 12
				subgroups: []                                                                                                      // 13
			};                                                                                                                  // 10
			f_forums.update({                                                                                                   // 16
				organisation: ids.organisation                                                                                     // 16
			}, {                                                                                                                // 16
				$push: {                                                                                                           // 17
					groups: newGroup                                                                                                  // 18
				}                                                                                                                  // 17
			});                                                                                                                 // 16
		} else if (target == "subgroup") {                                                                                   // 22
			/* Add new Subgroup */var newSubgroup = {                                                                           // 22
				id: ids.subgroup,                                                                                                  // 24
				threads: []                                                                                                        // 25
			};                                                                                                                  // 23
			f_forums.update({                                                                                                   // 28
				organisation: ids.organisation,                                                                                    // 28
				groups: {                                                                                                          // 28
					$elemMatch: {                                                                                                     // 28
						id: ids.group                                                                                                    // 28
					}                                                                                                                 // 28
				}                                                                                                                  // 28
			}, {                                                                                                                // 28
				$push: {                                                                                                           // 29
					"$.subgroups": newSubgroup                                                                                        // 30
				}                                                                                                                  // 29
			});                                                                                                                 // 28
		} else if (target == "organisationDelete") {                                                                         // 34
			f_forums.remove({                                                                                                   // 35
				organisation: orgId                                                                                                // 35
			});                                                                                                                 // 35
		} else if (target == "groupDelete") {                                                                                // 37
			var orgId = groups.findOne({                                                                                        // 38
				_id: ids.group                                                                                                     // 38
			}).organisation;                                                                                                    // 38
			f_forums.update({                                                                                                   // 39
				organisation: orgId                                                                                                // 39
			}, {                                                                                                                // 39
				$pull: {                                                                                                           // 39
					groups: {                                                                                                         // 39
						$elemMatch: {                                                                                                    // 39
							id: ids.group                                                                                                   // 39
						}                                                                                                                // 39
					}                                                                                                                 // 39
				}                                                                                                                  // 39
			});                                                                                                                 // 39
		} else if (target == "subgroupDelete") {                                                                             // 41
			var orgId = groups.findOne({                                                                                        // 42
				_id: ids.group                                                                                                     // 42
			}).organisation;                                                                                                    // 42
			f_forums.update({                                                                                                   // 43
				organisation: orgId,                                                                                               // 43
				groups: {                                                                                                          // 43
					$elemMatch: {                                                                                                     // 43
						id: ids.group                                                                                                    // 43
					}                                                                                                                 // 43
				}                                                                                                                  // 43
			}, {                                                                                                                // 43
				$pull: {                                                                                                           // 43
					"$.subgroups": {                                                                                                  // 43
						$elemMatch: {                                                                                                    // 43
							id: ids.subgroup                                                                                                // 43
						}                                                                                                                // 43
					}                                                                                                                 // 43
				}                                                                                                                  // 43
			});                                                                                                                 // 43
		} else {                                                                                                             // 45
			throw new Meteor.Error("Unknown operation '" + target + "' in Meteor method 'UpdateForum'");                        // 46
		}                                                                                                                    // 47
	},                                                                                                                    // 48
	'createNewThread': function (organisationId, group, subgroup, title, post, uID) {                                     // 51
		var formattedDate = getFormattedDate();                                                                              // 52
		var currentUser = Meteor.users.findOne({                                                                             // 54
			_id: uID                                                                                                            // 54
		});                                                                                                                  // 54
		var orgId = currentUser.organisation;                                                                                // 55
		var groups = currentUser.groups;                                                                                     // 56
		var oldGroupThreads = [];                                                                                            // 57
		getGroupThreads(organisationId, group).forEach(function (thread) {                                                   // 58
			oldGroupThreads.push(thread);                                                                                       // 59
		});                                                                                                                  // 60
                                                                                                                       //
		if (!admin()) {                                                                                                      // 62
			var wrongOrg = orgId != organisationId;                                                                             // 63
			var wrongGroup = (student() || tutor()) && groups.indexOf(group) == -1;                                             // 64
                                                                                                                       //
			if (wrongOrg || wrongGroup) {                                                                                       // 65
				throw new Meteor.Error(500, 'No permission to make a thread here.');                                               // 66
				return false;                                                                                                      // 67
			}                                                                                                                   // 68
                                                                                                                       //
			var newThreads = {                                                                                                  // 69
				"title": title,                                                                                                    // 69
				"date": formattedDate,                                                                                             // 69
				"posts": [{                                                                                                        // 69
					poster: Meteor.userId(),                                                                                          // 69
					date: formattedDate,                                                                                              // 69
					content: post                                                                                                     // 69
				}]                                                                                                                 // 69
			};                                                                                                                  // 69
		} else {                                                                                                             // 70
			var newThreads = {                                                                                                  // 71
				"title": title,                                                                                                    // 71
				"date": formattedDate,                                                                                             // 71
				sticky: false,                                                                                                     // 71
				"posts": [{                                                                                                        // 71
					poster: Meteor.userId(),                                                                                          // 71
					date: formattedDate,                                                                                              // 71
					content: post                                                                                                     // 71
				}]                                                                                                                 // 71
			};                                                                                                                  // 71
		}                                                                                                                    // 72
                                                                                                                       //
		if (subgroup == null) {                                                                                              // 75
			/* New Group Thread */oldGroupThreads.push(newThreads);                                                             // 76
			f_forums.update({                                                                                                   // 78
				organisation: organisationId,                                                                                      // 78
				groups: {                                                                                                          // 78
					$elemMatch: {                                                                                                     // 78
						id: group                                                                                                        // 78
					}                                                                                                                 // 78
				}                                                                                                                  // 78
			}, {                                                                                                                // 78
				$set: {                                                                                                            // 78
					"groups.$.threads": oldGroupThreads                                                                               // 78
				}                                                                                                                  // 78
			});                                                                                                                 // 78
		} else {                                                                                                             // 80
			/* New Subgroup Thread */ //This does not work in mongoDB - multiple $ are not allowed.                             // 81
			//Instead take the whole subgroups part of groups.$ and replace that.                                               // 83
			var oldSubgroups = getGroupSubgroups(organisationId, group);                                                        // 84
			oldSubgroups = pushSubgroupThread(oldSubgroups, subgroup, newThreads);                                              // 85
			f_forums.update({                                                                                                   // 86
				organisation: organisationId,                                                                                      // 86
				groups: {                                                                                                          // 86
					$elemMatch: {                                                                                                     // 86
						id: group                                                                                                        // 86
					}                                                                                                                 // 86
				}                                                                                                                  // 86
			}, {                                                                                                                // 86
				$set: {                                                                                                            // 86
					"groups.$.subgroups": oldSubgroups                                                                                // 86
				}                                                                                                                  // 86
			});                                                                                                                 // 86
		}                                                                                                                    // 87
	},                                                                                                                    // 89
	'toggleSticky': function (orgId, group, subgroup, threadNo, uID, lock) {                                              // 92
		if (lock == true) {                                                                                                  // 93
			throw new Meteor.Error(500, 'Previous toggle still executing. Please wait.');                                       // 94
		}                                                                                                                    // 95
                                                                                                                       //
		var currentUser = Meteor.users.findOne({                                                                             // 97
			_id: uID                                                                                                            // 97
		});                                                                                                                  // 97
                                                                                                                       //
		for (var _iterator = currentUser.organisation, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
			if (_isArray) {                                                                                                     // 99
				if (_i >= _iterator.length) break;                                                                                 // 99
				orgId = _iterator[_i++];                                                                                           // 99
			} else {                                                                                                            // 99
				_i = _iterator.next();                                                                                             // 99
				if (_i.done) break;                                                                                                // 99
				orgId = _i.value;                                                                                                  // 99
			}                                                                                                                   // 99
                                                                                                                       //
			if (!admin() && orgId != currentUser.organisation) {                                                                // 100
				throw new Meteor.Error(500, 'You\'re not part of this organisation!');                                             // 101
			}                                                                                                                   // 102
		}                                                                                                                    // 103
                                                                                                                       //
		if (subgroup == null) {                                                                                              // 106
			var threads = getGroupThreads(orgId, group);                                                                        // 107
			threads[threadNo].sticky = sticky == null || sticky == undefined ? true : !threads[threadNo].sticky;                // 108
			f_forums.update({                                                                                                   // 110
				organisation: orgId,                                                                                               // 110
				groups: {                                                                                                          // 110
					$elemMatch: {                                                                                                     // 110
						id: group                                                                                                        // 110
					}                                                                                                                 // 110
				}                                                                                                                  // 110
			}, {                                                                                                                // 110
				$set: {                                                                                                            // 110
					"groups.$.threads": threads                                                                                       // 110
				}                                                                                                                  // 110
			});                                                                                                                 // 110
		} else {                                                                                                             // 111
			var subgroups = getGroupSubgroups(orgId, group);                                                                    // 112
			subgroups.forEach(function (subG) {                                                                                 // 113
				if (subG.id == subgroup) {                                                                                         // 114
					subG.threads[threadNo].sticky = !subG.threads[threadNo].sticky;                                                   // 115
					return false;                                                                                                     // 116
				}                                                                                                                  // 117
			});                                                                                                                 // 118
			f_forums.update({                                                                                                   // 119
				organisation: orgId,                                                                                               // 119
				groups: {                                                                                                          // 119
					$elemMatch: {                                                                                                     // 119
						id: group                                                                                                        // 119
					}                                                                                                                 // 119
				}                                                                                                                  // 119
			}, {                                                                                                                // 119
				$set: {                                                                                                            // 119
					"groups.$.subgroups": subgroups                                                                                   // 119
				}                                                                                                                  // 119
			});                                                                                                                 // 119
		}                                                                                                                    // 120
	},                                                                                                                    // 121
	'editThreadTitle': function (orgId, group, subgroup, threadNo, uID, newTitle) {                                       // 123
		var currentUser = Meteor.users.findOne({                                                                             // 125
			_id: uID                                                                                                            // 125
		});                                                                                                                  // 125
                                                                                                                       //
		for (var _iterator2 = currentUser.organisation, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {
			if (_isArray2) {                                                                                                    // 127
				if (_i2 >= _iterator2.length) break;                                                                               // 127
				orgId = _iterator2[_i2++];                                                                                         // 127
			} else {                                                                                                            // 127
				_i2 = _iterator2.next();                                                                                           // 127
				if (_i2.done) break;                                                                                               // 127
				orgId = _i2.value;                                                                                                 // 127
			}                                                                                                                   // 127
                                                                                                                       //
			if (!admin() && orgId != currentUser.organisation) {                                                                // 128
				throw new Meteor.Error(500, 'You\'re not part of this organisation!');                                             // 129
			}                                                                                                                   // 130
		}                                                                                                                    // 131
                                                                                                                       //
		if (subgroup == null) {                                                                                              // 133
			var threads = getGroupThreads(orgId, group);                                                                        // 134
			threads[threadNo].title = newTitle;                                                                                 // 135
			f_forums.update({                                                                                                   // 137
				organisation: orgId,                                                                                               // 137
				groups: {                                                                                                          // 137
					$elemMatch: {                                                                                                     // 137
						id: group                                                                                                        // 137
					}                                                                                                                 // 137
				}                                                                                                                  // 137
			}, {                                                                                                                // 137
				$set: {                                                                                                            // 137
					"groups.$.threads": threads                                                                                       // 137
				}                                                                                                                  // 137
			});                                                                                                                 // 137
		} else {                                                                                                             // 138
			var subgroups = getGroupSubgroups(orgId, group);                                                                    // 139
			subgroups.forEach(function (subG) {                                                                                 // 140
				if (subG.id == subgroup) {                                                                                         // 141
					subG.threads[threadNo].title = newTitle;                                                                          // 142
					return false;                                                                                                     // 143
				}                                                                                                                  // 144
			});                                                                                                                 // 145
			f_forums.update({                                                                                                   // 146
				organisation: orgId,                                                                                               // 146
				groups: {                                                                                                          // 146
					$elemMatch: {                                                                                                     // 146
						id: group                                                                                                        // 146
					}                                                                                                                 // 146
				}                                                                                                                  // 146
			}, {                                                                                                                // 146
				$set: {                                                                                                            // 146
					"groups.$.subgroups": subgroups                                                                                   // 146
				}                                                                                                                  // 146
			});                                                                                                                 // 146
		}                                                                                                                    // 147
	},                                                                                                                    // 148
	'deleteThread': function (orgId, group, subgroup, threadNo, uID) {                                                    // 150
		var currentUser = Meteor.users.findOne({                                                                             // 152
			_id: uID                                                                                                            // 152
		});                                                                                                                  // 152
                                                                                                                       //
		for (var _iterator3 = currentUser.organisation, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {
			if (_isArray3) {                                                                                                    // 154
				if (_i3 >= _iterator3.length) break;                                                                               // 154
				orgId = _iterator3[_i3++];                                                                                         // 154
			} else {                                                                                                            // 154
				_i3 = _iterator3.next();                                                                                           // 154
				if (_i3.done) break;                                                                                               // 154
				orgId = _i3.value;                                                                                                 // 154
			}                                                                                                                   // 154
                                                                                                                       //
			if (!admin() && orgId != currentUser.organisation) {                                                                // 155
				throw new Meteor.Error(500, 'You\'re not part of this organisation!');                                             // 156
			}                                                                                                                   // 157
		}                                                                                                                    // 158
                                                                                                                       //
		if (subgroup == null) {                                                                                              // 160
			var threads = getGroupThreads(orgId, group);                                                                        // 162
			threads.splice(threadNo, 1);                                                                                        // 163
			f_forums.update({                                                                                                   // 165
				organisation: orgId,                                                                                               // 165
				groups: {                                                                                                          // 165
					$elemMatch: {                                                                                                     // 165
						id: group                                                                                                        // 165
					}                                                                                                                 // 165
				}                                                                                                                  // 165
			}, {                                                                                                                // 165
				$set: {                                                                                                            // 165
					"groups.$.threads": threads                                                                                       // 165
				}                                                                                                                  // 165
			});                                                                                                                 // 165
		} else {                                                                                                             // 167
			var oldSubgroups = getGroupSubgroups(orgId, group);                                                                 // 169
			oldSubgroups.forEach(function (subG) {                                                                              // 170
				if (subG.id == subgroup) {                                                                                         // 171
					subG.threads.splice(threadNo, 1);                                                                                 // 172
					return false;                                                                                                     // 173
				}                                                                                                                  // 174
			});                                                                                                                 // 175
			f_forums.update({                                                                                                   // 177
				organisation: orgId,                                                                                               // 177
				groups: {                                                                                                          // 177
					$elemMatch: {                                                                                                     // 177
						id: group                                                                                                        // 177
					}                                                                                                                 // 177
				}                                                                                                                  // 177
			}, {                                                                                                                // 177
				$set: {                                                                                                            // 177
					"groups.$.subgroups": oldSubgroups                                                                                // 177
				}                                                                                                                  // 177
			});                                                                                                                 // 177
		}                                                                                                                    // 179
	},                                                                                                                    // 180
	'editPost': function (orgId, group, subgroup, threadNo, postNo, uID, newContent) {                                    // 182
		var formattedDate = getFormattedDate();                                                                              // 183
		var currentUser = Meteor.users.findOne({                                                                             // 185
			_id: uID                                                                                                            // 185
		});                                                                                                                  // 185
                                                                                                                       //
		for (var _iterator4 = currentUser.organisation, _isArray4 = Array.isArray(_iterator4), _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {
			if (_isArray4) {                                                                                                    // 187
				if (_i4 >= _iterator4.length) break;                                                                               // 187
				orgId = _iterator4[_i4++];                                                                                         // 187
			} else {                                                                                                            // 187
				_i4 = _iterator4.next();                                                                                           // 187
				if (_i4.done) break;                                                                                               // 187
				orgId = _i4.value;                                                                                                 // 187
			}                                                                                                                   // 187
                                                                                                                       //
			if (!admin() && orgId != currentUser.organisation) {                                                                // 188
				throw new Meteor.Error(500, 'You\'re not part of this organisation!');                                             // 189
			}                                                                                                                   // 190
		}                                                                                                                    // 191
                                                                                                                       //
		newContent = newContent + "\n\nEdited by poster on " + formattedDate;                                                // 193
                                                                                                                       //
		if (subgroup == null) {                                                                                              // 195
			var threads = getGroupThreads(orgId, group);                                                                        // 197
			threads[threadNo].posts[postNo].content = newContent;                                                               // 198
			f_forums.update({                                                                                                   // 200
				organisation: orgId,                                                                                               // 200
				groups: {                                                                                                          // 200
					$elemMatch: {                                                                                                     // 200
						id: group                                                                                                        // 200
					}                                                                                                                 // 200
				}                                                                                                                  // 200
			}, {                                                                                                                // 200
				$set: {                                                                                                            // 200
					"groups.$.threads": threads                                                                                       // 200
				}                                                                                                                  // 200
			});                                                                                                                 // 200
		} else {                                                                                                             // 202
			var oldSubgroups = getGroupSubgroups(orgId, group);                                                                 // 204
			oldSubgroups.forEach(function (subG) {                                                                              // 205
				if (subG.id == subgroup) {                                                                                         // 206
					subG.threads[threadNo].posts[postNo].content = newContent;                                                        // 207
					return false;                                                                                                     // 208
				}                                                                                                                  // 209
			});                                                                                                                 // 210
			f_forums.update({                                                                                                   // 212
				organisation: orgId,                                                                                               // 212
				groups: {                                                                                                          // 212
					$elemMatch: {                                                                                                     // 212
						id: group                                                                                                        // 212
					}                                                                                                                 // 212
				}                                                                                                                  // 212
			}, {                                                                                                                // 212
				$set: {                                                                                                            // 212
					"groups.$.subgroups": oldSubgroups                                                                                // 212
				}                                                                                                                  // 212
			});                                                                                                                 // 212
		}                                                                                                                    // 214
	},                                                                                                                    // 215
	'replyInThread': function (orgId, group, subgroup, threadNo, post, uID) {                                             // 217
		var formattedDate = getFormattedDate();                                                                              // 218
		var currentUser = Meteor.users.findOne({                                                                             // 221
			_id: uID                                                                                                            // 221
		});                                                                                                                  // 221
                                                                                                                       //
		for (var _iterator5 = currentUser.organisation, _isArray5 = Array.isArray(_iterator5), _i5 = 0, _iterator5 = _isArray5 ? _iterator5 : _iterator5[Symbol.iterator]();;) {
			if (_isArray5) {                                                                                                    // 223
				if (_i5 >= _iterator5.length) break;                                                                               // 223
				orgId = _iterator5[_i5++];                                                                                         // 223
			} else {                                                                                                            // 223
				_i5 = _iterator5.next();                                                                                           // 223
				if (_i5.done) break;                                                                                               // 223
				orgId = _i5.value;                                                                                                 // 223
			}                                                                                                                   // 223
                                                                                                                       //
			if (!admin() && orgId != currentUser.organisation) {                                                                // 224
				throw new Meteor.Error(500, 'You\'re not part of this organisation!');                                             // 225
			}                                                                                                                   // 226
		}                                                                                                                    // 227
                                                                                                                       //
		var newPost = {                                                                                                      // 229
			poster: uID,                                                                                                        // 230
			date: formattedDate,                                                                                                // 231
			content: post                                                                                                       // 232
		};                                                                                                                   // 229
                                                                                                                       //
		if (subgroup == null) {                                                                                              // 234
			var threads = getGroupThreads(orgId, group);                                                                        // 236
			threads[threadNo].posts.push(newPost);                                                                              // 237
			f_forums.update({                                                                                                   // 239
				organisation: orgId,                                                                                               // 239
				groups: {                                                                                                          // 239
					$elemMatch: {                                                                                                     // 239
						id: group                                                                                                        // 239
					}                                                                                                                 // 239
				}                                                                                                                  // 239
			}, {                                                                                                                // 239
				$set: {                                                                                                            // 239
					"groups.$.threads": threads                                                                                       // 239
				}                                                                                                                  // 239
			});                                                                                                                 // 239
		} else {                                                                                                             // 241
			var oldSubgroups = getGroupSubgroups(orgId, group);                                                                 // 243
			oldSubgroups.forEach(function (subG) {                                                                              // 244
				if (subG.id == subgroup) {                                                                                         // 245
					subG.threads[threadNo].posts.push(newPost);                                                                       // 246
					return false;                                                                                                     // 247
				}                                                                                                                  // 248
			});                                                                                                                 // 249
			f_forums.update({                                                                                                   // 251
				organisation: orgId,                                                                                               // 251
				groups: {                                                                                                          // 251
					$elemMatch: {                                                                                                     // 251
						id: group                                                                                                        // 251
					}                                                                                                                 // 251
				}                                                                                                                  // 251
			}, {                                                                                                                // 251
				$set: {                                                                                                            // 251
					"groups.$.subgroups": oldSubgroups                                                                                // 251
				}                                                                                                                  // 251
			});                                                                                                                 // 251
		}                                                                                                                    // 253
	},                                                                                                                    // 255
	'deletePost': function (orgId, group, subgroup, threadNo, postNo, uID) {                                              // 257
		var currentUser = Meteor.users.findOne({                                                                             // 259
			_id: uID                                                                                                            // 259
		});                                                                                                                  // 259
                                                                                                                       //
		for (var _iterator6 = currentUser.organisation, _isArray6 = Array.isArray(_iterator6), _i6 = 0, _iterator6 = _isArray6 ? _iterator6 : _iterator6[Symbol.iterator]();;) {
			if (_isArray6) {                                                                                                    // 261
				if (_i6 >= _iterator6.length) break;                                                                               // 261
				orgId = _iterator6[_i6++];                                                                                         // 261
			} else {                                                                                                            // 261
				_i6 = _iterator6.next();                                                                                           // 261
				if (_i6.done) break;                                                                                               // 261
				orgId = _i6.value;                                                                                                 // 261
			}                                                                                                                   // 261
                                                                                                                       //
			if (!admin() && orgId != currentUser.organisation) {                                                                // 262
				throw new Meteor.Error(500, 'You\'re not part of this organisation!');                                             // 263
			}                                                                                                                   // 264
		}                                                                                                                    // 265
                                                                                                                       //
		if (subgroup == null) {                                                                                              // 267
			var threads = getGroupThreads(orgId, group);                                                                        // 269
			threads[threadNo].posts.splice(postNo, 1);                                                                          // 270
			f_forums.update({                                                                                                   // 272
				organisation: orgId,                                                                                               // 272
				groups: {                                                                                                          // 272
					$elemMatch: {                                                                                                     // 272
						id: group                                                                                                        // 272
					}                                                                                                                 // 272
				}                                                                                                                  // 272
			}, {                                                                                                                // 272
				$set: {                                                                                                            // 272
					"groups.$.threads": threads                                                                                       // 272
				}                                                                                                                  // 272
			});                                                                                                                 // 272
                                                                                                                       //
			if (threads[threadNo].posts.length == 0) {                                                                          // 274
				Meteor.call("deleteThread", orgId, group, subgroup, threadNo, uID);                                                // 275
			}                                                                                                                   // 276
		} else {                                                                                                             // 277
			var oldSubgroups = getGroupSubgroups(orgId, group);                                                                 // 279
			var removeTopic = false;                                                                                            // 280
			oldSubgroups.forEach(function (subG) {                                                                              // 281
				if (subG.id == subgroup) {                                                                                         // 282
					subG.threads[threadNo].posts.splice(postNo, 1);                                                                   // 283
                                                                                                                       //
					if (subG.threads[threadNo].posts.length == 0) {                                                                   // 284
						removeTopic = true;                                                                                              // 285
					}                                                                                                                 // 286
                                                                                                                       //
					return false;                                                                                                     // 287
				}                                                                                                                  // 288
			});                                                                                                                 // 289
			f_forums.update({                                                                                                   // 291
				organisation: orgId,                                                                                               // 291
				groups: {                                                                                                          // 291
					$elemMatch: {                                                                                                     // 291
						id: group                                                                                                        // 291
					}                                                                                                                 // 291
				}                                                                                                                  // 291
			}, {                                                                                                                // 291
				$set: {                                                                                                            // 291
					"groups.$.subgroups": oldSubgroups                                                                                // 291
				}                                                                                                                  // 291
			});                                                                                                                 // 291
                                                                                                                       //
			if (removeTopic) {                                                                                                  // 293
				Meteor.call("deleteThread", orgId, group, subgroup, threadNo, uID);                                                // 294
			}                                                                                                                   // 295
		}                                                                                                                    // 296
	}                                                                                                                     // 297
});                                                                                                                    // 1
                                                                                                                       //
updateForumPost = function (target, ids, obj) {                                                                        // 301
	if (target == "group") {                                                                                              // 302
		f_forums.update({                                                                                                    // 303
			organisation: ids.organisation,                                                                                     // 303
			groups: {                                                                                                           // 303
				$elemMatch: {                                                                                                      // 303
					id: ids.group                                                                                                     // 303
				}                                                                                                                  // 303
			}                                                                                                                   // 303
		}, {                                                                                                                 // 303
			$set: obj                                                                                                           // 303
		});                                                                                                                  // 303
	} else if (target == "subgroup") {                                                                                    // 304
		f_forums.update({                                                                                                    // 305
			organisation: ids.organisation,                                                                                     // 305
			groups: {                                                                                                           // 305
				$elemMatch: {                                                                                                      // 305
					id: ids.group                                                                                                     // 305
				}                                                                                                                  // 305
			},                                                                                                                  // 305
			"$.subgroups": {                                                                                                    // 305
				$elemMatch: {                                                                                                      // 305
					id: ids.subgroup                                                                                                  // 305
				}                                                                                                                  // 305
			}                                                                                                                   // 305
		}, {                                                                                                                 // 305
			$set: obj                                                                                                           // 305
		});                                                                                                                  // 305
	}                                                                                                                     // 306
};                                                                                                                     // 307
                                                                                                                       //
getFormattedDate = function () {                                                                                       // 310
	var d = new Date(); // var formattedDate = ("0" + d.getDate()).slice(-2) + "-" + ("0"+(d.getMonth()+1)).slice(-2) + "-" + d.getFullYear() + " " + ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
                                                                                                                       //
	var dayNames = ["Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat"];                                                    // 313
	var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept", "Oct", "Nov", "Dec"];             // 314
	var date = new Date();                                                                                                // 315
	var dayIndex = date.getDay();                                                                                         // 316
	var dateNo = date.getDate();                                                                                          // 317
	var monthIndex = date.getMonth();                                                                                     // 318
	var year = date.getFullYear();                                                                                        // 319
	var hours = date.getHours();                                                                                          // 320
	var minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();                                                // 321
	return dayNames[dayIndex] + ' ' + monthNames[monthIndex] + ' ' + dateNo + ' ' + year + ' ' + hours + ':' + minutes;   // 323
};                                                                                                                     // 324
                                                                                                                       //
admin = function () {                                                                                                  // 326
	return Roles.userIsInRole(Meteor.userId(), 'admin');                                                                  // 327
};                                                                                                                     // 328
                                                                                                                       //
moderator = function () {                                                                                              // 330
	return Roles.userIsInRole(Meteor.userId(), 'moderator');                                                              // 331
};                                                                                                                     // 332
                                                                                                                       //
tutor = function () {                                                                                                  // 334
	return Roles.userIsInRole(Meteor.userId(), 'tutor');                                                                  // 335
};                                                                                                                     // 336
                                                                                                                       //
student = function () {                                                                                                // 338
	return Roles.userIsInRole(Meteor.userId(), 'student');                                                                // 339
};                                                                                                                     // 340
                                                                                                                       //
getSubgroupThread = function (org, group, subgroup, thread) {                                                          // 342
	var groups = f_forums.findOne({                                                                                       // 343
		organisation: org,                                                                                                   // 343
		"groups.id": group                                                                                                   // 343
	}).groups;                                                                                                            // 343
	var currG = null;                                                                                                     // 344
	groups.forEach(function (item) {                                                                                      // 345
		if (item["id"] == groupId) {                                                                                         // 346
			currG = item;                                                                                                       // 347
		}                                                                                                                    // 348
	});                                                                                                                   // 349
	var threads = [];                                                                                                     // 351
	currG.subgroups.forEach(function (item) {                                                                             // 353
		if (item["id"] == subgroup) {                                                                                        // 354
			threads = item.threads;                                                                                             // 355
		}                                                                                                                    // 356
	});                                                                                                                   // 357
	return threads[thread];                                                                                               // 359
};                                                                                                                     // 361
                                                                                                                       //
getGroupThread = function (org, group) {                                                                               // 363
	var groups = f_forums.findOne({                                                                                       // 364
		organisation: org,                                                                                                   // 364
		"groups.id": group                                                                                                   // 364
	}).groups;                                                                                                            // 364
	var currG = null;                                                                                                     // 365
	groups.forEach(function (item) {                                                                                      // 366
		if (item["id"] == groupId) {                                                                                         // 367
			currG = item;                                                                                                       // 368
		}                                                                                                                    // 369
	});                                                                                                                   // 370
	var threads = currG.threads;                                                                                          // 372
	return threads;                                                                                                       // 374
};                                                                                                                     // 375
                                                                                                                       //
getGroupThreads = function (orgId, groupId) {                                                                          // 378
	forumDoc = f_forums.findOne({                                                                                         // 379
		organisation: orgId                                                                                                  // 379
	});                                                                                                                   // 379
	var threads = [];                                                                                                     // 380
	forumDoc.groups.forEach(function (item) {                                                                             // 382
		if (item.id == groupId) {                                                                                            // 383
			item.threads.forEach(function (thread) {                                                                            // 384
				threads.push(thread);                                                                                              // 385
			});                                                                                                                 // 386
			return false;                                                                                                       // 387
		}                                                                                                                    // 388
	});                                                                                                                   // 389
	return threads;                                                                                                       // 391
};                                                                                                                     // 393
                                                                                                                       //
getGroupSubgroups = function (orgId, groupId) {                                                                        // 395
	var subgroups = [];                                                                                                   // 396
	var forumDoc = f_forums.findOne({                                                                                     // 397
		organisation: orgId                                                                                                  // 397
	});                                                                                                                   // 397
	forumDoc.groups.forEach(function (group) {                                                                            // 398
		if (group.id == groupId) {                                                                                           // 399
			subgroups = group.subgroups;                                                                                        // 400
			return false;                                                                                                       // 401
		}                                                                                                                    // 402
	});                                                                                                                   // 403
	return subgroups;                                                                                                     // 405
};                                                                                                                     // 406
                                                                                                                       //
pushSubgroupThread = function (oldGroupThreads, subgroupId, newThreads) {                                              // 409
	oldGroupThreads.forEach(function (subgroup) {                                                                         // 410
		if (subgroup.id == subgroupId) {                                                                                     // 411
			subgroup.threads.push(newThreads);                                                                                  // 412
			return false;                                                                                                       // 413
		}                                                                                                                    // 414
	});                                                                                                                   // 415
	return oldGroupThreads;                                                                                               // 417
};                                                                                                                     // 418
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"group-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/group-methods.js                                                                              //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'addUserToGroupUsingGroupEditor': function (userId, groupId, role) {                                                  // 2
		if ((Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator')) && groups.findOne({
			_id: groupId                                                                                                        // 3
		}) != null) {                                                                                                        // 3
			if (role == "tutor") {                                                                                              // 4
				groups.update({                                                                                                    // 5
					_id: groupId                                                                                                      // 5
				}, {                                                                                                               // 5
					$push: {                                                                                                          // 5
						tutors: userId                                                                                                   // 5
					}                                                                                                                 // 5
				});                                                                                                                // 5
			} else if (role == "student") {                                                                                     // 6
				groups.update({                                                                                                    // 7
					_id: groupId                                                                                                      // 7
				}, {                                                                                                               // 7
					$push: {                                                                                                          // 7
						students: userId                                                                                                 // 7
					}                                                                                                                 // 7
				});                                                                                                                // 7
			}                                                                                                                   // 8
                                                                                                                       //
			Meteor.users.update({                                                                                               // 9
				_id: userId                                                                                                        // 9
			}, {                                                                                                                // 9
				$push: {                                                                                                           // 9
					groups: groupId                                                                                                   // 9
				}                                                                                                                  // 9
			});                                                                                                                 // 9
		} else {                                                                                                             // 10
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 12
		}                                                                                                                    // 13
	},                                                                                                                    // 15
	'removeUserFromGroupUsingGroupEditor': function (userId, groupId, role) {                                             // 17
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator')) {              // 18
			if (role == "tutor") {                                                                                              // 19
				groups.update({                                                                                                    // 20
					_id: groupId                                                                                                      // 20
				}, {                                                                                                               // 20
					$pull: {                                                                                                          // 20
						tutors: userId                                                                                                   // 20
					}                                                                                                                 // 20
				});                                                                                                                // 20
			} else if (role == "student") {                                                                                     // 21
				groups.update({                                                                                                    // 22
					_id: groupId                                                                                                      // 22
				}, {                                                                                                               // 22
					$pull: {                                                                                                          // 22
						students: userId                                                                                                 // 22
					}                                                                                                                 // 22
				});                                                                                                                // 22
			}                                                                                                                   // 23
                                                                                                                       //
			Meteor.users.update({                                                                                               // 24
				_id: userId                                                                                                        // 24
			}, {                                                                                                                // 24
				$pull: {                                                                                                           // 24
					groups: groupId                                                                                                   // 24
				}                                                                                                                  // 24
			});                                                                                                                 // 24
		} else {                                                                                                             // 25
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 27
		}                                                                                                                    // 28
	},                                                                                                                    // 30
	'changeOrganisationOfAGroup': function (orgId, groupId) {                                                             // 32
		if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                                  // 33
			groups.update({                                                                                                     // 34
				_id: groupId                                                                                                       // 34
			}, {                                                                                                                // 34
				$set: {                                                                                                            // 34
					organisation: orgId                                                                                               // 34
				}                                                                                                                  // 34
			}); /*                                                                                                              // 34
       	Change the forum documents for those organisations                                                             //
       */                                                                                                              //
		} else {                                                                                                             // 38
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 40
		}                                                                                                                    // 41
	},                                                                                                                    // 42
	'editGroupName': function (groupId, newTitle, uID) {                                                                  // 44
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator')) {              // 45
			groups.update({                                                                                                     // 46
				_id: groupId                                                                                                       // 46
			}, {                                                                                                                // 46
				$set: {                                                                                                            // 46
					name: newTitle                                                                                                    // 46
				}                                                                                                                  // 46
			});                                                                                                                 // 46
		} else {                                                                                                             // 47
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 49
		}                                                                                                                    // 50
	},                                                                                                                    // 51
	// Creates a new group and adds Tutors and Students to the group                                                      // 53
	'createNewGroup': function (aName, aTutors, aUsers, aOrganisation) {                                                  // 54
		var authorised = false;                                                                                              // 55
                                                                                                                       //
		if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                                  // 56
			authorised = true;                                                                                                  // 57
		} else if (Roles.userIsInRole(Meteor.userId(), 'moderator')) {                                                       // 58
			var userDoc = Meteor.users.findOne({                                                                                // 59
				_id: Meteor.userId()                                                                                               // 59
			});                                                                                                                 // 59
                                                                                                                       //
			if (userDoc.organisation.indexOf(aOrganisation) >= 0) {                                                             // 60
				authorised = true;                                                                                                 // 61
			}                                                                                                                   // 62
		}                                                                                                                    // 64
                                                                                                                       //
		if (authorised) {                                                                                                    // 65
			var exists = groups.findOne({                                                                                       // 66
				organisation: aOrganisation,                                                                                       // 66
				name: aName                                                                                                        // 66
			});                                                                                                                 // 66
			if (exists != null && exists != undefined) throw new Meteor.Error("Group with this name already exists in this organisation.");
			groups.insert({                                                                                                     // 70
				name: aName,                                                                                                       // 71
				tutors: aTutors,                                                                                                   // 72
				students: aUsers,                                                                                                  // 73
				subgroups: [],                                                                                                     // 74
				organisation: aOrganisation                                                                                        // 75
			}, function (error, result) {                                                                                       // 70
				if (error) {                                                                                                       // 77
					throw new Meteor.Error("Error creating group.");                                                                  // 78
				} else {                                                                                                           // 79
					for (var i = 0; i < aTutors.length; i++) {                                                                        // 80
						Meteor.users.update({                                                                                            // 81
							_id: aTutors[i]                                                                                                 // 81
						}, {                                                                                                             // 81
							$addToSet: {                                                                                                    // 81
								groups: result.valueOf()                                                                                       // 81
							}                                                                                                               // 81
						});                                                                                                              // 81
					}                                                                                                                 // 82
                                                                                                                       //
					for (var j = 0; j < aUsers.length; j++) {                                                                         // 83
						Meteor.users.update({                                                                                            // 84
							_id: aUsers[j]                                                                                                  // 84
						}, {                                                                                                             // 84
							$addToSet: {                                                                                                    // 84
								groups: result.valueOf()                                                                                       // 84
							}                                                                                                               // 84
						});                                                                                                              // 84
					} //creates a forum for the group                                                                                 // 85
					// //Outdated -  f_forums.insert({ organisation: aOrganisation, group: result.valueOf(), threads: [] });          // 88
                                                                                                                       //
                                                                                                                       //
					Meteor.call("UpdateForum", "group", {                                                                             // 90
						organisation: aOrganisation,                                                                                     // 90
						group: result.valueOf()                                                                                          // 90
					}, function (err) {                                                                                               // 90
						if (err) throw new Meteor.Error(err);                                                                            // 91
					});                                                                                                               // 92
				}                                                                                                                  // 93
			});                                                                                                                 // 94
		} else {                                                                                                             // 95
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 96
		}                                                                                                                    // 97
	},                                                                                                                    // 98
	// Deletes a Group and removes all references to it                                                                   // 100
	'deleteGroup': function (groupId) {                                                                                   // 101
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator')) {              // 102
			var group = groups.findOne({                                                                                        // 103
				_id: groupId                                                                                                       // 103
			});                                                                                                                 // 103
			var tutors = group.tutors;                                                                                          // 104
			var students = group.students;                                                                                      // 105
			var subgroups = group.subgroups; // Remove this group from all Tutors                                               // 106
                                                                                                                       //
			for (var i = 0; i < tutors; i++) {                                                                                  // 109
				Meteor.users.update({                                                                                              // 110
					_id: tutors[i]                                                                                                    // 110
				}, {                                                                                                               // 110
					$pull: {                                                                                                          // 110
						groups: groupId                                                                                                  // 110
					}                                                                                                                 // 110
				});                                                                                                                // 110
			} // Remove this group from all Students                                                                            // 111
                                                                                                                       //
                                                                                                                       //
			for (var j = 0; j < students; j++) {                                                                                // 114
				Meteor.users.update({                                                                                              // 115
					_id: students[j]                                                                                                  // 115
				}, {                                                                                                               // 115
					$pull: {                                                                                                          // 115
						groups: groupId                                                                                                  // 115
					}                                                                                                                 // 115
				});                                                                                                                // 115
			} // Remove all subgroups in this group.                                                                            // 116
                                                                                                                       //
                                                                                                                       //
			for (var k = 0; k < subgroups; k++) {                                                                               // 119
				Meteor.call("deleteSubgroup", subgroups[k]);                                                                       // 120
			} // Remove this group from the forum                                                                               // 121
                                                                                                                       //
                                                                                                                       //
			Meteor.call("UpdateForum", "groupDelete", {                                                                         // 124
				group: groupId                                                                                                     // 124
			}, function (err) {                                                                                                 // 124
				if (err) throw new Meteor.Error(err);                                                                              // 125
			}); // Remove the Group                                                                                             // 126
                                                                                                                       //
			groups.remove({                                                                                                     // 130
				_id: groupId                                                                                                       // 130
			});                                                                                                                 // 130
		} else {                                                                                                             // 131
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 132
		}                                                                                                                    // 133
	},                                                                                                                    // 134
	'createSubgroup': function (subgroupName, tutorId, groupId, organisationId) {                                         // 136
		var duplicates = subgroups.find({                                                                                    // 138
			$and: [{                                                                                                            // 138
				name: subgroupName                                                                                                 // 138
			}, {                                                                                                                // 138
				group: groupId                                                                                                     // 138
			}]                                                                                                                  // 138
		}).count();                                                                                                          // 138
                                                                                                                       //
		if (duplicates != null && duplicates != 'undefined' && duplicates > 0) {                                             // 139
			throw new Meteor.Error(500, 'Subgroup with this name already exists, please try again');                            // 140
			return false;                                                                                                       // 141
		}                                                                                                                    // 142
                                                                                                                       //
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Roles.userIsInRole(Meteor.userId(), 'tutor')) {
			subgroups.insert({                                                                                                  // 146
				name: subgroupName,                                                                                                // 147
				tutor: tutorId,                                                                                                    // 148
				students: [],                                                                                                      // 149
				group: groupId,                                                                                                    // 150
				organisation: organisationId                                                                                       // 151
			});                                                                                                                 // 146
                                                                                                                       //
			var subgroupId = subgroups.findOne({                                                                                // 153
				name: subgroupName                                                                                                 // 153
			})._id;                                                                                                             // 153
                                                                                                                       //
			Meteor.users.update({                                                                                               // 155
				_id: tutorId                                                                                                       // 155
			}, {                                                                                                                // 155
				$push: {                                                                                                           // 155
					subgroups: subgroupId                                                                                             // 155
				}                                                                                                                  // 155
			});                                                                                                                 // 155
			groups.update({                                                                                                     // 156
				_id: groupId                                                                                                       // 156
			}, {                                                                                                                // 156
				$push: {                                                                                                           // 156
					subgroups: subgroupId                                                                                             // 156
				}                                                                                                                  // 156
			});                                                                                                                 // 156
			var updated = f_forums.update({                                                                                     // 157
				groups: {                                                                                                          // 157
					$elemMatch: {                                                                                                     // 157
						id: groupId                                                                                                      // 157
					}                                                                                                                 // 157
				}                                                                                                                  // 157
			}, {                                                                                                                // 157
				$push: {                                                                                                           // 157
					"groups.$.subgroups": {                                                                                           // 157
						id: subgroupId,                                                                                                  // 158
						threads: []                                                                                                      // 159
					}                                                                                                                 // 157
				}                                                                                                                  // 157
			});                                                                                                                 // 157
		} else {                                                                                                             // 161
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 162
		}                                                                                                                    // 163
	},                                                                                                                    // 164
	'deleteSubgroup': function (subgroupId) {                                                                             // 166
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Roles.userIsInRole(Meteor.userId(), 'tutor')) {
			var old = subgroups.findOne({                                                                                       // 168
				_id: subgroupId                                                                                                    // 168
			}); /* remove the subgroup from all students' profiles */                                                           // 168
			var users = old.students;                                                                                           // 171
                                                                                                                       //
			for (var i = 0; i < users; i++) {                                                                                   // 172
				var userId = users[i];                                                                                             // 173
				Meteor.users.update({                                                                                              // 174
					_id: userId                                                                                                       // 174
				}, {                                                                                                               // 174
					$pull: {                                                                                                          // 174
						subgroups: subgroupId                                                                                            // 174
					}                                                                                                                 // 174
				});                                                                                                                // 174
			} /* remove the subgroup from the tutor's profile */                                                                // 175
                                                                                                                       //
			var tutor = old.tutor;                                                                                              // 178
			Meteor.users.update({                                                                                               // 179
				_id: tutor                                                                                                         // 179
			}, {                                                                                                                // 179
				$pull: {                                                                                                           // 179
					subgroups: subgroupId                                                                                             // 179
				}                                                                                                                  // 179
			}); /* remove the subgroup from the list of subgroups of its parent group */                                        // 179
			var groupId = old.group;                                                                                            // 182
			groups.update({                                                                                                     // 183
				_id: groupId                                                                                                       // 183
			}, {                                                                                                                // 183
				$pull: {                                                                                                           // 183
					subgroups: subgroupId                                                                                             // 183
				}                                                                                                                  // 183
			}); // Remove this subgroup from the forum                                                                          // 183
                                                                                                                       //
			Meteor.call("UpdateForum", "subgroupDelete", {                                                                      // 186
				group: groupId,                                                                                                    // 186
				subgroup: subgroupId                                                                                               // 186
			}, function (err) {                                                                                                 // 186
				if (err) throw new Meteor.Error(err);                                                                              // 187
			}); /* finally, delete the subgroup itself */                                                                       // 188
			subgroups.remove({                                                                                                  // 191
				_id: subgroupId                                                                                                    // 191
			});                                                                                                                 // 191
		} else {                                                                                                             // 193
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 194
		}                                                                                                                    // 195
	},                                                                                                                    // 196
	'addStudentToSubgroup': function (subgroupId, studentId) {                                                            // 198
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Roles.userIsInRole(Meteor.userId(), 'tutor')) {
			/* Check if this student exsists */var student = Meteor.users.findOne({                                             // 201
				_id: studentId                                                                                                     // 202
			});                                                                                                                 // 202
                                                                                                                       //
			if (student == null) {                                                                                              // 203
				throw new Meteor.Error(500, 'This student is doesn\'t exsist, please try another one.');                           // 204
				return false;                                                                                                      // 205
			} /* Check if the user is not already in the subgroup */                                                            // 206
                                                                                                                       //
			var currStudents = subgroups.findOne({                                                                              // 209
				_id: subgroupId                                                                                                    // 209
			}).students;                                                                                                        // 209
                                                                                                                       //
			if (currStudents > 0) {                                                                                             // 210
				currStudents.forEach(function (elem) {                                                                             // 211
					if (elem == studentId) {                                                                                          // 212
						throw new Meteor.Error(500, 'This student is already in this subgroup, please try another one.');                // 213
						return false;                                                                                                    // 214
					}                                                                                                                 // 215
				});                                                                                                                // 216
			} /* If everything is okay, proceed to update */                                                                    // 217
                                                                                                                       //
			subgroups.update({                                                                                                  // 220
				_id: subgroupId                                                                                                    // 220
			}, {                                                                                                                // 220
				$push: {                                                                                                           // 220
					students: studentId                                                                                               // 220
				}                                                                                                                  // 220
			});                                                                                                                 // 220
			Meteor.users.update({                                                                                               // 221
				_id: studentId                                                                                                     // 221
			}, {                                                                                                                // 221
				$push: {                                                                                                           // 221
					subgroups: subgroupId                                                                                             // 221
				}                                                                                                                  // 221
			});                                                                                                                 // 221
		} else {                                                                                                             // 222
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 223
		}                                                                                                                    // 224
	},                                                                                                                    // 225
	'removeStudentFromSubgroup': function (subgroupId, studentId) {                                                       // 227
		if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Roles.userIsInRole(Meteor.userId(), 'tutor')) {
			subgroups.update({                                                                                                  // 229
				_id: subgroupId                                                                                                    // 229
			}, {                                                                                                                // 229
				$pull: {                                                                                                           // 229
					students: studentId                                                                                               // 229
				}                                                                                                                  // 229
			});                                                                                                                 // 229
			Meteor.users.update({                                                                                               // 230
				_id: studentId                                                                                                     // 230
			}, {                                                                                                                // 230
				$pull: {                                                                                                           // 230
					subgroups: subgroupId                                                                                             // 230
				}                                                                                                                  // 230
			});                                                                                                                 // 230
		} else {                                                                                                             // 231
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 232
		}                                                                                                                    // 233
	}                                                                                                                     // 234
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"hub_methods.js":function(require,exports,module){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/hub_methods.js                                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
var crypto = require('crypto'); // Node.js module for cryptography                                                     // 1
//encryption/decryption parameters                                                                                     // 3
                                                                                                                       //
                                                                                                                       //
var password = '1234567890abcdef1234567890abcdef'; // password- same as on the hub                                     // 4
                                                                                                                       //
var iv = '1234567890abcdef'; // initialization vector, same as on the hub                                              // 5
                                                                                                                       //
Meteor.methods({                                                                                                       // 8
    /*                                                                                                                 // 9
        encrypts @text based on 'aes-256-ctr' algorithm                                                                //
        @params text- text to be encrypted                                                                             //
        @return encrypted- encrypted text value or Error if crypto module has not been found                           //
    */'hub_encrypt': function (text) {                                                                                 //
        console.log('hub encrypt');                                                                                    // 15
                                                                                                                       //
        if (crypto) {                                                                                                  // 16
            var cipher = crypto.createCipheriv('aes-256-ctr', password, iv);                                           // 17
            var encrypted = cipher.update(text, 'utf8', 'hex');                                                        // 18
            encrypted += cipher.final('hex');                                                                          // 19
            return encrypted;                                                                                          // 20
        }                                                                                                              // 21
                                                                                                                       //
        return new Error('crypto module not found');                                                                   // 22
    },                                                                                                                 // 23
    /*                                                                                                                 // 25
        decrypts @text based on 'aes-256-ctr' algorithm                                                                //
        @params text- text to be decrypted                                                                             //
        @return dec- decrypted text value or Error if crypto module has not been found                                 //
    */'hub_decrypt': function (text) {                                                                                 //
        if (crypto) {                                                                                                  // 31
            var decipher = crypto.createDecipheriv('aes-256-ctr', password, iv);                                       // 32
            var dec = decipher.update(text, 'hex', 'utf8');                                                            // 33
            dec += decipher.final('utf8');                                                                             // 34
            return dec;                                                                                                // 35
        }                                                                                                              // 36
                                                                                                                       //
        return new Error('crypto module not found');                                                                   // 37
    } /*                                                                                                               // 38
          --------------NOT USED---------------                                                                        //
          got 404 responses from the hub on dev                                                                        //
           sends POST request to hub API to receive an encrypted user email                                            //
          @params key -  token for quering the hub API received earlier by get message                                 //
          @returns j2e_email - encrypted j2e email received from the hub or Error if email has not been received       //
                              or if there has been a network error                                                     //
      */ /*                                                                                                            //
          'query_user_email_hub': async function (key) {                                                               //
              try {                                                                                                    //
                  const url = 'https://hub.klik2learn.com/api/getUserStatus'; // hub API url                           //
                   let hub_resp = new Promise(function (resolve, reject) {                                             //
                      // call 'POST' request on hub API                                                                //
                      HTTP.call('POST', url,                                                                           //
                          { params: { userKey: key },                                                                  //
                            npmRequestOptions: { rejectUnauthorized: false }                                           //
                          },                                                                                           //
                          function (err, res) {                                                                        //
                              if (err) {                                                                               //
                                  resolve({res: res, err_msg: "Error POST conn", err: err});                           //
                              } else {                                                                                 //
                                  //response content                                                                   //
                                  let res_content = res['content'];                                                    //
                                  if (!res_content) {                                                                  //
                                      //reject(new Error('invalid POST response'));                                    //
                                      resolve({res: res, err: "No res_content field"});                                //
                                  }                                                                                    //
                                  res_content = JSON.parse(res_content);                                               //
                                  let data = res_content['data'];                                                      //
                                  if (!data) {                                                                         //
                                      //reject(new Error('invalid POST response'));                                    //
                                      resolve({res: res, err: "No data field"});                                       //
                                  }                                                                                    //
                                  let j2eId = data['j2eId']; //encrypted user email                                    //
                                  result = j2eId;                                                                      //
                                  resolve({j2eId: j2eId, res: res});                                                   //
                              }                                                                                        //
                          });                                                                                          //
                  });                                                                                                  //
                   let j2e_email = await hub_resp;                                                                     //
                  return j2e_email;                                                                                    //
               } catch (e) {                                                                                           //
                  // Got a network error, timeout, or HTTP error in the 400 or 500 range.                              //
                  return Error('Network error');                                                                       //
              }                                                                                                        //
          }                                                                                                            //
          */                                                                                                           //
});                                                                                                                    // 8
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"messaging-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/messaging-methods.js                                                                          //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'sendMessage': function (receiver, msgsubject, msgbody, uID) {                                                        // 2
		if (msgbody == '') {                                                                                                 // 3
			throw new Meteor.Error(500, 'You can\'t send an empty message.');                                                   // 4
		} else if (msgsubject == '') {                                                                                       // 5
			throw new Meteor.Error(500, 'You can\'t send a message without a subject.');                                        // 6
		} else {                                                                                                             // 7
			var d = new Date(); // var formattedDate = ("0" + d.getDate()).slice(-2) + "-" + ("0"+(d.getMonth()+1)).slice(-2) + "-" + d.getFullYear() + " " + ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
                                                                                                                       //
			var dayNames = ["Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat"];                                                  // 10
			var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept", "Oct", "Nov", "Dec"];           // 11
			var date = new Date();                                                                                              // 12
			var dayIndex = date.getDay();                                                                                       // 13
			var dateNo = date.getDate();                                                                                        // 14
			var monthIndex = date.getMonth();                                                                                   // 15
			var year = date.getFullYear();                                                                                      // 16
			var hours = date.getHours();                                                                                        // 17
			var minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();                                              // 18
			var formattedDate = dayNames[dayIndex] + ' ' + monthNames[monthIndex] + ' ' + dateNo + ' ' + year + ' ' + hours + ':' + minutes;
			messages.insert({                                                                                                   // 21
				"p1": uID,                                                                                                         // 21
				"p2": receiver,                                                                                                    // 21
				"p1_unread": false,                                                                                                // 21
				"p2_unread": true,                                                                                                 // 21
				"p1_visible": true,                                                                                                // 21
				"p2_visible": true,                                                                                                // 21
				"title": msgsubject,                                                                                               // 21
				"messages": [{                                                                                                     // 21
					"sender": uID,                                                                                                    // 21
					"date": formattedDate,                                                                                            // 21
					"message": msgbody                                                                                                // 21
				}]                                                                                                                 // 21
			});                                                                                                                 // 21
		}                                                                                                                    // 22
	},                                                                                                                    // 23
	'sendReply': function (mID, sender, msgbody) {                                                                        // 25
		if (msgbody == '') {                                                                                                 // 26
			throw new Meteor.Error(500, 'You can\'t send an empty message.');                                                   // 27
		} else {                                                                                                             // 28
			var d = new Date(); // var formattedDate = ("0" + d.getDate()).slice(-2) + "-" + ("0"+(d.getMonth()+1)).slice(-2) + "-" + d.getFullYear() + " " + ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2);
                                                                                                                       //
			var dayNames = ["Sun", "Mon", "Tue", "Wed", "Thur", "Fri", "Sat"];                                                  // 31
			var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept", "Oct", "Nov", "Dec"];           // 32
			var date = new Date();                                                                                              // 33
			var dayIndex = date.getDay();                                                                                       // 34
			var dateNo = date.getDate();                                                                                        // 35
			var monthIndex = date.getMonth();                                                                                   // 36
			var year = date.getFullYear();                                                                                      // 37
			var hours = date.getHours();                                                                                        // 38
			var minutes = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();                                              // 39
			var formattedDate = dayNames[dayIndex] + ' ' + monthNames[monthIndex] + ' ' + dateNo + ' ' + year + ' ' + hours + ':' + minutes;
			obj = {};                                                                                                           // 42
			obj["messages"] = {                                                                                                 // 43
				"sender": sender,                                                                                                  // 43
				"date": formattedDate,                                                                                             // 43
				"message": msgbody                                                                                                 // 43
			};                                                                                                                  // 43
			messages.update({                                                                                                   // 45
				$and: [{                                                                                                           // 45
					_id: mID                                                                                                          // 45
				}]                                                                                                                 // 45
			}, {                                                                                                                // 45
				$addToSet: obj                                                                                                     // 45
			});                                                                                                                 // 45
			var currentConv = messages.findOne({                                                                                // 47
				"_id": mID                                                                                                         // 47
			});                                                                                                                 // 47
                                                                                                                       //
			if (currentConv.p1 == sender) {                                                                                     // 49
				messages.update({                                                                                                  // 50
					$and: [{                                                                                                          // 50
						_id: mID                                                                                                         // 50
					}]                                                                                                                // 50
				}, {                                                                                                               // 50
					$set: {                                                                                                           // 50
						p2_unread: true                                                                                                  // 50
					}                                                                                                                 // 50
				});                                                                                                                // 50
			} else {                                                                                                            // 51
				messages.update({                                                                                                  // 52
					$and: [{                                                                                                          // 52
						_id: mID                                                                                                         // 52
					}]                                                                                                                // 52
				}, {                                                                                                               // 52
					$set: {                                                                                                           // 52
						p1_unread: true                                                                                                  // 52
					}                                                                                                                 // 52
				});                                                                                                                // 52
			}                                                                                                                   // 53
		}                                                                                                                    // 54
	},                                                                                                                    // 55
	'deleteMessage': function (mID, uID) {                                                                                // 57
		var currentConv = messages.findOne({                                                                                 // 58
			"_id": mID                                                                                                          // 58
		});                                                                                                                  // 58
                                                                                                                       //
		if (currentConv.p1 == uID) {                                                                                         // 60
			messages.update({                                                                                                   // 61
				$and: [{                                                                                                           // 61
					_id: mID                                                                                                          // 61
				}]                                                                                                                 // 61
			}, {                                                                                                                // 61
				$set: {                                                                                                            // 61
					p1_visible: false                                                                                                 // 61
				}                                                                                                                  // 61
			});                                                                                                                 // 61
		} else {                                                                                                             // 62
			messages.update({                                                                                                   // 63
				$and: [{                                                                                                           // 63
					_id: mID                                                                                                          // 63
				}]                                                                                                                 // 63
			}, {                                                                                                                // 63
				$set: {                                                                                                            // 63
					p2_visible: false                                                                                                 // 63
				}                                                                                                                  // 63
			});                                                                                                                 // 63
		}                                                                                                                    // 64
	},                                                                                                                    // 65
	'readMessage': function (mID, uID) {                                                                                  // 67
		var currentConv = messages.findOne({                                                                                 // 68
			"_id": mID                                                                                                          // 68
		});                                                                                                                  // 68
                                                                                                                       //
		if (currentConv.p1 == uID) {                                                                                         // 70
			messages.update({                                                                                                   // 71
				$and: [{                                                                                                           // 71
					_id: mID                                                                                                          // 71
				}]                                                                                                                 // 71
			}, {                                                                                                                // 71
				$set: {                                                                                                            // 71
					p1_unread: false                                                                                                  // 71
				}                                                                                                                  // 71
			});                                                                                                                 // 71
		} else {                                                                                                             // 72
			messages.update({                                                                                                   // 73
				$and: [{                                                                                                           // 73
					_id: mID                                                                                                          // 73
				}]                                                                                                                 // 73
			}, {                                                                                                                // 73
				$set: {                                                                                                            // 73
					p2_unread: false                                                                                                  // 73
				}                                                                                                                  // 73
			});                                                                                                                 // 73
		}                                                                                                                    // 74
	}                                                                                                                     // 75
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"notebook-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/notebook-methods.js                                                                           //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'saveNote': function (userId, title, body, formattedDate) {                                                           // 3
		// Do some checks on the data before writing to DB.                                                                  // 4
		if (title.length > 50) {                                                                                             // 6
			throw new Meteor.Error("Invalid Note Title", "The note title must be less than 50 characters (including spaces).");
		} else if (title.length == 0) {                                                                                      // 8
			throw new Meteor.Error("Invalid Note Title", "You must enter a title for the note.");                               // 9
		} else if (body.length > 5000) {                                                                                     // 10
			throw new Meteor.Error("Invalid Note", "Your Note must not exceed 5000 characters. Your current character count is " + body.length + ".");
		} else if (body.length == 0) {                                                                                       // 12
			throw new Meteor.Error("Invalid Note", "You must enter a Note.");                                                   // 13
		} else {                                                                                                             // 14
			userNotes.insert({                                                                                                  // 17
				noteAuthor: userId,                                                                                                // 18
				noteDate: formattedDate,                                                                                           // 19
				noteTitle: title,                                                                                                  // 20
				noteBody: body                                                                                                     // 21
			});                                                                                                                 // 17
			return true;                                                                                                        // 23
		}                                                                                                                    // 24
	},                                                                                                                    // 25
	'deleteNote': function (noteId) {                                                                                     // 27
		note = userNotes.findOne({                                                                                           // 28
			_id: noteId                                                                                                         // 28
		});                                                                                                                  // 28
                                                                                                                       //
		if (note.noteAuthor == Meteor.userId() || Roles.userIsInRole(Meteor.userId(), 'admin')) {                            // 29
			userNotes.remove({                                                                                                  // 30
				_id: noteId                                                                                                        // 30
			});                                                                                                                 // 30
		}                                                                                                                    // 31
	},                                                                                                                    // 33
	'editNote': function (noteId, body) {                                                                                 // 35
		if (body.length == 0) {                                                                                              // 36
			throw new Meteor.Error("Invalid Note", "You must enter a Note.");                                                   // 37
		} else if (body.length > 5000) {                                                                                     // 38
			throw new Meteor.Error("Invalid Note", "Your Note must not exceed 5000 characters. Your current character count is " + body.length + ".");
		} else {                                                                                                             // 40
			userNotes.update({                                                                                                  // 41
				_id: noteId                                                                                                        // 42
			}, {                                                                                                                // 42
				$set: {                                                                                                            // 44
					noteBody: body                                                                                                    // 44
				}                                                                                                                  // 44
			});                                                                                                                 // 43
		}                                                                                                                    // 47
	},                                                                                                                    // 48
	/****************************************                                                                             // 50
 *                                                                                                                     //
 *			COMMENT METHODS                                                                                                   //
 *                                                                                                                     //
 *****************************************/'insertNoteComment': function (noteId, body, comment) {                     //
		// Check if Tutor/valid commentor                                                                                    // 56
		if (Roles.userIsInRole(Meteor.user(), "tutor") || Roles.userIsInRole(Meteor.user(), "admin")) {                      // 57
			userNotes.update({                                                                                                  // 58
				_id: noteId                                                                                                        // 58
			}, {                                                                                                                // 58
				$addToSet: {                                                                                                       // 60
					comments: {                                                                                                       // 60
						_id: Random.id(),                                                                                                // 61
						title: "na",                                                                                                     // 62
						comment: comment,                                                                                                // 63
						author: Meteor.userId(),                                                                                         // 64
						userType: "tutor"                                                                                                // 65
					}                                                                                                                 // 60
				},                                                                                                                 // 60
				$set: {                                                                                                            // 68
					noteBody: body                                                                                                    // 68
				}                                                                                                                  // 68
			});                                                                                                                 // 59
		}                                                                                                                    // 70
	},                                                                                                                    // 71
	'insertCommentComment': function (noteId, updatedComment, commentId, comment) {                                       // 73
		if (Roles.userIsInRole(Meteor.user(), "tutor") || Roles.userIsInRole(Meteor.user(), "admin")) {                      // 74
			userNotes.update({                                                                                                  // 75
				_id: noteId                                                                                                        // 75
			}, {                                                                                                                // 75
				$addToSet: {                                                                                                       // 77
					comments: {                                                                                                       // 77
						_id: Random.id(),                                                                                                // 78
						title: "na",                                                                                                     // 79
						comment: comment,                                                                                                // 80
						author: Meteor.userId(),                                                                                         // 81
						userType: "tutor"                                                                                                // 82
					}                                                                                                                 // 77
				}                                                                                                                  // 77
			});                                                                                                                 // 76
			userNotes.update({                                                                                                  // 87
				_id: noteId,                                                                                                       // 87
				"comments._id": commentId                                                                                          // 87
			}, {                                                                                                                // 87
				$set: {                                                                                                            // 89
					"comments.$.comment": updatedComment                                                                              // 89
				}                                                                                                                  // 89
			});                                                                                                                 // 88
		}                                                                                                                    // 91
	},                                                                                                                    // 92
	'insertStudentNoteComment': function (noteId, comment) {                                                              // 94
		// Check if Student                                                                                                  // 95
		if (Roles.userIsInRole(Meteor.user(), "student") || Roles.userIsInRole(Meteor.user(), "admin")) {                    // 96
			userNotes.update({                                                                                                  // 97
				_id: noteId                                                                                                        // 97
			}, {                                                                                                                // 97
				$addToSet: {                                                                                                       // 99
					comments: {                                                                                                       // 99
						_id: Random.id(),                                                                                                // 100
						title: "na",                                                                                                     // 101
						comment: comment,                                                                                                // 102
						author: Meteor.userId(),                                                                                         // 103
						userType: "student"                                                                                              // 104
					}                                                                                                                 // 99
				}                                                                                                                  // 99
			});                                                                                                                 // 98
		} else if (Roles.userIsInRole(Meteor.user(), "tutor") || Roles.userIsInRole(Meteor.user(), "admin")) {               // 108
			userNotes.update({                                                                                                  // 109
				_id: noteId                                                                                                        // 109
			}, {                                                                                                                // 109
				$addToSet: {                                                                                                       // 111
					comments: {                                                                                                       // 111
						_id: Random.id(),                                                                                                // 112
						title: "na",                                                                                                     // 113
						comment: comment,                                                                                                // 114
						author: Meteor.userId(),                                                                                         // 115
						userType: "tutor"                                                                                                // 116
					}                                                                                                                 // 111
				}                                                                                                                  // 111
			});                                                                                                                 // 110
		}                                                                                                                    // 120
	}                                                                                                                     // 121
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"organisation-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/organisation-methods.js                                                                       //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	'createNewOrg': function (orgName) {                                                                                  // 2
		if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                                  // 3
			try {                                                                                                               // 4
				var doc = organisations.insert({                                                                                   // 5
					name: orgName                                                                                                     // 5
				});                                                                                                                // 5
                                                                                                                       //
				var orgId = organisations.findOne({                                                                                // 6
					name: orgName                                                                                                     // 6
				})._id;                                                                                                            // 6
                                                                                                                       //
				Meteor.call("UpdateForum", "organisation", {                                                                       // 7
					organisation: orgId                                                                                               // 7
				}, function (err) {                                                                                                // 7
					if (err) {                                                                                                        // 8
						throw new Meteor.Error(err); //Do something                                                                      // 9
					}                                                                                                                 // 11
				});                                                                                                                // 12
				return doc;                                                                                                        // 13
			} catch (err) {                                                                                                     // 14
				if (err.code == 11000) {                                                                                           // 15
					throw new Meteor.Error('An organisation with the name  ' + orgName + ' already exists. Please enter a different value.');
				} else {                                                                                                           // 17
					throw new Meteor.Error(err.message);                                                                              // 18
				}                                                                                                                  // 19
			}                                                                                                                   // 20
		} else {                                                                                                             // 21
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 23
		}                                                                                                                    // 24
	},                                                                                                                    // 25
	'editOrganisationName': function (orgId, newTitle, uID) {                                                             // 27
		if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                                  // 28
			organisations.update({                                                                                              // 29
				_id: orgId                                                                                                         // 29
			}, {                                                                                                                // 29
				$set: {                                                                                                            // 29
					name: newTitle                                                                                                    // 29
				}                                                                                                                  // 29
			});                                                                                                                 // 29
		} else {                                                                                                             // 30
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 32
		}                                                                                                                    // 33
	},                                                                                                                    // 34
	'deleteOrganisation': function (orgId, uID) {                                                                         // 36
		if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                                  // 37
			organisations.remove({                                                                                              // 38
				_id: orgId                                                                                                         // 38
			});                                                                                                                 // 38
			groups.update({                                                                                                     // 39
				organisation: orgId                                                                                                // 39
			}, {                                                                                                                // 39
				$set: {                                                                                                            // 39
					organisation: ""                                                                                                  // 39
				}                                                                                                                  // 39
			});                                                                                                                 // 39
			Meteor.call("UpdateForum", "organisationDelete", {                                                                  // 40
				organisation: orgId                                                                                                // 40
			}, function (err) {                                                                                                 // 40
				if (err) throw new Meteor.Error(err);                                                                              // 41
			});                                                                                                                 // 42
		} else {                                                                                                             // 43
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 45
		}                                                                                                                    // 46
	},                                                                                                                    // 47
	'changeOrganisationOfAUser': function (orgId, userId) {                                                               // 49
		if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                                  // 50
			if (Roles.userIsInRole(Meteor.userId(), 'moderator')) {                                                             // 51
				Meteor.users.update({                                                                                              // 52
					_id: userId                                                                                                       // 52
				}, {                                                                                                               // 52
					$addToSet: {                                                                                                      // 52
						organisation: [orgId]                                                                                            // 52
					}                                                                                                                 // 52
				});                                                                                                                // 52
			} else {                                                                                                            // 53
				Meteor.users.update({                                                                                              // 54
					_id: userId                                                                                                       // 54
				}, {                                                                                                               // 54
					$set: {                                                                                                           // 54
						organisation: [orgId]                                                                                            // 54
					}                                                                                                                 // 54
				});                                                                                                                // 54
			}                                                                                                                   // 55
		} else {                                                                                                             // 56
			throw new Meteor.Error(500, 'You\'re not authorised.');                                                             // 58
		}                                                                                                                    // 59
	},                                                                                                                    // 60
	'removeOrganisationFromUser': function (orgId, userId) {                                                              // 62
		return Meteor.users.update({                                                                                         // 63
			_id: userId                                                                                                         // 63
		}, {                                                                                                                 // 63
			$pull: {                                                                                                            // 63
				organisation: orgId                                                                                                // 63
			}                                                                                                                   // 63
		});                                                                                                                  // 63
	},                                                                                                                    // 64
	'addOrganisationToUser': function (orgId, userId) {                                                                   // 66
		return Meteor.users.update({                                                                                         // 67
			_id: userId                                                                                                         // 67
		}, {                                                                                                                 // 67
			$addToSet: {                                                                                                        // 67
				organisation: orgId                                                                                                // 67
			}                                                                                                                   // 67
		});                                                                                                                  // 67
	},                                                                                                                    // 68
	'changeOrganisationLogoAlt': function (orgId, orgLogoAlt) {                                                           // 70
		return organisations.update({                                                                                        // 71
			_id: orgId                                                                                                          // 71
		}, {                                                                                                                 // 71
			$set: {                                                                                                             // 71
				logoAlt: orgLogoAlt                                                                                                // 71
			}                                                                                                                   // 71
		});                                                                                                                  // 71
	},                                                                                                                    // 72
	'getOrgIdByName': function (orgName) {                                                                                // 74
		return organisations.findOne({                                                                                       // 75
			"name": orgName                                                                                                     // 75
		})._id;                                                                                                              // 75
	}                                                                                                                     // 76
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"plan-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/plan-methods.js                                                                               //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
	// PACKAGES                                                                                                           // 3
	// Loops through packages returning html for template	                                                                // 4
	'methodPackagesCollection': function () {                                                                             // 5
		return payment_plans.find().fetch();                                                                                 // 6
	},                                                                                                                    // 7
	'methodSinglePackage': function (packageId) {                                                                         // 9
		return payment_plans.find({                                                                                          // 10
			planId: packageId                                                                                                   // 10
		}).fetch();                                                                                                          // 10
	},                                                                                                                    // 11
	"redeemVoucher": function (submittedCode) {                                                                           // 13
		var selectedVouchers = vouchers.find({                                                                               // 14
			code: submittedCode                                                                                                 // 14
		}).fetch();                                                                                                          // 14
		var usedVouchers = appliedVouchers.find({                                                                            // 15
			code: submittedCode                                                                                                 // 15
		}).fetch();                                                                                                          // 15
                                                                                                                       //
		if (selectedVouchers.length < 1) {                                                                                   // 17
			throw new Meteor.Error(500, 'Voucher not found or expired.');                                                       // 18
		} else {                                                                                                             // 19
			if (selectedVouchers[0].active === true) {                                                                          // 20
				if (selectedVouchers[0].uId != null && selectedVouchers[0].uId != Meteor.userId()) {                               // 22
					throw new Meteor.Error(500, 'Voucher not found or expired.');                                                     // 23
				} else {                                                                                                           // 24
					if (selectedVouchers.length === 1) {                                                                              // 25
						if (selectedVouchers[0].limitedUsage === true) {                                                                 // 27
							if (usedVouchers.length < selectedVouchers[0].usageAmount) {                                                    // 29
								return selectedVouchers;                                                                                       // 30
							} else {                                                                                                        // 31
								throw new Meteor.Error(500, 'Voucher not found or expired.');                                                  // 32
							}                                                                                                               // 33
						} else {                                                                                                         // 34
							return selectedVouchers;                                                                                        // 35
						}                                                                                                                // 36
					} else {                                                                                                          // 37
						throw new Meteor.Error(500, 'Voucher not found or expired.');                                                    // 38
					}                                                                                                                 // 39
				}                                                                                                                  // 40
			} else {                                                                                                            // 41
				throw new Meteor.Error(500, 'Voucher not found or expired.');                                                      // 42
			}                                                                                                                   // 43
		}                                                                                                                    // 44
	}                                                                                                                     // 45
});                                                                                                                    // 1
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"stripe-charge-NOT-IN-USE.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/stripe-charge-NOT-IN-USE.js                                                                   //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/**                                                                                                                    // 1
*   @method:    chargeCard                                                                                             //
*   @summary:   - This method process the stripe payment. On success updates account to include newly purchased time. 
*                                                                                                                      //
*                                                                                                                      //
*   @requires:  - stripeToken,cost,planType& planAmount - sent accross from client/system/subscriptionPayment/subscriptions.js              
*                                                                                                                      //
*   @returns:   True if user successfully added. False if an error occurs.                                             //
*                                                                                                                      //
*   @notes:   	For help contact Boundary Creative                                                                      //
*/Meteor.methods({/*                                                                                                   //
                  'chargeCard': function(stripeToken,cost,planType,planAmount,voucherArray) {                          //
                  	var testSecretKey =  Meteor.settings.private.testSecretKey;                                         //
                  var liveSecretKey =  Meteor.settings.private.liveSecretKey;	                                         //
                                                                                                                       //
                  if (cost > 0){                                                                                       //
                  var Stripe = StripeAPI(liveSecretKey);                                                               //
                     Stripe.charges.create({                                                                           //
                       amount: cost,                                                                                   //
                       currency: 'gbp',                                                                                //
                       source: stripeToken                                                                             //
                     },Meteor.bindEnvironment(function(err, charge) {                                                  //
                  	      if (err === null){                                                                            //
                  	  stripeLog.insert({ status : 'succeeded', data: charge });                                         //
                  	                                                                                                    //
                  	  Meteor.call('addTimeToAccount', planType,planAmount);                                             //
                  	                                                                                                    //
                  	  	if (voucherArray !== null){                                                                      //
                  	  		Meteor.call('registerVoucher', voucherArray);                                                   //
                  		}                                                                                                  //
                  	 return 'succeeded';	                                                                               //
                  	  		                                                                                                //
                       }else{                                                                                          //
                      	stripeLog.insert({ status : 'errors', data: err });                                             //
                      	var stripeOutput = $('.stripeOutput').html('<span class="error">Sorry there has been an error processing your card details. You have not been charged.</span>');	
                      	return 'error';                                                                                 //
                       }                                                                                               //
                     }));                                                                                              //
                                                                                                                       //
                                                                                                                       //
                  }                                                                                                    //
                                                                                                                       //
                  },                                                                                                   //
                                                                                                                       //
                  'processVoucher': function(cost,planType,planAmount,voucherArray) {                                  //
                  		Meteor.call('addTimeToAccount', planType,planAmount, voucherArray);                                //
                                                                                                                       //
                  if (voucherArray !== null){                                                                          //
                  	Meteor.call('registerVoucher', voucherArray);                                                       //
                  }                                                                                                    //
                  return true;                                                                                         //
                  },                                                                                                   //
                  	'addTimeToAccount': function(planType,planAmount){                                                  //
                  var uId = Meteor.userId();	                                                                          //
                                                                                                                       //
                  // if (planType ==="monthly"){                                                                       //
                  	// console.log('user'+ uId +'months: '+planAmount);                                                 //
                  	                                                                                                    //
                  	 if (planType === 'monthly'){                                                                       //
                  		                                                                                                   //
                  		// var dayWrapper = moment().add(planAmount,'months').calendar();                                  //
                  		// var expireDateNew = moment(dayWrapper).format("DD/MM/YYYY H:mm");                               //
                  		var currentDate = new Date();                                                                      //
                                var expireDateNew = new Date(currentDate.setTime( currentDate.getTime() + planAmount * 2629746000 ));
                  		                                                                                                   //
                  				                                                                                                 //
                  			                                                                                                  //
                  		Meteor.users.update({_id : uId}, {$set: { 'expiredSubscription': false,'expiry': expireDateNew,'authorisedCourses.journey2English' : true  } });
                                                                                                                       //
                  	 }                                                                                                  //
                  	 	                                                                                                  //
                  	 if (planType === 'daily' || planType === 'trial'){                                                 //
                  		                                                                                                   //
                  		// var dayWrapper = moment().add(planAmount,'days').calendar();                                    //
                  		// var expireDateNew = moment(dayWrapper).format("DD/MM/YYYY H:mm");                               //
                  		var currentDate = new Date();                                                                      //
                                var expireDateNew = new Date(currentDate.setTime( currentDate.getTime() + planAmount * 86400000 ));
                  		                                                                                                   //
                  		                                                                                                   //
                  		Meteor.users.update({_id : uId}, {$set: { 'expiredSubscription': false,'expiry': expireDateNew,'authorisedCourses.journey2English' : true  } });
                  	                                                                                                    //
                                                                                                                       //
                  	 }	                                                                                                 //
                  			 if (planType === 'Assessment'){                                                                  //
                  		                                                                                                   //
                  		// var dayWrapper = moment().add(planAmount,'days').calendar();                                    //
                  		// var expireDateNew = moment(dayWrapper).format("DD/MM/YYYY H:mm");                               //
                  		var currentDate = new Date();                                                                      //
                                var expireDateNew = new Date(currentDate.setTime( currentDate.getTime() +  86400000 ));
                  		                                                                                                   //
                  		                                                                                                   //
                  		Meteor.users.update({_id : uId}, {$set: { 'expiredSubscription': false,'expiry': expireDateNew  } });
                  	                                                                                                    //
                                                                                                                       //
                  	 }	                                                                                                 //
                   // }	                                                                                               //
                   return true;                                                                                        //
                  	},                                                                                                  //
                  	'registerVoucher': function(voucherArray){                                                          //
                  var datetime = moment().format("DD/MM/YYYY H:mm");                                                   //
                  var uId = Meteor.userId();	                                                                          //
                                                                                                                       //
                  // Register voucher as used                                                                          //
                  appliedVouchers.insert({ code : voucherArray[0].code, userId: uId, date: datetime  });               //
                                                                                                                       //
                  //Upgrade account if applicable                                                                      //
                  if (voucherArray[0].applyGroup != null && voucherArray[0].applyGroup.length > 1){                    //
                  	Meteor.users.update({_id : uId}, {$set: { 'roles': [voucherArray[0].applyGroup] } });               //
                  }                                                                                                    //
                  		if (voucherArray[0].applyOrgID != null && voucherArray[0].applyOrgID.length > 1){                  //
                  	Meteor.users.update({_id : uId}, {$set: { 'organisation': voucherArray[0].applyOrgID } });          //
                  }                                                                                                    //
                  		if (voucherArray[0].applyGroupID != null && voucherArray[0].applyGroupID.length > 1){              //
                  	Meteor.users.update({ _id : uId }, {$push : {groups : voucherArray[0].applyGroupID}});              //
                  	 // Meteor.users.update({_id : uId}, {$set: { 'groups': [voucherArray[0].applyGroupID] } });        //
                  	 var role = Meteor.users.findOne({_id : uId}).roles[0];                                             //
                  	 if(role == "tutor"){                                                                               //
                  	 	 groups.update({ _id : voucherArray[0].applyGroupID }, {$push : {tutors : uId}});                 //
                  	 } else {                                                                                           //
                  	 groups.update({ _id : voucherArray[0].applyGroupID }, {$push : {students : uId}});                 //
                  	}                                                                                                   //
                  }                                                                                                    //
                                                                                                                       //
                  		if (voucherArray[0].initialAssess === true ){                                                      //
                  	Meteor.call('assignNewAssessment', uId, voucher = true, function(err, result){                      //
                  		if(err){                                                                                           //
                  			console.log(err);                                                                                 //
                  		}                                                                                                  //
                  	});                                                                                                 //
                  }                                                                                                    //
                  		if (voucherArray[0].discountType === "trial"){                                                     //
                  	Meteor.users.update({_id : uId}, {$set: { 'authorisedCourses.journey2English': true  } });          //
                  }                                                                                                    //
                  return true;                                                                                         //
                  }*/});                                                                                               //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"user-account-methods.js":function(require,exports,module){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/user-account-methods.js                                                                       //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
    /**************************************                                                                            // 3
    *                                                                                                                  //
    *   User Account methods                                                                                           //
    *                                                                                                                  //
    ***************************************/'addTrailtoAccount': function (uId, expiry) {                              //
        var Trial = organisations.findOne({                                                                            // 11
            name: "Trial"                                                                                              // 11
        })._id;                                                                                                        // 11
                                                                                                                       //
        var Demo = groups.findOne({                                                                                    // 12
            name: "Demo"                                                                                               // 12
        })._id;                                                                                                        // 12
                                                                                                                       //
        Meteor.users.update({                                                                                          // 13
            _id: uId                                                                                                   // 13
        }, {                                                                                                           // 13
            $set: {                                                                                                    // 13
                'roles': ["tutor"],                                                                                    // 13
                'expiry': expiry,                                                                                      // 13
                'organisation': Trial,                                                                                 // 13
                groups: [Demo]                                                                                         // 13
            }                                                                                                          // 13
        });                                                                                                            // 13
        groups.update({                                                                                                // 14
            name: 'Demo'                                                                                               // 14
        }, {                                                                                                           // 14
            $push: {                                                                                                   // 14
                tutors: uId                                                                                            // 14
            }                                                                                                          // 14
        });                                                                                                            // 14
    },                                                                                                                 // 16
    /**                                                                                                                // 18
    *   @method:    createNewEnrollmentAccount                                                                         //
    *   @summary:   This method creates a new user and add the user to the system. An enrollment email is automatically
    *               sent to the provided email address. The user must follow the instructions in the enrollment email  //
    *               in order to verify their account and set their password.                                           //
    *   @requires:  Currently logged in user is admin                                                                  //
    *               Valid email address                                                                                //
    *                                                                                                                  //
    */'createNewEnrollmentAccount': function (aFirstname, aSurname, aUsername, aEmail, organisation, aAuthorised, aRole, aExpiry) {
        // Permission checks                                                                                           // 29
        if (Roles.userIsInRole(this.userId, 'admin')) {// ok                                                           // 30
        } else if (Roles.userIsInRole(this.userId, 'moderator')) {                                                     // 32
            if (aRole == "admin" || aRole == "moderator") {                                                            // 33
                throw new Meteor.Error('No permission to make such a user.');                                          // 34
            }                                                                                                          // 35
        } else if (Roles.userIsInRole(this.userId, 'tutor')) {                                                         // 36
            if (aRole == "admin" || aRole == "moderator" || aRole == "tutor") {                                        // 37
                throw new Meteor.Error('No permission to make such a user.');                                          // 38
            }                                                                                                          // 39
        } else if (Roles.userIsInRole(this.userId, 'student')) {                                                       // 40
            throw new Meteor.Error('No permission to make a new user as a student.');                                  // 41
        } else {                                                                                                       // 42
            throw new Meteor.Error('No permission to make a new user.');                                               // 43
        }                                                                                                              // 44
                                                                                                                       //
        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                            // 46
            var email = aEmail;                                                                                        // 47
            var profile = {                                                                                            // 48
                firstname: aFirstname,                                                                                 // 49
                surname: aSurname                                                                                      // 50
            };                                                                                                         // 48
            var org = organisation;                                                                                    // 52
            var role = aRole; // "admin", "tutor" or "student"                                                         // 53
                                                                                                                       //
            var username = aUsername;                                                                                  // 54
            var orgId;                                                                                                 // 55
            var authorisedCourses = {};                                                                                // 56
            var userId;                                                                                                // 57
            var messages = [];                                                                                         // 58
            var certificateEnabled = true;                                                                             // 59
            console.log(certificateEnabled);                                                                           // 60
                                                                                                                       //
            if (aExpiry == undefined || aExpiry == "") {                                                               // 62
                var expiry = undefined;                                                                                // 63
            } else {                                                                                                   // 64
                var currentDate = new Date();                                                                          // 65
                var expiry = new Date(currentDate.setTime(currentDate.getTime() + aExpiry * 86400000));                // 66
            }                                                                                                          // 67
                                                                                                                       //
            for (var i = 0; i < aAuthorised.length; i++) {                                                             // 69
                authorisedCourses[aAuthorised[i]] = true;                                                              // 70
            }                                                                                                          // 71
                                                                                                                       //
            if (!organisations.findOne({                                                                               // 73
                _id: org                                                                                               // 73
            })) {                                                                                                      // 73
                if (!organisations.findOne({                                                                           // 74
                    name: org                                                                                          // 74
                })) {                                                                                                  // 74
                    throw new Meteor.Error('Organisation ' + org + ' does not exist.');                                // 75
                } else {                                                                                               // 76
                    var orgDoc = organisations.findOne({                                                               // 77
                        name: org                                                                                      // 77
                    });                                                                                                // 77
                    orgId = orgDoc._id;                                                                                // 78
                }                                                                                                      // 79
            } else {                                                                                                   // 80
                orgId = org;                                                                                           // 81
            }                                                                                                          // 82
                                                                                                                       //
            console.log(certificateEnabled);                                                                           // 84
                                                                                                                       //
            if (isValidEmailAddress(email)) {                                                                          // 86
                // Uses the Accounts package to create the user and add the document to the 'user'                     // 87
                userId = Accounts.createUser({                                                                         // 88
                    email: email,                                                                                      // 89
                    username: username,                                                                                // 90
                    profile: profile,                                                                                  // 91
                    organisation: [orgId],                                                                             // 92
                    authorisedCourses: authorisedCourses,                                                              // 93
                    expiry: expiry,                                                                                    // 94
                    messages: messages,                                                                                // 95
                    certificateEnabled: certificateEnabled                                                             // 96
                });                                                                                                    // 88
                                                                                                                       //
                if (role === 'admin') {                                                                                // 98
                    Roles.addUsersToRoles(userId, role);                                                               // 99
                } else {                                                                                               // 100
                    Roles.addUsersToRoles(userId, role);                                                               // 101
                }                                                                                                      // 102
                                                                                                                       //
                Accounts.sendEnrollmentEmail(userId); // insert new document userProgress collection                   // 103
                                                                                                                       //
                createUserProgress(userId);                                                                            // 105
                                                                                                                       //
                if (aExpiry != undefined && aExpiry != "") {                                                           // 108
                    Meteor.call("durationLogEntry", userId, Meteor.userId(), "Account creation.", 0, aExpiry);         // 109
                }                                                                                                      // 110
            } else {                                                                                                   // 112
                return new Meteor.Error('Error: Invalid Email Address. Please provide an email with the format "joe@company.com"');
            }                                                                                                          // 114
                                                                                                                       //
            return userId;                                                                                             // 115
        }                                                                                                              // 116
    },                                                                                                                 // 118
    /**                                                                                                                // 120
    *   @method:    createNewPasswordAccount                                                                           //
    *   @summary:   - This method creates a new user and add the user to the system. The password is passed            //
    *               as an argument to this method and that password is set as the account password.                    //
    *               - If an email address is supplied the email is added to the user.                                  //
    *                                                                                                                  //
    *   @requires:  - Currently logged in user is admin                                                                //
    *               - Valid Organisation                                                                               //
    *                                                                                                                  //
    *   @returns:   True if user successfully added. False if an error occurs.                                         //
    *                                                                                                                  //
    *   @notes:   	Edited by Boundary Creative to add publicSignup option                                              //
    */ // This executes when using the /register form.                                                                 //
    'createNewPasswordAccount': function (newUserObj) {                                                                // 136
        // var newUserObj = {                                                                                          // 137
        //     newUserObj.fName: firstName,                                                                            // 138
        //     newUserObj.lName: lastName,                                                                             // 139
        //     newUserObj.userName: userEmail,                                                                         // 140
        //     newUserObj.email: userEmail,                                                                            // 141
        //     newUserObj.pass: userPassword,                                                                          // 142
        //     newUserObj.org: organisation,                                                                           // 143
        //     newUserObj.group: group,                                                                                // 144
        //     newUserObj.authorised: authorisedCourses,                                                               // 145
        //     newUserObj.role: role,                                                                                  // 146
        //     newUserObj.expiry: expiry,                                                                              // 147
        //     newUserObj.registration: registration,                                                                  // 148
        // };                                                                                                          // 149
        //aFirstname, aSurname, aUsername, aEmail, aPassword, organisation, aGroup, aAuthorised, aRole, aExpiry, registration
        // Permission checks                                                                                           // 152
        if (Roles.userIsInRole(this.userId, 'admin') || newUserObj.role === "publicSignup" || newUserObj.registration === true) {// ok
        } else if (Roles.userIsInRole(this.userId, 'moderator')) {                                                     // 155
            if (newUserObj.role == "admin" || newUserObj.role == "moderator") {                                        // 156
                throw new Meteor.Error('No permission to make such a user.');                                          // 157
            }                                                                                                          // 158
        } else if (Roles.userIsInRole(this.userId, 'tutor')) {                                                         // 159
            if (newUserObj.role == "admin" || newUserObj.role == "moderator" || newUserObj.role == "tutor") {          // 160
                throw new Meteor.Error('No permission to make such a user.');                                          // 161
            }                                                                                                          // 162
        } else if (Roles.userIsInRole(this.userId, 'student')) {                                                       // 163
            throw new Meteor.Error('No permission to make a new user as a student.');                                  // 164
        } else {                                                                                                       // 165
            throw new Meteor.Error('No permission to make a new user.');                                               // 166
        }                                                                                                              // 167
                                                                                                                       //
        if (Roles.userIsInRole(Meteor.userId(), 'admin') || newUserObj.role === "publicSignup" || newUserObj.registration === true) {
            var email = newUserObj.email;                                                                              // 170
            var profile = {                                                                                            // 171
                firstname: newUserObj.fName,                                                                           // 172
                surname: newUserObj.lName                                                                              // 173
            };                                                                                                         // 171
            var username = newUserObj.userName;                                                                        // 175
            var org = newUserObj.org[0];                                                                               // 176
            var groupId = newUserObj.group;                                                                            // 177
            var role = newUserObj.role; // "admin", "moderator", "tutor" or "student"                                  // 178
                                                                                                                       //
            if (role === "publicSignup") {                                                                             // 179
                role = "student";                                                                                      // 179
            }                                                                                                          // 179
                                                                                                                       //
            var userId = {};                                                                                           // 180
            var password = newUserObj.pass;                                                                            // 181
            var orgId;                                                                                                 // 182
            var authorisedCourses = {};                                                                                // 183
            var messages = [];                                                                                         // 184
                                                                                                                       //
            if (newUserObj.cert == 1) {                                                                                // 185
                var certificateEnabled = true;                                                                         // 186
            } else {                                                                                                   // 187
                var certificateEnabled = false;                                                                        // 188
            } //var confirmedEmail = false;                                                                            // 189
                                                                                                                       //
                                                                                                                       //
            if (newUserObj.expiry == undefined || newUserObj.expiry == "") {                                           // 193
                var expiry = undefined;                                                                                // 194
            } else {                                                                                                   // 195
                var currentDate = new Date();                                                                          // 196
                var expiry = new Date(currentDate.setTime(currentDate.getTime() + newUserObj.expiry * 86400000)); // newUserObj.expiry * 1 day (newUserObj.expiry is the number of days)
            }                                                                                                          // 198
                                                                                                                       //
            for (var i = 0; i < newUserObj.authorised.length; i++) {                                                   // 200
                authorisedCourses[newUserObj.authorised[i]] = true;                                                    // 201
            }                                                                                                          // 202
                                                                                                                       //
            if (!organisations.findOne({                                                                               // 204
                _id: org                                                                                               // 204
            })) {                                                                                                      // 204
                if (!organisations.findOne({                                                                           // 205
                    name: org                                                                                          // 205
                })) {                                                                                                  // 205
                    throw new Meteor.Error('Organisation ' + org + ' does not exist.');                                // 206
                } else {                                                                                               // 207
                    var orgDoc = organisations.findOne({                                                               // 208
                        name: org                                                                                      // 208
                    });                                                                                                // 208
                    orgId = orgDoc._id;                                                                                // 209
                }                                                                                                      // 210
            } else {                                                                                                   // 211
                orgId = org;                                                                                           // 212
            }                                                                                                          // 213
                                                                                                                       //
            if (isValidEmailAddress(email) || email.length == 0) {                                                     // 215
                userId = Accounts.createUser({                                                                         // 216
                    email: email,                                                                                      // 217
                    username: username,                                                                                // 218
                    profile: profile,                                                                                  // 219
                    organisation: [orgId],                                                                             // 220
                    authorisedCourses: authorisedCourses,                                                              // 221
                    password: password,                                                                                // 222
                    expiry: expiry,                                                                                    // 223
                    messages: messages,                                                                                // 224
                    certificateEnabled: certificateEnabled                                                             // 225
                });                                                                                                    // 216
                Roles.addUsersToRoles(userId, role);                                                                   // 228
                                                                                                                       //
                if (isValidEmailAddress(email)) {                                                                      // 229
                    Accounts.sendVerificationEmail(userId);                                                            // 230
                }                                                                                                      // 231
                                                                                                                       //
                createUserProgress(userId);                                                                            // 232
                                                                                                                       //
                if (groupId != null && groupId != 'undefined') {                                                       // 234
                    if (role == "tutor" || role == "admin" || role == "moderator") {                                   // 235
                        groups.update({                                                                                // 236
                            _id: groupId                                                                               // 236
                        }, {                                                                                           // 236
                            $push: {                                                                                   // 236
                                tutors: userId                                                                         // 236
                            }                                                                                          // 236
                        });                                                                                            // 236
                    } else {                                                                                           // 237
                        groups.update({                                                                                // 238
                            _id: groupId                                                                               // 238
                        }, {                                                                                           // 238
                            $push: {                                                                                   // 238
                                students: userId                                                                       // 238
                            }                                                                                          // 238
                        });                                                                                            // 238
                    }                                                                                                  // 239
                                                                                                                       //
                    Meteor.users.update({                                                                              // 241
                        _id: userId                                                                                    // 241
                    }, {                                                                                               // 241
                        $push: {                                                                                       // 241
                            groups: groupId                                                                            // 241
                        }                                                                                              // 241
                    });                                                                                                // 241
                }                                                                                                      // 242
            }                                                                                                          // 244
                                                                                                                       //
            if (newUserObj.expiry != undefined && newUserObj.expiry != "") {                                           // 246
                Meteor.call("durationLogEntry", userId, Meteor.userId(), "Account creation.", 0, newUserObj.expiry);   // 247
            }                                                                                                          // 248
                                                                                                                       //
            return userId;                                                                                             // 250
        }                                                                                                              // 251
    },                                                                                                                 // 253
    'setStartActivity': function (module, activity) {                                                                  // 255
        /* Checks copied from client-side (needed in both places) */var currentActivityDB = userProgress.findOne({     // 256
            userId: Meteor.userId()                                                                                    // 257
        }).modules[module - 1].activities[activity - 1];                                                               // 257
        var dateEndedField = currentActivityDB.dateEnded;                                                              // 258
                                                                                                                       //
        if (dateEndedField != null) {                                                                                  // 259
            return;                                                                                                    // 259
        } /* Check end */                                                                                              // 259
                                                                                                                       //
        console.log("setStartActivity");                                                                               // 262
        var obj = {};                                                                                                  // 264
        var dateSta = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.dateStarted';                    // 265
        var compl = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.completed';                        // 266
        var key_compl = currentActivityDB.completed;                                                                   // 267
                                                                                                                       //
        if (key_compl == false) {                                                                                      // 269
            obj[dateSta] = new Date();                                                                                 // 270
            userProgress.update({                                                                                      // 271
                userId: Meteor.userId()                                                                                // 271
            }, {                                                                                                       // 271
                $set: obj                                                                                              // 271
            });                                                                                                        // 271
            var obj2 = {};                                                                                             // 272
            obj2[compl] = "Started";                                                                                   // 273
            userProgress.update({                                                                                      // 274
                userId: Meteor.userId()                                                                                // 274
            }, {                                                                                                       // 274
                $set: obj2                                                                                             // 274
            });                                                                                                        // 274
        } else if (key_compl == "Paused") {                                                                            // 275
            // Resume button change                                                                                    // 277
            Meteor.call('setResumeActivity', module, activity);                                                        // 278
        }                                                                                                              // 279
    },                                                                                                                 // 280
    'setResumeActivity': function (module, activity) {                                                                 // 282
        /* Checks copied from client-side (needed in both places) */var currentActivityDB = userProgress.findOne({     // 283
            userId: Meteor.userId()                                                                                    // 284
        }).modules[module - 1].activities[activity - 1];                                                               // 284
        var dateStartedField = currentActivityDB.dateStarted;                                                          // 285
        var completedField = currentActivityDB.completed;                                                              // 286
                                                                                                                       //
        if (completedField != "Paused" || dateStartedField == null) {                                                  // 287
            //console.log('returning');                                                                                // 288
            return;                                                                                                    // 289
        } /* Check end */                                                                                              // 289
                                                                                                                       //
        console.log("setResumeActivity");                                                                              // 292
        var now = new Date();                                                                                          // 294
        var currActivityDB = userProgress.findOne({                                                                    // 295
            userId: Meteor.userId()                                                                                    // 295
        }).modules[module - 1].activities[activity - 1]; // var paused = currActivityDB.datePaused;                    // 295
        // var started = currActivityDB.dateStarted;                                                                   // 297
                                                                                                                       //
        var obj = {};                                                                                                  // 299
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.dateResumed';                        // 300
        obj[key] = now;                                                                                                // 301
        userProgress.update({                                                                                          // 302
            userId: Meteor.userId()                                                                                    // 302
        }, {                                                                                                           // 302
            $set: obj                                                                                                  // 302
        }); /* var obj = {};                                                                                           // 302
             var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.datePaused';                    //
             obj[key] = now;                                                                                           //
             userProgress.update({ userId: Meteor.userId() }, { $set: obj }); */                                       //
        var obj = {};                                                                                                  // 309
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.dateStarted'; //started = new Date(now - (paused - started));
                                                                                                                       //
        obj[key] = now;                                                                                                // 312
        userProgress.update({                                                                                          // 313
            userId: Meteor.userId()                                                                                    // 313
        }, {                                                                                                           // 313
            $set: obj                                                                                                  // 313
        });                                                                                                            // 313
        var obj = {};                                                                                                  // 315
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.completed';                          // 316
        obj[key] = "Resumed";                                                                                          // 317
        userProgress.update({                                                                                          // 318
            userId: Meteor.userId()                                                                                    // 318
        }, {                                                                                                           // 318
            $set: obj                                                                                                  // 318
        });                                                                                                            // 318
    },                                                                                                                 // 319
    'setPauseActivity': function (module, activity, user) {                                                            // 321
        console.log("setPauseActivity"); //console.log('PAUSING');                                                     // 322
        //Meteor.call("setLastActivity", user, module, activity);                                                      // 324
                                                                                                                       //
        if (user == null || user == undefined) {                                                                       // 326
            user = Meteor.userId();                                                                                    // 327
        } /* Checks copied from client-side (needed in both places) */                                                 // 328
                                                                                                                       //
        var currentActivityDB = userProgress.findOne({                                                                 // 331
            userId: user                                                                                               // 331
        }).modules[module - 1].activities[activity - 1];                                                               // 331
        var dateStartedField = currentActivityDB.dateStarted;                                                          // 332
        var dateEndedField = currentActivityDB.dateEnded;                                                              // 333
                                                                                                                       //
        if (dateStartedField == null || dateEndedField != null) {                                                      // 334
            return;                                                                                                    // 334
        } /* Check end */                                                                                              // 334
                                                                                                                       //
        var obj = {};                                                                                                  // 338
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.datePaused';                         // 339
                                                                                                                       //
        if (obj[key] == null) {                                                                                        // 340
            obj[key] = new Date();                                                                                     // 340
        }                                                                                                              // 340
                                                                                                                       //
        userProgress.update({                                                                                          // 341
            userId: user                                                                                               // 341
        }, {                                                                                                           // 341
            $set: obj                                                                                                  // 341
        });                                                                                                            // 341
        var obj = {};                                                                                                  // 343
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.completed';                          // 344
        obj[key] = "Paused";                                                                                           // 345
        userProgress.update({                                                                                          // 346
            userId: user                                                                                               // 346
        }, {                                                                                                           // 346
            $set: obj                                                                                                  // 346
        });                                                                                                            // 346
        var currentActivityDB = userProgress.findOne({                                                                 // 348
            userId: user                                                                                               // 348
        }).modules[module - 1].activities[activity - 1];                                                               // 348
        var dateSta = moment(currentActivityDB.dateStarted);                                                           // 349
        var datePau = moment(currentActivityDB.datePaused);                                                            // 350
        var dateRes = moment(currentActivityDB.dateResumed);                                                           // 351
        var timeTaken = currentActivityDB.timeTaken;                                                                   // 352
        var obj = {};                                                                                                  // 354
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.timeTaken'; /*if (timeTaken == null || timeTaken == undefined || timeTaken == NaN) {
                                                                                                  var time = 0;        //
                                                                                                  time = datePau - dateSta;
                                                                                              } else {                 //
                                                                                                  time = timeTaken;    //
                                                                                                  time += datePau - dateRes;
                                                                                              }*/                      //
        var time = 0;                                                                                                  // 365
        time = datePau - dateSta;                                                                                      // 366
        obj[key] = parseInt(time);                                                                                     // 368
        userProgress.update({                                                                                          // 369
            userId: user                                                                                               // 369
        }, {                                                                                                           // 369
            $set: obj                                                                                                  // 369
        });                                                                                                            // 369
    },                                                                                                                 // 370
    'setEndActivity': function (module, activity) {                                                                    // 372
        /* Checks copied from client-side (needed in both places) */var currentActivityDB = userProgress.findOne({     // 373
            userId: Meteor.userId()                                                                                    // 374
        }).modules[module - 1].activities[activity - 1];                                                               // 374
        var dateEndedField = currentActivityDB.dateEnded;                                                              // 375
                                                                                                                       //
        if (dateEndedField != null) {                                                                                  // 376
            return;                                                                                                    // 376
        } /* Check end */                                                                                              // 376
                                                                                                                       //
        console.log("setEndActivity");                                                                                 // 379
        var obj = {};                                                                                                  // 381
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.dateEnded';                          // 382
                                                                                                                       //
        if (obj[key] == null) {                                                                                        // 383
            obj[key] = new Date();                                                                                     // 383
        }                                                                                                              // 383
                                                                                                                       //
        userProgress.update({                                                                                          // 384
            userId: Meteor.userId()                                                                                    // 384
        }, {                                                                                                           // 384
            $set: obj                                                                                                  // 384
        });                                                                                                            // 384
        var currentActivityDB = userProgress.findOne({                                                                 // 386
            userId: Meteor.userId()                                                                                    // 386
        }).modules[module - 1].activities[activity - 1];                                                               // 386
        var dateRes_bare = currentActivityDB.dateResumed;                                                              // 388
        var dateSta = moment(currentActivityDB.dateStarted);                                                           // 389
        var dateEnd = moment(currentActivityDB.dateEnded);                                                             // 390
        var time = dateEnd - dateSta; /*if (dateRes_bare == null) {                                                    // 392
                                          time = dateEnd - dateSta;                                                    //
                                      } else {                                                                         //
                                          time = dateEnd - dateSta;                                                    //
                                      }*/                                                                              //
        var obj = {};                                                                                                  // 400
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.timeTaken';                          // 401
        obj[key] = parseInt(time);                                                                                     // 402
        userProgress.update({                                                                                          // 403
            userId: Meteor.userId()                                                                                    // 403
        }, {                                                                                                           // 403
            $set: obj                                                                                                  // 403
        });                                                                                                            // 403
        var obj = {};                                                                                                  // 405
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.latestSubpage';                      // 406
        obj[key] = null;                                                                                               // 407
        userProgress.update({                                                                                          // 408
            userId: Meteor.userId()                                                                                    // 408
        }, {                                                                                                           // 408
            $set: obj                                                                                                  // 408
        }); //Meteor.call("setLastActivity", Meteor.userId(), module, activity);                                       // 408
                                                                                                                       //
        Meteor.call('setCompletedActivity', module, activity);                                                         // 412
    },                                                                                                                 // 413
    'setLastActivity': function (uId, mod, activity) {                                                                 // 415
        var lastActivityStr = "m" + mod + "a" + activity;                                                              // 416
        userProgress.update({                                                                                          // 417
            userId: uId                                                                                                // 417
        }, {                                                                                                           // 417
            $set: {                                                                                                    // 417
                lastActivity: lastActivityStr                                                                          // 417
            }                                                                                                          // 417
        });                                                                                                            // 417
    },                                                                                                                 // 418
    'getLastActivity': function (uId) {                                                                                // 420
        var lastActivity = userProgress.findOne({                                                                      // 421
            userId: uId                                                                                                // 421
        }).lastActivity;                                                                                               // 421
                                                                                                                       //
        if (lastActivity == null || lastActivity == 'undefined' || lastActivity == "m10a29") {                         // 422
            return null;                                                                                               // 423
        } else {                                                                                                       // 424
            if (activityCompleted(lastActivity, uId)) {                                                                // 425
                return lastActivity = getNextActivity(lastActivity, uId); //return lastActivity = getNextActivity(lastActivity, uId);
            } else {                                                                                                   // 428
                return lastActivity;                                                                                   // 429
            }                                                                                                          // 430
        }                                                                                                              // 431
                                                                                                                       //
        return null;                                                                                                   // 432
    },                                                                                                                 // 433
    'setLatestSubpage': function (module, activity, subpage) {                                                         // 435
        var activityObj = userProgress.findOne({                                                                       // 436
            userId: Meteor.userId()                                                                                    // 436
        }).modules[module - 1].activities[activity - 1];                                                               // 436
                                                                                                                       //
        if ("latestSubpage" in activityObj) {                                                                          // 437
            var obj = {};                                                                                              // 438
            var subpageField = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.latestSubpage';         // 439
            obj[subpageField] = subpage;                                                                               // 440
            userProgress.update({                                                                                      // 441
                userId: Meteor.userId()                                                                                // 441
            }, {                                                                                                       // 441
                $set: obj                                                                                              // 441
            });                                                                                                        // 441
        }                                                                                                              // 442
    },                                                                                                                 // 443
    'setCompletedActivity': function (module, activity) {                                                              // 445
        console.log("setCompletedActivity");                                                                           // 446
        var obj = {};                                                                                                  // 448
        var key = 'modules.' + (module - 1) + '.activities.' + (activity - 1) + '.completed';                          // 449
        obj[key] = "Completed";                                                                                        // 450
        userProgress.update({                                                                                          // 451
            userId: Meteor.userId()                                                                                    // 451
        }, {                                                                                                           // 451
            $set: obj                                                                                                  // 451
        });                                                                                                            // 451
        var notificationModule = Meteor.users.findOne({                                                                // 454
            _id: Meteor.userId()                                                                                       // 454
        }).moduleFinishedNotification;                                                                                 // 454
                                                                                                                       //
        if (notificationModule != null && notificationModule != undefined) {                                           // 455
            notificationModule = notificationModule[module];                                                           // 456
        }                                                                                                              // 457
                                                                                                                       //
        if (checkCompletedGame(module) && checkModuleFinishedActivities(module) && notificationModule != 'Read' && notificationModule != 'ModalSeen') {
            setModuleCompletionField(module);                                                                          // 460
        }                                                                                                              // 461
                                                                                                                       //
        if (module <= 5) {                                                                                             // 463
            var unit = 1;                                                                                              // 464
        } else if (module > 5) {                                                                                       // 465
            var unit = 2;                                                                                              // 466
        }                                                                                                              // 467
                                                                                                                       //
        var feedbackForms = Meteor.users.findOne({                                                                     // 469
            _id: Meteor.userId()                                                                                       // 469
        }).unitFeedbackForms;                                                                                          // 469
                                                                                                                       //
        if (feedbackForms != null && feedbackForms != undefined) {                                                     // 470
            feedbackForms = feedbackForms[unit];                                                                       // 471
        }                                                                                                              // 472
                                                                                                                       //
        if (checkUnitCompleted(module) && feedbackForms != 'Ignored' && feedbackForms != 'Completed') {                // 473
            setUnitFeedbackFormStatus(unit);                                                                           // 474
        }                                                                                                              // 475
                                                                                                                       //
        checkTrophyCompletion(); //Check if the user progress matches a custom set percentage by an organisation, and if so, update the user's document to
        //set a flag which will then be used to show a custom message to congratulate them for the completion.         // 480
                                                                                                                       //
        var orgArray = Meteor.users.findOne({                                                                          // 481
            _id: Meteor.userId()                                                                                       // 481
        }).organisation; //By default the "main" organisation of users will be the 1st one, even though moderators should not access the course.
        //For other users, there is only 1 organisation anyway.                                                        // 483
                                                                                                                       //
        var org = orgArray[0];                                                                                         // 484
        var orgName = null;                                                                                            // 485
                                                                                                                       //
        if (org != null && org != 'undefined') {                                                                       // 486
            orgName = organisations.findOne({                                                                          // 487
                _id: org                                                                                               // 487
            }).name;                                                                                                   // 487
        } else {                                                                                                       // 488
            return null;                                                                                               // 489
        } //Need to calculate those 2 variables                                                                        // 490
                                                                                                                       //
                                                                                                                       //
        var progress = getPercentageComplete(Meteor.userId());                                                         // 493
        var timeSpent = getTimeTaken(Meteor.userId());                                                                 // 494
        var hoursSpent = timeSpent / 1000 / 60 / 60;                                                                   // 495
        var allGamesCompleted = checkAllCompletedGames();                                                              // 496
        var progressCompletion = checkProgressCompletion(progress, hoursSpent, orgName, allGamesCompleted);            // 497
                                                                                                                       //
        if (progressCompletion == "Full-Completion") {                                                                 // 498
            setUserProgressCompletionNotification();                                                                   // 499
        } else if (progressCompletion == "Half-Way-Completion") {                                                      // 500
            setUserProgressHalfCompletionNotification();                                                               // 501
        } else {//not achieved or other options                                                                        // 502
        }                                                                                                              // 504
                                                                                                                       //
        for (var i = 0; i < userProgress.findOne({                                                                     // 507
            userId: Meteor.userId()                                                                                    // 507
        }).modules[module - 1].activities.length; i++) {                                                               // 507
            if (userProgress.findOne({                                                                                 // 508
                userId: Meteor.userId()                                                                                // 508
            }).modules[module - 1].activities[i].completed != "Completed") {                                           // 508
                return;                                                                                                // 509
            }                                                                                                          // 510
        }                                                                                                              // 511
                                                                                                                       //
        Meteor.call('setFinishedModule', module);                                                                      // 513
    },                                                                                                                 // 514
    'setFinishedModule': function (module) {                                                                           // 516
        var obj = {};                                                                                                  // 517
        var key = 'modules.' + (module - 1) + '.finished';                                                             // 518
        obj[key] = true;                                                                                               // 519
        userProgress.update({                                                                                          // 520
            userId: Meteor.userId()                                                                                    // 520
        }, {                                                                                                           // 520
            $set: obj                                                                                                  // 520
        });                                                                                                            // 520
    },                                                                                                                 // 521
    'setGameAccess': function (uId, module_, score_, pass) {                                                           // 523
        var dateCompleted = new Date();                                                                                // 524
        return gameAccess.insert({                                                                                     // 525
            user: uId,                                                                                                 // 525
            module: module_,                                                                                           // 525
            score: score_,                                                                                             // 525
            date: dateCompleted,                                                                                       // 525
            passedTest: pass                                                                                           // 525
        });                                                                                                            // 525
    },                                                                                                                 // 526
    'editUserFirstname': function (aUser, aFirstname) {                                                                // 528
        // console.log("UPDATING user first name");                                                                    // 530
        // console.log(aUser);                                                                                         // 531
        // console.log(aFirstname);                                                                                    // 532
        if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Meteor.userId() == aUser) {
            Meteor.users.update({                                                                                      // 534
                _id: aUser                                                                                             // 534
            }, {                                                                                                       // 534
                $set: {                                                                                                // 534
                    'profile.firstname': aFirstname                                                                    // 534
                }                                                                                                      // 534
            });                                                                                                        // 534
        }                                                                                                              // 535
    },                                                                                                                 // 537
    'editUserSurname': function (aUser, aSurname) {                                                                    // 539
        if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Meteor.userId() == aUser) {
            Meteor.users.update({                                                                                      // 542
                _id: aUser                                                                                             // 542
            }, {                                                                                                       // 542
                $set: {                                                                                                // 542
                    'profile.surname': aSurname                                                                        // 542
                }                                                                                                      // 542
            });                                                                                                        // 542
        }                                                                                                              // 543
    },                                                                                                                 // 545
    'editUserEmail': function (aUser, aEmail) {                                                                        // 547
        if (Roles.userIsInRole(Meteor.userId(), 'admin') || Roles.userIsInRole(Meteor.userId(), 'moderator') || Meteor.userId() == aUser) {
            Meteor.users.update({                                                                                      // 550
                _id: aUser                                                                                             // 550
            }, {                                                                                                       // 550
                $set: {                                                                                                // 550
                    'emails.0.address': aEmail                                                                         // 550
                }                                                                                                      // 550
            });                                                                                                        // 550
        }                                                                                                              // 551
    },                                                                                                                 // 553
    'setRoleOnUser': function (options) {                                                                              // 555
        check(options, {                                                                                               // 556
            user: String,                                                                                              // 557
            role: String                                                                                               // 558
        });                                                                                                            // 556
                                                                                                                       //
        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                            // 560
            try {                                                                                                      // 561
                Roles.setUserRoles(options.user, [options.role]);                                                      // 562
            } catch (exception) {                                                                                      // 563
                return exception;                                                                                      // 564
            }                                                                                                          // 565
        }                                                                                                              // 566
    },                                                                                                                 // 567
    // Send User an Email to reset their password                                                                      // 569
    'sendResetPasswordEmail': function (userId) {                                                                      // 570
        if (Roles.userIsInRole(Meteor.userId(), 'admin') || Meteor.userId == userId) {                                 // 571
            return Accounts.sendResetPasswordEmail(userId);                                                            // 572
        } else {                                                                                                       // 573
            throw new Meteor.Error('Error! You are not an admin or this is not your account.');                        // 574
        }                                                                                                              // 575
    },                                                                                                                 // 576
    'addJ2ECourse': function (userId) {                                                                                // 578
        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                            // 579
            console.log('updating' + userId);                                                                          // 580
            Meteor.users.update({                                                                                      // 581
                _id: userId                                                                                            // 581
            }, {                                                                                                       // 581
                $set: {                                                                                                // 581
                    'authorisedCourses.journey2English': true                                                          // 581
                }                                                                                                      // 581
            });                                                                                                        // 581
        } else {                                                                                                       // 582
            throw new Meteor.Error('Error! You are not an admin or this is not your account.');                        // 583
        }                                                                                                              // 584
    },                                                                                                                 // 585
    'changePasswordAcc': function (oldPass, newPass) {                                                                 // 587
        //if (Roles.userIsInRole( Meteor.userId(), 'admin' )) {                                                        // 588
        Accounts.changePassword(oldPass, newPass); //} else {                                                          // 589
        //    throw new Meteor.Error('Error! You are not an admin or this is not your account.');                      // 591
        //}                                                                                                            // 592
    },                                                                                                                 // 593
    'changeToDefaultPassword': function (userId) {                                                                     // 595
        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                            // 596
            return Accounts.setPassword(userId, 'journey001');                                                         // 597
        } else {                                                                                                       // 598
            throw new Meteor.Error('Error! You are not an admin or this is not your account.');                        // 599
        }                                                                                                              // 600
    },                                                                                                                 // 601
    'parseUpload': function (data) {                                                                                   // 603
        for (var i = 0; i < data.length; i++) {                                                                        // 604
            var item = data[i];                                                                                        // 605
            var email = {};                                                                                            // 606
            var courses = [];                                                                                          // 607
            var userId;                                                                                                // 608
            var messages = [];                                                                                         // 609
                                                                                                                       //
            if (item.autoPassAssessment == true || item.role == 'admin' || item.role == 'moderator' || item.role == 'tutor') {
                courses.push('journey2English');                                                                       // 612
            }                                                                                                          // 613
                                                                                                                       //
            if (item.email) {                                                                                          // 615
                email = item.email;                                                                                    // 616
                                                                                                                       //
                if (item.password) {                                                                                   // 617
                    userId = Meteor.call('createNewPasswordAccount', item.firstname, item.surname, item.username, email, item.password, item.organisation, courses, item.role, item.expiry, false);
                } else {                                                                                               // 620
                    userId = Meteor.call('createNewEnrollmentAccount', item.firstname, item.surname, item.username, email, item.organisation, courses, item.role, item.expiry);
                }                                                                                                      // 622
            } else {                                                                                                   // 623
                userId = Meteor.call('createNewPasswordAccount', item.firstname, item.surname, item.username, email, item.password, item.organisation, courses, item.role, item.expiry, false);
            } // Assign the Assessment.                                                                                // 625
                                                                                                                       //
                                                                                                                       //
            if (item.role != 'admin' && item.role != 'moderator' && item.role != 'tutor') {                            // 628
                if (item.autoPassAssessment == false || item.autoPassAssessment == undefined) {                        // 629
                    Meteor.call('assignNewAssessment', userId);                                                        // 630
                }                                                                                                      // 631
            }                                                                                                          // 632
        }                                                                                                              // 633
    },                                                                                                                 // 634
    'removeUser': function (userId) {                                                                                  // 636
        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                            // 637
            if (Meteor.userId() == userId) {                                                                           // 638
                throw new Meteor.Error('You cannot delete yourself.');                                                 // 639
            }                                                                                                          // 640
                                                                                                                       //
            Meteor.users.remove({                                                                                      // 641
                _id: userId                                                                                            // 641
            });                                                                                                        // 641
            studentAssessments.remove({                                                                                // 642
                userId: userId                                                                                         // 642
            });                                                                                                        // 642
        }                                                                                                              // 643
    },                                                                                                                 // 644
    /**                                                                                                                // 646
     * Used for a % course completion for a certificate - uncomment if needed                                          //
     */ // 'setProgCompNotification': function(state){                                                                 //
    //     if(state != null && state != 'undefined'){                                                                  // 650
    //         var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: { 'progCompNotification': state } });
    //         return result;                                                                                          // 652
    //     } else {                                                                                                    // 653
    //         throw new Meteor.Error('Error! Invalid state for progress completion notification variable');           // 654
    //     }                                                                                                           // 655
    // },                                                                                                              // 656
    'setFeedbackFormStatus': function (unit, status) {                                                                 // 658
        if (status != null && status != 'undefined' && unit != null && unit != undefined) {                            // 659
            var obj = {};                                                                                              // 660
            var feedbackForms = Meteor.users.findOne({                                                                 // 662
                _id: Meteor.userId()                                                                                   // 662
            }).unitFeedbackForms;                                                                                      // 662
            if (feedbackForms != null && feedbackForms != undefined) obj = feedbackForms;                              // 663
            obj[unit] = status;                                                                                        // 666
            var result = Meteor.users.update({                                                                         // 667
                _id: Meteor.userId()                                                                                   // 667
            }, {                                                                                                       // 667
                $set: {                                                                                                // 667
                    'unitFeedbackForms': obj                                                                           // 667
                }                                                                                                      // 667
            });                                                                                                        // 667
            return result;                                                                                             // 668
        } else {                                                                                                       // 669
            throw new Meteor.Error('Error! Invalid status for unit completion notification variable');                 // 670
        }                                                                                                              // 671
    },                                                                                                                 // 672
    'setModuleProgress': function (module, state) {                                                                    // 674
        if (state != null && state != 'undefined' && module != null && module != undefined) {                          // 675
            var obj = {};                                                                                              // 676
            var modulesFinishedNotification = Meteor.users.findOne({                                                   // 678
                _id: Meteor.userId()                                                                                   // 678
            }).moduleFinishedNotification;                                                                             // 678
            if (modulesFinishedNotification != null && modulesFinishedNotification != undefined) obj = modulesFinishedNotification;
            obj[module] = state;                                                                                       // 682
            var result = Meteor.users.update({                                                                         // 683
                _id: Meteor.userId()                                                                                   // 683
            }, {                                                                                                       // 683
                $set: {                                                                                                // 683
                    'moduleFinishedNotification': obj                                                                  // 683
                }                                                                                                      // 683
            });                                                                                                        // 683
            return result;                                                                                             // 684
        } else {                                                                                                       // 685
            throw new Meteor.Error('Error! Invalid state for module completion notification variable');                // 686
        }                                                                                                              // 687
    },                                                                                                                 // 688
    'setTrophyProgress': function (trophyIndex, state) {                                                               // 690
        if (state != null && state != 'undefined' && trophyIndex != null && trophyIndex != undefined) {                // 691
            var obj = {};                                                                                              // 692
            var trophyAchieved = Meteor.users.findOne({                                                                // 694
                _id: Meteor.userId()                                                                                   // 694
            }).trophyAchieved;                                                                                         // 694
            if (trophyAchieved != null && trophyAchieved != undefined) obj = trophyAchieved;                           // 695
            obj[trophyIndex] = state;                                                                                  // 698
            var result = Meteor.users.update({                                                                         // 699
                _id: Meteor.userId()                                                                                   // 699
            }, {                                                                                                       // 699
                $set: {                                                                                                // 699
                    'trophyAchieved': obj                                                                              // 699
                }                                                                                                      // 699
            });                                                                                                        // 699
            return result;                                                                                             // 700
        } else {                                                                                                       // 701
            throw new Meteor.Error('Error! Invalid state for trophy achievement variable');                            // 702
        }                                                                                                              // 703
    },                                                                                                                 // 704
    'setCertificateNotification': function (state) {                                                                   // 706
        if (state != null && state != undefined) {                                                                     // 707
            var result = Meteor.users.update({                                                                         // 708
                _id: Meteor.userId()                                                                                   // 708
            }, {                                                                                                       // 708
                $set: {                                                                                                // 708
                    'certificateNotification': state                                                                   // 708
                }                                                                                                      // 708
            });                                                                                                        // 708
            return result;                                                                                             // 709
        } else {                                                                                                       // 710
            throw new Meteor.Error('Error! Invalid parameter for changing the certificate field for this account');    // 711
        }                                                                                                              // 712
    },                                                                                                                 // 713
    'setCertificateStatus': function (aUser, status) {                                                                 // 715
        if (aUser != null && aUser != undefined && status != null && status != undefined) {                            // 716
            if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                        // 717
                var result = Meteor.users.update({                                                                     // 718
                    _id: aUser                                                                                         // 718
                }, {                                                                                                   // 718
                    $set: {                                                                                            // 718
                        'certificateEnabled': status                                                                   // 718
                    }                                                                                                  // 718
                });                                                                                                    // 718
                return result;                                                                                         // 719
            }                                                                                                          // 720
        } else {                                                                                                       // 721
            throw new Meteor.Error('Error! Invalid parameters for setting the certificate status for this account');   // 722
        }                                                                                                              // 723
    },                                                                                                                 // 724
    'setCertificateDetails': function (details) {                                                                      // 726
        if (details != null && details != undefined) {                                                                 // 727
            var result = Meteor.users.update({                                                                         // 728
                _id: Meteor.userId()                                                                                   // 728
            }, {                                                                                                       // 728
                $set: {                                                                                                // 728
                    'certificateDetails': details                                                                      // 728
                }                                                                                                      // 728
            });                                                                                                        // 728
            return result;                                                                                             // 729
        } else {                                                                                                       // 730
            throw new Meteor.Error('Error! Invalid parameter for changing the certificate field for this account');    // 731
        }                                                                                                              // 732
    },                                                                                                                 // 733
    /**                                                                                                                // 736
    * Used for a certificate/non-certificate version of the course                                                     //
    * Uncomment if needed - not implemented fully yet                                                                  //
     * _id needs to be the id of the selected user, not the one currently logged-in - needs to be fixed if             //
     * the code is going to be used                                                                                    //
    */ // 'addCertificate': function(flag) {                                                                           //
    //     if(flag != null && flat != 'undefined') {                                                                   // 743
    //         var result = Meteor.users.update({ _id: Meteor.userId() }, { $set: { 'addedCertificate': flag } });     // 744
    //         return result;                                                                                          // 745
    //     } else {                                                                                                    // 746
    //         throw new Meteor.Error('Error! Invalid flag for adding a certificate for this account');                // 747
    //     }                                                                                                           // 748
    // },                                                                                                              // 749
    /*                                                                                                                 // 751
        creates and inserts a login token for the user with @param user_id                                             //
    */'create_token': function (user_id) {                                                                             //
        var stampedLoginToken = Accounts._generateStampedLoginToken();                                                 // 755
                                                                                                                       //
        Accounts._insertLoginToken(user_id, stampedLoginToken);                                                        // 756
                                                                                                                       //
        return stampedLoginToken;                                                                                      // 757
    },                                                                                                                 // 758
    /*                                                                                                                 // 760
        returns a user whose email is the same as @param email                                                         //
     */'getUserByEmail': function (email) {                                                                            //
        user = Accounts.findUserByEmail(email);                                                                        // 764
        return user;                                                                                                   // 765
    },                                                                                                                 // 766
    'authoriseCourse': function (userId, course) {                                                                     // 768
        var userDoc = Meteor.users.findOne({                                                                           // 769
            _id: userId                                                                                                // 769
        });                                                                                                            // 769
        var authorisedCourses = userDoc.authorisedCourses;                                                             // 770
        authorisedCourses[course] = true;                                                                              // 771
        Meteor.users.update({                                                                                          // 772
            _id: userId                                                                                                // 772
        }, {                                                                                                           // 772
            $set: {                                                                                                    // 772
                'authorisedCourses': authorisedCourses                                                                 // 772
            }                                                                                                          // 772
        });                                                                                                            // 772
    },                                                                                                                 // 773
    /**                                                                                                                // 774
    *   @method insertNewUserProgress                                                                                  //
    *   @summary This method create a new 'userProgress' document and inserts it into the database.                    //
    *           Each user has a reference to one userProgress entry. The entry references its user with the            //
    *           userId field.                                                                                          //
    *                                                                                                                  //
    *                                                                                                                  //
    */'insertNewUserProgress': function (aUser) {                                                                      //
        return userProgress.insert({                                                                                   // 783
            userId: aUser,                                                                                             // 784
            modules: [{                                                                                                // 785
                finished: false,                                                                                       // 787
                activities: [{                                                                                         // 788
                    completed: false,                                                                                  // 789
                    dateStarted: null,                                                                                 // 789
                    dateEnded: null,                                                                                   // 789
                    datePaused: null,                                                                                  // 789
                    dateResumed: null,                                                                                 // 789
                    timeTaken: null,                                                                                   // 789
                    latestSubpage: null                                                                                // 789
                }, {                                                                                                   // 789
                    completed: false,                                                                                  // 790
                    dateStarted: null,                                                                                 // 790
                    dateEnded: null,                                                                                   // 790
                    datePaused: null,                                                                                  // 790
                    dateResumed: null,                                                                                 // 790
                    timeTaken: null,                                                                                   // 790
                    latestSubpage: null                                                                                // 790
                }, {                                                                                                   // 790
                    completed: false,                                                                                  // 791
                    dateStarted: null,                                                                                 // 791
                    dateEnded: null,                                                                                   // 791
                    datePaused: null,                                                                                  // 791
                    dateResumed: null,                                                                                 // 791
                    timeTaken: null,                                                                                   // 791
                    latestSubpage: null                                                                                // 791
                }, {                                                                                                   // 791
                    completed: false,                                                                                  // 792
                    dateStarted: null,                                                                                 // 792
                    dateEnded: null,                                                                                   // 792
                    datePaused: null,                                                                                  // 792
                    dateResumed: null,                                                                                 // 792
                    timeTaken: null,                                                                                   // 792
                    latestSubpage: null                                                                                // 792
                }, {                                                                                                   // 792
                    completed: false,                                                                                  // 793
                    dateStarted: null,                                                                                 // 793
                    dateEnded: null,                                                                                   // 793
                    datePaused: null,                                                                                  // 793
                    dateResumed: null,                                                                                 // 793
                    timeTaken: null,                                                                                   // 793
                    latestSubpage: null                                                                                // 793
                }, {                                                                                                   // 793
                    completed: false,                                                                                  // 794
                    dateStarted: null,                                                                                 // 794
                    dateEnded: null,                                                                                   // 794
                    datePaused: null,                                                                                  // 794
                    dateResumed: null,                                                                                 // 794
                    timeTaken: null,                                                                                   // 794
                    latestSubpage: null                                                                                // 794
                }, {                                                                                                   // 794
                    completed: false,                                                                                  // 795
                    dateStarted: null,                                                                                 // 795
                    dateEnded: null,                                                                                   // 795
                    datePaused: null,                                                                                  // 795
                    dateResumed: null,                                                                                 // 795
                    timeTaken: null,                                                                                   // 795
                    latestSubpage: null                                                                                // 795
                }, {                                                                                                   // 795
                    completed: false,                                                                                  // 796
                    dateStarted: null,                                                                                 // 796
                    dateEnded: null,                                                                                   // 796
                    datePaused: null,                                                                                  // 796
                    dateResumed: null,                                                                                 // 796
                    timeTaken: null,                                                                                   // 796
                    latestSubpage: null                                                                                // 796
                }, {                                                                                                   // 796
                    completed: false,                                                                                  // 797
                    dateStarted: null,                                                                                 // 797
                    dateEnded: null,                                                                                   // 797
                    datePaused: null,                                                                                  // 797
                    dateResumed: null,                                                                                 // 797
                    timeTaken: null,                                                                                   // 797
                    latestSubpage: null                                                                                // 797
                }, {                                                                                                   // 797
                    completed: false,                                                                                  // 798
                    dateStarted: null,                                                                                 // 798
                    dateEnded: null,                                                                                   // 798
                    datePaused: null,                                                                                  // 798
                    dateResumed: null,                                                                                 // 798
                    timeTaken: null,                                                                                   // 798
                    latestSubpage: null                                                                                // 798
                }, {                                                                                                   // 798
                    completed: false,                                                                                  // 799
                    dateStarted: null,                                                                                 // 799
                    dateEnded: null,                                                                                   // 799
                    datePaused: null,                                                                                  // 799
                    dateResumed: null,                                                                                 // 799
                    timeTaken: null,                                                                                   // 799
                    latestSubpage: null                                                                                // 799
                }, {                                                                                                   // 799
                    completed: false,                                                                                  // 800
                    dateStarted: null,                                                                                 // 800
                    dateEnded: null,                                                                                   // 800
                    datePaused: null,                                                                                  // 800
                    dateResumed: null,                                                                                 // 800
                    timeTaken: null,                                                                                   // 800
                    latestSubpage: null                                                                                // 800
                }, {                                                                                                   // 800
                    completed: false,                                                                                  // 801
                    dateStarted: null,                                                                                 // 801
                    dateEnded: null,                                                                                   // 801
                    datePaused: null,                                                                                  // 801
                    dateResumed: null,                                                                                 // 801
                    timeTaken: null,                                                                                   // 801
                    latestSubpage: null                                                                                // 801
                }, {                                                                                                   // 801
                    completed: false,                                                                                  // 802
                    dateStarted: null,                                                                                 // 802
                    dateEnded: null,                                                                                   // 802
                    datePaused: null,                                                                                  // 802
                    dateResumed: null,                                                                                 // 802
                    timeTaken: null,                                                                                   // 802
                    latestSubpage: null                                                                                // 802
                }, {                                                                                                   // 802
                    completed: false,                                                                                  // 803
                    dateStarted: null,                                                                                 // 803
                    dateEnded: null,                                                                                   // 803
                    datePaused: null,                                                                                  // 803
                    dateResumed: null,                                                                                 // 803
                    timeTaken: null,                                                                                   // 803
                    latestSubpage: null                                                                                // 803
                }, {                                                                                                   // 803
                    completed: false,                                                                                  // 804
                    dateStarted: null,                                                                                 // 804
                    dateEnded: null,                                                                                   // 804
                    datePaused: null,                                                                                  // 804
                    dateResumed: null,                                                                                 // 804
                    timeTaken: null,                                                                                   // 804
                    latestSubpage: null                                                                                // 804
                }, {                                                                                                   // 804
                    completed: false,                                                                                  // 805
                    dateStarted: null,                                                                                 // 805
                    dateEnded: null,                                                                                   // 805
                    datePaused: null,                                                                                  // 805
                    dateResumed: null,                                                                                 // 805
                    timeTaken: null,                                                                                   // 805
                    latestSubpage: null                                                                                // 805
                }, {                                                                                                   // 805
                    completed: false,                                                                                  // 806
                    dateStarted: null,                                                                                 // 806
                    dateEnded: null,                                                                                   // 806
                    datePaused: null,                                                                                  // 806
                    dateResumed: null,                                                                                 // 806
                    timeTaken: null,                                                                                   // 806
                    latestSubpage: null                                                                                // 806
                }, {                                                                                                   // 806
                    completed: false,                                                                                  // 807
                    dateStarted: null,                                                                                 // 807
                    dateEnded: null,                                                                                   // 807
                    datePaused: null,                                                                                  // 807
                    dateResumed: null,                                                                                 // 807
                    timeTaken: null,                                                                                   // 807
                    latestSubpage: null                                                                                // 807
                }, {                                                                                                   // 807
                    completed: false,                                                                                  // 808
                    dateStarted: null,                                                                                 // 808
                    dateEnded: null,                                                                                   // 808
                    datePaused: null,                                                                                  // 808
                    dateResumed: null,                                                                                 // 808
                    timeTaken: null,                                                                                   // 808
                    latestSubpage: null                                                                                // 808
                }, {                                                                                                   // 808
                    completed: false,                                                                                  // 809
                    dateStarted: null,                                                                                 // 809
                    dateEnded: null,                                                                                   // 809
                    datePaused: null,                                                                                  // 809
                    dateResumed: null,                                                                                 // 809
                    timeTaken: null,                                                                                   // 809
                    latestSubpage: null                                                                                // 809
                }, {                                                                                                   // 809
                    completed: false,                                                                                  // 810
                    dateStarted: null,                                                                                 // 810
                    dateEnded: null,                                                                                   // 810
                    datePaused: null,                                                                                  // 810
                    dateResumed: null,                                                                                 // 810
                    timeTaken: null,                                                                                   // 810
                    latestSubpage: null                                                                                // 810
                }, {                                                                                                   // 810
                    completed: false,                                                                                  // 811
                    dateStarted: null,                                                                                 // 811
                    dateEnded: null,                                                                                   // 811
                    datePaused: null,                                                                                  // 811
                    dateResumed: null,                                                                                 // 811
                    timeTaken: null,                                                                                   // 811
                    latestSubpage: null                                                                                // 811
                }, {                                                                                                   // 811
                    completed: false,                                                                                  // 812
                    dateStarted: null,                                                                                 // 812
                    dateEnded: null,                                                                                   // 812
                    datePaused: null,                                                                                  // 812
                    dateResumed: null,                                                                                 // 812
                    timeTaken: null,                                                                                   // 812
                    latestSubpage: null                                                                                // 812
                }, {                                                                                                   // 812
                    completed: false,                                                                                  // 813
                    dateStarted: null,                                                                                 // 813
                    dateEnded: null,                                                                                   // 813
                    datePaused: null,                                                                                  // 813
                    dateResumed: null,                                                                                 // 813
                    timeTaken: null,                                                                                   // 813
                    latestSubpage: null                                                                                // 813
                }, {                                                                                                   // 813
                    completed: false,                                                                                  // 814
                    dateStarted: null,                                                                                 // 814
                    dateEnded: null,                                                                                   // 814
                    datePaused: null,                                                                                  // 814
                    dateResumed: null,                                                                                 // 814
                    timeTaken: null,                                                                                   // 814
                    latestSubpage: null                                                                                // 814
                }, {                                                                                                   // 814
                    completed: false,                                                                                  // 815
                    dateStarted: null,                                                                                 // 815
                    dateEnded: null,                                                                                   // 815
                    datePaused: null,                                                                                  // 815
                    dateResumed: null,                                                                                 // 815
                    timeTaken: null,                                                                                   // 815
                    latestSubpage: null                                                                                // 815
                }, {                                                                                                   // 815
                    completed: false,                                                                                  // 816
                    dateStarted: null,                                                                                 // 816
                    dateEnded: null,                                                                                   // 816
                    datePaused: null,                                                                                  // 816
                    dateResumed: null,                                                                                 // 816
                    timeTaken: null,                                                                                   // 816
                    latestSubpage: null                                                                                // 816
                }],                                                                                                    // 816
                timeCompleted: {},                                                                                     // 818
                timeStarted: {}                                                                                        // 819
            }, {                                                                                                       // 786
                finished: false,                                                                                       // 823
                activities: [{                                                                                         // 824
                    completed: false,                                                                                  // 825
                    dateStarted: null,                                                                                 // 825
                    dateEnded: null,                                                                                   // 825
                    datePaused: null,                                                                                  // 825
                    dateResumed: null,                                                                                 // 825
                    timeTaken: null,                                                                                   // 825
                    latestSubpage: null                                                                                // 825
                }, {                                                                                                   // 825
                    completed: false,                                                                                  // 826
                    dateStarted: null,                                                                                 // 826
                    dateEnded: null,                                                                                   // 826
                    datePaused: null,                                                                                  // 826
                    dateResumed: null,                                                                                 // 826
                    timeTaken: null,                                                                                   // 826
                    latestSubpage: null                                                                                // 826
                }, {                                                                                                   // 826
                    completed: false,                                                                                  // 827
                    dateStarted: null,                                                                                 // 827
                    dateEnded: null,                                                                                   // 827
                    datePaused: null,                                                                                  // 827
                    dateResumed: null,                                                                                 // 827
                    timeTaken: null,                                                                                   // 827
                    latestSubpage: null                                                                                // 827
                }, {                                                                                                   // 827
                    completed: false,                                                                                  // 828
                    dateStarted: null,                                                                                 // 828
                    dateEnded: null,                                                                                   // 828
                    datePaused: null,                                                                                  // 828
                    dateResumed: null,                                                                                 // 828
                    timeTaken: null,                                                                                   // 828
                    latestSubpage: null                                                                                // 828
                }, {                                                                                                   // 828
                    completed: false,                                                                                  // 829
                    dateStarted: null,                                                                                 // 829
                    dateEnded: null,                                                                                   // 829
                    datePaused: null,                                                                                  // 829
                    dateResumed: null,                                                                                 // 829
                    timeTaken: null,                                                                                   // 829
                    latestSubpage: null                                                                                // 829
                }, {                                                                                                   // 829
                    completed: false,                                                                                  // 830
                    dateStarted: null,                                                                                 // 830
                    dateEnded: null,                                                                                   // 830
                    datePaused: null,                                                                                  // 830
                    dateResumed: null,                                                                                 // 830
                    timeTaken: null,                                                                                   // 830
                    latestSubpage: null                                                                                // 830
                }, {                                                                                                   // 830
                    completed: false,                                                                                  // 831
                    dateStarted: null,                                                                                 // 831
                    dateEnded: null,                                                                                   // 831
                    datePaused: null,                                                                                  // 831
                    dateResumed: null,                                                                                 // 831
                    timeTaken: null,                                                                                   // 831
                    latestSubpage: null                                                                                // 831
                }, {                                                                                                   // 831
                    completed: false,                                                                                  // 832
                    dateStarted: null,                                                                                 // 832
                    dateEnded: null,                                                                                   // 832
                    datePaused: null,                                                                                  // 832
                    dateResumed: null,                                                                                 // 832
                    timeTaken: null,                                                                                   // 832
                    latestSubpage: null                                                                                // 832
                }, {                                                                                                   // 832
                    completed: false,                                                                                  // 833
                    dateStarted: null,                                                                                 // 833
                    dateEnded: null,                                                                                   // 833
                    datePaused: null,                                                                                  // 833
                    dateResumed: null,                                                                                 // 833
                    timeTaken: null,                                                                                   // 833
                    latestSubpage: null                                                                                // 833
                }, {                                                                                                   // 833
                    completed: false,                                                                                  // 834
                    dateStarted: null,                                                                                 // 834
                    dateEnded: null,                                                                                   // 834
                    datePaused: null,                                                                                  // 834
                    dateResumed: null,                                                                                 // 834
                    timeTaken: null,                                                                                   // 834
                    latestSubpage: null                                                                                // 834
                }, {                                                                                                   // 834
                    completed: false,                                                                                  // 835
                    dateStarted: null,                                                                                 // 835
                    dateEnded: null,                                                                                   // 835
                    datePaused: null,                                                                                  // 835
                    dateResumed: null,                                                                                 // 835
                    timeTaken: null,                                                                                   // 835
                    latestSubpage: null                                                                                // 835
                }, {                                                                                                   // 835
                    completed: false,                                                                                  // 836
                    dateStarted: null,                                                                                 // 836
                    dateEnded: null,                                                                                   // 836
                    datePaused: null,                                                                                  // 836
                    dateResumed: null,                                                                                 // 836
                    timeTaken: null,                                                                                   // 836
                    latestSubpage: null                                                                                // 836
                }, {                                                                                                   // 836
                    completed: false,                                                                                  // 837
                    dateStarted: null,                                                                                 // 837
                    dateEnded: null,                                                                                   // 837
                    datePaused: null,                                                                                  // 837
                    dateResumed: null,                                                                                 // 837
                    timeTaken: null,                                                                                   // 837
                    latestSubpage: null                                                                                // 837
                }, {                                                                                                   // 837
                    completed: false,                                                                                  // 838
                    dateStarted: null,                                                                                 // 838
                    dateEnded: null,                                                                                   // 838
                    datePaused: null,                                                                                  // 838
                    dateResumed: null,                                                                                 // 838
                    timeTaken: null,                                                                                   // 838
                    latestSubpage: null                                                                                // 838
                }, {                                                                                                   // 838
                    completed: false,                                                                                  // 839
                    dateStarted: null,                                                                                 // 839
                    dateEnded: null,                                                                                   // 839
                    datePaused: null,                                                                                  // 839
                    dateResumed: null,                                                                                 // 839
                    timeTaken: null,                                                                                   // 839
                    latestSubpage: null                                                                                // 839
                }, {                                                                                                   // 839
                    completed: false,                                                                                  // 840
                    dateStarted: null,                                                                                 // 840
                    dateEnded: null,                                                                                   // 840
                    datePaused: null,                                                                                  // 840
                    dateResumed: null,                                                                                 // 840
                    timeTaken: null,                                                                                   // 840
                    latestSubpage: null                                                                                // 840
                }, {                                                                                                   // 840
                    completed: false,                                                                                  // 841
                    dateStarted: null,                                                                                 // 841
                    dateEnded: null,                                                                                   // 841
                    datePaused: null,                                                                                  // 841
                    dateResumed: null,                                                                                 // 841
                    timeTaken: null,                                                                                   // 841
                    latestSubpage: null                                                                                // 841
                }, {                                                                                                   // 841
                    completed: false,                                                                                  // 842
                    dateStarted: null,                                                                                 // 842
                    dateEnded: null,                                                                                   // 842
                    datePaused: null,                                                                                  // 842
                    dateResumed: null,                                                                                 // 842
                    timeTaken: null,                                                                                   // 842
                    latestSubpage: null                                                                                // 842
                }, {                                                                                                   // 842
                    completed: false,                                                                                  // 843
                    dateStarted: null,                                                                                 // 843
                    dateEnded: null,                                                                                   // 843
                    datePaused: null,                                                                                  // 843
                    dateResumed: null,                                                                                 // 843
                    timeTaken: null,                                                                                   // 843
                    latestSubpage: null                                                                                // 843
                }, {                                                                                                   // 843
                    completed: false,                                                                                  // 844
                    dateStarted: null,                                                                                 // 844
                    dateEnded: null,                                                                                   // 844
                    datePaused: null,                                                                                  // 844
                    dateResumed: null,                                                                                 // 844
                    timeTaken: null,                                                                                   // 844
                    latestSubpage: null                                                                                // 844
                }, {                                                                                                   // 844
                    completed: false,                                                                                  // 845
                    dateStarted: null,                                                                                 // 845
                    dateEnded: null,                                                                                   // 845
                    datePaused: null,                                                                                  // 845
                    dateResumed: null,                                                                                 // 845
                    timeTaken: null,                                                                                   // 845
                    latestSubpage: null                                                                                // 845
                }, {                                                                                                   // 845
                    completed: false,                                                                                  // 846
                    dateStarted: null,                                                                                 // 846
                    dateEnded: null,                                                                                   // 846
                    datePaused: null,                                                                                  // 846
                    dateResumed: null,                                                                                 // 846
                    timeTaken: null,                                                                                   // 846
                    latestSubpage: null                                                                                // 846
                }, {                                                                                                   // 846
                    completed: false,                                                                                  // 847
                    dateStarted: null,                                                                                 // 847
                    dateEnded: null,                                                                                   // 847
                    datePaused: null,                                                                                  // 847
                    dateResumed: null,                                                                                 // 847
                    timeTaken: null,                                                                                   // 847
                    latestSubpage: null                                                                                // 847
                }, {                                                                                                   // 847
                    completed: false,                                                                                  // 848
                    dateStarted: null,                                                                                 // 848
                    dateEnded: null,                                                                                   // 848
                    datePaused: null,                                                                                  // 848
                    dateResumed: null,                                                                                 // 848
                    timeTaken: null,                                                                                   // 848
                    latestSubpage: null                                                                                // 848
                }, {                                                                                                   // 848
                    completed: false,                                                                                  // 849
                    dateStarted: null,                                                                                 // 849
                    dateEnded: null,                                                                                   // 849
                    datePaused: null,                                                                                  // 849
                    dateResumed: null,                                                                                 // 849
                    timeTaken: null,                                                                                   // 849
                    latestSubpage: null                                                                                // 849
                }, {                                                                                                   // 849
                    completed: false,                                                                                  // 850
                    dateStarted: null,                                                                                 // 850
                    dateEnded: null,                                                                                   // 850
                    datePaused: null,                                                                                  // 850
                    dateResumed: null,                                                                                 // 850
                    timeTaken: null,                                                                                   // 850
                    latestSubpage: null                                                                                // 850
                }, {                                                                                                   // 850
                    completed: false,                                                                                  // 851
                    dateStarted: null,                                                                                 // 851
                    dateEnded: null,                                                                                   // 851
                    datePaused: null,                                                                                  // 851
                    dateResumed: null,                                                                                 // 851
                    timeTaken: null,                                                                                   // 851
                    latestSubpage: null                                                                                // 851
                }, {                                                                                                   // 851
                    completed: false,                                                                                  // 852
                    dateStarted: null,                                                                                 // 852
                    dateEnded: null,                                                                                   // 852
                    datePaused: null,                                                                                  // 852
                    dateResumed: null,                                                                                 // 852
                    timeTaken: null,                                                                                   // 852
                    latestSubpage: null                                                                                // 852
                }, {                                                                                                   // 852
                    completed: false,                                                                                  // 853
                    dateStarted: null,                                                                                 // 853
                    dateEnded: null,                                                                                   // 853
                    datePaused: null,                                                                                  // 853
                    dateResumed: null,                                                                                 // 853
                    timeTaken: null,                                                                                   // 853
                    latestSubpage: null                                                                                // 853
                }],                                                                                                    // 853
                timeCompleted: {},                                                                                     // 856
                timeStarted: {}                                                                                        // 857
            }, {                                                                                                       // 822
                finished: false,                                                                                       // 861
                activities: [{                                                                                         // 862
                    completed: false,                                                                                  // 863
                    dateStarted: null,                                                                                 // 863
                    dateEnded: null,                                                                                   // 863
                    datePaused: null,                                                                                  // 863
                    dateResumed: null,                                                                                 // 863
                    timeTaken: null,                                                                                   // 863
                    latestSubpage: null                                                                                // 863
                }, {                                                                                                   // 863
                    completed: false,                                                                                  // 864
                    dateStarted: null,                                                                                 // 864
                    dateEnded: null,                                                                                   // 864
                    datePaused: null,                                                                                  // 864
                    dateResumed: null,                                                                                 // 864
                    timeTaken: null,                                                                                   // 864
                    latestSubpage: null                                                                                // 864
                }, {                                                                                                   // 864
                    completed: false,                                                                                  // 865
                    dateStarted: null,                                                                                 // 865
                    dateEnded: null,                                                                                   // 865
                    datePaused: null,                                                                                  // 865
                    dateResumed: null,                                                                                 // 865
                    timeTaken: null,                                                                                   // 865
                    latestSubpage: null                                                                                // 865
                }, {                                                                                                   // 865
                    completed: false,                                                                                  // 866
                    dateStarted: null,                                                                                 // 866
                    dateEnded: null,                                                                                   // 866
                    datePaused: null,                                                                                  // 866
                    dateResumed: null,                                                                                 // 866
                    timeTaken: null,                                                                                   // 866
                    latestSubpage: null                                                                                // 866
                }, {                                                                                                   // 866
                    completed: false,                                                                                  // 867
                    dateStarted: null,                                                                                 // 867
                    dateEnded: null,                                                                                   // 867
                    datePaused: null,                                                                                  // 867
                    dateResumed: null,                                                                                 // 867
                    timeTaken: null,                                                                                   // 867
                    latestSubpage: null                                                                                // 867
                }, {                                                                                                   // 867
                    completed: false,                                                                                  // 868
                    dateStarted: null,                                                                                 // 868
                    dateEnded: null,                                                                                   // 868
                    datePaused: null,                                                                                  // 868
                    dateResumed: null,                                                                                 // 868
                    timeTaken: null,                                                                                   // 868
                    latestSubpage: null                                                                                // 868
                }, {                                                                                                   // 868
                    completed: false,                                                                                  // 869
                    dateStarted: null,                                                                                 // 869
                    dateEnded: null,                                                                                   // 869
                    datePaused: null,                                                                                  // 869
                    dateResumed: null,                                                                                 // 869
                    timeTaken: null,                                                                                   // 869
                    latestSubpage: null                                                                                // 869
                }, {                                                                                                   // 869
                    completed: false,                                                                                  // 870
                    dateStarted: null,                                                                                 // 870
                    dateEnded: null,                                                                                   // 870
                    datePaused: null,                                                                                  // 870
                    dateResumed: null,                                                                                 // 870
                    timeTaken: null,                                                                                   // 870
                    latestSubpage: null                                                                                // 870
                }, {                                                                                                   // 870
                    completed: false,                                                                                  // 871
                    dateStarted: null,                                                                                 // 871
                    dateEnded: null,                                                                                   // 871
                    datePaused: null,                                                                                  // 871
                    dateResumed: null,                                                                                 // 871
                    timeTaken: null,                                                                                   // 871
                    latestSubpage: null                                                                                // 871
                }, {                                                                                                   // 871
                    completed: false,                                                                                  // 872
                    dateStarted: null,                                                                                 // 872
                    dateEnded: null,                                                                                   // 872
                    datePaused: null,                                                                                  // 872
                    dateResumed: null,                                                                                 // 872
                    timeTaken: null,                                                                                   // 872
                    latestSubpage: null                                                                                // 872
                }, {                                                                                                   // 872
                    completed: false,                                                                                  // 873
                    dateStarted: null,                                                                                 // 873
                    dateEnded: null,                                                                                   // 873
                    datePaused: null,                                                                                  // 873
                    dateResumed: null,                                                                                 // 873
                    timeTaken: null,                                                                                   // 873
                    latestSubpage: null                                                                                // 873
                }, {                                                                                                   // 873
                    completed: false,                                                                                  // 874
                    dateStarted: null,                                                                                 // 874
                    dateEnded: null,                                                                                   // 874
                    datePaused: null,                                                                                  // 874
                    dateResumed: null,                                                                                 // 874
                    timeTaken: null,                                                                                   // 874
                    latestSubpage: null                                                                                // 874
                }, {                                                                                                   // 874
                    completed: false,                                                                                  // 875
                    dateStarted: null,                                                                                 // 875
                    dateEnded: null,                                                                                   // 875
                    datePaused: null,                                                                                  // 875
                    dateResumed: null,                                                                                 // 875
                    timeTaken: null,                                                                                   // 875
                    latestSubpage: null                                                                                // 875
                }, {                                                                                                   // 875
                    completed: false,                                                                                  // 876
                    dateStarted: null,                                                                                 // 876
                    dateEnded: null,                                                                                   // 876
                    datePaused: null,                                                                                  // 876
                    dateResumed: null,                                                                                 // 876
                    timeTaken: null,                                                                                   // 876
                    latestSubpage: null                                                                                // 876
                }, {                                                                                                   // 876
                    completed: false,                                                                                  // 877
                    dateStarted: null,                                                                                 // 877
                    dateEnded: null,                                                                                   // 877
                    datePaused: null,                                                                                  // 877
                    dateResumed: null,                                                                                 // 877
                    timeTaken: null,                                                                                   // 877
                    latestSubpage: null                                                                                // 877
                }, {                                                                                                   // 877
                    completed: false,                                                                                  // 878
                    dateStarted: null,                                                                                 // 878
                    dateEnded: null,                                                                                   // 878
                    datePaused: null,                                                                                  // 878
                    dateResumed: null,                                                                                 // 878
                    timeTaken: null,                                                                                   // 878
                    latestSubpage: null                                                                                // 878
                }, {                                                                                                   // 878
                    completed: false,                                                                                  // 879
                    dateStarted: null,                                                                                 // 879
                    dateEnded: null,                                                                                   // 879
                    datePaused: null,                                                                                  // 879
                    dateResumed: null,                                                                                 // 879
                    timeTaken: null,                                                                                   // 879
                    latestSubpage: null                                                                                // 879
                }, {                                                                                                   // 879
                    completed: false,                                                                                  // 880
                    dateStarted: null,                                                                                 // 880
                    dateEnded: null,                                                                                   // 880
                    datePaused: null,                                                                                  // 880
                    dateResumed: null,                                                                                 // 880
                    timeTaken: null,                                                                                   // 880
                    latestSubpage: null                                                                                // 880
                }, {                                                                                                   // 880
                    completed: false,                                                                                  // 881
                    dateStarted: null,                                                                                 // 881
                    dateEnded: null,                                                                                   // 881
                    datePaused: null,                                                                                  // 881
                    dateResumed: null,                                                                                 // 881
                    timeTaken: null,                                                                                   // 881
                    latestSubpage: null                                                                                // 881
                }, {                                                                                                   // 881
                    completed: false,                                                                                  // 882
                    dateStarted: null,                                                                                 // 882
                    dateEnded: null,                                                                                   // 882
                    datePaused: null,                                                                                  // 882
                    dateResumed: null,                                                                                 // 882
                    timeTaken: null,                                                                                   // 882
                    latestSubpage: null                                                                                // 882
                }, {                                                                                                   // 882
                    completed: false,                                                                                  // 883
                    dateStarted: null,                                                                                 // 883
                    dateEnded: null,                                                                                   // 883
                    datePaused: null,                                                                                  // 883
                    dateResumed: null,                                                                                 // 883
                    timeTaken: null,                                                                                   // 883
                    latestSubpage: null                                                                                // 883
                }, {                                                                                                   // 883
                    completed: false,                                                                                  // 884
                    dateStarted: null,                                                                                 // 884
                    dateEnded: null,                                                                                   // 884
                    datePaused: null,                                                                                  // 884
                    dateResumed: null,                                                                                 // 884
                    timeTaken: null,                                                                                   // 884
                    latestSubpage: null                                                                                // 884
                }, {                                                                                                   // 884
                    completed: false,                                                                                  // 885
                    dateStarted: null,                                                                                 // 885
                    dateEnded: null,                                                                                   // 885
                    datePaused: null,                                                                                  // 885
                    dateResumed: null,                                                                                 // 885
                    timeTaken: null,                                                                                   // 885
                    latestSubpage: null                                                                                // 885
                }, {                                                                                                   // 885
                    completed: false,                                                                                  // 886
                    dateStarted: null,                                                                                 // 886
                    dateEnded: null,                                                                                   // 886
                    datePaused: null,                                                                                  // 886
                    dateResumed: null,                                                                                 // 886
                    timeTaken: null,                                                                                   // 886
                    latestSubpage: null                                                                                // 886
                }, {                                                                                                   // 886
                    completed: false,                                                                                  // 887
                    dateStarted: null,                                                                                 // 887
                    dateEnded: null,                                                                                   // 887
                    datePaused: null,                                                                                  // 887
                    dateResumed: null,                                                                                 // 887
                    timeTaken: null,                                                                                   // 887
                    latestSubpage: null                                                                                // 887
                }, {                                                                                                   // 887
                    completed: false,                                                                                  // 888
                    dateStarted: null,                                                                                 // 888
                    dateEnded: null,                                                                                   // 888
                    datePaused: null,                                                                                  // 888
                    dateResumed: null,                                                                                 // 888
                    timeTaken: null,                                                                                   // 888
                    latestSubpage: null                                                                                // 888
                }, {                                                                                                   // 888
                    completed: false,                                                                                  // 889
                    dateStarted: null,                                                                                 // 889
                    dateEnded: null,                                                                                   // 889
                    datePaused: null,                                                                                  // 889
                    dateResumed: null,                                                                                 // 889
                    timeTaken: null,                                                                                   // 889
                    latestSubpage: null                                                                                // 889
                }, {                                                                                                   // 889
                    completed: false,                                                                                  // 890
                    dateStarted: null,                                                                                 // 890
                    dateEnded: null,                                                                                   // 890
                    datePaused: null,                                                                                  // 890
                    dateResumed: null,                                                                                 // 890
                    timeTaken: null,                                                                                   // 890
                    latestSubpage: null                                                                                // 890
                }, {                                                                                                   // 890
                    completed: false,                                                                                  // 891
                    dateStarted: null,                                                                                 // 891
                    dateEnded: null,                                                                                   // 891
                    datePaused: null,                                                                                  // 891
                    dateResumed: null,                                                                                 // 891
                    timeTaken: null,                                                                                   // 891
                    latestSubpage: null                                                                                // 891
                }, {                                                                                                   // 891
                    completed: false,                                                                                  // 892
                    dateStarted: null,                                                                                 // 892
                    dateEnded: null,                                                                                   // 892
                    datePaused: null,                                                                                  // 892
                    dateResumed: null,                                                                                 // 892
                    timeTaken: null,                                                                                   // 892
                    latestSubpage: null                                                                                // 892
                }],                                                                                                    // 892
                timeCompleted: {},                                                                                     // 894
                timeStarted: {}                                                                                        // 895
            }, {                                                                                                       // 860
                finished: false,                                                                                       // 899
                activities: [{                                                                                         // 900
                    completed: false,                                                                                  // 901
                    dateStarted: null,                                                                                 // 901
                    dateEnded: null,                                                                                   // 901
                    datePaused: null,                                                                                  // 901
                    dateResumed: null,                                                                                 // 901
                    timeTaken: null,                                                                                   // 901
                    latestSubpage: null                                                                                // 901
                }, {                                                                                                   // 901
                    completed: false,                                                                                  // 902
                    dateStarted: null,                                                                                 // 902
                    dateEnded: null,                                                                                   // 902
                    datePaused: null,                                                                                  // 902
                    dateResumed: null,                                                                                 // 902
                    timeTaken: null,                                                                                   // 902
                    latestSubpage: null                                                                                // 902
                }, {                                                                                                   // 902
                    completed: false,                                                                                  // 903
                    dateStarted: null,                                                                                 // 903
                    dateEnded: null,                                                                                   // 903
                    datePaused: null,                                                                                  // 903
                    dateResumed: null,                                                                                 // 903
                    timeTaken: null,                                                                                   // 903
                    latestSubpage: null                                                                                // 903
                }, {                                                                                                   // 903
                    completed: false,                                                                                  // 904
                    dateStarted: null,                                                                                 // 904
                    dateEnded: null,                                                                                   // 904
                    datePaused: null,                                                                                  // 904
                    dateResumed: null,                                                                                 // 904
                    timeTaken: null,                                                                                   // 904
                    latestSubpage: null                                                                                // 904
                }, {                                                                                                   // 904
                    completed: false,                                                                                  // 905
                    dateStarted: null,                                                                                 // 905
                    dateEnded: null,                                                                                   // 905
                    datePaused: null,                                                                                  // 905
                    dateResumed: null,                                                                                 // 905
                    timeTaken: null,                                                                                   // 905
                    latestSubpage: null                                                                                // 905
                }, {                                                                                                   // 905
                    completed: false,                                                                                  // 906
                    dateStarted: null,                                                                                 // 906
                    dateEnded: null,                                                                                   // 906
                    datePaused: null,                                                                                  // 906
                    dateResumed: null,                                                                                 // 906
                    timeTaken: null,                                                                                   // 906
                    latestSubpage: null                                                                                // 906
                }, {                                                                                                   // 906
                    completed: false,                                                                                  // 907
                    dateStarted: null,                                                                                 // 907
                    dateEnded: null,                                                                                   // 907
                    datePaused: null,                                                                                  // 907
                    dateResumed: null,                                                                                 // 907
                    timeTaken: null,                                                                                   // 907
                    latestSubpage: null                                                                                // 907
                }, {                                                                                                   // 907
                    completed: false,                                                                                  // 908
                    dateStarted: null,                                                                                 // 908
                    dateEnded: null,                                                                                   // 908
                    datePaused: null,                                                                                  // 908
                    dateResumed: null,                                                                                 // 908
                    timeTaken: null,                                                                                   // 908
                    latestSubpage: null                                                                                // 908
                }, {                                                                                                   // 908
                    completed: false,                                                                                  // 909
                    dateStarted: null,                                                                                 // 909
                    dateEnded: null,                                                                                   // 909
                    datePaused: null,                                                                                  // 909
                    dateResumed: null,                                                                                 // 909
                    timeTaken: null,                                                                                   // 909
                    latestSubpage: null                                                                                // 909
                }, {                                                                                                   // 909
                    completed: false,                                                                                  // 910
                    dateStarted: null,                                                                                 // 910
                    dateEnded: null,                                                                                   // 910
                    datePaused: null,                                                                                  // 910
                    dateResumed: null,                                                                                 // 910
                    timeTaken: null,                                                                                   // 910
                    latestSubpage: null                                                                                // 910
                }, {                                                                                                   // 910
                    completed: false,                                                                                  // 911
                    dateStarted: null,                                                                                 // 911
                    dateEnded: null,                                                                                   // 911
                    datePaused: null,                                                                                  // 911
                    dateResumed: null,                                                                                 // 911
                    timeTaken: null,                                                                                   // 911
                    latestSubpage: null                                                                                // 911
                }, {                                                                                                   // 911
                    completed: false,                                                                                  // 912
                    dateStarted: null,                                                                                 // 912
                    dateEnded: null,                                                                                   // 912
                    datePaused: null,                                                                                  // 912
                    dateResumed: null,                                                                                 // 912
                    timeTaken: null,                                                                                   // 912
                    latestSubpage: null                                                                                // 912
                }, {                                                                                                   // 912
                    completed: false,                                                                                  // 913
                    dateStarted: null,                                                                                 // 913
                    dateEnded: null,                                                                                   // 913
                    datePaused: null,                                                                                  // 913
                    dateResumed: null,                                                                                 // 913
                    timeTaken: null,                                                                                   // 913
                    latestSubpage: null                                                                                // 913
                }, {                                                                                                   // 913
                    completed: false,                                                                                  // 914
                    dateStarted: null,                                                                                 // 914
                    dateEnded: null,                                                                                   // 914
                    datePaused: null,                                                                                  // 914
                    dateResumed: null,                                                                                 // 914
                    timeTaken: null,                                                                                   // 914
                    latestSubpage: null                                                                                // 914
                }, {                                                                                                   // 914
                    completed: false,                                                                                  // 915
                    dateStarted: null,                                                                                 // 915
                    dateEnded: null,                                                                                   // 915
                    datePaused: null,                                                                                  // 915
                    dateResumed: null,                                                                                 // 915
                    timeTaken: null,                                                                                   // 915
                    latestSubpage: null                                                                                // 915
                }, {                                                                                                   // 915
                    completed: false,                                                                                  // 916
                    dateStarted: null,                                                                                 // 916
                    dateEnded: null,                                                                                   // 916
                    datePaused: null,                                                                                  // 916
                    dateResumed: null,                                                                                 // 916
                    timeTaken: null,                                                                                   // 916
                    latestSubpage: null                                                                                // 916
                }, {                                                                                                   // 916
                    completed: false,                                                                                  // 917
                    dateStarted: null,                                                                                 // 917
                    dateEnded: null,                                                                                   // 917
                    datePaused: null,                                                                                  // 917
                    dateResumed: null,                                                                                 // 917
                    timeTaken: null,                                                                                   // 917
                    latestSubpage: null                                                                                // 917
                }, {                                                                                                   // 917
                    completed: false,                                                                                  // 918
                    dateStarted: null,                                                                                 // 918
                    dateEnded: null,                                                                                   // 918
                    datePaused: null,                                                                                  // 918
                    dateResumed: null,                                                                                 // 918
                    timeTaken: null,                                                                                   // 918
                    latestSubpage: null                                                                                // 918
                }, {                                                                                                   // 918
                    completed: false,                                                                                  // 919
                    dateStarted: null,                                                                                 // 919
                    dateEnded: null,                                                                                   // 919
                    datePaused: null,                                                                                  // 919
                    dateResumed: null,                                                                                 // 919
                    timeTaken: null,                                                                                   // 919
                    latestSubpage: null                                                                                // 919
                }, {                                                                                                   // 919
                    completed: false,                                                                                  // 920
                    dateStarted: null,                                                                                 // 920
                    dateEnded: null,                                                                                   // 920
                    datePaused: null,                                                                                  // 920
                    dateResumed: null,                                                                                 // 920
                    timeTaken: null,                                                                                   // 920
                    latestSubpage: null                                                                                // 920
                }, {                                                                                                   // 920
                    completed: false,                                                                                  // 921
                    dateStarted: null,                                                                                 // 921
                    dateEnded: null,                                                                                   // 921
                    datePaused: null,                                                                                  // 921
                    dateResumed: null,                                                                                 // 921
                    timeTaken: null,                                                                                   // 921
                    latestSubpage: null                                                                                // 921
                }, {                                                                                                   // 921
                    completed: false,                                                                                  // 922
                    dateStarted: null,                                                                                 // 922
                    dateEnded: null,                                                                                   // 922
                    datePaused: null,                                                                                  // 922
                    dateResumed: null,                                                                                 // 922
                    timeTaken: null,                                                                                   // 922
                    latestSubpage: null                                                                                // 922
                }, {                                                                                                   // 922
                    completed: false,                                                                                  // 923
                    dateStarted: null,                                                                                 // 923
                    dateEnded: null,                                                                                   // 923
                    datePaused: null,                                                                                  // 923
                    dateResumed: null,                                                                                 // 923
                    timeTaken: null,                                                                                   // 923
                    latestSubpage: null                                                                                // 923
                }, {                                                                                                   // 923
                    completed: false,                                                                                  // 924
                    dateStarted: null,                                                                                 // 924
                    dateEnded: null,                                                                                   // 924
                    datePaused: null,                                                                                  // 924
                    dateResumed: null,                                                                                 // 924
                    timeTaken: null,                                                                                   // 924
                    latestSubpage: null                                                                                // 924
                }, {                                                                                                   // 924
                    completed: false,                                                                                  // 925
                    dateStarted: null,                                                                                 // 925
                    dateEnded: null,                                                                                   // 925
                    datePaused: null,                                                                                  // 925
                    dateResumed: null,                                                                                 // 925
                    timeTaken: null,                                                                                   // 925
                    latestSubpage: null                                                                                // 925
                }, {                                                                                                   // 925
                    completed: false,                                                                                  // 926
                    dateStarted: null,                                                                                 // 926
                    dateEnded: null,                                                                                   // 926
                    datePaused: null,                                                                                  // 926
                    dateResumed: null,                                                                                 // 926
                    timeTaken: null,                                                                                   // 926
                    latestSubpage: null                                                                                // 926
                }, {                                                                                                   // 926
                    completed: false,                                                                                  // 927
                    dateStarted: null,                                                                                 // 927
                    dateEnded: null,                                                                                   // 927
                    datePaused: null,                                                                                  // 927
                    dateResumed: null,                                                                                 // 927
                    timeTaken: null,                                                                                   // 927
                    latestSubpage: null                                                                                // 927
                }, {                                                                                                   // 927
                    completed: false,                                                                                  // 928
                    dateStarted: null,                                                                                 // 928
                    dateEnded: null,                                                                                   // 928
                    datePaused: null,                                                                                  // 928
                    dateResumed: null,                                                                                 // 928
                    timeTaken: null,                                                                                   // 928
                    latestSubpage: null                                                                                // 928
                }, {                                                                                                   // 928
                    completed: false,                                                                                  // 929
                    dateStarted: null,                                                                                 // 929
                    dateEnded: null,                                                                                   // 929
                    datePaused: null,                                                                                  // 929
                    dateResumed: null,                                                                                 // 929
                    timeTaken: null,                                                                                   // 929
                    latestSubpage: null                                                                                // 929
                }, {                                                                                                   // 929
                    completed: false,                                                                                  // 930
                    dateStarted: null,                                                                                 // 930
                    dateEnded: null,                                                                                   // 930
                    datePaused: null,                                                                                  // 930
                    dateResumed: null,                                                                                 // 930
                    timeTaken: null,                                                                                   // 930
                    latestSubpage: null                                                                                // 930
                }, {                                                                                                   // 930
                    completed: false,                                                                                  // 931
                    dateStarted: null,                                                                                 // 931
                    dateEnded: null,                                                                                   // 931
                    datePaused: null,                                                                                  // 931
                    dateResumed: null,                                                                                 // 931
                    timeTaken: null,                                                                                   // 931
                    latestSubpage: null                                                                                // 931
                }],                                                                                                    // 931
                timeCompleted: {},                                                                                     // 933
                timeStarted: {}                                                                                        // 934
            }, {                                                                                                       // 898
                finished: false,                                                                                       // 938
                activities: [{                                                                                         // 939
                    completed: false,                                                                                  // 940
                    dateStarted: null,                                                                                 // 940
                    dateEnded: null,                                                                                   // 940
                    datePaused: null,                                                                                  // 940
                    dateResumed: null,                                                                                 // 940
                    timeTaken: null,                                                                                   // 940
                    latestSubpage: null                                                                                // 940
                }, {                                                                                                   // 940
                    completed: false,                                                                                  // 941
                    dateStarted: null,                                                                                 // 941
                    dateEnded: null,                                                                                   // 941
                    datePaused: null,                                                                                  // 941
                    dateResumed: null,                                                                                 // 941
                    timeTaken: null,                                                                                   // 941
                    latestSubpage: null                                                                                // 941
                }, {                                                                                                   // 941
                    completed: false,                                                                                  // 942
                    dateStarted: null,                                                                                 // 942
                    dateEnded: null,                                                                                   // 942
                    datePaused: null,                                                                                  // 942
                    dateResumed: null,                                                                                 // 942
                    timeTaken: null,                                                                                   // 942
                    latestSubpage: null                                                                                // 942
                }, {                                                                                                   // 942
                    completed: false,                                                                                  // 943
                    dateStarted: null,                                                                                 // 943
                    dateEnded: null,                                                                                   // 943
                    datePaused: null,                                                                                  // 943
                    dateResumed: null,                                                                                 // 943
                    timeTaken: null,                                                                                   // 943
                    latestSubpage: null                                                                                // 943
                }, {                                                                                                   // 943
                    completed: false,                                                                                  // 944
                    dateStarted: null,                                                                                 // 944
                    dateEnded: null,                                                                                   // 944
                    datePaused: null,                                                                                  // 944
                    dateResumed: null,                                                                                 // 944
                    timeTaken: null,                                                                                   // 944
                    latestSubpage: null                                                                                // 944
                }, {                                                                                                   // 944
                    completed: false,                                                                                  // 945
                    dateStarted: null,                                                                                 // 945
                    dateEnded: null,                                                                                   // 945
                    datePaused: null,                                                                                  // 945
                    dateResumed: null,                                                                                 // 945
                    timeTaken: null,                                                                                   // 945
                    latestSubpage: null                                                                                // 945
                }, {                                                                                                   // 945
                    completed: false,                                                                                  // 946
                    dateStarted: null,                                                                                 // 946
                    dateEnded: null,                                                                                   // 946
                    datePaused: null,                                                                                  // 946
                    dateResumed: null,                                                                                 // 946
                    timeTaken: null,                                                                                   // 946
                    latestSubpage: null                                                                                // 946
                }, {                                                                                                   // 946
                    completed: false,                                                                                  // 947
                    dateStarted: null,                                                                                 // 947
                    dateEnded: null,                                                                                   // 947
                    datePaused: null,                                                                                  // 947
                    dateResumed: null,                                                                                 // 947
                    timeTaken: null,                                                                                   // 947
                    latestSubpage: null                                                                                // 947
                }, {                                                                                                   // 947
                    completed: false,                                                                                  // 948
                    dateStarted: null,                                                                                 // 948
                    dateEnded: null,                                                                                   // 948
                    datePaused: null,                                                                                  // 948
                    dateResumed: null,                                                                                 // 948
                    timeTaken: null,                                                                                   // 948
                    latestSubpage: null                                                                                // 948
                }, {                                                                                                   // 948
                    completed: false,                                                                                  // 949
                    dateStarted: null,                                                                                 // 949
                    dateEnded: null,                                                                                   // 949
                    datePaused: null,                                                                                  // 949
                    dateResumed: null,                                                                                 // 949
                    timeTaken: null,                                                                                   // 949
                    latestSubpage: null                                                                                // 949
                }, {                                                                                                   // 949
                    completed: false,                                                                                  // 950
                    dateStarted: null,                                                                                 // 950
                    dateEnded: null,                                                                                   // 950
                    datePaused: null,                                                                                  // 950
                    dateResumed: null,                                                                                 // 950
                    timeTaken: null,                                                                                   // 950
                    latestSubpage: null                                                                                // 950
                }, {                                                                                                   // 950
                    completed: false,                                                                                  // 951
                    dateStarted: null,                                                                                 // 951
                    dateEnded: null,                                                                                   // 951
                    datePaused: null,                                                                                  // 951
                    dateResumed: null,                                                                                 // 951
                    timeTaken: null,                                                                                   // 951
                    latestSubpage: null                                                                                // 951
                }, {                                                                                                   // 951
                    completed: false,                                                                                  // 952
                    dateStarted: null,                                                                                 // 952
                    dateEnded: null,                                                                                   // 952
                    datePaused: null,                                                                                  // 952
                    dateResumed: null,                                                                                 // 952
                    timeTaken: null,                                                                                   // 952
                    latestSubpage: null                                                                                // 952
                }, {                                                                                                   // 952
                    completed: false,                                                                                  // 953
                    dateStarted: null,                                                                                 // 953
                    dateEnded: null,                                                                                   // 953
                    datePaused: null,                                                                                  // 953
                    dateResumed: null,                                                                                 // 953
                    timeTaken: null,                                                                                   // 953
                    latestSubpage: null                                                                                // 953
                }, {                                                                                                   // 953
                    completed: false,                                                                                  // 954
                    dateStarted: null,                                                                                 // 954
                    dateEnded: null,                                                                                   // 954
                    datePaused: null,                                                                                  // 954
                    dateResumed: null,                                                                                 // 954
                    timeTaken: null,                                                                                   // 954
                    latestSubpage: null                                                                                // 954
                }, {                                                                                                   // 954
                    completed: false,                                                                                  // 955
                    dateStarted: null,                                                                                 // 955
                    dateEnded: null,                                                                                   // 955
                    datePaused: null,                                                                                  // 955
                    dateResumed: null,                                                                                 // 955
                    timeTaken: null,                                                                                   // 955
                    latestSubpage: null                                                                                // 955
                }, {                                                                                                   // 955
                    completed: false,                                                                                  // 956
                    dateStarted: null,                                                                                 // 956
                    dateEnded: null,                                                                                   // 956
                    datePaused: null,                                                                                  // 956
                    dateResumed: null,                                                                                 // 956
                    timeTaken: null,                                                                                   // 956
                    latestSubpage: null                                                                                // 956
                }, {                                                                                                   // 956
                    completed: false,                                                                                  // 957
                    dateStarted: null,                                                                                 // 957
                    dateEnded: null,                                                                                   // 957
                    datePaused: null,                                                                                  // 957
                    dateResumed: null,                                                                                 // 957
                    timeTaken: null,                                                                                   // 957
                    latestSubpage: null                                                                                // 957
                }, {                                                                                                   // 957
                    completed: false,                                                                                  // 958
                    dateStarted: null,                                                                                 // 958
                    dateEnded: null,                                                                                   // 958
                    datePaused: null,                                                                                  // 958
                    dateResumed: null,                                                                                 // 958
                    timeTaken: null,                                                                                   // 958
                    latestSubpage: null                                                                                // 958
                }, {                                                                                                   // 958
                    completed: false,                                                                                  // 959
                    dateStarted: null,                                                                                 // 959
                    dateEnded: null,                                                                                   // 959
                    datePaused: null,                                                                                  // 959
                    dateResumed: null,                                                                                 // 959
                    timeTaken: null,                                                                                   // 959
                    latestSubpage: null                                                                                // 959
                }, {                                                                                                   // 959
                    completed: false,                                                                                  // 960
                    dateStarted: null,                                                                                 // 960
                    dateEnded: null,                                                                                   // 960
                    datePaused: null,                                                                                  // 960
                    dateResumed: null,                                                                                 // 960
                    timeTaken: null,                                                                                   // 960
                    latestSubpage: null                                                                                // 960
                }, {                                                                                                   // 960
                    completed: false,                                                                                  // 961
                    dateStarted: null,                                                                                 // 961
                    dateEnded: null,                                                                                   // 961
                    datePaused: null,                                                                                  // 961
                    dateResumed: null,                                                                                 // 961
                    timeTaken: null,                                                                                   // 961
                    latestSubpage: null                                                                                // 961
                }, {                                                                                                   // 961
                    completed: false,                                                                                  // 962
                    dateStarted: null,                                                                                 // 962
                    dateEnded: null,                                                                                   // 962
                    datePaused: null,                                                                                  // 962
                    dateResumed: null,                                                                                 // 962
                    timeTaken: null,                                                                                   // 962
                    latestSubpage: null                                                                                // 962
                }, {                                                                                                   // 962
                    completed: false,                                                                                  // 963
                    dateStarted: null,                                                                                 // 963
                    dateEnded: null,                                                                                   // 963
                    datePaused: null,                                                                                  // 963
                    dateResumed: null,                                                                                 // 963
                    timeTaken: null,                                                                                   // 963
                    latestSubpage: null                                                                                // 963
                }, {                                                                                                   // 963
                    completed: false,                                                                                  // 964
                    dateStarted: null,                                                                                 // 964
                    dateEnded: null,                                                                                   // 964
                    datePaused: null,                                                                                  // 964
                    dateResumed: null,                                                                                 // 964
                    timeTaken: null,                                                                                   // 964
                    latestSubpage: null                                                                                // 964
                }],                                                                                                    // 964
                timeCompleted: {},                                                                                     // 966
                timeStarted: {}                                                                                        // 967
            }, {                                                                                                       // 937
                finished: false,                                                                                       // 971
                activities: [{                                                                                         // 972
                    completed: false,                                                                                  // 973
                    dateStarted: null,                                                                                 // 973
                    dateEnded: null,                                                                                   // 973
                    datePaused: null,                                                                                  // 973
                    dateResumed: null,                                                                                 // 973
                    timeTaken: null,                                                                                   // 973
                    latestSubpage: null                                                                                // 973
                }, {                                                                                                   // 973
                    completed: false,                                                                                  // 974
                    dateStarted: null,                                                                                 // 974
                    dateEnded: null,                                                                                   // 974
                    datePaused: null,                                                                                  // 974
                    dateResumed: null,                                                                                 // 974
                    timeTaken: null,                                                                                   // 974
                    latestSubpage: null                                                                                // 974
                }, {                                                                                                   // 974
                    completed: false,                                                                                  // 975
                    dateStarted: null,                                                                                 // 975
                    dateEnded: null,                                                                                   // 975
                    datePaused: null,                                                                                  // 975
                    dateResumed: null,                                                                                 // 975
                    timeTaken: null,                                                                                   // 975
                    latestSubpage: null                                                                                // 975
                }, {                                                                                                   // 975
                    completed: false,                                                                                  // 976
                    dateStarted: null,                                                                                 // 976
                    dateEnded: null,                                                                                   // 976
                    datePaused: null,                                                                                  // 976
                    dateResumed: null,                                                                                 // 976
                    timeTaken: null,                                                                                   // 976
                    latestSubpage: null                                                                                // 976
                }, {                                                                                                   // 976
                    completed: false,                                                                                  // 977
                    dateStarted: null,                                                                                 // 977
                    dateEnded: null,                                                                                   // 977
                    datePaused: null,                                                                                  // 977
                    dateResumed: null,                                                                                 // 977
                    timeTaken: null,                                                                                   // 977
                    latestSubpage: null                                                                                // 977
                }, {                                                                                                   // 977
                    completed: false,                                                                                  // 978
                    dateStarted: null,                                                                                 // 978
                    dateEnded: null,                                                                                   // 978
                    datePaused: null,                                                                                  // 978
                    dateResumed: null,                                                                                 // 978
                    timeTaken: null,                                                                                   // 978
                    latestSubpage: null                                                                                // 978
                }, {                                                                                                   // 978
                    completed: false,                                                                                  // 979
                    dateStarted: null,                                                                                 // 979
                    dateEnded: null,                                                                                   // 979
                    datePaused: null,                                                                                  // 979
                    dateResumed: null,                                                                                 // 979
                    timeTaken: null,                                                                                   // 979
                    latestSubpage: null                                                                                // 979
                }, {                                                                                                   // 979
                    completed: false,                                                                                  // 980
                    dateStarted: null,                                                                                 // 980
                    dateEnded: null,                                                                                   // 980
                    datePaused: null,                                                                                  // 980
                    dateResumed: null,                                                                                 // 980
                    timeTaken: null,                                                                                   // 980
                    latestSubpage: null                                                                                // 980
                }, {                                                                                                   // 980
                    completed: false,                                                                                  // 981
                    dateStarted: null,                                                                                 // 981
                    dateEnded: null,                                                                                   // 981
                    datePaused: null,                                                                                  // 981
                    dateResumed: null,                                                                                 // 981
                    timeTaken: null,                                                                                   // 981
                    latestSubpage: null                                                                                // 981
                }, {                                                                                                   // 981
                    completed: false,                                                                                  // 982
                    dateStarted: null,                                                                                 // 982
                    dateEnded: null,                                                                                   // 982
                    datePaused: null,                                                                                  // 982
                    dateResumed: null,                                                                                 // 982
                    timeTaken: null,                                                                                   // 982
                    latestSubpage: null                                                                                // 982
                }, {                                                                                                   // 982
                    completed: false,                                                                                  // 983
                    dateStarted: null,                                                                                 // 983
                    dateEnded: null,                                                                                   // 983
                    datePaused: null,                                                                                  // 983
                    dateResumed: null,                                                                                 // 983
                    timeTaken: null,                                                                                   // 983
                    latestSubpage: null                                                                                // 983
                }, {                                                                                                   // 983
                    completed: false,                                                                                  // 984
                    dateStarted: null,                                                                                 // 984
                    dateEnded: null,                                                                                   // 984
                    datePaused: null,                                                                                  // 984
                    dateResumed: null,                                                                                 // 984
                    timeTaken: null,                                                                                   // 984
                    latestSubpage: null                                                                                // 984
                }, {                                                                                                   // 984
                    completed: false,                                                                                  // 985
                    dateStarted: null,                                                                                 // 985
                    dateEnded: null,                                                                                   // 985
                    datePaused: null,                                                                                  // 985
                    dateResumed: null,                                                                                 // 985
                    timeTaken: null,                                                                                   // 985
                    latestSubpage: null                                                                                // 985
                }, {                                                                                                   // 985
                    completed: false,                                                                                  // 986
                    dateStarted: null,                                                                                 // 986
                    dateEnded: null,                                                                                   // 986
                    datePaused: null,                                                                                  // 986
                    dateResumed: null,                                                                                 // 986
                    timeTaken: null,                                                                                   // 986
                    latestSubpage: null                                                                                // 986
                }, {                                                                                                   // 986
                    completed: false,                                                                                  // 987
                    dateStarted: null,                                                                                 // 987
                    dateEnded: null,                                                                                   // 987
                    datePaused: null,                                                                                  // 987
                    dateResumed: null,                                                                                 // 987
                    timeTaken: null,                                                                                   // 987
                    latestSubpage: null                                                                                // 987
                }, {                                                                                                   // 987
                    completed: false,                                                                                  // 988
                    dateStarted: null,                                                                                 // 988
                    dateEnded: null,                                                                                   // 988
                    datePaused: null,                                                                                  // 988
                    dateResumed: null,                                                                                 // 988
                    timeTaken: null,                                                                                   // 988
                    latestSubpage: null                                                                                // 988
                }, {                                                                                                   // 988
                    completed: false,                                                                                  // 989
                    dateStarted: null,                                                                                 // 989
                    dateEnded: null,                                                                                   // 989
                    datePaused: null,                                                                                  // 989
                    dateResumed: null,                                                                                 // 989
                    timeTaken: null,                                                                                   // 989
                    latestSubpage: null                                                                                // 989
                }, {                                                                                                   // 989
                    completed: false,                                                                                  // 990
                    dateStarted: null,                                                                                 // 990
                    dateEnded: null,                                                                                   // 990
                    datePaused: null,                                                                                  // 990
                    dateResumed: null,                                                                                 // 990
                    timeTaken: null,                                                                                   // 990
                    latestSubpage: null                                                                                // 990
                }, {                                                                                                   // 990
                    completed: false,                                                                                  // 991
                    dateStarted: null,                                                                                 // 991
                    dateEnded: null,                                                                                   // 991
                    datePaused: null,                                                                                  // 991
                    dateResumed: null,                                                                                 // 991
                    timeTaken: null,                                                                                   // 991
                    latestSubpage: null                                                                                // 991
                }, {                                                                                                   // 991
                    completed: false,                                                                                  // 992
                    dateStarted: null,                                                                                 // 992
                    dateEnded: null,                                                                                   // 992
                    datePaused: null,                                                                                  // 992
                    dateResumed: null,                                                                                 // 992
                    timeTaken: null,                                                                                   // 992
                    latestSubpage: null                                                                                // 992
                }, {                                                                                                   // 992
                    completed: false,                                                                                  // 993
                    dateStarted: null,                                                                                 // 993
                    dateEnded: null,                                                                                   // 993
                    datePaused: null,                                                                                  // 993
                    dateResumed: null,                                                                                 // 993
                    timeTaken: null,                                                                                   // 993
                    latestSubpage: null                                                                                // 993
                }, {                                                                                                   // 993
                    completed: false,                                                                                  // 994
                    dateStarted: null,                                                                                 // 994
                    dateEnded: null,                                                                                   // 994
                    datePaused: null,                                                                                  // 994
                    dateResumed: null,                                                                                 // 994
                    timeTaken: null,                                                                                   // 994
                    latestSubpage: null                                                                                // 994
                }, {                                                                                                   // 994
                    completed: false,                                                                                  // 995
                    dateStarted: null,                                                                                 // 995
                    dateEnded: null,                                                                                   // 995
                    datePaused: null,                                                                                  // 995
                    dateResumed: null,                                                                                 // 995
                    timeTaken: null,                                                                                   // 995
                    latestSubpage: null                                                                                // 995
                }, {                                                                                                   // 995
                    completed: false,                                                                                  // 996
                    dateStarted: null,                                                                                 // 996
                    dateEnded: null,                                                                                   // 996
                    datePaused: null,                                                                                  // 996
                    dateResumed: null,                                                                                 // 996
                    timeTaken: null,                                                                                   // 996
                    latestSubpage: null                                                                                // 996
                }, {                                                                                                   // 996
                    completed: false,                                                                                  // 997
                    dateStarted: null,                                                                                 // 997
                    dateEnded: null,                                                                                   // 997
                    datePaused: null,                                                                                  // 997
                    dateResumed: null,                                                                                 // 997
                    timeTaken: null,                                                                                   // 997
                    latestSubpage: null                                                                                // 997
                }, {                                                                                                   // 997
                    completed: false,                                                                                  // 998
                    dateStarted: null,                                                                                 // 998
                    dateEnded: null,                                                                                   // 998
                    datePaused: null,                                                                                  // 998
                    dateResumed: null,                                                                                 // 998
                    timeTaken: null,                                                                                   // 998
                    latestSubpage: null                                                                                // 998
                }, {                                                                                                   // 998
                    completed: false,                                                                                  // 999
                    dateStarted: null,                                                                                 // 999
                    dateEnded: null,                                                                                   // 999
                    datePaused: null,                                                                                  // 999
                    dateResumed: null,                                                                                 // 999
                    timeTaken: null,                                                                                   // 999
                    latestSubpage: null                                                                                // 999
                }, {                                                                                                   // 999
                    completed: false,                                                                                  // 1000
                    dateStarted: null,                                                                                 // 1000
                    dateEnded: null,                                                                                   // 1000
                    datePaused: null,                                                                                  // 1000
                    dateResumed: null,                                                                                 // 1000
                    timeTaken: null,                                                                                   // 1000
                    latestSubpage: null                                                                                // 1000
                }, {                                                                                                   // 1000
                    completed: false,                                                                                  // 1001
                    dateStarted: null,                                                                                 // 1001
                    dateEnded: null,                                                                                   // 1001
                    datePaused: null,                                                                                  // 1001
                    dateResumed: null,                                                                                 // 1001
                    timeTaken: null,                                                                                   // 1001
                    latestSubpage: null                                                                                // 1001
                }, {                                                                                                   // 1001
                    completed: false,                                                                                  // 1002
                    dateStarted: null,                                                                                 // 1002
                    dateEnded: null,                                                                                   // 1002
                    datePaused: null,                                                                                  // 1002
                    dateResumed: null,                                                                                 // 1002
                    timeTaken: null,                                                                                   // 1002
                    latestSubpage: null                                                                                // 1002
                }],                                                                                                    // 1002
                timeCompleted: {},                                                                                     // 1004
                timeStarted: {}                                                                                        // 1005
            }, {                                                                                                       // 970
                finished: false,                                                                                       // 1009
                activities: [{                                                                                         // 1010
                    completed: false,                                                                                  // 1011
                    dateStarted: null,                                                                                 // 1011
                    dateEnded: null,                                                                                   // 1011
                    datePaused: null,                                                                                  // 1011
                    dateResumed: null,                                                                                 // 1011
                    timeTaken: null,                                                                                   // 1011
                    latestSubpage: null                                                                                // 1011
                }, {                                                                                                   // 1011
                    completed: false,                                                                                  // 1012
                    dateStarted: null,                                                                                 // 1012
                    dateEnded: null,                                                                                   // 1012
                    datePaused: null,                                                                                  // 1012
                    dateResumed: null,                                                                                 // 1012
                    timeTaken: null,                                                                                   // 1012
                    latestSubpage: null                                                                                // 1012
                }, {                                                                                                   // 1012
                    completed: false,                                                                                  // 1013
                    dateStarted: null,                                                                                 // 1013
                    dateEnded: null,                                                                                   // 1013
                    datePaused: null,                                                                                  // 1013
                    dateResumed: null,                                                                                 // 1013
                    timeTaken: null,                                                                                   // 1013
                    latestSubpage: null                                                                                // 1013
                }, {                                                                                                   // 1013
                    completed: false,                                                                                  // 1014
                    dateStarted: null,                                                                                 // 1014
                    dateEnded: null,                                                                                   // 1014
                    datePaused: null,                                                                                  // 1014
                    dateResumed: null,                                                                                 // 1014
                    timeTaken: null,                                                                                   // 1014
                    latestSubpage: null                                                                                // 1014
                }, {                                                                                                   // 1014
                    completed: false,                                                                                  // 1015
                    dateStarted: null,                                                                                 // 1015
                    dateEnded: null,                                                                                   // 1015
                    datePaused: null,                                                                                  // 1015
                    dateResumed: null,                                                                                 // 1015
                    timeTaken: null,                                                                                   // 1015
                    latestSubpage: null                                                                                // 1015
                }, {                                                                                                   // 1015
                    completed: false,                                                                                  // 1016
                    dateStarted: null,                                                                                 // 1016
                    dateEnded: null,                                                                                   // 1016
                    datePaused: null,                                                                                  // 1016
                    dateResumed: null,                                                                                 // 1016
                    timeTaken: null,                                                                                   // 1016
                    latestSubpage: null                                                                                // 1016
                }, {                                                                                                   // 1016
                    completed: false,                                                                                  // 1017
                    dateStarted: null,                                                                                 // 1017
                    dateEnded: null,                                                                                   // 1017
                    datePaused: null,                                                                                  // 1017
                    dateResumed: null,                                                                                 // 1017
                    timeTaken: null,                                                                                   // 1017
                    latestSubpage: null                                                                                // 1017
                }, {                                                                                                   // 1017
                    completed: false,                                                                                  // 1018
                    dateStarted: null,                                                                                 // 1018
                    dateEnded: null,                                                                                   // 1018
                    datePaused: null,                                                                                  // 1018
                    dateResumed: null,                                                                                 // 1018
                    timeTaken: null,                                                                                   // 1018
                    latestSubpage: null                                                                                // 1018
                }, {                                                                                                   // 1018
                    completed: false,                                                                                  // 1019
                    dateStarted: null,                                                                                 // 1019
                    dateEnded: null,                                                                                   // 1019
                    datePaused: null,                                                                                  // 1019
                    dateResumed: null,                                                                                 // 1019
                    timeTaken: null,                                                                                   // 1019
                    latestSubpage: null                                                                                // 1019
                }, {                                                                                                   // 1019
                    completed: false,                                                                                  // 1020
                    dateStarted: null,                                                                                 // 1020
                    dateEnded: null,                                                                                   // 1020
                    datePaused: null,                                                                                  // 1020
                    dateResumed: null,                                                                                 // 1020
                    timeTaken: null,                                                                                   // 1020
                    latestSubpage: null                                                                                // 1020
                }, {                                                                                                   // 1020
                    completed: false,                                                                                  // 1021
                    dateStarted: null,                                                                                 // 1021
                    dateEnded: null,                                                                                   // 1021
                    datePaused: null,                                                                                  // 1021
                    dateResumed: null,                                                                                 // 1021
                    timeTaken: null,                                                                                   // 1021
                    latestSubpage: null                                                                                // 1021
                }, {                                                                                                   // 1021
                    completed: false,                                                                                  // 1022
                    dateStarted: null,                                                                                 // 1022
                    dateEnded: null,                                                                                   // 1022
                    datePaused: null,                                                                                  // 1022
                    dateResumed: null,                                                                                 // 1022
                    timeTaken: null,                                                                                   // 1022
                    latestSubpage: null                                                                                // 1022
                }, {                                                                                                   // 1022
                    completed: false,                                                                                  // 1023
                    dateStarted: null,                                                                                 // 1023
                    dateEnded: null,                                                                                   // 1023
                    datePaused: null,                                                                                  // 1023
                    dateResumed: null,                                                                                 // 1023
                    timeTaken: null,                                                                                   // 1023
                    latestSubpage: null                                                                                // 1023
                }, {                                                                                                   // 1023
                    completed: false,                                                                                  // 1024
                    dateStarted: null,                                                                                 // 1024
                    dateEnded: null,                                                                                   // 1024
                    datePaused: null,                                                                                  // 1024
                    dateResumed: null,                                                                                 // 1024
                    timeTaken: null,                                                                                   // 1024
                    latestSubpage: null                                                                                // 1024
                }, {                                                                                                   // 1024
                    completed: false,                                                                                  // 1025
                    dateStarted: null,                                                                                 // 1025
                    dateEnded: null,                                                                                   // 1025
                    datePaused: null,                                                                                  // 1025
                    dateResumed: null,                                                                                 // 1025
                    timeTaken: null,                                                                                   // 1025
                    latestSubpage: null                                                                                // 1025
                }, {                                                                                                   // 1025
                    completed: false,                                                                                  // 1026
                    dateStarted: null,                                                                                 // 1026
                    dateEnded: null,                                                                                   // 1026
                    datePaused: null,                                                                                  // 1026
                    dateResumed: null,                                                                                 // 1026
                    timeTaken: null,                                                                                   // 1026
                    latestSubpage: null                                                                                // 1026
                }, {                                                                                                   // 1026
                    completed: false,                                                                                  // 1027
                    dateStarted: null,                                                                                 // 1027
                    dateEnded: null,                                                                                   // 1027
                    datePaused: null,                                                                                  // 1027
                    dateResumed: null,                                                                                 // 1027
                    timeTaken: null,                                                                                   // 1027
                    latestSubpage: null                                                                                // 1027
                }, {                                                                                                   // 1027
                    completed: false,                                                                                  // 1028
                    dateStarted: null,                                                                                 // 1028
                    dateEnded: null,                                                                                   // 1028
                    datePaused: null,                                                                                  // 1028
                    dateResumed: null,                                                                                 // 1028
                    timeTaken: null,                                                                                   // 1028
                    latestSubpage: null                                                                                // 1028
                }, {                                                                                                   // 1028
                    completed: false,                                                                                  // 1029
                    dateStarted: null,                                                                                 // 1029
                    dateEnded: null,                                                                                   // 1029
                    datePaused: null,                                                                                  // 1029
                    dateResumed: null,                                                                                 // 1029
                    timeTaken: null,                                                                                   // 1029
                    latestSubpage: null                                                                                // 1029
                }, {                                                                                                   // 1029
                    completed: false,                                                                                  // 1030
                    dateStarted: null,                                                                                 // 1030
                    dateEnded: null,                                                                                   // 1030
                    datePaused: null,                                                                                  // 1030
                    dateResumed: null,                                                                                 // 1030
                    timeTaken: null,                                                                                   // 1030
                    latestSubpage: null                                                                                // 1030
                }, {                                                                                                   // 1030
                    completed: false,                                                                                  // 1031
                    dateStarted: null,                                                                                 // 1031
                    dateEnded: null,                                                                                   // 1031
                    datePaused: null,                                                                                  // 1031
                    dateResumed: null,                                                                                 // 1031
                    timeTaken: null,                                                                                   // 1031
                    latestSubpage: null                                                                                // 1031
                }, {                                                                                                   // 1031
                    completed: false,                                                                                  // 1032
                    dateStarted: null,                                                                                 // 1032
                    dateEnded: null,                                                                                   // 1032
                    datePaused: null,                                                                                  // 1032
                    dateResumed: null,                                                                                 // 1032
                    timeTaken: null,                                                                                   // 1032
                    latestSubpage: null                                                                                // 1032
                }, {                                                                                                   // 1032
                    completed: false,                                                                                  // 1033
                    dateStarted: null,                                                                                 // 1033
                    dateEnded: null,                                                                                   // 1033
                    datePaused: null,                                                                                  // 1033
                    dateResumed: null,                                                                                 // 1033
                    timeTaken: null,                                                                                   // 1033
                    latestSubpage: null                                                                                // 1033
                }, {                                                                                                   // 1033
                    completed: false,                                                                                  // 1034
                    dateStarted: null,                                                                                 // 1034
                    dateEnded: null,                                                                                   // 1034
                    datePaused: null,                                                                                  // 1034
                    dateResumed: null,                                                                                 // 1034
                    timeTaken: null,                                                                                   // 1034
                    latestSubpage: null                                                                                // 1034
                }, {                                                                                                   // 1034
                    completed: false,                                                                                  // 1035
                    dateStarted: null,                                                                                 // 1035
                    dateEnded: null,                                                                                   // 1035
                    datePaused: null,                                                                                  // 1035
                    dateResumed: null,                                                                                 // 1035
                    timeTaken: null,                                                                                   // 1035
                    latestSubpage: null                                                                                // 1035
                }, {                                                                                                   // 1035
                    completed: false,                                                                                  // 1036
                    dateStarted: null,                                                                                 // 1036
                    dateEnded: null,                                                                                   // 1036
                    datePaused: null,                                                                                  // 1036
                    dateResumed: null,                                                                                 // 1036
                    timeTaken: null,                                                                                   // 1036
                    latestSubpage: null                                                                                // 1036
                }, {                                                                                                   // 1036
                    completed: false,                                                                                  // 1037
                    dateStarted: null,                                                                                 // 1037
                    dateEnded: null,                                                                                   // 1037
                    datePaused: null,                                                                                  // 1037
                    dateResumed: null,                                                                                 // 1037
                    timeTaken: null,                                                                                   // 1037
                    latestSubpage: null                                                                                // 1037
                }],                                                                                                    // 1037
                timeCompleted: {},                                                                                     // 1039
                timeStarted: {}                                                                                        // 1040
            }, {                                                                                                       // 1008
                finished: false,                                                                                       // 1044
                activities: [{                                                                                         // 1045
                    completed: false,                                                                                  // 1046
                    dateStarted: null,                                                                                 // 1046
                    dateEnded: null,                                                                                   // 1046
                    datePaused: null,                                                                                  // 1046
                    dateResumed: null,                                                                                 // 1046
                    timeTaken: null,                                                                                   // 1046
                    latestSubpage: null                                                                                // 1046
                }, {                                                                                                   // 1046
                    completed: false,                                                                                  // 1047
                    dateStarted: null,                                                                                 // 1047
                    dateEnded: null,                                                                                   // 1047
                    datePaused: null,                                                                                  // 1047
                    dateResumed: null,                                                                                 // 1047
                    timeTaken: null,                                                                                   // 1047
                    latestSubpage: null                                                                                // 1047
                }, {                                                                                                   // 1047
                    completed: false,                                                                                  // 1048
                    dateStarted: null,                                                                                 // 1048
                    dateEnded: null,                                                                                   // 1048
                    datePaused: null,                                                                                  // 1048
                    dateResumed: null,                                                                                 // 1048
                    timeTaken: null,                                                                                   // 1048
                    latestSubpage: null                                                                                // 1048
                }, {                                                                                                   // 1048
                    completed: false,                                                                                  // 1049
                    dateStarted: null,                                                                                 // 1049
                    dateEnded: null,                                                                                   // 1049
                    datePaused: null,                                                                                  // 1049
                    dateResumed: null,                                                                                 // 1049
                    timeTaken: null,                                                                                   // 1049
                    latestSubpage: null                                                                                // 1049
                }, {                                                                                                   // 1049
                    completed: false,                                                                                  // 1050
                    dateStarted: null,                                                                                 // 1050
                    dateEnded: null,                                                                                   // 1050
                    datePaused: null,                                                                                  // 1050
                    dateResumed: null,                                                                                 // 1050
                    timeTaken: null,                                                                                   // 1050
                    latestSubpage: null                                                                                // 1050
                }, {                                                                                                   // 1050
                    completed: false,                                                                                  // 1051
                    dateStarted: null,                                                                                 // 1051
                    dateEnded: null,                                                                                   // 1051
                    datePaused: null,                                                                                  // 1051
                    dateResumed: null,                                                                                 // 1051
                    timeTaken: null,                                                                                   // 1051
                    latestSubpage: null                                                                                // 1051
                }, {                                                                                                   // 1051
                    completed: false,                                                                                  // 1052
                    dateStarted: null,                                                                                 // 1052
                    dateEnded: null,                                                                                   // 1052
                    datePaused: null,                                                                                  // 1052
                    dateResumed: null,                                                                                 // 1052
                    timeTaken: null,                                                                                   // 1052
                    latestSubpage: null                                                                                // 1052
                }, {                                                                                                   // 1052
                    completed: false,                                                                                  // 1053
                    dateStarted: null,                                                                                 // 1053
                    dateEnded: null,                                                                                   // 1053
                    datePaused: null,                                                                                  // 1053
                    dateResumed: null,                                                                                 // 1053
                    timeTaken: null,                                                                                   // 1053
                    latestSubpage: null                                                                                // 1053
                }, {                                                                                                   // 1053
                    completed: false,                                                                                  // 1054
                    dateStarted: null,                                                                                 // 1054
                    dateEnded: null,                                                                                   // 1054
                    datePaused: null,                                                                                  // 1054
                    dateResumed: null,                                                                                 // 1054
                    timeTaken: null,                                                                                   // 1054
                    latestSubpage: null                                                                                // 1054
                }, {                                                                                                   // 1054
                    completed: false,                                                                                  // 1055
                    dateStarted: null,                                                                                 // 1055
                    dateEnded: null,                                                                                   // 1055
                    datePaused: null,                                                                                  // 1055
                    dateResumed: null,                                                                                 // 1055
                    timeTaken: null,                                                                                   // 1055
                    latestSubpage: null                                                                                // 1055
                }, {                                                                                                   // 1055
                    completed: false,                                                                                  // 1056
                    dateStarted: null,                                                                                 // 1056
                    dateEnded: null,                                                                                   // 1056
                    datePaused: null,                                                                                  // 1056
                    dateResumed: null,                                                                                 // 1056
                    timeTaken: null,                                                                                   // 1056
                    latestSubpage: null                                                                                // 1056
                }, {                                                                                                   // 1056
                    completed: false,                                                                                  // 1057
                    dateStarted: null,                                                                                 // 1057
                    dateEnded: null,                                                                                   // 1057
                    datePaused: null,                                                                                  // 1057
                    dateResumed: null,                                                                                 // 1057
                    timeTaken: null,                                                                                   // 1057
                    latestSubpage: null                                                                                // 1057
                }, {                                                                                                   // 1057
                    completed: false,                                                                                  // 1058
                    dateStarted: null,                                                                                 // 1058
                    dateEnded: null,                                                                                   // 1058
                    datePaused: null,                                                                                  // 1058
                    dateResumed: null,                                                                                 // 1058
                    timeTaken: null,                                                                                   // 1058
                    latestSubpage: null                                                                                // 1058
                }, {                                                                                                   // 1058
                    completed: false,                                                                                  // 1059
                    dateStarted: null,                                                                                 // 1059
                    dateEnded: null,                                                                                   // 1059
                    datePaused: null,                                                                                  // 1059
                    dateResumed: null,                                                                                 // 1059
                    timeTaken: null,                                                                                   // 1059
                    latestSubpage: null                                                                                // 1059
                }, {                                                                                                   // 1059
                    completed: false,                                                                                  // 1060
                    dateStarted: null,                                                                                 // 1060
                    dateEnded: null,                                                                                   // 1060
                    datePaused: null,                                                                                  // 1060
                    dateResumed: null,                                                                                 // 1060
                    timeTaken: null,                                                                                   // 1060
                    latestSubpage: null                                                                                // 1060
                }, {                                                                                                   // 1060
                    completed: false,                                                                                  // 1061
                    dateStarted: null,                                                                                 // 1061
                    dateEnded: null,                                                                                   // 1061
                    datePaused: null,                                                                                  // 1061
                    dateResumed: null,                                                                                 // 1061
                    timeTaken: null,                                                                                   // 1061
                    latestSubpage: null                                                                                // 1061
                }, {                                                                                                   // 1061
                    completed: false,                                                                                  // 1062
                    dateStarted: null,                                                                                 // 1062
                    dateEnded: null,                                                                                   // 1062
                    datePaused: null,                                                                                  // 1062
                    dateResumed: null,                                                                                 // 1062
                    timeTaken: null,                                                                                   // 1062
                    latestSubpage: null                                                                                // 1062
                }, {                                                                                                   // 1062
                    completed: false,                                                                                  // 1063
                    dateStarted: null,                                                                                 // 1063
                    dateEnded: null,                                                                                   // 1063
                    datePaused: null,                                                                                  // 1063
                    dateResumed: null,                                                                                 // 1063
                    timeTaken: null,                                                                                   // 1063
                    latestSubpage: null                                                                                // 1063
                }, {                                                                                                   // 1063
                    completed: false,                                                                                  // 1064
                    dateStarted: null,                                                                                 // 1064
                    dateEnded: null,                                                                                   // 1064
                    datePaused: null,                                                                                  // 1064
                    dateResumed: null,                                                                                 // 1064
                    timeTaken: null,                                                                                   // 1064
                    latestSubpage: null                                                                                // 1064
                }, {                                                                                                   // 1064
                    completed: false,                                                                                  // 1065
                    dateStarted: null,                                                                                 // 1065
                    dateEnded: null,                                                                                   // 1065
                    datePaused: null,                                                                                  // 1065
                    dateResumed: null,                                                                                 // 1065
                    timeTaken: null,                                                                                   // 1065
                    latestSubpage: null                                                                                // 1065
                }, {                                                                                                   // 1065
                    completed: false,                                                                                  // 1066
                    dateStarted: null,                                                                                 // 1066
                    dateEnded: null,                                                                                   // 1066
                    datePaused: null,                                                                                  // 1066
                    dateResumed: null,                                                                                 // 1066
                    timeTaken: null,                                                                                   // 1066
                    latestSubpage: null                                                                                // 1066
                }, {                                                                                                   // 1066
                    completed: false,                                                                                  // 1067
                    dateStarted: null,                                                                                 // 1067
                    dateEnded: null,                                                                                   // 1067
                    datePaused: null,                                                                                  // 1067
                    dateResumed: null,                                                                                 // 1067
                    timeTaken: null,                                                                                   // 1067
                    latestSubpage: null                                                                                // 1067
                }, {                                                                                                   // 1067
                    completed: false,                                                                                  // 1068
                    dateStarted: null,                                                                                 // 1068
                    dateEnded: null,                                                                                   // 1068
                    datePaused: null,                                                                                  // 1068
                    dateResumed: null,                                                                                 // 1068
                    timeTaken: null,                                                                                   // 1068
                    latestSubpage: null                                                                                // 1068
                }, {                                                                                                   // 1068
                    completed: false,                                                                                  // 1069
                    dateStarted: null,                                                                                 // 1069
                    dateEnded: null,                                                                                   // 1069
                    datePaused: null,                                                                                  // 1069
                    dateResumed: null,                                                                                 // 1069
                    timeTaken: null,                                                                                   // 1069
                    latestSubpage: null                                                                                // 1069
                }, {                                                                                                   // 1069
                    completed: false,                                                                                  // 1070
                    dateStarted: null,                                                                                 // 1070
                    dateEnded: null,                                                                                   // 1070
                    datePaused: null,                                                                                  // 1070
                    dateResumed: null,                                                                                 // 1070
                    timeTaken: null,                                                                                   // 1070
                    latestSubpage: null                                                                                // 1070
                }, {                                                                                                   // 1070
                    completed: false,                                                                                  // 1071
                    dateStarted: null,                                                                                 // 1071
                    dateEnded: null,                                                                                   // 1071
                    datePaused: null,                                                                                  // 1071
                    dateResumed: null,                                                                                 // 1071
                    timeTaken: null,                                                                                   // 1071
                    latestSubpage: null                                                                                // 1071
                }, {                                                                                                   // 1071
                    completed: false,                                                                                  // 1072
                    dateStarted: null,                                                                                 // 1072
                    dateEnded: null,                                                                                   // 1072
                    datePaused: null,                                                                                  // 1072
                    dateResumed: null,                                                                                 // 1072
                    timeTaken: null,                                                                                   // 1072
                    latestSubpage: null                                                                                // 1072
                }, {                                                                                                   // 1072
                    completed: false,                                                                                  // 1073
                    dateStarted: null,                                                                                 // 1073
                    dateEnded: null,                                                                                   // 1073
                    datePaused: null,                                                                                  // 1073
                    dateResumed: null,                                                                                 // 1073
                    timeTaken: null,                                                                                   // 1073
                    latestSubpage: null                                                                                // 1073
                }, {                                                                                                   // 1073
                    completed: false,                                                                                  // 1074
                    dateStarted: null,                                                                                 // 1074
                    dateEnded: null,                                                                                   // 1074
                    datePaused: null,                                                                                  // 1074
                    dateResumed: null,                                                                                 // 1074
                    timeTaken: null,                                                                                   // 1074
                    latestSubpage: null                                                                                // 1074
                }, {                                                                                                   // 1074
                    completed: false,                                                                                  // 1075
                    dateStarted: null,                                                                                 // 1075
                    dateEnded: null,                                                                                   // 1075
                    datePaused: null,                                                                                  // 1075
                    dateResumed: null,                                                                                 // 1075
                    timeTaken: null,                                                                                   // 1075
                    latestSubpage: null                                                                                // 1075
                }, {                                                                                                   // 1075
                    completed: false,                                                                                  // 1076
                    dateStarted: null,                                                                                 // 1076
                    dateEnded: null,                                                                                   // 1076
                    datePaused: null,                                                                                  // 1076
                    dateResumed: null,                                                                                 // 1076
                    timeTaken: null,                                                                                   // 1076
                    latestSubpage: null                                                                                // 1076
                }, {                                                                                                   // 1076
                    completed: false,                                                                                  // 1077
                    dateStarted: null,                                                                                 // 1077
                    dateEnded: null,                                                                                   // 1077
                    datePaused: null,                                                                                  // 1077
                    dateResumed: null,                                                                                 // 1077
                    timeTaken: null,                                                                                   // 1077
                    latestSubpage: null                                                                                // 1077
                }, {                                                                                                   // 1077
                    completed: false,                                                                                  // 1078
                    dateStarted: null,                                                                                 // 1078
                    dateEnded: null,                                                                                   // 1078
                    datePaused: null,                                                                                  // 1078
                    dateResumed: null,                                                                                 // 1078
                    timeTaken: null,                                                                                   // 1078
                    latestSubpage: null                                                                                // 1078
                }, {                                                                                                   // 1078
                    completed: false,                                                                                  // 1079
                    dateStarted: null,                                                                                 // 1079
                    dateEnded: null,                                                                                   // 1079
                    datePaused: null,                                                                                  // 1079
                    dateResumed: null,                                                                                 // 1079
                    timeTaken: null,                                                                                   // 1079
                    latestSubpage: null                                                                                // 1079
                }, {                                                                                                   // 1079
                    completed: false,                                                                                  // 1080
                    dateStarted: null,                                                                                 // 1080
                    dateEnded: null,                                                                                   // 1080
                    datePaused: null,                                                                                  // 1080
                    dateResumed: null,                                                                                 // 1080
                    timeTaken: null,                                                                                   // 1080
                    latestSubpage: null                                                                                // 1080
                }],                                                                                                    // 1080
                timeCompleted: {},                                                                                     // 1082
                timeStarted: {}                                                                                        // 1083
            }, {                                                                                                       // 1043
                finished: false,                                                                                       // 1087
                activities: [{                                                                                         // 1088
                    completed: false,                                                                                  // 1089
                    dateStarted: null,                                                                                 // 1089
                    dateEnded: null,                                                                                   // 1089
                    datePaused: null,                                                                                  // 1089
                    dateResumed: null,                                                                                 // 1089
                    timeTaken: null,                                                                                   // 1089
                    latestSubpage: null                                                                                // 1089
                }, {                                                                                                   // 1089
                    completed: false,                                                                                  // 1090
                    dateStarted: null,                                                                                 // 1090
                    dateEnded: null,                                                                                   // 1090
                    datePaused: null,                                                                                  // 1090
                    dateResumed: null,                                                                                 // 1090
                    timeTaken: null,                                                                                   // 1090
                    latestSubpage: null                                                                                // 1090
                }, {                                                                                                   // 1090
                    completed: false,                                                                                  // 1091
                    dateStarted: null,                                                                                 // 1091
                    dateEnded: null,                                                                                   // 1091
                    datePaused: null,                                                                                  // 1091
                    dateResumed: null,                                                                                 // 1091
                    timeTaken: null,                                                                                   // 1091
                    latestSubpage: null                                                                                // 1091
                }, {                                                                                                   // 1091
                    completed: false,                                                                                  // 1092
                    dateStarted: null,                                                                                 // 1092
                    dateEnded: null,                                                                                   // 1092
                    datePaused: null,                                                                                  // 1092
                    dateResumed: null,                                                                                 // 1092
                    timeTaken: null,                                                                                   // 1092
                    latestSubpage: null                                                                                // 1092
                }, {                                                                                                   // 1092
                    completed: false,                                                                                  // 1093
                    dateStarted: null,                                                                                 // 1093
                    dateEnded: null,                                                                                   // 1093
                    datePaused: null,                                                                                  // 1093
                    dateResumed: null,                                                                                 // 1093
                    timeTaken: null,                                                                                   // 1093
                    latestSubpage: null                                                                                // 1093
                }, {                                                                                                   // 1093
                    completed: false,                                                                                  // 1094
                    dateStarted: null,                                                                                 // 1094
                    dateEnded: null,                                                                                   // 1094
                    datePaused: null,                                                                                  // 1094
                    dateResumed: null,                                                                                 // 1094
                    timeTaken: null,                                                                                   // 1094
                    latestSubpage: null                                                                                // 1094
                }, {                                                                                                   // 1094
                    completed: false,                                                                                  // 1095
                    dateStarted: null,                                                                                 // 1095
                    dateEnded: null,                                                                                   // 1095
                    datePaused: null,                                                                                  // 1095
                    dateResumed: null,                                                                                 // 1095
                    timeTaken: null,                                                                                   // 1095
                    latestSubpage: null                                                                                // 1095
                }, {                                                                                                   // 1095
                    completed: false,                                                                                  // 1096
                    dateStarted: null,                                                                                 // 1096
                    dateEnded: null,                                                                                   // 1096
                    datePaused: null,                                                                                  // 1096
                    dateResumed: null,                                                                                 // 1096
                    timeTaken: null,                                                                                   // 1096
                    latestSubpage: null                                                                                // 1096
                }, {                                                                                                   // 1096
                    completed: false,                                                                                  // 1097
                    dateStarted: null,                                                                                 // 1097
                    dateEnded: null,                                                                                   // 1097
                    datePaused: null,                                                                                  // 1097
                    dateResumed: null,                                                                                 // 1097
                    timeTaken: null,                                                                                   // 1097
                    latestSubpage: null                                                                                // 1097
                }, {                                                                                                   // 1097
                    completed: false,                                                                                  // 1098
                    dateStarted: null,                                                                                 // 1098
                    dateEnded: null,                                                                                   // 1098
                    datePaused: null,                                                                                  // 1098
                    dateResumed: null,                                                                                 // 1098
                    timeTaken: null,                                                                                   // 1098
                    latestSubpage: null                                                                                // 1098
                }, {                                                                                                   // 1098
                    completed: false,                                                                                  // 1099
                    dateStarted: null,                                                                                 // 1099
                    dateEnded: null,                                                                                   // 1099
                    datePaused: null,                                                                                  // 1099
                    dateResumed: null,                                                                                 // 1099
                    timeTaken: null,                                                                                   // 1099
                    latestSubpage: null                                                                                // 1099
                }, {                                                                                                   // 1099
                    completed: false,                                                                                  // 1100
                    dateStarted: null,                                                                                 // 1100
                    dateEnded: null,                                                                                   // 1100
                    datePaused: null,                                                                                  // 1100
                    dateResumed: null,                                                                                 // 1100
                    timeTaken: null,                                                                                   // 1100
                    latestSubpage: null                                                                                // 1100
                }, {                                                                                                   // 1100
                    completed: false,                                                                                  // 1101
                    dateStarted: null,                                                                                 // 1101
                    dateEnded: null,                                                                                   // 1101
                    datePaused: null,                                                                                  // 1101
                    dateResumed: null,                                                                                 // 1101
                    timeTaken: null,                                                                                   // 1101
                    latestSubpage: null                                                                                // 1101
                }, {                                                                                                   // 1101
                    completed: false,                                                                                  // 1102
                    dateStarted: null,                                                                                 // 1102
                    dateEnded: null,                                                                                   // 1102
                    datePaused: null,                                                                                  // 1102
                    dateResumed: null,                                                                                 // 1102
                    timeTaken: null,                                                                                   // 1102
                    latestSubpage: null                                                                                // 1102
                }, {                                                                                                   // 1102
                    completed: false,                                                                                  // 1103
                    dateStarted: null,                                                                                 // 1103
                    dateEnded: null,                                                                                   // 1103
                    datePaused: null,                                                                                  // 1103
                    dateResumed: null,                                                                                 // 1103
                    timeTaken: null,                                                                                   // 1103
                    latestSubpage: null                                                                                // 1103
                }, {                                                                                                   // 1103
                    completed: false,                                                                                  // 1104
                    dateStarted: null,                                                                                 // 1104
                    dateEnded: null,                                                                                   // 1104
                    datePaused: null,                                                                                  // 1104
                    dateResumed: null,                                                                                 // 1104
                    timeTaken: null,                                                                                   // 1104
                    latestSubpage: null                                                                                // 1104
                }, {                                                                                                   // 1104
                    completed: false,                                                                                  // 1105
                    dateStarted: null,                                                                                 // 1105
                    dateEnded: null,                                                                                   // 1105
                    datePaused: null,                                                                                  // 1105
                    dateResumed: null,                                                                                 // 1105
                    timeTaken: null,                                                                                   // 1105
                    latestSubpage: null                                                                                // 1105
                }, {                                                                                                   // 1105
                    completed: false,                                                                                  // 1106
                    dateStarted: null,                                                                                 // 1106
                    dateEnded: null,                                                                                   // 1106
                    datePaused: null,                                                                                  // 1106
                    dateResumed: null,                                                                                 // 1106
                    timeTaken: null,                                                                                   // 1106
                    latestSubpage: null                                                                                // 1106
                }, {                                                                                                   // 1106
                    completed: false,                                                                                  // 1107
                    dateStarted: null,                                                                                 // 1107
                    dateEnded: null,                                                                                   // 1107
                    datePaused: null,                                                                                  // 1107
                    dateResumed: null,                                                                                 // 1107
                    timeTaken: null,                                                                                   // 1107
                    latestSubpage: null                                                                                // 1107
                }, {                                                                                                   // 1107
                    completed: false,                                                                                  // 1108
                    dateStarted: null,                                                                                 // 1108
                    dateEnded: null,                                                                                   // 1108
                    datePaused: null,                                                                                  // 1108
                    dateResumed: null,                                                                                 // 1108
                    timeTaken: null,                                                                                   // 1108
                    latestSubpage: null                                                                                // 1108
                }, {                                                                                                   // 1108
                    completed: false,                                                                                  // 1109
                    dateStarted: null,                                                                                 // 1109
                    dateEnded: null,                                                                                   // 1109
                    datePaused: null,                                                                                  // 1109
                    dateResumed: null,                                                                                 // 1109
                    timeTaken: null,                                                                                   // 1109
                    latestSubpage: null                                                                                // 1109
                }, {                                                                                                   // 1109
                    completed: false,                                                                                  // 1110
                    dateStarted: null,                                                                                 // 1110
                    dateEnded: null,                                                                                   // 1110
                    datePaused: null,                                                                                  // 1110
                    dateResumed: null,                                                                                 // 1110
                    timeTaken: null,                                                                                   // 1110
                    latestSubpage: null                                                                                // 1110
                }, {                                                                                                   // 1110
                    completed: false,                                                                                  // 1111
                    dateStarted: null,                                                                                 // 1111
                    dateEnded: null,                                                                                   // 1111
                    datePaused: null,                                                                                  // 1111
                    dateResumed: null,                                                                                 // 1111
                    timeTaken: null,                                                                                   // 1111
                    latestSubpage: null                                                                                // 1111
                }, {                                                                                                   // 1111
                    completed: false,                                                                                  // 1112
                    dateStarted: null,                                                                                 // 1112
                    dateEnded: null,                                                                                   // 1112
                    datePaused: null,                                                                                  // 1112
                    dateResumed: null,                                                                                 // 1112
                    timeTaken: null,                                                                                   // 1112
                    latestSubpage: null                                                                                // 1112
                }, {                                                                                                   // 1112
                    completed: false,                                                                                  // 1113
                    dateStarted: null,                                                                                 // 1113
                    dateEnded: null,                                                                                   // 1113
                    datePaused: null,                                                                                  // 1113
                    dateResumed: null,                                                                                 // 1113
                    timeTaken: null,                                                                                   // 1113
                    latestSubpage: null                                                                                // 1113
                }, {                                                                                                   // 1113
                    completed: false,                                                                                  // 1114
                    dateStarted: null,                                                                                 // 1114
                    dateEnded: null,                                                                                   // 1114
                    datePaused: null,                                                                                  // 1114
                    dateResumed: null,                                                                                 // 1114
                    timeTaken: null,                                                                                   // 1114
                    latestSubpage: null                                                                                // 1114
                }, {                                                                                                   // 1114
                    completed: false,                                                                                  // 1115
                    dateStarted: null,                                                                                 // 1115
                    dateEnded: null,                                                                                   // 1115
                    datePaused: null,                                                                                  // 1115
                    dateResumed: null,                                                                                 // 1115
                    timeTaken: null,                                                                                   // 1115
                    latestSubpage: null                                                                                // 1115
                }, {                                                                                                   // 1115
                    completed: false,                                                                                  // 1116
                    dateStarted: null,                                                                                 // 1116
                    dateEnded: null,                                                                                   // 1116
                    datePaused: null,                                                                                  // 1116
                    dateResumed: null,                                                                                 // 1116
                    timeTaken: null,                                                                                   // 1116
                    latestSubpage: null                                                                                // 1116
                }, {                                                                                                   // 1116
                    completed: false,                                                                                  // 1117
                    dateStarted: null,                                                                                 // 1117
                    dateEnded: null,                                                                                   // 1117
                    datePaused: null,                                                                                  // 1117
                    dateResumed: null,                                                                                 // 1117
                    timeTaken: null,                                                                                   // 1117
                    latestSubpage: null                                                                                // 1117
                }, {                                                                                                   // 1117
                    completed: false,                                                                                  // 1118
                    dateStarted: null,                                                                                 // 1118
                    dateEnded: null,                                                                                   // 1118
                    datePaused: null,                                                                                  // 1118
                    dateResumed: null,                                                                                 // 1118
                    timeTaken: null,                                                                                   // 1118
                    latestSubpage: null                                                                                // 1118
                }, {                                                                                                   // 1118
                    completed: false,                                                                                  // 1119
                    dateStarted: null,                                                                                 // 1119
                    dateEnded: null,                                                                                   // 1119
                    datePaused: null,                                                                                  // 1119
                    dateResumed: null,                                                                                 // 1119
                    timeTaken: null,                                                                                   // 1119
                    latestSubpage: null                                                                                // 1119
                }],                                                                                                    // 1119
                timeCompleted: {},                                                                                     // 1121
                timeStarted: {}                                                                                        // 1122
            }, {                                                                                                       // 1086
                finished: false,                                                                                       // 1126
                activities: [{                                                                                         // 1127
                    completed: false,                                                                                  // 1128
                    dateStarted: null,                                                                                 // 1128
                    dateEnded: null,                                                                                   // 1128
                    datePaused: null,                                                                                  // 1128
                    dateResumed: null,                                                                                 // 1128
                    timeTaken: null,                                                                                   // 1128
                    latestSubpage: null                                                                                // 1128
                }, {                                                                                                   // 1128
                    completed: false,                                                                                  // 1129
                    dateStarted: null,                                                                                 // 1129
                    dateEnded: null,                                                                                   // 1129
                    datePaused: null,                                                                                  // 1129
                    dateResumed: null,                                                                                 // 1129
                    timeTaken: null,                                                                                   // 1129
                    latestSubpage: null                                                                                // 1129
                }, {                                                                                                   // 1129
                    completed: false,                                                                                  // 1130
                    dateStarted: null,                                                                                 // 1130
                    dateEnded: null,                                                                                   // 1130
                    datePaused: null,                                                                                  // 1130
                    dateResumed: null,                                                                                 // 1130
                    timeTaken: null,                                                                                   // 1130
                    latestSubpage: null                                                                                // 1130
                }, {                                                                                                   // 1130
                    completed: false,                                                                                  // 1131
                    dateStarted: null,                                                                                 // 1131
                    dateEnded: null,                                                                                   // 1131
                    datePaused: null,                                                                                  // 1131
                    dateResumed: null,                                                                                 // 1131
                    timeTaken: null,                                                                                   // 1131
                    latestSubpage: null                                                                                // 1131
                }, {                                                                                                   // 1131
                    completed: false,                                                                                  // 1132
                    dateStarted: null,                                                                                 // 1132
                    dateEnded: null,                                                                                   // 1132
                    datePaused: null,                                                                                  // 1132
                    dateResumed: null,                                                                                 // 1132
                    timeTaken: null,                                                                                   // 1132
                    latestSubpage: null                                                                                // 1132
                }, {                                                                                                   // 1132
                    completed: false,                                                                                  // 1133
                    dateStarted: null,                                                                                 // 1133
                    dateEnded: null,                                                                                   // 1133
                    datePaused: null,                                                                                  // 1133
                    dateResumed: null,                                                                                 // 1133
                    timeTaken: null,                                                                                   // 1133
                    latestSubpage: null                                                                                // 1133
                }, {                                                                                                   // 1133
                    completed: false,                                                                                  // 1134
                    dateStarted: null,                                                                                 // 1134
                    dateEnded: null,                                                                                   // 1134
                    datePaused: null,                                                                                  // 1134
                    dateResumed: null,                                                                                 // 1134
                    timeTaken: null,                                                                                   // 1134
                    latestSubpage: null                                                                                // 1134
                }, {                                                                                                   // 1134
                    completed: false,                                                                                  // 1135
                    dateStarted: null,                                                                                 // 1135
                    dateEnded: null,                                                                                   // 1135
                    datePaused: null,                                                                                  // 1135
                    dateResumed: null,                                                                                 // 1135
                    timeTaken: null,                                                                                   // 1135
                    latestSubpage: null                                                                                // 1135
                }, {                                                                                                   // 1135
                    completed: false,                                                                                  // 1136
                    dateStarted: null,                                                                                 // 1136
                    dateEnded: null,                                                                                   // 1136
                    datePaused: null,                                                                                  // 1136
                    dateResumed: null,                                                                                 // 1136
                    timeTaken: null,                                                                                   // 1136
                    latestSubpage: null                                                                                // 1136
                }, {                                                                                                   // 1136
                    completed: false,                                                                                  // 1137
                    dateStarted: null,                                                                                 // 1137
                    dateEnded: null,                                                                                   // 1137
                    datePaused: null,                                                                                  // 1137
                    dateResumed: null,                                                                                 // 1137
                    timeTaken: null,                                                                                   // 1137
                    latestSubpage: null                                                                                // 1137
                }, {                                                                                                   // 1137
                    completed: false,                                                                                  // 1138
                    dateStarted: null,                                                                                 // 1138
                    dateEnded: null,                                                                                   // 1138
                    datePaused: null,                                                                                  // 1138
                    dateResumed: null,                                                                                 // 1138
                    timeTaken: null,                                                                                   // 1138
                    latestSubpage: null                                                                                // 1138
                }, {                                                                                                   // 1138
                    completed: false,                                                                                  // 1139
                    dateStarted: null,                                                                                 // 1139
                    dateEnded: null,                                                                                   // 1139
                    datePaused: null,                                                                                  // 1139
                    dateResumed: null,                                                                                 // 1139
                    timeTaken: null,                                                                                   // 1139
                    latestSubpage: null                                                                                // 1139
                }, {                                                                                                   // 1139
                    completed: false,                                                                                  // 1140
                    dateStarted: null,                                                                                 // 1140
                    dateEnded: null,                                                                                   // 1140
                    datePaused: null,                                                                                  // 1140
                    dateResumed: null,                                                                                 // 1140
                    timeTaken: null,                                                                                   // 1140
                    latestSubpage: null                                                                                // 1140
                }, {                                                                                                   // 1140
                    completed: false,                                                                                  // 1141
                    dateStarted: null,                                                                                 // 1141
                    dateEnded: null,                                                                                   // 1141
                    datePaused: null,                                                                                  // 1141
                    dateResumed: null,                                                                                 // 1141
                    timeTaken: null,                                                                                   // 1141
                    latestSubpage: null                                                                                // 1141
                }, {                                                                                                   // 1141
                    completed: false,                                                                                  // 1142
                    dateStarted: null,                                                                                 // 1142
                    dateEnded: null,                                                                                   // 1142
                    datePaused: null,                                                                                  // 1142
                    dateResumed: null,                                                                                 // 1142
                    timeTaken: null,                                                                                   // 1142
                    latestSubpage: null                                                                                // 1142
                }, {                                                                                                   // 1142
                    completed: false,                                                                                  // 1143
                    dateStarted: null,                                                                                 // 1143
                    dateEnded: null,                                                                                   // 1143
                    datePaused: null,                                                                                  // 1143
                    dateResumed: null,                                                                                 // 1143
                    timeTaken: null,                                                                                   // 1143
                    latestSubpage: null                                                                                // 1143
                }, {                                                                                                   // 1143
                    completed: false,                                                                                  // 1144
                    dateStarted: null,                                                                                 // 1144
                    dateEnded: null,                                                                                   // 1144
                    datePaused: null,                                                                                  // 1144
                    dateResumed: null,                                                                                 // 1144
                    timeTaken: null,                                                                                   // 1144
                    latestSubpage: null                                                                                // 1144
                }, {                                                                                                   // 1144
                    completed: false,                                                                                  // 1145
                    dateStarted: null,                                                                                 // 1145
                    dateEnded: null,                                                                                   // 1145
                    datePaused: null,                                                                                  // 1145
                    dateResumed: null,                                                                                 // 1145
                    timeTaken: null,                                                                                   // 1145
                    latestSubpage: null                                                                                // 1145
                }, {                                                                                                   // 1145
                    completed: false,                                                                                  // 1146
                    dateStarted: null,                                                                                 // 1146
                    dateEnded: null,                                                                                   // 1146
                    datePaused: null,                                                                                  // 1146
                    dateResumed: null,                                                                                 // 1146
                    timeTaken: null,                                                                                   // 1146
                    latestSubpage: null                                                                                // 1146
                }, {                                                                                                   // 1146
                    completed: false,                                                                                  // 1147
                    dateStarted: null,                                                                                 // 1147
                    dateEnded: null,                                                                                   // 1147
                    datePaused: null,                                                                                  // 1147
                    dateResumed: null,                                                                                 // 1147
                    timeTaken: null,                                                                                   // 1147
                    latestSubpage: null                                                                                // 1147
                }, {                                                                                                   // 1147
                    completed: false,                                                                                  // 1148
                    dateStarted: null,                                                                                 // 1148
                    dateEnded: null,                                                                                   // 1148
                    datePaused: null,                                                                                  // 1148
                    dateResumed: null,                                                                                 // 1148
                    timeTaken: null,                                                                                   // 1148
                    latestSubpage: null                                                                                // 1148
                }, {                                                                                                   // 1148
                    completed: false,                                                                                  // 1149
                    dateStarted: null,                                                                                 // 1149
                    dateEnded: null,                                                                                   // 1149
                    datePaused: null,                                                                                  // 1149
                    dateResumed: null,                                                                                 // 1149
                    timeTaken: null,                                                                                   // 1149
                    latestSubpage: null                                                                                // 1149
                }, {                                                                                                   // 1149
                    completed: false,                                                                                  // 1150
                    dateStarted: null,                                                                                 // 1150
                    dateEnded: null,                                                                                   // 1150
                    datePaused: null,                                                                                  // 1150
                    dateResumed: null,                                                                                 // 1150
                    timeTaken: null,                                                                                   // 1150
                    latestSubpage: null                                                                                // 1150
                }, {                                                                                                   // 1150
                    completed: false,                                                                                  // 1151
                    dateStarted: null,                                                                                 // 1151
                    dateEnded: null,                                                                                   // 1151
                    datePaused: null,                                                                                  // 1151
                    dateResumed: null,                                                                                 // 1151
                    timeTaken: null,                                                                                   // 1151
                    latestSubpage: null                                                                                // 1151
                }, {                                                                                                   // 1151
                    completed: false,                                                                                  // 1152
                    dateStarted: null,                                                                                 // 1152
                    dateEnded: null,                                                                                   // 1152
                    datePaused: null,                                                                                  // 1152
                    dateResumed: null,                                                                                 // 1152
                    timeTaken: null,                                                                                   // 1152
                    latestSubpage: null                                                                                // 1152
                }, {                                                                                                   // 1152
                    completed: false,                                                                                  // 1153
                    dateStarted: null,                                                                                 // 1153
                    dateEnded: null,                                                                                   // 1153
                    datePaused: null,                                                                                  // 1153
                    dateResumed: null,                                                                                 // 1153
                    timeTaken: null,                                                                                   // 1153
                    latestSubpage: null                                                                                // 1153
                }, {                                                                                                   // 1153
                    completed: false,                                                                                  // 1154
                    dateStarted: null,                                                                                 // 1154
                    dateEnded: null,                                                                                   // 1154
                    datePaused: null,                                                                                  // 1154
                    dateResumed: null,                                                                                 // 1154
                    timeTaken: null,                                                                                   // 1154
                    latestSubpage: null                                                                                // 1154
                }, {                                                                                                   // 1154
                    completed: false,                                                                                  // 1155
                    dateStarted: null,                                                                                 // 1155
                    dateEnded: null,                                                                                   // 1155
                    datePaused: null,                                                                                  // 1155
                    dateResumed: null,                                                                                 // 1155
                    timeTaken: null,                                                                                   // 1155
                    latestSubpage: null                                                                                // 1155
                }, {                                                                                                   // 1155
                    completed: false,                                                                                  // 1156
                    dateStarted: null,                                                                                 // 1156
                    dateEnded: null,                                                                                   // 1156
                    datePaused: null,                                                                                  // 1156
                    dateResumed: null,                                                                                 // 1156
                    timeTaken: null,                                                                                   // 1156
                    latestSubpage: null                                                                                // 1156
                }],                                                                                                    // 1156
                timeCompleted: {},                                                                                     // 1158
                timeStarted: {}                                                                                        // 1159
            }]                                                                                                         // 1125
        });                                                                                                            // 783
    }                                                                                                                  // 1164
});                                                                                                                    // 1
                                                                                                                       //
function createUserProgress(userId) {                                                                                  // 1168
    // Once the user has been created, a new userProgress document must be created for the user                        // 1169
    Meteor.call('insertNewUserProgress', userId, function (error, result) {                                            // 1170
        if (!error) {                                                                                                  // 1171
            Meteor.users.update({                                                                                      // 1172
                _id: userId                                                                                            // 1172
            }, {                                                                                                       // 1172
                $set: {                                                                                                // 1172
                    progress: result                                                                                   // 1172
                }                                                                                                      // 1172
            });                                                                                                        // 1172
        }                                                                                                              // 1173
    });                                                                                                                // 1174
}                                                                                                                      // 1175
                                                                                                                       //
function isValidEmailAddress(emailAddress) {                                                                           // 1177
    var pattern = new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);
    return pattern.test(emailAddress);                                                                                 // 1179
}                                                                                                                      // 1180
                                                                                                                       //
;                                                                                                                      // 1180
                                                                                                                       //
function activityCompleted(activity, uId) {                                                                            // 1183
    console.log(activity);                                                                                             // 1184
    var actObj = extractModActNum(activity);                                                                           // 1185
    var completed = userProgress.findOne({                                                                             // 1186
        userId: uId                                                                                                    // 1186
    }).modules[actObj.modNum].activities[actObj.actNum].completed;                                                     // 1186
    return completed == "Completed";                                                                                   // 1187
}                                                                                                                      // 1188
                                                                                                                       //
function getNextActivity(activity, uId) {                                                                              // 1190
    var actObj = extractModActNum(activity);                                                                           // 1191
    var userProg = userProgress.findOne({                                                                              // 1192
        userId: uId                                                                                                    // 1192
    });                                                                                                                // 1192
    var nextAct = userProg.modules[actObj.modNum].activities[actObj.actNum + 1];                                       // 1193
    var nextActStr = "m" + (actObj.modNum + 1) + "a" + (actObj.actNum + 2);                                            // 1194
    var passed = gameAccess.find({                                                                                     // 1195
        "user": uId,                                                                                                   // 1195
        "module": (actObj.modNum + 1).toString(),                                                                      // 1195
        "passedTest": true                                                                                             // 1195
    }).count();                                                                                                        // 1195
                                                                                                                       //
    if (activityIsGame(nextActStr)) {                                                                                  // 1196
        nextActStr = getGameStr(nextActStr);                                                                           // 1197
        console.log("if game: " + nextActStr);                                                                         // 1198
                                                                                                                       //
        if (passed == 0) {                                                                                             // 1199
            //if "test" is failed, "continue" gets you to the next module, activity 1                                  // 1200
            return "m" + (actObj.modNum + 2) + "a" + 1;                                                                // 1201
        }                                                                                                              // 1202
                                                                                                                       //
        ;                                                                                                              // 1202
        return nextActStr;                                                                                             // 1203
    }                                                                                                                  // 1204
                                                                                                                       //
    if (nextAct == null || nextAct == 'undefined') {                                                                   // 1205
        nextActStr = "m" + (actObj.modNum + 2) + "a1";                                                                 // 1206
    }                                                                                                                  // 1207
                                                                                                                       //
    console.log("if not game: " + nextActStr);                                                                         // 1208
    return nextActStr;                                                                                                 // 1209
}                                                                                                                      // 1210
                                                                                                                       //
function extractModActNum(activityStr) {                                                                               // 1212
    var obj = {                                                                                                        // 1213
        modNum: null,                                                                                                  // 1214
        actNum: null                                                                                                   // 1215
    };                                                                                                                 // 1213
    obj.modNum = activityStr.substring(activityStr.indexOf("m") + 1, activityStr.indexOf("a")) - 1;                    // 1218
    obj.actNum = activityStr.substring(activityStr.indexOf("a") + 1, activityStr.length) - 1;                          // 1219
    return obj;                                                                                                        // 1220
}                                                                                                                      // 1221
                                                                                                                       //
function activityIsGame(actStr) {                                                                                      // 1223
    var gameActs = ["m1a28", "m2a29", "m3a30", "m4a31", "m5a25", "m6a30", "m7a27", "m8a35", "m9a31", "m10a29"];        // 1224
    return gameActs.indexOf(actStr) >= 0;                                                                              // 1225
}                                                                                                                      // 1226
                                                                                                                       //
function getGameStr(actStr) {                                                                                          // 1228
    return actStr.substring(0, actStr.indexOf("a")) + "Game";                                                          // 1229
}                                                                                                                      // 1230
                                                                                                                       //
function checkProgressCompletion(progress, timeSpent, orgName, allGamesCompleted) {                                    // 1232
    var result = "";                                                                                                   // 1233
                                                                                                                       //
    if (allGamesCompleted) {                                                                                           // 1234
        if (orgName == "City and Guilds") {} else {                                                                    // 1235
            //default for other orgs                                                                                   // 1237
            //Leaving this the same as with c&g for testing only. This should be changed                               // 1238
            //Once the whole thing is implemented                                                                      // 1239
            if (progress >= 40 && timeSpent >= 20) result = "Half-Way-Completion";                                     // 1240
            if (progress >= 80 && timeSpent >= 40) result = "Full-Completion";                                         // 1243
        }                                                                                                              // 1245
    } //Currently checking overall course completion only, however it should be possible to switch to checking units instead
                                                                                                                       //
                                                                                                                       //
    return result;                                                                                                     // 1248
}                                                                                                                      // 1249
                                                                                                                       //
function checkCompletedUnit(moduleNum) {                                                                               // 1251
    var progress = userProgress.findOne({                                                                              // 1252
        userId: Meteor.userId()                                                                                        // 1252
    });                                                                                                                // 1252
    var modules = progress.modules;                                                                                    // 1253
                                                                                                                       //
    if (modules[moduleNum - 1].finished == true) {                                                                     // 1254
        return true;                                                                                                   // 1255
    }                                                                                                                  // 1256
                                                                                                                       //
    return false;                                                                                                      // 1257
}                                                                                                                      // 1258
                                                                                                                       //
function checkUnitCompleted(currModule) {                                                                              // 1260
    if (currModule <= 5) {                                                                                             // 1261
        var startModule = 1;                                                                                           // 1262
        var endModule = 5;                                                                                             // 1263
    } else if (currModule > 5) {                                                                                       // 1264
        var startModule = 6;                                                                                           // 1265
        var endModule = 10;                                                                                            // 1266
    }                                                                                                                  // 1267
                                                                                                                       //
    for (var i = startModule; i <= endModule; i++) {                                                                   // 1268
        if (!checkCompletedUnit(i)) {                                                                                  // 1269
            return false;                                                                                              // 1270
        }                                                                                                              // 1271
    }                                                                                                                  // 1272
                                                                                                                       //
    return true;                                                                                                       // 1273
}                                                                                                                      // 1274
                                                                                                                       //
;                                                                                                                      // 1274
                                                                                                                       //
function checkTrophyCompletion() {                                                                                     // 1276
    var percent = showPercentageComplete(); //('PERCENT ' + percent);                                                  // 1278
                                                                                                                       //
    if (checkTrophyStatus(1) == null || checkTrophyStatus(1) == undefined) {                                           // 1280
        var firstTrophyPercentage = 30;                                                                                // 1281
        if (percent >= firstTrophyPercentage) setTrophyCompletionField(1);                                             // 1282
    }                                                                                                                  // 1284
                                                                                                                       //
    if (checkTrophyStatus(2) == null || checkTrophyStatus(2) == undefined) {                                           // 1286
        var secondTrophyPercentage = 60;                                                                               // 1287
        if (percent >= secondTrophyPercentage) setTrophyCompletionField(2);                                            // 1288
    }                                                                                                                  // 1290
                                                                                                                       //
    if (checkTrophyStatus(3) == null || checkTrophyStatus(3) == undefined) {                                           // 1292
        var moduleNum = 10;                                                                                            // 1293
        var modulesCompleted = getNumberOfModuleBadges();                                                              // 1294
        if (modulesCompleted == moduleNum) setTrophyCompletionField(3);                                                // 1295
    }                                                                                                                  // 1297
}                                                                                                                      // 1299
                                                                                                                       //
function getNumberOfModuleBadges() {                                                                                   // 1301
    var modulesFinishedNotification = Meteor.users.findOne({                                                           // 1302
        _id: Meteor.userId()                                                                                           // 1302
    }).moduleFinishedNotification;                                                                                     // 1302
    var completedCount = 0;                                                                                            // 1303
    var moduleNum = 10;                                                                                                // 1304
                                                                                                                       //
    if (modulesFinishedNotification != null && modulesFinishedNotification != undefined) {                             // 1305
        for (var i = 1; i <= moduleNum; i++) {                                                                         // 1306
            if (modulesFinishedNotification[i] != null && modulesFinishedNotification[i] != undefined) {               // 1307
                completedCount++;                                                                                      // 1308
            }                                                                                                          // 1309
        }                                                                                                              // 1310
                                                                                                                       //
        return completedCount;                                                                                         // 1311
    }                                                                                                                  // 1312
}                                                                                                                      // 1313
                                                                                                                       //
function checkTrophyStatus(trophyIndex) {                                                                              // 1315
    var trophyAchievement = Meteor.users.findOne({                                                                     // 1316
        _id: Meteor.userId()                                                                                           // 1316
    }).trophyAchieved;                                                                                                 // 1316
                                                                                                                       //
    if (trophyAchievement != null && trophyAchievement != undefined) {                                                 // 1317
        return trophyAchievement[trophyIndex];                                                                         // 1318
    }                                                                                                                  // 1319
}                                                                                                                      // 1320
                                                                                                                       //
function setTrophyReadField(trophyIndex) {                                                                             // 1322
    Meteor.call('setTrophyProgress', trophyIndex, 'Read');                                                             // 1323
}                                                                                                                      // 1324
                                                                                                                       //
function setTrophyCompletionField(trophyIndex) {                                                                       // 1326
    Meteor.call('setTrophyProgress', trophyIndex, 'Finished');                                                         // 1327
}                                                                                                                      // 1328
                                                                                                                       //
function setModuleCompletionField(moduleNumber) {                                                                      // 1330
    //set flag in DB user doc                                                                                          // 1331
    // flag should be either of these 2 values - null/undefined, "Finished", "Read"                                    // 1332
    // this will allow for the pop-up to be shown only after the current module is completed                           // 1333
    // and to not show again for the current module once it has been read already                                      // 1334
    Meteor.call('setModuleProgress', moduleNumber, 'Finished');                                                        // 1335
}                                                                                                                      // 1336
                                                                                                                       //
function setUnitFeedbackFormStatus(unit) {                                                                             // 1338
    Meteor.call('setFeedbackFormStatus', unit, 'Not completed');                                                       // 1339
} /**                                                                                                                  // 1340
   * Used for a % course completion for a certificate - uncomment if needed                                            //
   */ // function setUserProgressCompletionNotification(){                                                             //
//     //set flag in DB user doc to display message                                                                    // 1346
//     //flag should be either of these 3 values - null / undefined,  "Completed", HalfWay , "Read"                    // 1347
//     //this will allow for the pop-up to be shown only after course is completed                                     // 1348
//     //and to be hidden once it has been already seen.                                                               // 1349
//     Meteor.call('setProgCompNotification', "Completed");                                                            // 1350
// }                                                                                                                   // 1351
/**                                                                                                                    // 1353
 * Used for a % course completion for a certificate - uncomment if needed                                              //
 */ // function setUserProgressHalfCompletionNotification(){                                                           //
//     //set flag in DB user doc to display message                                                                    // 1357
//     //flag should be either of these 3 values - null / undefined,  "Completed", HalfWay , "Read"                    // 1358
//     //this will allow for the pop-up to be shown only after course is completed                                     // 1359
//     //and to be hidden once it has been already seen.                                                               // 1360
//     Meteor.call('setProgCompNotification', "Half-Way");                                                             // 1361
// }                                                                                                                   // 1362
                                                                                                                       //
                                                                                                                       //
function getPercentageComplete(_userId) {                                                                              // 1365
    var progress = userProgress.findOne({                                                                              // 1367
        userId: _userId                                                                                                // 1367
    });                                                                                                                // 1367
    var activityCount = 0;                                                                                             // 1368
    var completedCount = 0;                                                                                            // 1369
                                                                                                                       //
    if (progress == null || progress == "undefined") {                                                                 // 1371
        return;                                                                                                        // 1371
    }                                                                                                                  // 1371
                                                                                                                       //
    for (var i = 0; i < progress.modules.length; i++) {                                                                // 1373
        for (var j = 0; j < progress.modules[i].activities.length; j++) {                                              // 1374
            activityCount++;                                                                                           // 1375
                                                                                                                       //
            if (progress.modules[i].activities[j].completed == "Completed") {                                          // 1376
                completedCount++;                                                                                      // 1377
            }                                                                                                          // 1378
        }                                                                                                              // 1379
    } //This is the current completion percent for the user                                                            // 1380
                                                                                                                       //
                                                                                                                       //
    var endPercent = parseFloat(completedCount / activityCount * 100).toFixed(1);                                      // 1383
    return endPercent;                                                                                                 // 1384
}                                                                                                                      // 1386
                                                                                                                       //
function getTimeTaken(_userId) {                                                                                       // 1388
    var progress = userProgress.findOne({                                                                              // 1389
        userId: _userId                                                                                                // 1389
    });                                                                                                                // 1389
                                                                                                                       //
    if (progress == null || progress == "undefined") {                                                                 // 1390
        return null;                                                                                                   // 1390
    }                                                                                                                  // 1390
                                                                                                                       //
    var timeTaken = 0;                                                                                                 // 1391
                                                                                                                       //
    for (var i = 0; i < progress.modules.length; i++) {                                                                // 1392
        for (var j = 0; j < progress.modules[i].activities.length; j++) {                                              // 1393
            if (typeof progress.modules[i].activities[j].timeTaken == "number") {                                      // 1394
                timeTaken = timeTaken + progress.modules[i].activities[j].timeTaken;                                   // 1395
            }                                                                                                          // 1396
        }                                                                                                              // 1397
    }                                                                                                                  // 1398
                                                                                                                       //
    return timeTaken;                                                                                                  // 1400
} /**                                                                                                                  // 1401
   * This method returns true if for a given module                                                                    //
   * the user has completed at least all-2 activities.                                                                 //
   * Otherwise, returns false.                                                                                         //
   */                                                                                                                  //
                                                                                                                       //
function checkModuleFinishedActivities(mod) {                                                                          // 1408
    var currentModule = mod - 1;                                                                                       // 1409
    var loggedUser = Meteor.userId();                                                                                  // 1410
    var uProgress = userProgress.findOne({                                                                             // 1411
        userId: loggedUser                                                                                             // 1411
    });                                                                                                                // 1411
    var allModuleActivities = uProgress.modules[currentModule].activities;                                             // 1412
    var allModuleActivitiesCount = allModuleActivities.length;                                                         // 1413
    var completedModuleActivities = 0;                                                                                 // 1414
    allModuleActivities.forEach(function (x) {                                                                         // 1416
        if (x.completed == "Completed") {                                                                              // 1417
            completedModuleActivities++;                                                                               // 1418
        }                                                                                                              // 1419
    });                                                                                                                // 1420
                                                                                                                       //
    if (allModuleActivitiesCount - completedModuleActivities <= 4) {                                                   // 1422
        return true;                                                                                                   // 1423
    } else {                                                                                                           // 1424
        return false;                                                                                                  // 1425
    }                                                                                                                  // 1426
}                                                                                                                      // 1427
                                                                                                                       //
function checkCompletedGame(moduleNum) {                                                                               // 1429
    var progress = userProgress.findOne({                                                                              // 1430
        userId: Meteor.userId()                                                                                        // 1430
    });                                                                                                                // 1430
    var moduleAcitvities = progress.modules[moduleNum - 1].activities;                                                 // 1431
    var gameActivity = moduleAcitvities[moduleAcitvities.length - 1];                                                  // 1432
    if (gameActivity.completed == "Completed") return true;                                                            // 1433
    return false;                                                                                                      // 1436
}                                                                                                                      // 1437
                                                                                                                       //
function checkAllCompletedGames() {                                                                                    // 1439
    var moduleNum = 10;                                                                                                // 1440
                                                                                                                       //
    for (var i = 1; i <= moduleNum; i++) {                                                                             // 1441
        if (!checkCompletedGame(i)) return false;                                                                      // 1442
    }                                                                                                                  // 1444
                                                                                                                       //
    return true;                                                                                                       // 1445
}                                                                                                                      // 1446
                                                                                                                       //
function showPercentageComplete() {                                                                                    // 1448
    var progress = userProgress.findOne({                                                                              // 1450
        userId: Meteor.userId()                                                                                        // 1450
    });                                                                                                                // 1450
    var activityCount = 0;                                                                                             // 1451
    var completedCount = 0;                                                                                            // 1452
                                                                                                                       //
    if (progress == null || progress == "undefined") {                                                                 // 1454
        return;                                                                                                        // 1454
    }                                                                                                                  // 1454
                                                                                                                       //
    for (var i = 0; i < progress.modules.length; i++) {                                                                // 1456
        for (var j = 0; j < progress.modules[i].activities.length; j++) {                                              // 1457
            activityCount++;                                                                                           // 1458
                                                                                                                       //
            if (progress.modules[i].activities[j].completed == "Completed") {                                          // 1459
                completedCount++;                                                                                      // 1460
            }                                                                                                          // 1461
        }                                                                                                              // 1462
    } //This is the current completion percent for the user                                                            // 1463
                                                                                                                       //
                                                                                                                       //
    var endPercent = parseFloat(completedCount / activityCount * 100).toFixed(1) / 100;                                // 1466
    return endPercent * 100;                                                                                           // 1467
}                                                                                                                      // 1469
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"voucher-methods.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/meteor-methods/voucher-methods.js                                                                            //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
Meteor.methods({                                                                                                       // 1
    //'addVoucher': function (name, description, code, discount, usage, active, limitedUsage, assessment, roles, org, group, paymentPlans, discountType) {
    'addVoucher': function (voucher) {                                                                                 // 4
        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                            // 5
            //returns true if the voucher of a given code exists in the system                                         // 7
            //parameter: voucher code                                                                                  // 8
            var checkDuplicate = function (voucherCode) {                                                              // 9
                var duplicate = vouchers.findOne({                                                                     // 10
                    code: voucherCode                                                                                  // 10
                });                                                                                                    // 10
                var duplicateApplied = appliedVouchers.findOne({                                                       // 11
                    code: voucherCode                                                                                  // 11
                });                                                                                                    // 11
                                                                                                                       //
                if (duplicate != null && duplicate != 'undefined' || duplicateApplied != null && duplicateApplied != 'undefined') {
                    return true;                                                                                       // 13
                } else {                                                                                               // 14
                    return false;                                                                                      // 15
                }                                                                                                      // 16
            };                                                                                                         // 17
                                                                                                                       //
            try {                                                                                                      // 19
                //Check if the voucher is to be used for multiple users - usageAmount > 1                              // 20
                //if so, generate different voucher for each user and return an array of                               // 21
                //voucher codes back to the client                                                                     // 22
                //Nowhere in the mongo/meteor docs can I find how to insert multiple docs when                         // 23
                //the array is already pre-defined like below... none of the documents help, so                        // 24
                //have to do it the "dumb" way 1 by 1 and hope we don't have vouchers                                  // 25
                //for more than 50 users ....                                                                          // 26
                var voucherCodes = [];                                                                                 // 28
                                                                                                                       //
                if (voucher.multipleUsage >= 1) {                                                                      // 29
                    var currCode = "";                                                                                 // 30
                    var done = voucher.multipleUsage;                                                                  // 31
                    var i = 0;                                                                                         // 32
                                                                                                                       //
                    while (done > 0) {                                                                                 // 33
                        //currCode = voucher.code + "_j2e_" + i;                                                       // 34
                        currCode = makeVoucherCode();                                                                  // 35
                        currCode = "J2E" + currCode; //currCode = voucher.code + suffix;                               // 36
                                                                                                                       //
                        if (!checkDuplicate(currCode)) {                                                               // 38
                            voucherCodes.push(currCode);                                                               // 39
                            done--;                                                                                    // 40
                        }                                                                                              // 41
                                                                                                                       //
                        i++;                                                                                           // 42
                    }                                                                                                  // 43
                } else if (voucher.singleUsage >= 1) {                                                                 // 45
                    var currCode = "";                                                                                 // 46
                    var done = voucher.singleUsage;                                                                    // 47
                                                                                                                       //
                    while (done > 0) {                                                                                 // 48
                        currCode = makeVoucherCode();                                                                  // 49
                        currCode = "J2E" + currCode;                                                                   // 50
                                                                                                                       //
                        if (!checkDuplicate(currCode)) {                                                               // 51
                            vouchers.insert({                                                                          // 52
                                "name": voucher.name,                                                                  // 53
                                "description": voucher.description,                                                    // 54
                                "code": currCode,                                                                      // 55
                                "discount": voucher.discount,                                                          // 56
                                "discountType": voucher.discountType,                                                  // 57
                                "applyPlans": voucher.paymentPlans,                                                    // 58
                                "active": voucher.active,                                                              // 59
                                "limitedUsage": voucher.limitedUsage,                                                  // 60
                                "usageAmount": voucher.singleUsage,                                                    // 61
                                "initialAssess": voucher.assessment,                                                   // 62
                                "uId": voucher.uId,                                                                    // 63
                                "applyGroup": voucher.roles,                                                           // 64
                                "applyOrgID": voucher.org,                                                             // 65
                                "applyGroupID": voucher.group                                                          // 66
                            });                                                                                        // 52
                            done = 0;                                                                                  // 68
                        }                                                                                              // 69
                    }                                                                                                  // 70
                                                                                                                       //
                    return currCode;                                                                                   // 71
                } else {                                                                                               // 76
                    if (checkDuplicate(voucher.code)) {                                                                // 77
                        throw new Meteor.Error("This voucher code already exists. Please try again.");                 // 78
                    }                                                                                                  // 79
                                                                                                                       //
                    voucherCodes.push(voucher.code);                                                                   // 80
                }                                                                                                      // 81
                                                                                                                       //
                voucherCodes.forEach(function (code) {                                                                 // 83
                    vouchers.insert({                                                                                  // 84
                        "name": voucher.name,                                                                          // 85
                        "description": voucher.description,                                                            // 86
                        "code": code,                                                                                  // 87
                        "discount": voucher.discount,                                                                  // 88
                        "discountType": voucher.discountType,                                                          // 89
                        "applyPlans": voucher.paymentPlans,                                                            // 90
                        "active": voucher.active,                                                                      // 91
                        "limitedUsage": voucher.limitedUsage,                                                          // 92
                        "usageAmount": 1,                                                                              // 93
                        "initialAssess": voucher.assessment,                                                           // 94
                        "uId": voucher.uId,                                                                            // 95
                        "applyGroup": voucher.roles,                                                                   // 96
                        "applyOrgID": voucher.org,                                                                     // 97
                        "applyGroupID": voucher.group                                                                  // 98
                    });                                                                                                // 84
                });                                                                                                    // 100
                return voucherCodes;                                                                                   // 102
            } catch (err) {                                                                                            // 104
                throw new Meteor.Error(err.message);                                                                   // 105
            }                                                                                                          // 106
        } else {                                                                                                       // 107
            throw new Meteor.Error(500, 'You\'re not an admin - no permission to add voucher.');                       // 108
        }                                                                                                              // 109
    },                                                                                                                 // 110
    'deleteVoucher': function (vId) {                                                                                  // 112
        if (Roles.userIsInRole(Meteor.userId(), 'admin')) {                                                            // 113
            vouchers.remove({                                                                                          // 114
                _id: vId                                                                                               // 114
            });                                                                                                        // 114
        } else {                                                                                                       // 115
            throw new Meteor.Error(500, 'You\'re not authorised.');                                                    // 117
        }                                                                                                              // 118
    },                                                                                                                 // 119
    //Code not used anywhere                                                                                           // 121
    'getVoucherByCode': function (vCode) {                                                                             // 122
        var voucher = vouchers.findOne({                                                                               // 123
            code: vCode                                                                                                // 123
        });                                                                                                            // 123
                                                                                                                       //
        if (voucher == null || voucher == 'undefined') {                                                               // 124
            throw new Meteor.Error(500, 'No such voucher code');                                                       // 125
        } else {                                                                                                       // 126
            return voucher;                                                                                            // 127
        }                                                                                                              // 128
    },                                                                                                                 // 129
    'voucherUsed': function (vCode, uId) {                                                                             // 131
        var dateTime = new Date();                                                                                     // 132
        appliedVouchers.insert({                                                                                       // 133
            code: vCode,                                                                                               // 133
            userId: uId,                                                                                               // 133
            date: dateTime                                                                                             // 133
        });                                                                                                            // 133
    }                                                                                                                  // 134
});                                                                                                                    // 1
                                                                                                                       //
var makeVoucherCode = function () {                                                                                    // 137
    var code = "";                                                                                                     // 138
    var possibleChars = "ABCDEFGHIJKLMNPQRSTUVWXYZ123456789"; /**                                                      // 139
                                                               * Below can be used if the randomisation is implemented with regular expressions
                                                               */ // var lowerChar = new RegExp(/[a-z]/);              //
    // var upperChar = new RegExp(/[A-Z]/);                                                                            // 144
    // var digit = new RegExp(/\d/);                                                                                   // 145
    // var notDigit = new RegExp(/\D/);                                                                                // 146
    // var finalRegEx = new RegExp("(" + lowerChar.source + ")|(" + upperChar.source + ")|(" + digit.source + ")|(" + notDigit.source + ")");
                                                                                                                       //
    for (var i = 0; i < 11; i++) {                                                                                     // 149
        code += possibleChars.charAt(Math.floor(Math.random() * possibleChars.length));                                // 150
    }                                                                                                                  // 151
                                                                                                                       //
    return code;                                                                                                       // 153
};                                                                                                                     // 154
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}},"collections.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/collections.js                                                                                               //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
userNotes = new Mongo.Collection('userNotes');                                                                         // 2
userProgress = new Mongo.Collection('userProgress');                                                                   // 3
gameAccess = new Mongo.Collection('gameAccess');                                                                       // 4
groups = new Mongo.Collection('groups');                                                                               // 5
subgroups = new Mongo.Collection('subgroups');                                                                         // 6
organisations = new Mongo.Collection('organisations');                                                                 // 7
                                                                                                                       //
organisations._ensureIndex({                                                                                           // 8
    name: 1                                                                                                            // 8
}, {                                                                                                                   // 8
    unique: 1                                                                                                          // 8
});                                                                                                                    // 8
                                                                                                                       //
studentAssessments = new Mongo.Collection('studentAssessments');                                                       // 9
assessmentTypes = new Mongo.Collection('assessmentTypes');                                                             // 10
f_forums = new Mongo.Collection('f_forums');                                                                           // 11
bug_reports = new Mongo.Collection('bug_reports');                                                                     // 13
feedback_forms = new Mongo.Collection('feedback_forms');                                                               // 14
contact_form = new Mongo.Collection('contact_form');                                                                   // 15
duration_log = new Mongo.Collection('duration_log');                                                                   // 17
messages = new Mongo.Collection('messages');                                                                           // 18
ContactMails = new Mongo.Collection('contact_mail');                                                                   // 20
stripeLog = new Mongo.Collection('stripe_log');                                                                        // 21
payment_plans = new Mongo.Collection('payment_plans');                                                                 // 22
vouchers = new Mongo.Collection('vouchers');                                                                           // 23
appliedVouchers = new Mongo.Collection('appliedVouchers');                                                             // 24
Announcements = new Mongo.Collection('Announcements');                                                                 // 25
customEmails = new Mongo.Collection('customEmails');                                                                   // 26
CGBadgeData = new Mongo.Collection('CGBadgeData');                                                                     // 28
toolRecs = new Mongo.Collection('toolRecs');                                                                           // 30
toolRecs.allow({                                                                                                       // 32
    insert: function (userId, doc) {                                                                                   // 33
        if (userId) {                                                                                                  // 34
            return true;                                                                                               // 35
        }                                                                                                              // 36
    },                                                                                                                 // 37
    update: function () {                                                                                              // 38
        return true;                                                                                                   // 39
    },                                                                                                                 // 40
    remove: function () {                                                                                              // 41
        return true;                                                                                                   // 42
    }                                                                                                                  // 43
}); /****************************************************************                                                  // 32
    *****************************************************************                                                  //
    *                                                                                                                  //
    *                    audioRecordings                                                                               //
    *                                                                                                                  //
    *****************************************************************                                                  //
    *****************************************************************/ /*                                              //
                                                                       * - audioRecordings collection is used to hold each student's Voice Recorder
                                                                       *   entry.                                      //
                                                                       *                                               //
                                                                       */ // var audioStore = new FS.Store.FileSystem("audio-recordings", {
//     maxTries: 5, // optional, default 5                                                                             // 60
//     path: "cfs/audioRecs/files"                                                                                     // 61
//     //chunkSize: 1024 * 1024,  // optional, default GridFS chunk size in bytes (can be overridden per file).        // 62
//     // Default: 2MB. Reasonable range: 512KB - 4MB                                                                  // 63
// });                                                                                                                 // 64
// audioRecordings = new FS.Collection("audioRecordings", {                                                            // 66
//     stores: [audioStore]                                                                                            // 67
// });                                                                                                                 // 68
// audioRecordings.allow({                                                                                             // 70
//     insert: function (userId, doc) {                                                                                // 71
//         if (userId) {                                                                                               // 72
//             return true;                                                                                            // 73
//         }                                                                                                           // 74
//     },                                                                                                              // 75
//     update: function () {                                                                                           // 76
//         return true;                                                                                                // 77
//     },                                                                                                              // 78
//     remove: function () {                                                                                           // 79
//         return true;                                                                                                // 80
//     },                                                                                                              // 81
//     download: function () {                                                                                         // 82
//         return true;                                                                                                // 83
//     }                                                                                                               // 84
// })                                                                                                                  // 85
                                                                                                                       //
var audioStore = new FS.Store.S3("audio-recordings", {                                                                 // 87
    region: "eu-west-2",                                                                                               // 88
    accessKeyId: "AKIAJWTNAETF776YKCFQ",                                                                               // 89
    secretAccessKey: "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",                                                       // 90
    bucket: "j2e-recordings"                                                                                           // 91
});                                                                                                                    // 87
audioRecordings = new FS.Collection("audioRecordings", {                                                               // 94
    stores: [audioStore]                                                                                               // 95
});                                                                                                                    // 94
audioRecordings.allow({                                                                                                // 98
    insert: function (userId, doc) {                                                                                   // 99
        if (userId) {                                                                                                  // 100
            return true;                                                                                               // 101
        }                                                                                                              // 102
    },                                                                                                                 // 103
    update: function () {                                                                                              // 104
        return true;                                                                                                   // 105
    },                                                                                                                 // 106
    remove: function () {                                                                                              // 107
        return true;                                                                                                   // 108
    },                                                                                                                 // 109
    download: function () {                                                                                            // 110
        return true;                                                                                                   // 111
    }                                                                                                                  // 112
}); /*********************************************************************                                             // 98
    **********************************************************************                                             //
    **********************************************************************                                             //
    **********************************************************************/ /****************************************************************
                                                                            *****************************************************************
                                                                            *                                          //
                                                                            *                    commentAudioRecordings
                                                                            *                                          //
                                                                            *****************************************************************
                                                                            *****************************************************************/ /*
                                                                                                                                               * - commentAudioRecordings collection is used to hold audio replies to audioRecordings.
                                                                                                                                               *
                                                                                                                                               */ // var commentStore = new FS.Store.FileSystem("comment-recordings", {
//     maxTries: 5, // optional, default 5                                                                             // 132
//     path: "cfs/commentRecs/files"                                                                                   // 133
//     //chunkSize: 1024 * 1024  // optional, default GridFS chunk size in bytes (can be overridden per file).         // 134
//     // Default: 2MB. Reasonable range: 512KB - 4MB                                                                  // 135
// });                                                                                                                 // 136
// commentRecordings = new FS.Collection("commentRecordings", {                                                        // 138
//     stores: [commentStore]                                                                                          // 139
// });                                                                                                                 // 140
// commentRecordings.allow({                                                                                           // 142
//     insert: function (userId, doc) {                                                                                // 143
//         if (userId) {                                                                                               // 144
//             return true;                                                                                            // 145
//         }                                                                                                           // 146
//     },                                                                                                              // 147
//     update: function () {                                                                                           // 148
//         return true;                                                                                                // 149
//     },                                                                                                              // 150
//     remove: function () {                                                                                           // 151
//         return true;                                                                                                // 152
//     },                                                                                                              // 153
//     download: function () {                                                                                         // 154
//         return true;                                                                                                // 155
//     }                                                                                                               // 156
// })                                                                                                                  // 157
                                                                                                                       //
var commentStore = new FS.Store.S3("comment-recordings", {                                                             // 159
    region: "eu-west-2",                                                                                               // 160
    accessKeyId: "AKIAJWTNAETF776YKCFQ",                                                                               // 161
    secretAccessKey: "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",                                                       // 162
    bucket: "j2e-recordings"                                                                                           // 163
});                                                                                                                    // 159
commentRecordings = new FS.Collection("commentRecordings", {                                                           // 166
    stores: [commentStore]                                                                                             // 167
});                                                                                                                    // 166
commentRecordings.allow({                                                                                              // 170
    insert: function (userId, doc) {                                                                                   // 171
        if (userId) {                                                                                                  // 172
            return true;                                                                                               // 173
        }                                                                                                              // 174
    },                                                                                                                 // 175
    update: function () {                                                                                              // 176
        return true;                                                                                                   // 177
    },                                                                                                                 // 178
    remove: function () {                                                                                              // 179
        return true;                                                                                                   // 180
    },                                                                                                                 // 181
    download: function () {                                                                                            // 182
        return true;                                                                                                   // 183
    }                                                                                                                  // 184
}); /*********************************************************************                                             // 170
    **********************************************************************                                             //
    **********************************************************************                                             //
    **********************************************************************/ /****************************************************************
                                                                            *****************************************************************
                                                                            *                                          //
                                                                            *                    assessmentRecordings  //
                                                                            *                                          //
                                                                            *****************************************************************
                                                                            *****************************************************************/ /*
                                                                                                                                               * - assessmentRecordings collection is used to hold recordings used in assessments.
                                                                                                                                               *
                                                                                                                                               */ // var assessmentStore = new FS.Store.FileSystem("assessment-recordings", {
//     maxTries: 5, // optional, default 5                                                                             // 205
//     path: "cfs/assessmentRecs/files"                                                                                // 206
//     //chunkSize: 1024 * 1024  // optional, default GridFS chunk size in bytes (can be overridden per file).         // 207
//     // Default: 2MB. Reasonable range: 512KB - 4MB                                                                  // 208
// });                                                                                                                 // 209
// assessmentRecordings = new FS.Collection("assessmentRecordings", {                                                  // 211
//     stores: [assessmentStore]                                                                                       // 212
// });                                                                                                                 // 213
// assessmentRecordings.allow({                                                                                        // 215
//     insert: function (userId, doc) {                                                                                // 216
//         if (userId) {                                                                                               // 217
//             return true;                                                                                            // 218
//         }                                                                                                           // 219
//     },                                                                                                              // 220
//     update: function () {                                                                                           // 221
//         return true;                                                                                                // 222
//     },                                                                                                              // 223
//     remove: function () {                                                                                           // 224
//         return true;                                                                                                // 225
//     },                                                                                                              // 226
//     download: function () {                                                                                         // 227
//         return true;                                                                                                // 228
//     }                                                                                                               // 229
// })                                                                                                                  // 230
                                                                                                                       //
var assessmentStore = new FS.Store.S3("assessment-recordings", {                                                       // 232
    region: "eu-west-2",                                                                                               // 233
    accessKeyId: "AKIAJWTNAETF776YKCFQ",                                                                               // 234
    secretAccessKey: "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",                                                       // 235
    bucket: "j2e-recordings"                                                                                           // 236
});                                                                                                                    // 232
assessmentRecordings = new FS.Collection("assessmentRecordings", {                                                     // 239
    stores: [assessmentStore]                                                                                          // 240
});                                                                                                                    // 239
assessmentRecordings.allow({                                                                                           // 243
    insert: function (userId, doc) {                                                                                   // 244
        if (userId) {                                                                                                  // 245
            return true;                                                                                               // 246
        }                                                                                                              // 247
    },                                                                                                                 // 248
    update: function () {                                                                                              // 249
        return true;                                                                                                   // 250
    },                                                                                                                 // 251
    remove: function () {                                                                                              // 252
        return true;                                                                                                   // 253
    },                                                                                                                 // 254
    download: function () {                                                                                            // 255
        return true;                                                                                                   // 256
    }                                                                                                                  // 257
}); /****************************************************************                                                  // 243
    *****************************************************************                                                  //
    *                                                                                                                  //
    *                custom organisations logos                                                                        //
    *                                                                                                                  //
    *****************************************************************                                                  //
    *****************************************************************/ // Orglogos = new FS.Collection("orglogos", {   //
//     stores: [                                                                                                       // 268
//         new FS.Store.GridFS("original", { path: "/public/images/logos" }),                                          // 269
//         new FS.Store.GridFS("thumb", { path: "/public/images/logos" })                                              // 270
//     ],                                                                                                              // 271
//     filter: {                                                                                                       // 272
//         maxSize: 32000000, //32Mb                                                                                   // 273
//         allow: { contentTypes: ['image/*'] }                                                                        // 274
//     },                                                                                                              // 275
//     onInvalid: function (message) {                                                                                 // 276
//         //throw new Meteor.Error(403, message);                                                                     // 277
//     }                                                                                                               // 278
// });                                                                                                                 // 279
                                                                                                                       //
Orglogos = new FS.Collection("Orglogos", {                                                                             // 281
    stores: [new FS.Store.FileSystem("OrgLogosOriginals", {                                                            // 282
        path: "cfs/orgLogosOrig/files"                                                                                 // 283
    }), new FS.Store.FileSystem("OrgLogosThumbs", {                                                                    // 283
        path: "cfs/orgLogosThumbs/files"                                                                               // 284
    })],                                                                                                               // 284
    filter: {                                                                                                          // 286
        allow: {                                                                                                       // 287
            contentTypes: ['image/*']                                                                                  // 287
        }                                                                                                              // 287
    },                                                                                                                 // 286
    onInvalid: function (message) {                                                                                    // 289
        alert(message);                                                                                                // 290
    }                                                                                                                  // 291
});                                                                                                                    // 281
Orglogos.allow({                                                                                                       // 294
    insert: function (userId, doc) {                                                                                   // 295
        if (userId) {                                                                                                  // 296
            return true;                                                                                               // 297
        }                                                                                                              // 298
    },                                                                                                                 // 299
    update: function (userId, doc, fields, modifiers) {                                                                // 300
        return true;                                                                                                   // 301
    },                                                                                                                 // 302
    download: function () {                                                                                            // 303
        return true;                                                                                                   // 304
    }                                                                                                                  // 305
});                                                                                                                    // 294
LogoURLs = new Mongo.Collection("LogoURLs");                                                                           // 308
LogoURLs.allow({                                                                                                       // 310
    insert: function () {                                                                                              // 311
        return true;                                                                                                   // 312
    },                                                                                                                 // 313
    update: function (userId, doc, fields, modifiers) {                                                                // 314
        return true;                                                                                                   // 315
    }                                                                                                                  // 316
});                                                                                                                    // 310
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"mailchimp.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/mailchimp.js                                                                                                 //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// var settings = Meteor.settings.private.MailChimp,                                                                   // 1
//     chimp    = new MailChimp( settings.apiKey, { version: '2.0' } ),                                                // 2
//     listId   = settings.listId;                                                                                     // 3
// Meteor.methods({                                                                                                    // 5
//    getSubscribers: function() {                                                                                     // 6
//     try {                                                                                                           // 7
//       var subscribers = chimp.call( 'lists', 'members', {                                                           // 8
//         id: listId,                                                                                                 // 9
//         status: 'subscribed'                                                                                        // 10
//       });                                                                                                           // 11
//       subscribers = _.map( subscribers.data, function( subscriber ) {                                               // 13
//         return { email: subscriber.email };                                                                         // 14
//       });                                                                                                           // 15
//       return subscribers;                                                                                           // 17
//     } catch( exception ) {                                                                                          // 18
//       return exception;                                                                                             // 19
//     }                                                                                                               // 20
//   },                                                                                                                // 21
//   handleSubscriber: function( subscriber ) {                                                                        // 22
//     check( subscriber, {                                                                                            // 23
//       email: String,                                                                                                // 24
//       action: String                                                                                                // 25
//     });                                                                                                             // 26
//     try {                                                                                                           // 28
//       var subscribe = chimp.call( 'lists', subscriber.action, {                                                     // 29
//         id: listId,                                                                                                 // 30
//         email: {                                                                                                    // 31
//           email: subscriber.email                                                                                   // 32
//         }                                                                                                           // 33
//       });                                                                                                           // 34
//       return subscribe;                                                                                             // 36
//     } catch( exception ) {                                                                                          // 37
//       return exception;                                                                                             // 38
//     }                                                                                                               // 39
//   }                                                                                                                 // 40
// });                                                                                                                 // 41
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"publish.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/publish.js                                                                                                   //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
/**                                                                                                                    // 2
*	@summary: Publishes data from 'userNotes' collection. Data should be published in the following way.                 //
*				- Admins can see all notes and comments.                                                                          //
*				- Tutors can only see their own comments and notes of Students in their groups.                                   //
*				- Students can only see their own notes and the comments from a Tutor.                                            //
*/Meteor.publish("nbnotes", function () {                                                                              //
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 9
		return userNotes.find({});                                                                                           // 10
	} else if (Roles.userIsInRole(this.userId, 'moderator')) {                                                            // 11
		var userDoc = Meteor.users.findOne({                                                                                 // 12
			_id: this.userId                                                                                                    // 12
		});                                                                                                                  // 12
		var userArray = [];                                                                                                  // 13
		userArray = Meteor.users.find({                                                                                      // 14
			"organisation": {                                                                                                   // 15
				$in: userDoc.organisation                                                                                          // 15
			}                                                                                                                   // 15
		}).map(function (user) {                                                                                             // 14
			return user._id;                                                                                                    // 17
		});                                                                                                                  // 18
		var result = userArray.map(function (item) {                                                                         // 19
			return item.toString();                                                                                             // 20
		});                                                                                                                  // 21
		return userNotes.find({                                                                                              // 22
			noteAuthor: {                                                                                                       // 22
				$in: result                                                                                                        // 22
			}                                                                                                                   // 22
		});                                                                                                                  // 22
	} else if (Roles.userIsInRole(this.userId, 'tutor')) {                                                                // 23
		var studentArray = [];                                                                                               // 24
		var cursor = groups.find({                                                                                           // 25
			"tutors": this.userId                                                                                               // 25
		});                                                                                                                  // 25
		cursor.forEach(function (doc) {                                                                                      // 26
			for (var i = 0; i < doc.students.length; i++) {                                                                     // 27
				studentArray.push(doc.students[i]);                                                                                // 28
			}                                                                                                                   // 29
		});                                                                                                                  // 30
		var result = studentArray.map(function (item) {                                                                      // 31
			return item.toString();                                                                                             // 32
		});                                                                                                                  // 33
		result.push(this.userId);                                                                                            // 34
		return userNotes.find({                                                                                              // 35
			noteAuthor: {                                                                                                       // 35
				$in: result                                                                                                        // 35
			}                                                                                                                   // 35
		});                                                                                                                  // 35
	} else {                                                                                                              // 36
		return userNotes.find({                                                                                              // 37
			noteAuthor: this.userId                                                                                             // 37
		});                                                                                                                  // 37
	}                                                                                                                     // 38
}); /**                                                                                                                // 39
    *	@summary: Publishes data from the 'organisations' collection. Data should be published in the following way:     //
    *				- Admins can see all organisations and the users that constitute each organisation.                           //
    *				- Tutors and Moderators can only see organisations to which they belong.                                      //
    *				- Students can only see organisations to which they belong.                                                   //
    */                                                                                                                 //
Meteor.publish("organisations", function () {                                                                          // 47
	// Rule 1                                                                                                             // 48
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 49
		return organisations.find({});                                                                                       // 50
	} // Rule 2 & Rule 3 (Non-Admins)                                                                                     // 51
	else {                                                                                                                // 49
			if (!this.userId) {                                                                                                 // 53
				return;                                                                                                            // 54
			}                                                                                                                   // 55
                                                                                                                       //
			var user = Meteor.users.findOne({                                                                                   // 56
				_id: this.userId                                                                                                   // 56
			});                                                                                                                 // 56
			var userOrganisation = user.organisation;                                                                           // 57
			return organisations.find({                                                                                         // 58
				_id: {                                                                                                             // 58
					$in: userOrganisation                                                                                             // 58
				}                                                                                                                  // 58
			});                                                                                                                 // 58
		}                                                                                                                    // 59
});                                                                                                                    // 60
Meteor.publish("group", function (groupId) {                                                                           // 62
	return groups.find({                                                                                                  // 63
		_id: groupId                                                                                                         // 63
	});                                                                                                                   // 63
});                                                                                                                    // 64
Meteor.publish("messages", function () {                                                                               // 67
	var uID = this.userId;                                                                                                // 68
	return messages.find({                                                                                                // 69
		"$or": [{                                                                                                            // 69
			"p1": uID                                                                                                           // 69
		}, {                                                                                                                 // 69
			"p2": uID                                                                                                           // 69
		}]                                                                                                                   // 69
	});                                                                                                                   // 69
}); /**                                                                                                                // 70
    *	@summary: Publishes data from the 'groups' collection. Data should be published in the following way:            //
    *				- Admins can see all groups and the users that constitute each group.                                         //
    *				- Tutors and Moderators can only see groups belonging to their organisation and their constituents.           //
    *				- Students can only see Groups to which they belong and other users in the same group as them.                //
    */                                                                                                                 //
Meteor.publish("groups", function () {                                                                                 // 77
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 79
		return groups.find({});                                                                                              // 80
	} else if (Roles.userIsInRole(this.userId, 'moderator') || Roles.userIsInRole(this.userId, 'tutor')) {                // 81
		var user = Meteor.users.findOne({                                                                                    // 82
			_id: this.userId                                                                                                    // 82
		});                                                                                                                  // 82
		var userOrganisation = user.organisation;                                                                            // 83
		return groups.find({                                                                                                 // 84
			organisation: {                                                                                                     // 84
				$in: userOrganisation                                                                                              // 84
			}                                                                                                                   // 84
		});                                                                                                                  // 84
	} else {                                                                                                              // 85
		var user = Meteor.users.findOne({                                                                                    // 86
			_id: this.userId                                                                                                    // 86
		});                                                                                                                  // 86
                                                                                                                       //
		if (user.groups) {                                                                                                   // 87
			var userGroups = user.groups;                                                                                       // 88
			return groups.find({                                                                                                // 89
				_id: {                                                                                                             // 89
					$in: userGroups                                                                                                   // 89
				}                                                                                                                  // 89
			});                                                                                                                 // 89
		}                                                                                                                    // 90
	}                                                                                                                     // 91
}); /**                                                                                                                // 92
    *	@summary: Publishes data from the 'subgroups' collection. Data should be published in the following way:         //
    *				- Admins can see all subgroups and the users that constitute each subgroups.                                  //
    *				- Tutors and Moderators can only see subgroups belonging to their organisation and their constituents.        //
    *				- Students can only see subgroups to which they belong and other users in the same group as them.             //
    */                                                                                                                 //
Meteor.publish("subgroups", function () {                                                                              // 100
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 101
		return subgroups.find({});                                                                                           // 102
	} else if (Roles.userIsInRole(this.userId, 'moderator') || Roles.userIsInRole(this.userId, 'tutor')) {                // 103
		var user = Meteor.users.findOne({                                                                                    // 104
			_id: this.userId                                                                                                    // 104
		});                                                                                                                  // 104
		var userOrganisation = user.organisation;                                                                            // 105
		return subgroups.find({                                                                                              // 107
			organisation: {                                                                                                     // 107
				$in: userOrganisation                                                                                              // 107
			}                                                                                                                   // 107
		});                                                                                                                  // 107
	} else {                                                                                                              // 108
		var user = Meteor.users.findOne({                                                                                    // 109
			_id: this.userId                                                                                                    // 109
		});                                                                                                                  // 109
                                                                                                                       //
		if (user.subgroups) {                                                                                                // 110
			var userSubgroups = user.subgroups;                                                                                 // 111
			return subgroups.find({                                                                                             // 113
				_id: {                                                                                                             // 113
					$in: userSubgroups                                                                                                // 113
				}                                                                                                                  // 113
			});                                                                                                                 // 113
		}                                                                                                                    // 114
	}                                                                                                                     // 115
}); /**                                                                                                                // 116
    *	@summary: Publishes data from the 'audioRecordings' collection. Data should be published in the following way:   //
    *			- Admins can see all recordings                                                                                //
    *			- Moderators can see all recordings by Users in their organisation.                                            //
    *			- Tutors can only see recordings by Users in their group.                                                      //
    *			- Students can only hear their own recordings and replies from Tutors.                                         //
    */                                                                                                                 //
Meteor.publish("audioRecordings", function () {                                                                        // 125
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 126
		return audioRecordings.find({});                                                                                     // 127
	} else if (Roles.userIsInRole(this.userId, 'moderator')) {                                                            // 128
		var userDoc = Meteor.users.findOne({                                                                                 // 129
			_id: this.userId                                                                                                    // 129
		});                                                                                                                  // 129
		var userArray = [];                                                                                                  // 130
		userArray = Meteor.users.find({                                                                                      // 131
			"organisation": {                                                                                                   // 132
				$in: userDoc.organisation                                                                                          // 132
			}                                                                                                                   // 132
		}).map(function (user) {                                                                                             // 131
			return user._id;                                                                                                    // 134
		});                                                                                                                  // 135
		var result = userArray.map(function (item) {                                                                         // 136
			return item.toString();                                                                                             // 137
		});                                                                                                                  // 138
		return audioRecordings.find({                                                                                        // 139
			audioAuthor: {                                                                                                      // 139
				$in: result                                                                                                        // 139
			}                                                                                                                   // 139
		});                                                                                                                  // 139
	} else if (Roles.userIsInRole(this.userId, 'tutor')) {                                                                // 140
		var studentArray = [];                                                                                               // 141
		var cursor = groups.find({                                                                                           // 142
			"tutors": this.userId                                                                                               // 142
		});                                                                                                                  // 142
		cursor.forEach(function (doc) {                                                                                      // 143
			for (var i = 0; i < doc.students.length; i++) {                                                                     // 144
				studentArray.push(doc.students[i]);                                                                                // 145
			}                                                                                                                   // 146
		});                                                                                                                  // 147
		var result = studentArray.map(function (item) {                                                                      // 148
			return item.toString();                                                                                             // 149
		});                                                                                                                  // 150
		result.push(this.userId);                                                                                            // 151
		return audioRecordings.find({                                                                                        // 152
			audioAuthor: {                                                                                                      // 152
				$in: result                                                                                                        // 152
			}                                                                                                                   // 152
		});                                                                                                                  // 152
	} else {                                                                                                              // 153
		return audioRecordings.find({                                                                                        // 154
			audioAuthor: this.userId                                                                                            // 154
		});                                                                                                                  // 154
	}                                                                                                                     // 155
}); /**                                                                                                                // 156
    *	@summary: Publishes data from the 'commentAudioRecordings' collection. Data should be published in the following way:
    *			- Admins can see all recordings.                                                                               //
    *			- Moderators can see all recordings by Users in their organisation.                                            //
    *			- Tutors can only see recordings by Users in their group.                                                      //
    *			- Students can only hear their own recordings and replies from Tutors.                                         //
    */                                                                                                                 //
Meteor.publish("commentAudioRecordings", function () {                                                                 // 165
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 166
		return commentRecordings.find({});                                                                                   // 167
	} else if (Roles.userIsInRole(this.userId, 'moderator')) {                                                            // 168
		var userDoc = Meteor.users.findOne({                                                                                 // 169
			_id: this.userId                                                                                                    // 169
		});                                                                                                                  // 169
		var userArray = [];                                                                                                  // 170
		userArray = Meteor.users.find({                                                                                      // 171
			"organisation": {                                                                                                   // 172
				$in: userDoc.organisation                                                                                          // 172
			}                                                                                                                   // 172
		}).map(function (user) {                                                                                             // 171
			return user._id;                                                                                                    // 174
		});                                                                                                                  // 175
		var result = userArray.map(function (item) {                                                                         // 176
			return item.toString();                                                                                             // 177
		});                                                                                                                  // 178
		return commentRecordings.find({                                                                                      // 179
			audioAuthor: {                                                                                                      // 179
				$in: result                                                                                                        // 179
			}                                                                                                                   // 179
		});                                                                                                                  // 179
	} else if (Roles.userIsInRole(this.userId, 'tutor')) {                                                                // 180
		var studentArray = [];                                                                                               // 181
		var cursor = groups.find({                                                                                           // 182
			"tutors": this.userId                                                                                               // 182
		});                                                                                                                  // 182
		cursor.forEach(function (doc) {                                                                                      // 183
			for (var i = 0; i < doc.students.length; i++) {                                                                     // 184
				studentArray.push(doc.students[i]);                                                                                // 185
			}                                                                                                                   // 186
		});                                                                                                                  // 187
		var commentArray = [];                                                                                               // 189
		var audioCursor = audioRecordings.find({                                                                             // 190
			audioAuthor: {                                                                                                      // 190
				$in: studentArray                                                                                                  // 190
			}                                                                                                                   // 190
		});                                                                                                                  // 190
		audioCursor.forEach(function (doc) {                                                                                 // 191
			for (var i = 0; i < doc.comments.length; i++) {                                                                     // 192
				if (doc.comments[i].type == "audio") {                                                                             // 193
					commentArray.push(doc.comments[i]._id);                                                                           // 194
				}                                                                                                                  // 195
			}                                                                                                                   // 196
		});                                                                                                                  // 197
		var result = commentArray.map(function (item) {                                                                      // 199
			return item.toString();                                                                                             // 200
		});                                                                                                                  // 201
		return commentRecordings.find({                                                                                      // 204
			_id: {                                                                                                              // 204
				$in: result                                                                                                        // 204
			}                                                                                                                   // 204
		});                                                                                                                  // 204
	} else if (Roles.userIsInRole(this.userId, 'student')) {                                                              // 205
		var commentArray = [];                                                                                               // 206
		var cursor = audioRecordings.find({                                                                                  // 207
			"audioAuthor": this.userId                                                                                          // 207
		});                                                                                                                  // 207
		cursor.forEach(function (doc) {                                                                                      // 208
			for (var i = 0; i < doc.comments.length; i++) {                                                                     // 209
				if (doc.comments[i].type == "audio") {                                                                             // 210
					commentArray.push(doc.comments[i]._id);                                                                           // 211
				}                                                                                                                  // 212
			}                                                                                                                   // 213
		});                                                                                                                  // 214
		var result = commentArray.map(function (item) {                                                                      // 215
			return item.toString();                                                                                             // 216
		});                                                                                                                  // 217
		return commentRecordings.find({                                                                                      // 218
			_id: {                                                                                                              // 218
				$in: result                                                                                                        // 218
			}                                                                                                                   // 218
		});                                                                                                                  // 218
	}                                                                                                                     // 219
});                                                                                                                    // 220
Meteor.publish("assessmentRecordings", function () {                                                                   // 222
	return assessmentRecordings.find({});                                                                                 // 223
});                                                                                                                    // 224
Meteor.publish("connectionCheck", function (user, assessment, section) {                                               // 226
	this.onStop(function () {                                                                                             // 227
		Meteor.call('handleAssessmentDisconnect', user, assessment, section);                                                // 228
	});                                                                                                                   // 229
	return undefined;                                                                                                     // 230
});                                                                                                                    // 231
Meteor.publish("pauseConnection", function (mod, act, user) {                                                          // 233
	var uId = user;                                                                                                       // 235
	this.onStop(function () {                                                                                             // 236
		Meteor.call('setPauseActivity', mod, act, uId);                                                                      // 237
	});                                                                                                                   // 238
}); /**                                                                                                                // 239
    *	@summary: Publishes user data from the 'users' collection. Data should be published in the following way:        //
    *			- Admins can see all user data.                                                                                //
    *			- Tutors can see users in the organisation                                                                     //
    *			- Students can only only see users in their groups.                                                            //
    */                                                                                                                 //
Meteor.publish("Users", function () {                                                                                  // 247
	var trial = organisations.findOne({                                                                                   // 249
		name: "Trial"                                                                                                        // 249
	});                                                                                                                   // 249
	var user = Meteor.users.findOne({                                                                                     // 250
		_id: this.userId                                                                                                     // 250
	});                                                                                                                   // 250
	if (user == null || user == 'undefined') return null;                                                                 // 252
	var orgId = user.organisation;                                                                                        // 255
                                                                                                                       //
	if (trial != null && trial != 'undefined') {                                                                          // 257
		trial = trial._id;                                                                                                   // 258
	}                                                                                                                     // 259
                                                                                                                       //
	if (orgId == trial) {                                                                                                 // 261
		return Meteor.users.find({                                                                                           // 262
			roles: {                                                                                                            // 262
				$ne: "tutor"                                                                                                       // 262
			}                                                                                                                   // 262
		});                                                                                                                  // 262
	} else {                                                                                                              // 263
		if (Roles.userIsInRole(this.userId, 'admin')) {                                                                      // 264
			return Meteor.users.find({});                                                                                       // 266
		} else if (Roles.userIsInRole(this.userId, 'moderator')) {                                                           // 268
			var user = Meteor.users.findOne({                                                                                   // 270
				_id: this.userId                                                                                                   // 270
			});                                                                                                                 // 270
			var userOrganisation = user.organisation;                                                                           // 271
			return Meteor.users.find({                                                                                          // 272
				organisation: {                                                                                                    // 272
					$in: userOrganisation                                                                                             // 272
				},                                                                                                                 // 272
				"roles": {                                                                                                         // 272
					$ne: "admin"                                                                                                      // 272
				}                                                                                                                  // 272
			});                                                                                                                 // 272
		} else if (Roles.userIsInRole(this.userId, 'tutor')) {                                                               // 274
			var user = Meteor.users.findOne({                                                                                   // 276
				_id: this.userId                                                                                                   // 276
			});                                                                                                                 // 276
			var userOrganisation = user.organisation;                                                                           // 277
			return Meteor.users.find({                                                                                          // 278
				organisation: {                                                                                                    // 278
					$in: userOrganisation                                                                                             // 278
				},                                                                                                                 // 278
				"roles": {                                                                                                         // 278
					$ne: "admin"                                                                                                      // 278
				}                                                                                                                  // 278
			});                                                                                                                 // 278
		} else if (Roles.userIsInRole(this.userId, 'student')) {                                                             // 280
			var studentArray = [];                                                                                              // 282
			var cursor = groups.find({                                                                                          // 283
				"students": this.userId                                                                                            // 283
			});                                                                                                                 // 283
			cursor.forEach(function (doc) {                                                                                     // 284
				for (var i = 0; i < doc.students.length; i++) {                                                                    // 285
					studentArray.push(doc.students[i]);                                                                               // 286
				}                                                                                                                  // 287
                                                                                                                       //
				for (var i = 0; i < doc.tutors.length; i++) {                                                                      // 288
					studentArray.push(doc.tutors[i]);                                                                                 // 289
				}                                                                                                                  // 290
			});                                                                                                                 // 291
			var result = studentArray.map(function (item) {                                                                     // 293
				return item.toString();                                                                                            // 294
			});                                                                                                                 // 295
			return Meteor.users.find({                                                                                          // 296
				_id: {                                                                                                             // 296
					$in: result                                                                                                       // 296
				}                                                                                                                  // 296
			}, {                                                                                                                // 296
				fields: {                                                                                                          // 296
					username: 1,                                                                                                      // 296
					'emails.address': 1,                                                                                              // 296
					profile: 1,                                                                                                       // 296
					groups: 1,                                                                                                        // 296
					organisation: 1,                                                                                                  // 296
					roles: 1                                                                                                          // 296
				}                                                                                                                  // 296
			});                                                                                                                 // 296
		}                                                                                                                    // 297
	}                                                                                                                     // 298
});                                                                                                                    // 299
Meteor.publish("User", function () {                                                                                   // 301
	return Meteor.users.find({                                                                                            // 302
		_id: this.userId                                                                                                     // 302
	});                                                                                                                   // 302
}); /**                                                                                                                // 303
    *	@summary: Publishes data from the 'userProgress' collection. Data should be published in the following way:      //
    *			- Admins can see all userProgress.                                                                             //
    *			- Moderators can see all progress by Users in their organisation.                                              //
    *			- Tutors can only see progress by Users in their group.                                                        //
    *			- Students can only see their own progress                                                                     //
    */                                                                                                                 //
Meteor.publish("userProgress", function () {                                                                           // 312
	// ADMIN                                                                                                              // 313
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 314
		return userProgress.find({}); // MODERATOR                                                                           // 315
	} else if (Roles.userIsInRole(this.userId, 'moderator')) {                                                            // 317
		var userDoc = Meteor.users.findOne({                                                                                 // 318
			_id: this.userId                                                                                                    // 318
		});                                                                                                                  // 318
		var userArray = [];                                                                                                  // 319
		userArray = Meteor.users.find({                                                                                      // 320
			"organisation": {                                                                                                   // 321
				$in: userDoc.organisation                                                                                          // 321
			}                                                                                                                   // 321
		}).map(function (user) {                                                                                             // 320
			return user._id;                                                                                                    // 323
		});                                                                                                                  // 324
		var result = userArray.map(function (item) {                                                                         // 325
			return item.toString();                                                                                             // 326
		});                                                                                                                  // 327
		return userProgress.find({                                                                                           // 328
			userId: {                                                                                                           // 328
				$in: result                                                                                                        // 328
			}                                                                                                                   // 328
		}); // TUTOR                                                                                                         // 328
	} else if (Roles.userIsInRole(this.userId, 'tutor')) {                                                                // 330
		var userDoc = Meteor.users.findOne({                                                                                 // 332
			_id: this.userId                                                                                                    // 332
		});                                                                                                                  // 332
		var userArray = [];                                                                                                  // 333
		userArray = Meteor.users.find({                                                                                      // 334
			"groups": {                                                                                                         // 335
				$in: userDoc.groups                                                                                                // 335
			}                                                                                                                   // 335
		}).map(function (user) {                                                                                             // 334
			return user._id;                                                                                                    // 337
		});                                                                                                                  // 338
		var result = userArray.map(function (item) {                                                                         // 339
			return item.toString();                                                                                             // 340
		});                                                                                                                  // 341
		return userProgress.find({                                                                                           // 342
			userId: {                                                                                                           // 342
				$in: result                                                                                                        // 342
			}                                                                                                                   // 342
		});                                                                                                                  // 342
	} else if (Roles.userIsInRole(this.userId, 'student')) {                                                              // 344
		return userProgress.find({                                                                                           // 345
			userId: this.userId                                                                                                 // 345
		});                                                                                                                  // 345
	}                                                                                                                     // 346
});                                                                                                                    // 347
Meteor.publish('singleUserProgress', function () {                                                                     // 349
	if (this.userId) {                                                                                                    // 350
		return userProgress.find({                                                                                           // 351
			userId: this.userId                                                                                                 // 351
		});                                                                                                                  // 351
	} else {                                                                                                              // 352
		return;                                                                                                              // 353
	}                                                                                                                     // 354
});                                                                                                                    // 355
Meteor.publish("studentAssessments", function () {                                                                     // 357
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 358
		return studentAssessments.find({});                                                                                  // 359
	} else if (Roles.userIsInRole(this.userId, 'moderator')) {                                                            // 360
		var userDoc = Meteor.users.findOne({                                                                                 // 361
			_id: this.userId                                                                                                    // 361
		});                                                                                                                  // 361
		var userArray = [];                                                                                                  // 362
		userArray = Meteor.users.find({                                                                                      // 363
			"organisation": {                                                                                                   // 364
				$in: userDoc.organisation                                                                                          // 364
			}                                                                                                                   // 364
		}).map(function (user) {                                                                                             // 363
			return user._id;                                                                                                    // 366
		});                                                                                                                  // 367
		var result = userArray.map(function (item) {                                                                         // 368
			return item.toString();                                                                                             // 369
		});                                                                                                                  // 370
		result.push(this.userId);                                                                                            // 371
		return studentAssessments.find({                                                                                     // 372
			userId: {                                                                                                           // 372
				$in: result                                                                                                        // 372
			}                                                                                                                   // 372
		});                                                                                                                  // 372
	} else if (Roles.userIsInRole(this.userId, 'tutor')) {                                                                // 373
		var studentArray = [];                                                                                               // 374
		var cursor = groups.find({                                                                                           // 375
			"tutors": this.userId                                                                                               // 375
		});                                                                                                                  // 375
		cursor.forEach(function (doc) {                                                                                      // 376
			for (var i = 0; i < doc.students.length; i++) {                                                                     // 377
				studentArray.push(doc.students[i]);                                                                                // 378
			}                                                                                                                   // 379
		});                                                                                                                  // 380
		studentArray.push(this.userId); // This line ensures Tutor can see his own assessments (if ever any).                // 381
                                                                                                                       //
		return studentAssessments.find({                                                                                     // 382
			userId: {                                                                                                           // 382
				$in: studentArray                                                                                                  // 382
			}                                                                                                                   // 382
		});                                                                                                                  // 382
	} else if (Roles.userIsInRole(this.userId, 'student')) {                                                              // 383
		return studentAssessments.find({                                                                                     // 384
			userId: this.userId                                                                                                 // 384
		});                                                                                                                  // 384
	}                                                                                                                     // 385
});                                                                                                                    // 386
Meteor.publish("f_forums", function () {                                                                               // 388
	var user = Meteor.users.findOne({                                                                                     // 390
		_id: this.userId                                                                                                     // 390
	});                                                                                                                   // 390
	var userOrg = user.organisation;                                                                                      // 391
	var userGroups = user.groups; // if admin                                                                             // 392
                                                                                                                       //
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 395
		return f_forums.find({});                                                                                            // 396
	} else if (Roles.userIsInRole(this.userId, 'tutor') || Roles.userIsInRole(this.userId, 'moderator')) {                // 397
		return f_forums.find({                                                                                               // 398
			"organisation": {                                                                                                   // 398
				$in: userOrg                                                                                                       // 398
			}                                                                                                                   // 398
		});                                                                                                                  // 398
	} else if (Roles.userIsInRole(this.userId, 'student')) {                                                              // 399
		return f_forums.find({                                                                                               // 400
			"organisation": {                                                                                                   // 400
				$in: userOrg                                                                                                       // 400
			}                                                                                                                   // 400
		});                                                                                                                  // 400
		11;                                                                                                                  // 401
	} else {                                                                                                              // 401
		return {};                                                                                                           // 402
	}                                                                                                                     // 403
});                                                                                                                    // 404
Meteor.publish("assessmentTypes", function () {                                                                        // 406
	return assessmentTypes.find({});                                                                                      // 407
});                                                                                                                    // 408
Meteor.publish("bug_reports", function () {                                                                            // 410
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 411
		return bug_reports.find({});                                                                                         // 412
	}                                                                                                                     // 413
});                                                                                                                    // 414
Meteor.publish("feedback_forms", function () {                                                                         // 416
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 417
		return feedback_forms.find({});                                                                                      // 418
	}                                                                                                                     // 419
});                                                                                                                    // 420
Meteor.publish("vouchers", function () {                                                                               // 422
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 423
		return vouchers.find({});                                                                                            // 424
	}                                                                                                                     // 425
});                                                                                                                    // 426
Meteor.publish("payment_plans", function () {                                                                          // 428
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 429
		return payment_plans.find({});                                                                                       // 430
	}                                                                                                                     // 431
});                                                                                                                    // 432
Meteor.publish("contact_form", function () {                                                                           // 434
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 435
		return contact_form.find({});                                                                                        // 436
	}                                                                                                                     // 437
});                                                                                                                    // 438
Meteor.publish("duration_log", function () {                                                                           // 440
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 441
		return duration_log.find({});                                                                                        // 442
	}                                                                                                                     // 443
});                                                                                                                    // 444
Meteor.publish("gameAccess", function () {                                                                             // 446
	var userId = this.userId;                                                                                             // 447
                                                                                                                       //
	if (Roles.userIsInRole(userId, 'admin')) {                                                                            // 448
		return gameAccess.find({});                                                                                          // 449
	} else {                                                                                                              // 450
		return gameAccess.find({                                                                                             // 451
			user: userId                                                                                                        // 451
		});                                                                                                                  // 451
	}                                                                                                                     // 452
});                                                                                                                    // 453
Meteor.publish("Announcements", function () {                                                                          // 455
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 456
		return Announcements.find({});                                                                                       // 457
	} else if (Roles.userIsInRole(this.userId, 'moderator') || Roles.userIsInRole(this.userId, 'tutor') || Roles.userIsInRole(this.userId, 'student')) {
		var org = Meteor.users.findOne({                                                                                     // 459
			_id: this.userId                                                                                                    // 459
		}).organisation;                                                                                                     // 459
		return Announcements.find({                                                                                          // 460
			organisation: {                                                                                                     // 460
				$in: org                                                                                                           // 460
			}                                                                                                                   // 460
		});                                                                                                                  // 460
	}                                                                                                                     // 461
                                                                                                                       //
	;                                                                                                                     // 461
});                                                                                                                    // 462
Meteor.publish("appliedVouchers", function () {                                                                        // 465
	if (Roles.userIsInRole(this.userId, 'admin')) {                                                                       // 466
		return appliedVouchers.find({});                                                                                     // 467
	}                                                                                                                     // 468
});                                                                                                                    // 469
Meteor.publish("Orglogos", function () {                                                                               // 471
	return Orglogos.find({});                                                                                             // 472
});                                                                                                                    // 473
Meteor.publish("LogoURLs", function () {                                                                               // 475
	return LogoURLs.find({});                                                                                             // 476
});                                                                                                                    // 477
Meteor.publish(null, function () {                                                                                     // 479
	return Meteor.roles.find({});                                                                                         // 480
});                                                                                                                    // 481
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"server.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/server.js                                                                                                    //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// (server-side)                                                                                                       // 1
Accounts.onCreateUser(function (options, user) {                                                                       // 2
    var email = options.email;                                                                                         // 4
                                                                                                                       //
    if (email.indexOf("@") < 0 || email.indexOf(".") < 0) {                                                            // 5
        //Invalid email address. Do not allow account creation.                                                        // 6
        throw new Meteor.Error('500', 'Error: Invalid Email Address. Please provide an email with the format "joe@company.com"');
    }                                                                                                                  // 8
                                                                                                                       //
    user.profile = options.profile;                                                                                    // 10
    user.groups = [];                                                                                                  // 11
    user.organisation = options.organisation;                                                                          // 12
    user.authorisedCourses = options.authorisedCourses;                                                                // 13
    user.expiry = options.expiry;                                                                                      // 14
    user.messages = options.messages;                                                                                  // 15
                                                                                                                       //
    if (options.scormId != null && options.scormId != "undefined") {                                                   // 16
        user.scormId = options.scormId;                                                                                // 17
    }                                                                                                                  // 18
                                                                                                                       //
    user.certificateEnabled = options.certificateEnabled; //user.confirmedEmail = options.confirmedEmail;              // 19
    // we wait for Meteor to create the user before sending an email                                                   // 22
    //Meteor.setTimeout(function() {                                                                                   // 23
    //  Accounts.sendVerificationEmail(user._id);                                                                      // 24
    //}, 2 * 1000);                                                                                                    // 25
                                                                                                                       //
    return user;                                                                                                       // 27
});                                                                                                                    // 29
Accounts.onLogin(function () {                                                                                         // 31
    var uId = Meteor.userId();                                                                                         // 32
    var expiryDate = Meteor.users.findOne({                                                                            // 33
        _id: uId                                                                                                       // 33
    }).expiry;                                                                                                         // 33
                                                                                                                       //
    if (expiryDate == undefined || expiryDate == "") {                                                                 // 35
        Meteor.users.update({                                                                                          // 36
            _id: uId                                                                                                   // 36
        }, {                                                                                                           // 36
            $set: {                                                                                                    // 36
                'expiredSubscription': false                                                                           // 36
            }                                                                                                          // 36
        });                                                                                                            // 36
        return;                                                                                                        // 37
    }                                                                                                                  // 38
                                                                                                                       //
    var expiryDate = moment(Meteor.user().expiry, "DD/MM/YYYY H:mm");                                                  // 40
    var nowDate = moment();                                                                                            // 41
                                                                                                                       //
    if (expiryDate > nowDate) {                                                                                        // 43
        // Not expired yet                                                                                             // 44
        Meteor.users.update({                                                                                          // 45
            _id: uId                                                                                                   // 45
        }, {                                                                                                           // 45
            $set: {                                                                                                    // 45
                'expiredSubscription': false                                                                           // 45
            }                                                                                                          // 45
        });                                                                                                            // 45
    } else {                                                                                                           // 47
        // Update field used by routes.js                                                                              // 48
        Meteor.users.update({                                                                                          // 49
            _id: uId                                                                                                   // 49
        }, {                                                                                                           // 49
            $set: {                                                                                                    // 49
                'expiredSubscription': true                                                                            // 49
            }                                                                                                          // 49
        }); // Log out user if expired                                                                                 // 49
        /*                                                                                                             // 51
            Meteor.setTimeout(function(){                                                                              //
              Meteor.users.update({_id : uId}, {$set: { "services.resume.loginTokens" : [] }});                        //
            },2000);                                                                                                   //
        */                                                                                                             //
    }                                                                                                                  // 56
});                                                                                                                    // 57
Accounts.onLoginFailure(function () {// to implement counts                                                            // 59
    // console.log('login failure');                                                                                   // 61
});                                                                                                                    // 62
audioRecordings.allow({                                                                                                // 65
    insert: function (userId, doc) {                                                                                   // 66
        if (userId) {                                                                                                  // 67
            return true;                                                                                               // 68
        }                                                                                                              // 69
    },                                                                                                                 // 70
    update: function () {                                                                                              // 71
        return true;                                                                                                   // 72
    },                                                                                                                 // 73
    remove: function () {                                                                                              // 74
        return true;                                                                                                   // 75
    },                                                                                                                 // 76
    download: function () {                                                                                            // 77
        return true;                                                                                                   // 78
    }                                                                                                                  // 79
});                                                                                                                    // 65
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"sitemaps.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/sitemaps.js                                                                                                  //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
sitemaps.add('/sitemap.xml', function () {                                                                             // 1
  return [{                                                                                                            // 2
    // Required.  http[s]://sitename.com automatically prepended */                                                    // 4
    page: '/',                                                                                                         // 5
    // Optional.  Timestamp of when the page was last modified.                                                        // 6
    lastmod: new Date(),                                                                                               // 7
    // or new Date().getTime()                                                                                         // 7
    // Optional.  always, hourly, daily, weekly, monthly, yearly, never                                                // 8
    // http://www.sitemaps.org/protocol.html#changefreqdef                                                             // 9
    changefreq: 'weekly',                                                                                              // 10
    // Optional.  http://www.sitemaps.org/protocol.html#prioritydef                                                    // 11
    priority: 0.5,                                                                                                     // 12
    // Optional.  https://support.google.com/webmasters/answer/2620865                                                 // 13
    // Again, the base URL is automatically prepended to the href key                                                  // 14
    // /!!!\ Ian: We should come back to this if we translate the home page                                            // 16
    // xHtmlLinks: [                                                                                                   // 18
    //   { ref: 'alternate', 'hreflang': 'en', 'href': 'en/blah' },                                                    // 19
    //   { ref: 'alternate', 'hreflang': 'de', 'href': 'de/blah' }                                                     // 20
    // ],                                                                                                              // 21
    // Optional.  https://support.google.com/webmasters/answer/2620865?hl=en                                           // 22
    // Again, the base URL is automatically prepended to the loc key                                                   // 23
    images: [{                                                                                                         // 24
      loc: '/landing/logo-journey.png',                                                                                // 26
      caption: "Journey 2 English Logo",                                                                               // 27
      title: "Journey 2 English Logo"                                                                                  // 28
    }, {                                                                                                               // 25
      loc: 'landing/logo-klik2learn.png',                                                                              // 31
      caption: "Klik2learn Logo",                                                                                      // 32
      title: "Klik2learn Logo" // ,{                                                                                   // 33
      //   loc: '/myOtherImg.jpg',                                                                                     // 36
      //   // Below properties are optional                                                                            // 37
      //   caption: "..",                                                                                              // 38
      //   geo_location: "..",                                                                                         // 39
      //   title: "..",                                                                                                // 40
      //   license: ".."                                                                                               // 41
      // }                                                                                                             // 42
                                                                                                                       //
    }],                                                                                                                // 30
    // Optional.  https://support.google.com/webmasters/answer/80472?hl=en                                             // 44
    // Again, the base URL is automatically prepended to loc, *_loc                                                    // 45
    videos: [{                                                                                                         // 46
      content_loc: 'https://do9d8j0j2sh3m.cloudfront.net/assets/journey2english/video/course.mp4',                     // 48
      thumbnail_loc: "https://do9d8j0j2sh3m.cloudfront.net/assets/journey2english/video/course.jpg",                   // 49
      title: "Why choose Journey 2 English",                                                                           // 50
      description: "Why choose Journey 2 English"                                                                      // 51
    }, {                                                                                                               // 47
      content_loc: 'https://do9d8j0j2sh3m.cloudfront.net/assets/journey2english/video/testimonials.mp4',               // 54
      thumbnail_loc: "https://do9d8j0j2sh3m.cloudfront.net/assets/journey2english/video/testimonials.jpg",             // 55
      title: "Journey 2 English Testimonials",                                                                         // 56
      description: "What people say about Journey 2 English" // ,{                                                     // 57
      //   loc: '/myOtherVideo.jpg',  // Below properties are optional                                                 // 60
      //   thumbnail_loc: "..",                                                                                        // 61
      //   title: "..",                                                                                                // 62
      //   description: "..",                                                                                          // 63
      //   etc: ".."                                                                                                   // 64
      // }                                                                                                             // 65
                                                                                                                       //
    }]                                                                                                                 // 53
  }];                                                                                                                  // 3
});                                                                                                                    // 69
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"startup.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server/startup.js                                                                                                   //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
var parseQuery = function (queryString) {                                                                              // 1
	var query = {};                                                                                                       // 2
	var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');                                // 3
                                                                                                                       //
	for (var i = 0; i < pairs.length; i++) {                                                                              // 4
		var pair = pairs[i].split('=');                                                                                      // 5
		query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');                                              // 6
	}                                                                                                                     // 7
                                                                                                                       //
	return query;                                                                                                         // 8
}; /**                                                                                                                 // 9
   * Code to run on server deployment.                                                                                 //
   */                                                                                                                  //
                                                                                                                       //
Meteor.startup(function (callback) {                                                                                   // 14
	// smtp = {                                                                                                           // 16
	// 	username: 'contact@klik2learn.com',   // eg: server@gentlenode.com                                                // 17
	// 	password: 'k2ladmin001',   // eg: 3eeP1gtizk5eziohfervU                                                           // 18
	// 	server: 'smtp.gmail.com',  // eg: mail.gandi.net                                                                  // 19
	// 	port: 587	// Changed from '25' to remove ECONNREFUSED error (9th Feb 2016)                                        // 20
	// };                                                                                                                 // 21
	//POST request handling example- not used                                                                             // 23
	/*WebApp.connectHandlers.use("/hubLogin", function(req, res, next) {                                                  // 25
 	var body = '';                                                                                                       //
                                                                                                                       //
        req.on('data', function (data) {                                                                               //
 		body += data.toString('utf-8');                                                                                     //
 		console.log(body);                                                                                                  //
            //1e6 === 1 * Math.pow(10, 6) === 1 * 1000000 ~~~ 1MB                                                      //
            if (body.length > 1e6) {                                                                                   //
                // FLOOD ATTACK OR FAULTY CLIENT, NUKE REQUEST                                                         //
                req.connection.destroy();                                                                              //
 		}                                                                                                                   //
 	});                                                                                                                  //
                                                                                                                       //
        req.on('end', function () {                                                                                    //
 		let qs = parseQuery(body);                                                                                          //
 		console.log(qs);                                                                                                    //
 		console.log("END");                                                                                                 //
 		let username = qs.username;                                                                                         //
 		let password = qs.parsword;                                                                                         //
                                                                                                                       //
 		if(username && password){                                                                                           //
 		}                                                                                                                   //
 	});                                                                                                                  //
 	next();                                                                                                              //
 	console.log("NEXT");                                                                                                 //
 });*/smtp = {                                                                                                         //
		username: "noreply@journey2english.com",                                                                             // 54
		password: "K2Ln0r3ply",                                                                                              // 55
		server: 'mail.hostedemail.com',                                                                                      // 56
		port: 587                                                                                                            // 57
	};                                                                                                                    // 53
	process.env.MAIL_URL = 'smtp://' + encodeURIComponent(smtp.username) + ':' + encodeURIComponent(smtp.password) + '@' + encodeURIComponent(smtp.server) + ':' + smtp.port;
	process.env.METEOR_WATCH_PRIORITIZE_CHANGED = false;                                                                  // 60
	Accounts.emailTemplates.siteName = "Journey2English";                                                                 // 62
	Accounts.emailTemplates.from = 'Journey2English <noreply@journey2english.com>';                                       // 63
                                                                                                                       //
	Accounts.emailTemplates.enrollAccount.subject = function (user) {                                                     // 64
		return "Welcome to Journey 2 English, " + user.profile.firstname;                                                    // 65
	};                                                                                                                    // 66
                                                                                                                       //
	Accounts.emailTemplates.enrollAccount.html = function (user, url) {                                                   // 68
		var email = null;                                                                                                    // 69
                                                                                                                       //
		if (user.organisation == null || user.organisation == 'undefined') {                                                 // 71
			throw new Meteor.Error('500', "Failed to create account. No Organisation provided.");                               // 72
		} else {                                                                                                             // 73
			var customEmail = customEmails.findOne({                                                                            // 74
				orgId: user.organisation[0]                                                                                        // 74
			});                                                                                                                 // 74
                                                                                                                       //
			if (customEmail != null && customEmail != 'undefined') {                                                            // 75
				email = customEmail.enrollmentEmail;                                                                               // 76
			}                                                                                                                   // 77
		}                                                                                                                    // 78
                                                                                                                       //
		var displayUsername;                                                                                                 // 80
                                                                                                                       //
		if (user.username == undefined) {                                                                                    // 81
			displayUsername = '';                                                                                               // 82
		} else {                                                                                                             // 83
			displayUsername = user.username;                                                                                    // 84
		} //[VERIFICATION_URL] - url                                                                                         // 85
		//[USERNAME] - username                                                                                              // 87
                                                                                                                       //
                                                                                                                       //
		if (email != null) {                                                                                                 // 88
			email = email.split('[VERIFICATION_URL]').join(url);                                                                // 89
			email = email.split('[USERNAME]').join(displayUsername);                                                            // 90
			return email;                                                                                                       // 91
		}                                                                                                                    // 92
                                                                                                                       //
		return '<table border=0 cellpadding=0 cellspacing=0 style=background-color:#edf4ff;border-width:0;max-width:640px;margin-left:auto;margin-right:auto;font-family:sans-serif;font-size:16px><tr><td style=margin:0;padding:0><img alt="Journey 2 English"src=http://www.klik2learn.com/wp-content/uploads/2016/07/email_jte_logo.jpg style=max-width:100%><tr><td style=margin:0;padding:1em><h1 style=color:#1e72ca;font-family:sans-serif;text-align:center;margin-bottom:1em>Welcome to <span style=display:inline-block>Journey 2 English</span></h1><p style=font-family:sans-serif;font-weight:700>Follow these steps to create your account:<ol style=font-weight:800;font-size:24px><li style=margin-bottom:40px><p style=font-weight:400;font-size:16px>Go to this link:<br><br><a href="' + url + '">' + url + '</a><br><br><i>(The course works in <img alt=Chrome src=http://www.klik2learn.com/wp-content/uploads/2016/10/chrome.png style=padding-left:3px;padding-right:1px height=15 width=15>Chrome, <img alt=Firefox src=http://www.klik2learn.com/wp-content/uploads/2016/10/firefox.png style=padding-left:3px;padding-right:1px height=15 width=15>Firefox, <img alt=Safari src=http://www.klik2learn.com/wp-content/uploads/2016/10/safari.png style=padding-left:3px;padding-right:1px height=15 width=15>Safari and <img alt=Edge src=http://www.klik2learn.com/wp-content/uploads/2016/10/edge.png style=padding-left:3px;padding-right:1px height=15 width=15>Edge on all devices)</i><li style=margin-bottom:40px><p style=font-weight:400;font-size:16px>Choose a password<p style=text-align:center><img alt="Choose a password"src=http://www.klik2learn.com/wp-content/uploads/2016/10/set-password.png style=max-width:100%;height:auto><li style=margin-bottom:40px><p style=font-weight:400;font-size:16px>Congratulations! You can now access the course.<li style=margin-bottom:40px><p style=font-weight:400;font-size:16px>You can sign in again at any time at <a href=https://journey2english.com>journey2english.com</a> using your email or username. Your username is <span style=font-family:monospace;background-color:#fff;display:inline-block;margin:2px;padding:3px>' + user.username + '</span></ol><p style=text-align:center>Good luck with your studies.<p style=text-align:center>The Klik2learn team<p style=text-align:center><a href=http://www.klik2learn.com><img alt=Klik2learn src=http://www.klik2learn.com/wp-content/uploads/2016/10/header-logo.png height=100 width=100></a></table>';
	};                                                                                                                    // 95
                                                                                                                       //
	Accounts.emailTemplates.verifyEmail.subject = function (user) {                                                       // 97
		return "Welcome to Journey 2 English, " + user.profile.firstname;                                                    // 98
	};                                                                                                                    // 99
                                                                                                                       //
	Accounts.emailTemplates.verifyEmail.html = function (user, url) {                                                     // 101
		var email = null;                                                                                                    // 102
                                                                                                                       //
		if (user.organisation == null || user.organisation == 'undefined') {                                                 // 104
			throw new Meteor.Error('500', "Failed to create account. No Organisation provided.");                               // 105
		} else {                                                                                                             // 106
			var customEmail = customEmails.findOne({                                                                            // 107
				orgId: user.organisation[0]                                                                                        // 107
			});                                                                                                                 // 107
                                                                                                                       //
			if (customEmail != null && customEmail != 'undefined') {                                                            // 108
				email = customEmail.verificationEmail;                                                                             // 109
			}                                                                                                                   // 110
		}                                                                                                                    // 111
                                                                                                                       //
		var displayUsername;                                                                                                 // 113
                                                                                                                       //
		if (user.username == undefined) {                                                                                    // 114
			displayUsername = '';                                                                                               // 115
		} else {                                                                                                             // 116
			displayUsername = user.username;                                                                                    // 117
		} //[VERIFICATION_URL] - url                                                                                         // 118
		//[USERNAME] - username                                                                                              // 121
                                                                                                                       //
                                                                                                                       //
		if (email != null) {                                                                                                 // 122
			email = email.split('[VERIFICATION_URL]').join(url);                                                                // 123
			email = email.split('[USERNAME]').join(displayUsername);                                                            // 124
			return email;                                                                                                       // 125
		}                                                                                                                    // 126
                                                                                                                       //
		return '<!DOCTYPE html> <html> <head> <title></title> </head> <body> <table border="0" cellpadding="0" cellspacing="0" style="background-color:#edf4ff;border-width:0;max-width:640px;margin-left:auto;margin-right:auto;font-family:sans-serif;font-size:16px"> <tr> <td style="margin:0;padding:0"><img alt="Journey 2 English" src="http://www.klik2learn.com/wp-content/uploads/2016/07/email_jte_logo.jpg" style="max-width:100%"></td> </tr> <tr> <td style="margin:0;padding:1em"> <h1 style="color:#1e72ca;font-family:sans-serif;text-align:center;margin-bottom:1em">Welcome to <span style="display:inline-block">Journey 2 English</span></h1> <p style="font-family:sans-serif;font-weight:700">You are almost there!</p> <ol style="font-weight:800;font-size:24px"> <li style="margin-bottom:40px"> <p style="font-weight:400;font-size:16px">Click this link to activate your account:<br> <br> <a href="' + url + '">' + url + '</a><br> <br> <i>(The course works in <img alt="Chrome" height="15" src="http://www.klik2learn.com/wp-content/uploads/2016/10/chrome.png" style="padding-left:3px;padding-right:1px" width="15">Chrome, <img alt="Firefox" height="15" src="http://www.klik2learn.com/wp-content/uploads/2016/10/firefox.png" style="padding-left:3px;padding-right:1px" width="15">Firefox, <img alt=Safari src=http://www.klik2learn.com/wp-content/uploads/2016/10/safari.png style=padding-left:3px;padding-right:1px height=15 width=15>Safari and <img alt="Edge" height="15" src="http://www.klik2learn.com/wp-content/uploads/2016/10/edge.png" style="padding-left:3px;padding-right:1px" width="15">Edge on all devices)</i></p> </li> <li style="margin-bottom:40px"> <p style="font-weight:400;font-size:16px">You can sign in again at any time at <a href="https://journey2english.com">journey2english.com</a> using your email or username. Your username is <span style="font-family:monospace;background-color:#fff;display:inline-block;margin:2px;padding:3px">' + user.username + '</span></p> </li> </ol> <p style="text-align:center">Good luck with your studies.</p> <p style="text-align:center">The Klik2learn team</p> <p style="text-align:center"><a href="http://www.klik2learn.com"><img alt="Klik2learn" height="100" src="http://www.klik2learn.com/wp-content/uploads/2016/10/header-logo.png" width="100"></a></p> </td> </tr> </table> </body> </html>';
	};                                                                                                                    // 129
                                                                                                                       //
	Accounts.config({                                                                                                     // 131
		// use 0.0000001, and not 0, to test immediate expiration                                                            // 132
		"passwordResetTokenExpirationInDays": 30                                                                             // 133
	});                                                                                                                   // 131
});                                                                                                                    // 135
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}},"templates.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// templates.js                                                                                                        //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
if (Meteor.isClient) {                                                                                                 // 1
  // counter starts at 0                                                                                               // 2
  Session.setDefault("counter", 0);                                                                                    // 3
                                                                                                                       //
  window.fbAsyncInit = function () {                                                                                   // 5
    FB.init({                                                                                                          // 6
      appId: '334914750233778',                                                                                        // 7
      status: true,                                                                                                    // 8
      xfbml: true,                                                                                                     // 9
      version: 'v2.8'                                                                                                  // 10
    });                                                                                                                // 6
  }; //console.log("METEOR CLIENT TEMPLATES.js");                                                                      // 12
                                                                                                                       //
                                                                                                                       //
  if (Meteor.isClient) {                                                                                               // 15
    //console.log("meteor is client");                                                                                 // 16
    Meteor.settings = {                                                                                                // 17
      "public": {                                                                                                      // 17
        "ga": {                                                                                                        // 17
          "id": "UA-144464149-2"                                                                                       // 17
        }                                                                                                              // 17
      }                                                                                                                // 17
    };                                                                                                                 // 17
  }                                                                                                                    // 18
}                                                                                                                      // 19
                                                                                                                       //
if (Meteor.isServer) {}                                                                                                // 21
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}},{
  "extensions": [
    ".js",
    ".json"
  ]
});
require("./server/meteor-methods/SCORM-API-Methods.js");
require("./server/meteor-methods/access-duration-log.js");
require("./server/meteor-methods/announcement-methods.js");
require("./server/meteor-methods/assessment-methods.js");
require("./server/meteor-methods/audio-recorder-methods.js");
require("./server/meteor-methods/bug-reports.js");
require("./server/meteor-methods/cg-badge-methods.js");
require("./server/meteor-methods/contact-form.js");
require("./server/meteor-methods/database-queries-methods.js");
require("./server/meteor-methods/dictionary-methods.js");
require("./server/meteor-methods/feedback-forms.js");
require("./server/meteor-methods/forums-methods.js");
require("./server/meteor-methods/group-methods.js");
require("./server/meteor-methods/hub_methods.js");
require("./server/meteor-methods/messaging-methods.js");
require("./server/meteor-methods/notebook-methods.js");
require("./server/meteor-methods/organisation-methods.js");
require("./server/meteor-methods/plan-methods.js");
require("./server/meteor-methods/stripe-charge-NOT-IN-USE.js");
require("./server/meteor-methods/user-account-methods.js");
require("./server/meteor-methods/voucher-methods.js");
require("./server/collections.js");
require("./server/mailchimp.js");
require("./server/publish.js");
require("./server/server.js");
require("./server/sitemaps.js");
require("./server/startup.js");
require("./templates.js");
//# sourceMappingURL=app.js.map
